<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=5819&start=30&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 07:05:25 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>DosTips.com &bull; Dos Batch Math Library - Page 3</title>

<link href="styles/AllanStyle-SUBSILVER/theme/print.css" rel="stylesheet">
</head>
<body id="phpbb">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>DosTips.com</h1>
		<p>A Forum all about DOS Batch<br /><a href="index-2.html">https://www.dostips.com/forum/</a></p>

		<h2>Dos Batch Math Library</h2>
		<p><a href="viewtopic8d84.html?f=3&amp;t=5819">https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=5819</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>3</strong> of <strong>4</strong></div>
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>17 Nov 2015 01:00</strong></div>
				<div class="author">by <strong>Aacini</strong></div>
				<div class="content"><blockquote><div><cite>penpen wrote:</cite>. . .<br /><br />Note:<br />I have not tested, if this algorithm computes always the correct result.<br />Some values within [0:2^31-1] may need more iterations.<br />Because of the starting value the number of iterations is not monotonically increasing anymore<br />(if i remember right then the original algorithm (initial x=N) needs a maximum of 19 iterations).<br /><br />But you should check this using c++/java/similar... batch is much too slow to check all numbers within [0:2^32-1];<br />my pc would take &gt;300 days, but it isn't the fastest... .<br /><br />penpen</div></blockquote><br /><br />Well, that is not really neccessary... The problems with these <em class="text-italics">iterative</em> methods appears at the limits of a range of results. For example, the Sqrt from 25 to 35 is 5, so it is enough to test the method with 25 and 35 to know that all values in this range will return the same result. This way, the test should be done on the square of a number and this value minus one for all numbers from 2 up to Sqrt(2^31-1), that is 46340. I wrote the program below to perform this test over both methods:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion<br /><br />for /F %%a in ('copy /Z &quot;%~F0&quot; NUL') do set &quot;CR=%%a&quot;<br /><br /><br />rem Aacini's method:<br />set &quot;Sqrt1(Num)=set /A &quot;M=(Num),sqrt=M/(11*1024)+40,sqrt=(M/sqrt+sqrt)/2&quot;&amp;(for /L %%i in (1,1,5) do set /A &quot;x2=(M/sqrt+sqrt)/2&quot;^&amp;if ^!x2^! leq ^!sqrt^! set /A sqrt=x2)&quot;<br />echo Aacini start @ %time%<br /><br />&lt; NUL (for /L %%n in (2,1,46340) do (<br /><br />&nbsp; &nbsp;set /P &quot;=%%n!CR!&quot;<br /><br />&nbsp; &nbsp;set /A &quot;Num2=%%n*%%n, Num2M1=Num2-1, NM1=%%n-1&quot;<br /><br />&nbsp; &nbsp;%Sqrt1(Num):Num=Num2M1%<br />&nbsp; &nbsp;if !sqrt! neq !NM1! echo Aacini failed on %%n- sqrt(!Num2M1!^) = !sqrt!<br />&nbsp; &nbsp;%Sqrt1(Num):Num=Num2%<br />&nbsp; &nbsp;if !sqrt! neq %%n echo Aacini failed on %%n- sqrt(!Num2!^) = !sqrt!<br /><br />))<br /><br />echo Aacini end&nbsp; &nbsp;@ %time%<br /><br /><br />echo =====================<br /><br /><br />rem penpen's method:<br />set &quot;Sqrt2(N)=( x=(N)/(11*1024)+40-^!(N)*9, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x+=(((N)-((x-1)*(x-1)+(x+x-1)))&gt;&gt;31))/(1+((N)&gt;&gt;31))&quot;<br />echo penpen start @ %time%<br /><br />&lt; NUL (for /L %%n in (2,1,46340) do (<br /><br />&nbsp; &nbsp;set /P &quot;=%%n!CR!&quot;<br /><br />&nbsp; &nbsp;set /A &quot;Num2=%%n*%%n, Num2M1=Num2-1, NM1=%%n-1&quot;<br /><br />&nbsp; &nbsp;set /A &quot;sqrt=!Sqrt2(N):N=Num2M1!&quot;<br />&nbsp; &nbsp;if !sqrt! neq !NM1! echo penpen failed on %%n- sqrt(!Num2M1!^) = !sqrt!<br />&nbsp; &nbsp;set /A &quot;sqrt=!Sqrt2(N):N=Num2!&quot;<br />&nbsp; &nbsp;if !sqrt! neq %%n echo penpen failed on %%n- sqrt(!Num2!^) = !sqrt!<br /><br />))<br /><br />echo penpen end&nbsp; &nbsp;@ %time%<br /></code></pre></div><br />Each test takes less than 5 minutes; this is the output:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Aacini start @ 23:50:44.84<br />Aacini end&nbsp; &nbsp;@ 23:55:04.78<br />=====================<br />penpen start @ 23:55:04.79<br />penpen end&nbsp; &nbsp;@ 23:57:23.93<br /></code></pre></div><br />My method is slower because it have a FOR command; I will try to eliminate it in order to speed up the method.<br /><br />Antonio</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>17 Nov 2015 12:21</strong></div>
				<div class="author">by <strong>Aacini</strong></div>
				<div class="content">Ok. I converted the FOR loop into a long expression; after that, I realized that the IF test may be performed just in the last iteration and the result is the same. I also slightly optimized the expression changing the division by 2 for a right shift.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion<br /><br />for /F %%a in ('copy /Z &quot;%~F0&quot; NUL') do set &quot;CR=%%a&quot;<br /><br />rem Aacini's method, converted into a long expression:<br />set &quot;Sqrt(N)=( M=(N),x=M/(11*1024)+40, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x2=(M/x+x)&gt;&gt;1,x+=-(x2-x-1&gt;&gt;31)*(x2-x) )&quot;<br /><br />echo Aacini2 start @ %time%<br /><br />&lt; NUL (for /L %%n in (2,1,46340) do (<br /><br />&nbsp; &nbsp;set /P &quot;=%%n!CR!&quot;<br /><br />&nbsp; &nbsp;set /A &quot;Num2=%%n*%%n, Num2M1=Num2-1, NM1=%%n-1&quot;<br /><br />&nbsp; &nbsp;set /A &quot;sqrt=%Sqrt(N):N=Num2M1%&quot;<br />&nbsp; &nbsp;if !sqrt! neq !NM1! echo Aacini failed on %%n- sqrt(!Num2M1!^) = !sqrt!<br />&nbsp; &nbsp;set /A &quot;sqrt=%Sqrt(N):N=Num2%&quot;<br />&nbsp; &nbsp;if !sqrt! neq %%n echo Aacini failed on %%n- sqrt(!Num2!^) = !sqrt!<br /><br />))<br /><br />echo Aacini2 end&nbsp; &nbsp;@ %time%<br /></code></pre></div><br />This is the output:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Aacini2 start @ 11:50:33.11<br />Aacini2 end&nbsp; &nbsp;@ 11:52:53.84<br /></code></pre></div><br /><br />The timing in the original FOR-loop method was 4:19.94 minutes but this one takes just 2:20.73 minutes, practically the same than penpen's version that was 2:19.14 minutes.<br /><br />Antonio</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>17 Nov 2015 12:34</strong></div>
				<div class="author">by <strong>Squashman</strong></div>
				<div class="content">56 seconds on my 7 year old Duo Core.  My gosh.  How old are the computers you guys are using?</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>17 Nov 2015 15:55</strong></div>
				<div class="author">by <strong>einstein1969</strong></div>
				<div class="content">@Aacini<br /><blockquote class="uncited"><div>Yes. Your method fails with numbers as less as 35 or 48. The method iterates on a series of values and in each step it must produce a value less or equal than the previous one, so the method may fail when a next value is greater. I inserted the required IF command, but then realized that the test must not be applied to the first value. I inserted the test from the second value on and cut the loop to 4 cycles, but then realized that in certain cases the result was wrong and it requires an additional step. This means that it needs a total of 6 cycles.<br /></div></blockquote><br />Thanks, now it clear. Don't worry for the 6 iterations... We optimize later when all work.<br /><br />@penpen<br /><blockquote class="uncited"><div>So in your algorithm (using int calculus) you could test if (N-x*x) is greater than or equal to 0;<br />if this is true then sqrt(N)=x, else sqrt(N)=x-1.<br /></div></blockquote><br />It's the same solution proposed by AAcini?<br /><br /><blockquote class="uncited"><div>set &quot;Sqrt(N)=( x=(N)/(11*1024)+40-^!(N)*9, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x+=(((N)-((x-1)*(x-1)+(x+x-1)))&gt;&gt;31))/(1+((N)&gt;&gt;31))&quot;<br /></div></blockquote><br />where end the ) of the block of separator &quot;,&quot; ?<br /><br />Thanks for this solution!<br /><br />@Aacini<br />Very nice the Test. I like it!!!<br />This is necessary.<br /><blockquote class="uncited"><div>set &quot;Sqrt(N)=( M=(N),x=M/(11*1024)+40, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x2=(M/x+x)&gt;&gt;1,x+=-(x2-x-1&gt;&gt;31)*(x2-x) )&quot;<br /></div></blockquote><br />In this moment I don't undestand the difference with penpen method...<br />I will study better.<br /><br />@Squashman<br />For better test empty the environment.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>for /f &quot;delims==&quot; %%v in ('set') do set &quot;%%v=&quot;<br /></code></pre></div><br />If there are open applications the time is very different. I have closed and paused the applications that used more CPU.<br />On my celeron @2.00Ghz (The only pc live <img class="smilies" src="images/smilies/icon_sad.gif" alt=":(" title="Sad" /> and this is a present... The money are finished <img class="smilies" src="images/smilies/icon_sad.gif" alt=":(" title="Sad" /> ) take 19 second with empty environment e ReM the set/P<br /><br />EDIT:<br />Not bad for about 90000 sqrt's<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Aacini2 start @ 22:48:12,25<br />Aacini2 end&nbsp; &nbsp;@ 22:48:31,13<br /></code></pre></div><br /><br /><br />Einstein1969</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>17 Nov 2015 18:34</strong></div>
				<div class="author">by <strong>penpen</strong></div>
				<div class="content"><blockquote><div><cite>einstein1969 wrote:</cite>@penpen<br /><blockquote class="uncited"><div>So in your algorithm (using int calculus) you could test if (N-x*x) is greater than or equal to 0;<br />if this is true then sqrt(N)=x, else sqrt(N)=x-1.<br /></div></blockquote><br />It's the same solution proposed by AAcini?</div></blockquote>I think this is not the case, but i might have missed it:<br />As far as i understand Aacini's algorithm, it performs 6 iterations and chooses the minimal one of the last 2 iterations.<br />My algorithm performs 5 iterations, and then checks if (N &gt; x*x) and then returns x, else it returns (x-1).<br />(The last step equals one iteration if needed, because in this case (signed int 32 bit) ||x-N/x||&lt;=2.)<br /><br /><blockquote><div><cite>einstein1969 wrote:</cite><blockquote class="uncited"><div>set &quot;Sqrt(N)=( x=(N)/(11*1024)+40-^!(N)*9, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x+=(((N)-((x-1)*(x-1)+(x+x-1)))&gt;&gt;31))/(1+((N)&gt;&gt;31))&quot;<br /></div></blockquote><br />where end the ) of the block of separator &quot;,&quot; ?<br /></div></blockquote>It is hard to see, and it simply was a flaw (it was late when i wrote it):<br />set &quot;Sqrt(N)=<span style="color: #FF0000">(</span> x=(N)/(11*1024)+40-^!(N)*9, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x+=(((N)-((x-1)*(x-1)+(x+x-1)))&gt;&gt;31)<span style="color: #FF0000">)</span>/(1+((N)&gt;&gt;31))&quot;<br /><br />If you want, then you could place this <span style="color: #FF0000">)</span> to the end of the formula.<br /><br /><br />penpen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>17 Nov 2015 19:21</strong></div>
				<div class="author">by <strong>Squashman</strong></div>
				<div class="content"><blockquote><div><cite>Squashman wrote:</cite>56 seconds on my 7 year old Duo Core.  My gosh.  How old are the computers you guys are using?</div></blockquote><br />27 seconds on my Quad Core at home.  My Duo Core is the piece of crap that work gave me when I needed a laptop for a new job.  I went from a quad core I5 desktop at work to a old shitty Duo Core.  I told my boss that I would not take the job unless he gave me a laptop the same speed.  Should of had that written into my contract.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>17 Nov 2015 21:43</strong></div>
				<div class="author">by <strong>Aacini</strong></div>
				<div class="content">This is an excellent example of the reasons because I always give great importance to clear descriptions.<br /><br />First penpen's explanation was a mathematical one. When I saw it I have not much spare time, so I postponed a more detailed study of it for later. However, the phrase in his last explanation is crystal clear: &quot;My algorithm performs 5 iterations, and then checks if (N &gt; x*x) and then returns x, else it returns (x-1)&quot;. I modified my last code using this description; the result is a method 11% faster:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion<br /><br />for /F %%a in ('copy /Z &quot;%~F0&quot; NUL') do set &quot;CR=%%a&quot;<br /><br />rem Aacini's method, optimized using this penpen's description:<br />rem &quot;Perform 5 iterations; if x*x &gt; N decrement x by 1&quot;<br />set &quot;Sqrt(N)=( M=(N),x=M/(11*1024)+40, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x+=(M-x*x)&gt;&gt;31 )&quot;<br /><br />echo Aacini3 start @ %time%<br /><br />&lt; NUL (for /L %%n in (2,1,46340) do (<br /><br />&nbsp; &nbsp;set /P &quot;=%%n!CR!&quot;<br /><br />&nbsp; &nbsp;set /A &quot;Num2=%%n*%%n, Num2M1=Num2-1, NM1=%%n-1&quot;<br /><br />&nbsp; &nbsp;set /A &quot;sqrt=%Sqrt(N):N=Num2M1%&quot;<br />&nbsp; &nbsp;if !sqrt! neq !NM1! echo Aacini failed on %%n- sqrt(!Num2M1!^) = !sqrt!<br />&nbsp; &nbsp;set /A &quot;sqrt=%Sqrt(N):N=Num2%&quot;<br />&nbsp; &nbsp;if !sqrt! neq %%n echo Aacini failed on %%n- sqrt(!Num2!^) = !sqrt!<br /><br />))<br /><br />echo Aacini3 end&nbsp; &nbsp;@ %time%<br /></code></pre></div><br />Output:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Aacini3 start @ 21:21:31.41<br />Aacini3 end&nbsp; &nbsp;@ 21:23:36.12<br /><br />= 2:04.71 minutes<br /></code></pre></div><br />@Squashman: My computer is not an old one, but a <em class="text-italics">very</em> cheap one! <img class="smilies" src="images/smilies/icon_sad.gif" alt=":(" title="Sad" /> <br /><br />Antonio</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>18 Nov 2015 07:51</strong></div>
				<div class="author">by <strong>Squashman</strong></div>
				<div class="content"><blockquote><div><cite>Aacini wrote:</cite> the result is a method 11% faster:<br /></div></blockquote><br />Yep! Went down to 46 seconds on my Duo Core.  Ten seconds faster!</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>18 Nov 2015 08:48</strong></div>
				<div class="author">by <strong>Ed Dyreen</strong></div>
				<div class="content"><blockquote><div><cite>Squashman wrote:</cite>56 seconds on my 7 year old Duo Core.  My gosh.  How old are the computers you guys are using?<br /></div></blockquote>My virtual Machine is currently running on a dual socket hyper threading Xeon server of about 10 years old that I bought for 30€.<br /><br />I am planning to upgrade it to a quad socket single core Xeon Server with 3PSU's of 400 watts and room for 16 DRR1 slots and room for 16 scsi drives of about 12 years old that I bought for 50€.<br /><br />That's older than my nefue cuz he's only 7 <img class="smilies" src="images/smilies/icon_mrgreen.gif" alt=":mrgreen:" title="Mr. Green" /><br /><br />I am not a fan of single sockets no matter how many cores as their speed is always limited to the bandwidth of a single socket and that means sharing the limited bandwidth of a single socket between cores, no thanks. Due to the separate pipelines a multi socket can access the memory simultaneously as long as they are not both trying to write to the same address, can't do that with a single socket.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>18 Nov 2015 08:53</strong></div>
				<div class="author">by <strong>penpen</strong></div>
				<div class="content">I didn't use &quot;N-x*x&quot;, but &quot;N-(x-1)*(x-1)-2*x+1&quot; because i suspected the first term to fail for x&gt;46340:<br />I obviously was wrong on that part.<br /><br />Note that i have added the term &quot;/(1+((N)&gt;&gt;31))&quot; to guard against negative N values.<br />The most speed you gained would be lost if you add it (again; which i'm in favour of).<br /><br /><br />penpen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>18 Nov 2015 12:06</strong></div>
				<div class="author">by <strong>einstein1969</strong></div>
				<div class="content">Another problem on percent expand. I probed to undenstand but i don't have good basic  <img class="smilies" src="images/smilies/icon_confused.gif" alt=":?" title="Confused" /> <br />Why?<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion<br /><br />rem Aacini<br />rem As far as i understand Aacini's algorithm, it performs 6 iterations and chooses the minimal one of the last 2 iterations.<br />set &quot;Sqrt1(N)=( M=(N),x=M/(11*1024)+40, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x2=(M/x+x)&gt;&gt;1,x+=-(x2-x-1&gt;&gt;31)*(x2-x) )&quot;<br /><br /><br />rem penpen<br />rem My algorithm performs 5 iterations, and then checks if (N &gt; x*x) and then returns x, else it returns (x-1).<br />Rem (The last step equals one iteration if needed, because in this case (signed int 32 bit) ||x-N/x||&lt;=2.)<br /><br />set &quot;Sqrt2(N)=( x=(N)/(11*1024)+40-^!(N)*9, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x+=(((N)-((x-1)*(x-1)+(x+x-1)))&gt;&gt;31))/(1+((N)&gt;&gt;31))&quot;<br /><br /><br />(<br />&nbsp; set /A &quot;sqrt1=%Sqrt1(N):N=36%&quot;<br />)<br />(<br />&nbsp; set /A &quot;sqrt2=%Sqrt2(N):N=36%&quot;<br />)<br />echo %sqrt1% %sqrt2%<br />pause<br /></code></pre></div><br />result:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>6 -11<br /></code></pre></div><br /><br />einstein1969</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>18 Nov 2015 13:09</strong></div>
				<div class="author">by <strong>penpen</strong></div>
				<div class="content">The delayed expansion is enabled, so this is the expansion:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:: source %Sqrt2(N):N=36%<br />:: initial term<br />x=(N)/(11*1024)+40-^!(N)*9<br />:: %-expansion<br />x=(36)/(11*1024)+40-!(36)*9<br />:: !-expansion<br />x=(36)/(11*1024)+40-(36)*9<br />:: computes to<br />x=-284<br /></code></pre></div><br />The exclamation mark should have been used as the not operator:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:: source !Sqrt2(N):N=36!<br />:: initial term<br />x=(N)/(11*1024)+40-^!(N)*9<br />:: no %-expansion<br />:: !-expansion<br />x=(36)/(11*1024)+40-!(36)*9<br />:: computes to<br />x=40<br /></code></pre></div><br />Note: Aacini has demonstrated that the &quot;-^!(N)*9&quot; part isn't neccessary anymore.<br /><br /><br />penpen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>18 Nov 2015 13:24</strong></div>
				<div class="author">by <strong>einstein1969</strong></div>
				<div class="content">Ok. This is second step for optimizing the sqrt.<br /><br />I developed few days ago and there is the precedent problem of oscillating series of Newton. I have not applicated the solution of penpen and Aacini for the moment.<br /><br />What is the question that i raise?<br /><br />When perform a sqrt the integer/integral part is performed by the precedent developed code <strong class="text-strong">Integer 32 BIT SQRT</strong>. But for normal application is necessary some time the fractional part.<br /><br />In the previus developed code I, dbenham and trebor68 have used the classic schoolar algorithm with good result in term of precision and velocity, but I go down for a <strong class="text-strong">very fast solution</strong>. In this mode the <strong class="text-strong">32bit</strong> of the result can be full of the fractional part.<br /><br />In this i need your help.<br /><br />I introduce a my understud of <strong class="text-strong">FIXED POINT</strong> mathematic.<br /><br />For example the SQRT result can be of the type <strong class="text-strong">5.4</strong>. 5 integral digit plus 4 fractional digit.<br />And the result can be stored in TWO variables or in the same variable at BIT/DECIMAL position different.<br /><br />This is an example of start to compute a sqrt with fractional part using the INTEGER 32bit Sqrt<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion<br /><br />Rem Fixed Point<br />Rem If you have a fractional number, than precalc multiply by EVEN power of 10.<br />Rem es. SQRT(1.2)=SQRT(1.2*100)/10=SQRT(120)/10<br /><br />rem define sqrt<br />set &quot;Sqrt(N)=( x=(N)/(11*1024)+40-^!N*9, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x/=(1+((N)&gt;&gt;31)))&quot;<br /><br />rem es. sqrt 25 with 1 decimal<br />set /A &quot;num=!Sqrt(N):N=25*100!&quot;<br />echo Sqrt(25.0)=%num:~0,-1%.%num:~-1% &amp; echo(<br /><br />rem es. sqrt 28.0<br />set /A &quot;num=!Sqrt(N):N=28*100!&quot;<br />echo Sqrt(28.0)=%num:~0,-1%.%num:~-1% &amp; echo(<br /><br />rem es sqrt 2.0000 (with 4 decimal)<br />set /A &quot;num=!Sqrt(N):N=2*100*100*100*100!&quot;<br />echo Sqrt(2.0000)=%num:~0,-4%.%num:~-4% &amp; echo(<br /></code></pre></div><br />result:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Sqrt(25.0)=5.0<br /><br />Sqrt(28.0)=5.2<br /><br />Sqrt(2.0000)=1.4142<br /></code></pre></div><br /><br />This is limitated because the 32BIT. And the max number of digit rappresentable is 123.4567890 or 12345678.90 and all other combination. EDIT: (my flame:THIS is not TRUE)<br /><br />The best method is get the REMAINDER and continue from there.<br /><br />I have developed in this direction. I get the <strong class="text-strong">integer result</strong> of sqrt and the <strong class="text-strong">Remainder<br /></strong> and I have probed to applicate the Newton iteration!  <img class="smilies" src="images/smilies/icon_cool.gif" alt="8)" title="Cool" /> <br /><br />I introduce the simple mathematic (I'm not an expert...)<br />You can see this example on <a href="http://stackoverflow.com/questions/8894360/finding-square-root-as-float-from-int-and-remainder#" class="postlink">StackOverflow</a> But there isn't the Newton implementation. I done<br /><br />Call the integer sqrt &quot;ISQRT&quot; and &quot;SQRT&quot; is the real/floating point.<br /><br />ISQRT(140)=11<br /><br />140=11^2+19      (19 is the REMAINDER = N-ISQRT(N)*ISQRT(N))  [1]<br /><br />The SQRT(140) = 11,832 that is (11+0.832)<br /><br />that is (11+0.832)^2=140  [2]<br /><br />we need found 0.832 and then rewrite the [2]:<br /><br />(11+x)^2=140<br /><br />expand this : 11^2+2*11*x+x^2=140<br /><br />but if we get the [1] we see that  2*11*x+x^2=19<br /><br />With a guess of 0.5 (0&lt;x&lt;1) iterating via newton we get the fractional part in about <strong class="text-strong">3 iteration</strong>.<br /><br />That is:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code><br />set &quot;Sqrt(N)=( x=(N)/(11*1024)+40-^!N*9, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, x=((N)/x+x)/2, Sqrt_Remai_der=(N)-x*x, x=x )&quot;<br /><br /><br />rem approx via newton<br />rem es. sqrt of 60000<br />set /A &quot;num=!Sqrt(N):N=60000!&quot;<br />echo Sqrt(60000)=%num% Remainder=%Sqrt_Remai_der% &amp; echo(<br /><br />echo 2*%num%*x+x*x-%Sqrt_Remai_der%=0<br />rem set /A approx=0.5-(0.25+2*num/2-Sqrt_Remai_der)/(2*0.5+2*num) &amp; rem guess=0.5<br />rem set /A approx=0.5*1000-(0.25*1000+2*num/2*1000-Sqrt_Remai_der*1000)/(2*0.5+2*num) &amp; rem guess=0.5<br />set /A approx=500-(250+2*num/2*1000-Sqrt_Remai_der*1000)/(1+2*num)<br />For /L %%I in (1,1,2) do set /A approx=approx-(approx*approx/1000+2*num*approx-Sqrt_Remai_der*1000)*1/(2*approx/1000+2*num)<br />echo Sqrt(60000)=%num%.%approx%&nbsp; approx.&nbsp; (244.948...) &amp; echo(<br /><br />rem es. sqrt of 2<br />set /A &quot;num=!Sqrt(N):N=2!&quot;<br />echo Sqrt(2)=%num% Remainder=%Sqrt_Remai_der% &amp; echo(<br /><br />echo 2*%num%*x+x*x-%Sqrt_Remai_der%=0<br />set /A approx=500-(250+2*num/2*1000-Sqrt_Remai_der*1000)/(1+2*num)<br />For /L %%I in (1,1,2) do set /A approx=approx-(approx*approx/1000+2*num*approx-Sqrt_Remai_der*1000)*1/(2*approx/1000+2*num)<br />echo Sqrt(2)=%num%.%approx%&nbsp; &nbsp; (1.414...) &amp; echo(<br /><br />rem es. sqrt of 3<br />set /A &quot;num=!Sqrt(N):N=3!&quot;<br />echo Sqrt(3)=%num% Remainder=%Sqrt_Remai_der% &amp; echo(<br /><br />echo 2*%num%*x+x*x-%Sqrt_Remai_der%=0<br />set /A approx=500-(250+2*num/2*1000-Sqrt_Remai_der*1000)/(1+2*num)<br />For /L %%I in (1,1,2) do set /A approx=approx-(approx*approx/1000+2*num*approx-Sqrt_Remai_der*1000)*1/(2*approx/1000+2*num)<br />echo Sqrt(3)=%num%.%approx%&nbsp; &nbsp; (1.732...) &amp; echo(<br /><br />rem es. sqrt of 2147483647<br />set /A &quot;num=!Sqrt(N):N=2147483647!&quot;<br />echo Sqrt(2147483647)=%num% Remainder=%Sqrt_Remai_der% &amp; echo(<br /><br />echo 2*%num%*x+x*x-%Sqrt_Remai_der%=0<br />set /A approx=500-(250+2*num/2*1000-Sqrt_Remai_der*1000)/(1+2*num)<br />For /L %%I in (1,1,2) do set /A approx=approx-(approx*approx/1000+2*num*approx-Sqrt_Remai_der*1000)*1/(2*approx/1000+2*num)<br />echo Sqrt(2147483647)=%num%.%approx%&nbsp; &nbsp; (46340.950...) &amp; echo(<br /><br />rem es. sqrt of 65535<br />set /A &quot;num=!Sqrt(N):N=65535!&quot;<br />echo Sqrt(65535)=%num% Remainder=%Sqrt_Remai_der% &amp; echo(<br /><br />echo 2*%num%*x+x*x-%Sqrt_Remai_der%=0<br />set /A approx=500-(250+2*num/2*1000-Sqrt_Remai_der*1000)/(1+2*num)<br />For /L %%I in (1,1,2) do set /A approx=approx-(approx*approx/1000+2*num*approx-Sqrt_Remai_der*1000)*1/(2*approx/1000+2*num)<br />echo Sqrt(65535)=%num%.%approx%&nbsp; &nbsp; (255.998...) &amp; echo(<br /><br />Rem Patching<br /></code></pre></div><br /><br />And we get the error at 65535 with the <strong class="text-strong">REMAINDER=-1</strong><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Sqrt(2)=1 Remainder=1<br /><br />2*1*x+x*x-1=0<br />Sqrt(2)=1.414&nbsp; &nbsp; (1.414...)<br /><br />Sqrt(3)=1 Remainder=2<br /><br />2*1*x+x*x-2=0<br />Sqrt(3)=1.732&nbsp; &nbsp; (1.732...)<br /><br />Sqrt(2147483647)=46340 Remainder=88047<br /><br />2*46340*x+x*x-88047=0<br />Sqrt(2147483647)=46340.950&nbsp; &nbsp; (46340.950...)<br /><br />Sqrt(65535)=256 Remainder=-1<br /><br />2*256*x+x*x--1=0<br />Sqrt(65535)=256.-1&nbsp; &nbsp; (255.998...)</code></pre></div><br /><br /><br />I have not patched at the moment. I need a confirm by you if the error is the same<br /><br />@penpen<br />I can't understund how to patch the ! problem in the percent expansion... I will go down the iteration from 5 to 4 or 3<br /><br />EDIT: added the definition of ISQRT with remainder. Not optimized.<br />EDIT2: correct explain on ISQRT(140)<br /><br />Einstein1969</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>18 Nov 2015 14:03</strong></div>
				<div class="author">by <strong>Ed Dyreen</strong></div>
				<div class="content"><blockquote><div><cite>penpen wrote:</cite>The exclamation mark should have been used as the not operator:<br /></div></blockquote>Bizarre, it is missing from the set /? help. from a simple test I assume that ! only executes if the operand NEQ the operated<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\profSys\ADMIN&gt;set /a x=(36)-(35)<br />1<br />C:\profSys\ADMIN&gt;set /a x=(36)-!(35)<br />36<br /></code></pre></div>Is this a correct interpretation and why is it not listed under set /? while the operator &amp; clearly is ??</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>18 Nov 2015 15:15</strong></div>
				<div class="author">by <strong>penpen</strong></div>
				<div class="content"><blockquote><div><cite>einstein1969 wrote:</cite>@penpen<br />I can't understund how to patch the ! problem in the percent expansion... I will go down the iteration from 5 to 4 or 3</div></blockquote>If you want to create a function, that works with both &quot;%&quot;-expansion and &quot;!&quot;-expansion, then i think:<br />This is impossible.<br /><br />You would have to escape the exclamation mark &quot;^^^!&quot; if you want the correct result using &quot;%sqrt2(N):N=36%&quot;;<br />but then you lose the correct function of &quot;!sqrt2(N):N=36!&quot; because the tilde character is interpreted as XOR.<br /><br /><br />Sidenote:<br />If you want an sqrt with as many decimal digits as possible, you should use another algorithm.<br />I cannot remember the name, but maybe i could find a link.<br />(This algorithm probably is slower, but computes a digit every iteration.)<br /><br /><blockquote><div><cite>Ed Dyreen wrote:</cite>Bizarre, it is missing from the set /? help.</div></blockquote>It is present (but not explained) in the <a href="https://technet.microsoft.com/de-de/library/cc754250(v=ws.10).aspx" class="postlink">technet page</a> listed as unary operator:<br />If N equals 0 then !N equals 1, else 0.<br /><br /><br />penpen</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="UTC-6">UTC-06:00</span><br />Page <strong>3</strong> of <strong>4</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Limited<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=5819&start=30&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 07:05:25 GMT -->
</html>
