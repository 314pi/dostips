<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=2836&start=15&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:20:54 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>DosTips.com &bull; foolproof counting of arguments - Page 2</title>

<link href="styles/AllanStyle-SUBSILVER/theme/print.css" rel="stylesheet">
</head>
<body id="phpbb">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>DosTips.com</h1>
		<p>A Forum all about DOS Batch<br /><a href="index-2.html">https://www.dostips.com/forum/</a></p>

		<h2>foolproof counting of arguments</h2>
		<p><a href="viewtopic9303.html?f=3&amp;t=2836">https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=2836</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>2</strong> of <strong>4</strong></div>
					<div class="post">
				<h3>Re: foolproof counting of arguments</h3>
				<div class="date">Posted: <strong>24 Jan 2012 13:28</strong></div>
				<div class="author">by <strong>Liviu</strong></div>
				<div class="content">Yet another variation on the same theme... The code below collects all parameters in a temp file, with the stop condition based on the size of the file. Then, it reads the file back in one shot.<br /><br />EDIT: code below has changed vs. the one posted earlier today. At the time I edited, there were no followups, so I hope no one minds too much. More details at the bottom.<br /><br />2nd EDIT: nested the &quot;do rem&quot; parts inside a &quot;setlocal disableextensions&quot; block to protect against accidental expansion of %~a %~dpa etc.<br /><br />Note that the enclosing (...) is still evaluated at the outer level with extensions enabled, which allows %* to work correctly, but the for loop executes with extensions disabled so %~a, %~dpa etc are no longer expanded.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal disableDelayedExpansion<br />set &quot;tab=&nbsp; &nbsp;&quot;<br /><br />:: can't call with wacky %%*<br />:: must goto and rely on hardcoded return to :main<br />::<br />:: upon return, the following variables are set<br />::&nbsp; &nbsp;args is the complete command line<br />::&nbsp; &nbsp;argc is the number of arguments<br />::&nbsp; &nbsp;arg1, arg2, etc are the individual arguments<br />::&nbsp; &nbsp;argsLen, arg1len, arg2len etc are the respective string lengths<br />:: inside a nested setlocal enableDelayedExpansion<br />::<br />goto :getArgs<br /><br />:: body of actual code would go under :main below<br />::<br />:main<br /><br />echo.<br />echo ---- copied from %%? ----<br />echo.<br />echo args %tab% %tab%{ !args! }<br />for /l %%n in (1, 1, %argc%) do (<br />&nbsp; echo arg%%n %tab% %tab%{ !arg%%n! }<br />)<br /><br />:: this part is only needed to get the original cmd line offsets<br />:: e.g. in order to preserve whitespace with !args:~%arg2off%!<br />::<br />:: requires the args, argc, arg?len variables be set by :getArgs<br />:: sets arg?off upon return to the offset of arg? within args<br />::<br />call :getOffs<br /><br />:: only uses arg1, arg2 etc for verification<br />::<br />echo.<br />echo ---- chopped off %%* ----<br />echo.<br />@rem entire command line<br />echo args %tab%~0,%argsLen% %tab%{ !args! }<br />set /a delimOff = 0<br />for /l %%n in (1, 1, %argc%) do (<br />&nbsp; @rem whitespace before %%n'th argument<br />&nbsp; set /a delimLen = !arg%%noff! - !delimOff!<br />&nbsp; for /f &quot;tokens=1*&quot; %%p in (&quot;!delimOff! !delimLen!&quot;) do (<br />&nbsp; &nbsp; echo %tab%~!delimOff!,!delimLen! %tab%{ !args:~%%p,%%q! }<br />&nbsp; )<br />&nbsp; set /a delimOff = !arg%%noff! + !arg%%nLen!<br />&nbsp; @rem %%n'th argument<br />&nbsp; for /f &quot;tokens=1*&quot; %%p in (&quot;!arg%%noff! !arg%%nlen!&quot;) do (<br />&nbsp; &nbsp; echo arg%%n %tab%~!arg%%noff!,!arg%%nlen! %tab%{ !args:~%%p,%%q! }<br />&nbsp; &nbsp; @rem reality check<br />&nbsp; &nbsp; if not &quot;!args:~%%p,%%q!&quot;==&quot;!arg%%n!&quot; (<br />&nbsp; &nbsp; &nbsp; echo arg%%n ??? %tab%{ !args:~%%p,%%q! } ^^!= { !arg%%n! } 1&gt;&amp;2<br />&nbsp; &nbsp; )<br />&nbsp; )<br />)<br />set /a delimLen = !argsLen! - !delimOff!<br />if defined args (<br />&nbsp; @rem whitespace after last argument<br />&nbsp; echo %tab%~!delimOff!,!delimLen! %tab%{ !args:~%delimOff%,%delimLen%! }<br />)<br />set &quot;delimOff=&quot;<br />set &quot;delimLen=&quot;<br /><br />goto :eof<br /><br />::.............................................................................<br /><br />:getArgs<br />set &quot;remArgs=%temp%\%random%.tmp&quot;<br />set prompt=@<br />&gt;&quot;%remArgs%&quot; (<br />&nbsp; setlocal disableextensions<br />&nbsp; echo on<br />&nbsp; for %%a in (%%a) do rem { %* }<br />&nbsp; @echo off<br />&nbsp; endlocal<br />)<br />call :getFileSize &quot;%remArgs%&quot; sizeOld<br />set /a argsLen = %sizeOld% - 14<br /><br />set /a argc = 1<br />:nextArg<br />&gt;&gt;&quot;%remArgs%&quot; (<br />&nbsp; setlocal disableextensions<br />&nbsp; echo on<br />&nbsp; for %%a in (%%a) do rem { %1 }<br />&nbsp; @echo off<br />&nbsp; endlocal<br />)<br />call :getFileSize &quot;%remArgs%&quot; sizeNew<br />set /a argLen = %sizeNew% - %sizeOld% - 14<br />if %argLen% leq 0 (<br />&nbsp; set &quot;sizeOld=&quot;<br />&nbsp; set &quot;sizeNew=&quot;<br />&nbsp; set &quot;argLen=&quot;<br />&nbsp; goto :lastArg<br />)<br /><br />set /a arg%argc%len = %argLen%<br />set /a sizeOld = %sizeNew%<br />set /a argc += 1<br />shift /1<br />goto :nextArg<br /><br />:lastArg<br />set /a argc -= 1<br />prompt<br /><br />setlocal enableDelayedExpansion<br />&lt;&quot;%remArgs%&quot; (<br />&nbsp; set /p &quot;args=&quot;<br />&nbsp; set /p &quot;args=&quot;<br />&nbsp; set &quot;args=!args:~7,-3!&quot;<br />&nbsp; for /l %%n in (1, 1, %argc%) do (<br />&nbsp; &nbsp; set /p &quot;arg%%n=&quot;<br />&nbsp; &nbsp; set /p &quot;arg%%n=&quot;<br />&nbsp; &nbsp; set &quot;arg%%n=!arg%%n:~7,-3!&quot;<br />&nbsp; )<br />)<br />del &quot;%remArgs%&quot;<br /><br />goto :main<br /><br />:getFileSize<br />set /a %~2 = %~z1<br />goto :eof<br /><br />::.............................................................................<br /><br />:getOffs<br />set /a argsOff = 0<br />for /l %%n in (1, 1, %argc%) do (<br />&nbsp; call :getOff args !argsOff! arg%%noff<br />&nbsp; set /a argsOff = !arg%%noff! + !arg%%nlen!<br />)<br />set &quot;argsOff=&quot;<br />goto :eof<br /><br />:getOff<br />setlocal enableDelayedExpansion<br />set /a argOff = %~2<br />:nextOff<br />set &quot;chrNext=!%~1:~%argOff%,1!&quot;<br />if &quot;!chrNext!&quot;==&quot;&quot; goto :lastOff<br />if not &quot;!chrNext!&quot;==&quot; &quot; ^<br />if not &quot;!chrNext!&quot;==&quot;%tab%&quot; ^<br />if not &quot;!chrNext!&quot;==&quot;,&quot; ^<br />if not &quot;!chrNext!&quot;==&quot;;&quot; ^<br />if not &quot;!chrNext!&quot;==&quot;=&quot; goto :lastOff<br />set /a argOff += 1<br />goto :nextOff<br />:lastOff<br />endlocal &amp; set /a %~3 = %argOff%<br />goto :eof<br /></code></pre></div><br /><br />Still don't like it completely, because it shifts parameters out thus destroying the original %1/%2/etc. It also leaves all variables stuck in a setlocal block without an easy way to send them back to the enclosing context. But, other than that, it appears to be working as advertised.<br /><br />Liviu<br /><br />EDIT: I tidied up some code (the 'for' loop when reading &quot;%remArgs%&quot; back), and added some inline comments (since I seem to be misplacing/forgetting web references way more often than I lose local batch files).<br /> <br />Also added the :getOffs counterpart, which essentially recovers the separators that cmd ignores from the full command line. Nice thing about it is that it basically tokenizes the command line while leaving the actual token parsing to cmd itself. In other words, as long as (1) cmd uses the same escaping logic between %* and %1/%2/etc, and (2) the delimiters remain the known space/tab/comma/semicolon/equal ones, this &quot;manual reparsing&quot; should match cmd's own, regardless of whatever the rules are inside a token.<br /> <br />Below is a sample output using the updated code.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\&gt;eccoargs ; %a %0 %~1 %cd^% !cd! a^|b a^&amp;b &quot;a&amp;b&quot; ^&lt;&quot;&amp;&quot;^&gt; ^^;,=<br /><br />---- copied from %? ----<br /><br />args&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { ; %a %0 %~1 %cd% !cd! a|b a&amp;b &quot;a&amp;b&quot; &lt;&quot;&amp;&quot;&gt; ^;,= }<br />arg1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { %a }<br />arg2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { %0 }<br />arg3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { %~1 }<br />arg4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { %cd% }<br />arg5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { !cd! }<br />arg6&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { a|b }<br />arg7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { a&amp;b }<br />arg8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { &quot;a&amp;b&quot; }<br />arg9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { &lt;&quot;&amp;&quot;&gt; }<br />arg10&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{ ^ }<br /><br />---- chopped off %* ----<br /><br />args&nbsp; &nbsp; ~0,46&nbsp; &nbsp;{ ; %a %0 %~1 %cd% !cd! a|b a&amp;b &quot;a&amp;b&quot; &lt;&quot;&amp;&quot;&gt; ^;,= }<br />&nbsp; &nbsp; &nbsp; &nbsp; ~0,2&nbsp; &nbsp; { ;&nbsp; }<br />arg1&nbsp; &nbsp; ~2,2&nbsp; &nbsp; { %a }<br />&nbsp; &nbsp; &nbsp; &nbsp; ~4,1&nbsp; &nbsp; {&nbsp; &nbsp;}<br />arg2&nbsp; &nbsp; ~5,2&nbsp; &nbsp; { %0 }<br />&nbsp; &nbsp; &nbsp; &nbsp; ~7,1&nbsp; &nbsp; {&nbsp; &nbsp;}<br />arg3&nbsp; &nbsp; ~8,3&nbsp; &nbsp; { %~1 }<br />&nbsp; &nbsp; &nbsp; &nbsp; ~11,1&nbsp; &nbsp;{&nbsp; &nbsp;}<br />arg4&nbsp; &nbsp; ~12,4&nbsp; &nbsp;{ %cd% }<br />&nbsp; &nbsp; &nbsp; &nbsp; ~16,1&nbsp; &nbsp;{&nbsp; &nbsp;}<br />arg5&nbsp; &nbsp; ~17,4&nbsp; &nbsp;{ !cd! }<br />&nbsp; &nbsp; &nbsp; &nbsp; ~21,1&nbsp; &nbsp;{&nbsp; &nbsp;}<br />arg6&nbsp; &nbsp; ~22,3&nbsp; &nbsp;{ a|b }<br />&nbsp; &nbsp; &nbsp; &nbsp; ~25,1&nbsp; &nbsp;{&nbsp; &nbsp;}<br />arg7&nbsp; &nbsp; ~26,3&nbsp; &nbsp;{ a&amp;b }<br />&nbsp; &nbsp; &nbsp; &nbsp; ~29,1&nbsp; &nbsp;{&nbsp; &nbsp;}<br />arg8&nbsp; &nbsp; ~30,5&nbsp; &nbsp;{ &quot;a&amp;b&quot; }<br />&nbsp; &nbsp; &nbsp; &nbsp; ~35,1&nbsp; &nbsp;{&nbsp; &nbsp;}<br />arg9&nbsp; &nbsp; ~36,5&nbsp; &nbsp;{ &lt;&quot;&amp;&quot;&gt; }<br />&nbsp; &nbsp; &nbsp; &nbsp; ~41,1&nbsp; &nbsp;{&nbsp; &nbsp;}<br />arg10&nbsp; &nbsp;~42,1&nbsp; &nbsp;{ ^ }<br />&nbsp; &nbsp; &nbsp; &nbsp; ~43,3&nbsp; &nbsp;{ ;,= }<br /><br />C:\&gt;</code></pre></div></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: foolproof counting of arguments</h3>
				<div class="date">Posted: <strong>27 Jan 2012 02:44</strong></div>
				<div class="author">by <strong>jeb</strong></div>
				<div class="content">Hi, <br /><br /><blockquote><div><cite>Liviu wrote:</cite>Pretty sure I've seen this noted before, though I can't find a reference handy now... One other corner case is that the 'for' loop would save the incorrect %1 when passed %a or similar as an argument, presumably because of some loop variable name clash. Didn't look into it much yet, but for whatever reason replacing it with<br />Code:<br />for %%a in (%%a) do rem . %1.<br /><br />appears to work better under xp.sp3 at least. Again, not fully understood or tested on my part.<br /></div></blockquote><br /><br />Good idea, but it fails too <img class="smilies" src="images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /> <br /><br />The main problem is to use a FOR-Parameter which can't be expanded.<br />That's Dave speciality, he made somewhere a list.<br /><br />As now your code would fail with<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>foolProofParam.bat %a...%~a...%~dpa</code></pre></div><br /><br />jeb</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: foolproof counting of arguments</h3>
				<div class="date">Posted: <strong>27 Jan 2012 11:19</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><blockquote><div><cite>jeb wrote:</cite>Hi, <br /><br /><blockquote><div><cite>Liviu wrote:</cite>for %%a in (%%a) do rem . %1.<br /></div></blockquote><br /><br />Good idea, but it fails too <img class="smilies" src="images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /> <br /><br />The main problem is to use a FOR-Parameter which can't be expanded.<br />That's Dave speciality, he made somewhere a list.<br /><br />As now your code would fail with<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>foolProofParam.bat %a...%~a...%~dpa</code></pre></div><br /></div></blockquote><br />Good catch <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br />I should have seen that one coming once the problem with %a was pointed out <img class="smilies" src="images/smilies/icon_rolleyes.gif" alt=":roll:" title="Rolling Eyes" /> <br /><br />Unfortunately, I think we've reached a dead end <img class="smilies" src="images/smilies/icon_sad.gif" alt=":(" title="Sad" /> <br /><br />The <a href="http://stackoverflow.com/a/8520993/1012053" class="postlink">list of special cases for FOR variables</a> you were referring to is on StackOverflow. There are characters that cannot be directly defined as FOR variables, yet can be expanded. But they don't do us any good.<br /><br />What we need is a character that can be defined as a FOR variable, but can't be expanded. I've never come up with any. The closest we have is the one you showed me: %<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>for %%%% in (%%~%%) do rem . %1.<br /></code></pre></div><br />Command line arguments %% and %~% will be preserved.<br /><br />But arguments like %~a%  %~dp%  %~path:%  etc. will fail<br /><br />So % has the fewest possible corner cases. But I don't think those cases are the least likely to occur. We might be better off choosing some extremly rare character for a command line argument. Perhaps a control character like &lt;BackSpace&gt; 0x08.<br /><br />I believe we can't ever have a &quot;perfect&quot; solution involving FOR.<br /><br />The only other way I know to capture the echoed command line in a file involves CALL, and that is no good because it can corrupt the command line and it isn't safe.<br /><br />So it seems we are at a dead end. I don't see how we can ever have an absolutely foolproof method to capture any argument...  <br /><br /><br />unless... <img class="smilies" src="images/smilies/icon_idea.gif" alt=":idea:" title="Idea" /> <br /><br />We could attempt to capture the complete set of arguments at least twice, using a different character for the FOR statement in each attempt. We could then compare the results and if we find discrepencies, we can use logic to try to reconstruct the full argument list. But it sounds like a complicated process. I don't think I want to try to attempt it. I'm not even sure if that could ever be foolproof.<br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: foolproof counting of arguments</h3>
				<div class="date">Posted: <strong>27 Jan 2012 12:55</strong></div>
				<div class="author">by <strong>Liviu</strong></div>
				<div class="content"><blockquote><div><cite>jeb wrote:</cite>Good idea, but it fails too <img class="smilies" src="images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /> <br />...<br />As now your code would fail with<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>foolProofParam.bat %a...%~a...%~dpa</code></pre></div><br /></div></blockquote><br />Thanks for pointing that. Think I have a workaround, see the &quot;2nd EDIT&quot; comments above.<br /><blockquote><div><cite>dbenham wrote:</cite>What we need is a character that can be defined as a FOR variable, but can't be expanded. I've never come up with any. The closest we have is the one you showed me: %<br />...<br />So % has the fewest possible corner cases. But I don't think those cases are the least likely to occur. We might be better off choosing some extremly rare character for a command line argument. Perhaps a control character like &lt;BackSpace&gt; 0x08.<br /></div></blockquote><br />Agreed. I'll remember &lt;BackSpace&gt; as a fallback if the disableextensions workaround proves to be insufficient.<br /><blockquote><div><cite>dbenham wrote:</cite>unless... <img class="smilies" src="images/smilies/icon_idea.gif" alt=":idea:" title="Idea" /> <br /><br />We could attempt to capture the complete set of arguments at least twice, using a different character for the FOR statement in each attempt. We could then compare the results and if we find discrepencies, we can use logic to try to reconstruct the full argument list. But it sounds like a complicated process. I don't think I want to try to attempt it. I'm not even sure if that could ever be foolproof.<br /></div></blockquote><br />Crossed my mind, too, but I wouldn't go there, either <img class="smilies" src="images/smilies/icon_wink.gif" alt=";-)" title="Wink" /><br /><br />Liviu</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: foolproof counting of arguments</h3>
				<div class="date">Posted: <strong>27 Jan 2012 13:32</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><blockquote><div><cite>Liviu wrote:</cite>Note that the enclosing (...) is still evaluated at the outer level with extensions enabled, which allows %* to work correctly, but the for loop executes with extensions disabled so %~a, %~dpa etc are no longer expanded.<br /></div></blockquote><br />disableExtensions - perfect  <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" />  <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> <br /><br />I always forget that option.<br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: foolproof counting of arguments</h3>
				<div class="date">Posted: <strong>11 Feb 2012 15:29</strong></div>
				<div class="author">by <strong>Liviu</strong></div>
				<div class="content"><blockquote><div><cite>dbenham wrote:</cite>Now I understand why jeb had that # in his REM statement, to protect against /?</div></blockquote>And only now do I understand why he had the space after # as well... REM appears to look for a '/?' all across the first argument (unless quoted) i.e. 'REM */?*' and 'REM a^&amp;b%%c^(^!^&lt;^|^&gt;/^?...' both work just as 'REM /?'.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: foolproof counting of arguments</h3>
				<div class="date">Posted: <strong>13 Feb 2012 05:43</strong></div>
				<div class="author">by <strong>jeb</strong></div>
				<div class="content"><blockquote><div><cite>dbenham wrote:</cite>Now I understand why jeb had that # in his REM statement, to protect against /?</div></blockquote><br /><br /><blockquote><div><cite>Liviu wrote:</cite>And only now do I understand why he had the space after # as well... REM appears to look for a '/?' all across the first argument (unless quoted) i.e. 'REM */?*' and 'REM a^&amp;b%%c^(^!^&lt;^|^&gt;/^?...' both work just as 'REM /?'.<br /></div></blockquote><br /><br />Ok, perhaps I should comment a bit more  <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /> <br /><br /><blockquote><div><cite>Liviu wrote:</cite>Note that the enclosing (...) is still evaluated at the outer level with extensions enabled, which allows %* to work correctly, but the for loop executes with extensions disabled so %~a, %~dpa etc are no longer expanded.<br /></div></blockquote><br />I didn't understand why you disable extensions, as the REM never use delayed expansion, or better it's hard to see it.<br /><br />The redirection is done to the output of the echo phase (before the delayed expansion phase).<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>setlocal EnableDelayedExpansion<br />set quest=/?<br />rem !quest!<br />rem results to nothing</code></pre></div><br /><br /><strong class="text-strong">EDIT: Reading is helpful</strong> <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br />I didn't realize that you used the word &quot;EXTENSION&quot; not &quot;EXPANSION&quot;<br /><br />Now, I understand why you disable <em class="text-italics">extensions</em>  <img class="smilies" src="images/smilies/icon_idea.gif" alt=":idea:" title="Idea" />, a really clever trick</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: foolproof counting of arguments</h3>
				<div class="date">Posted: <strong>13 Feb 2012 09:05</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><blockquote><div><cite>jeb wrote:</cite><strong class="text-strong">EDIT: Reading is helpful</strong> <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br />I didn't realize that you used the word &quot;EXTENSION&quot; not &quot;EXPANSION&quot;<br /></div></blockquote> You would never <a href="viewtopic6c27.html?p=8313#p8313" class="postlink">catch me failing to read properly</a>... noooooo, Not me  <img class="smilies" src="images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" /> <br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: foolproof counting of arguments</h3>
				<div class="date">Posted: <strong>13 Feb 2012 19:26</strong></div>
				<div class="author">by <strong>Liviu</strong></div>
				<div class="content"><blockquote><div><cite>dbenham wrote:</cite><blockquote><div><cite>jeb wrote:</cite><strong class="text-strong">EDIT: Reading is helpful</strong> <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br />I didn't realize that you used the word &quot;EXTENSION&quot; not &quot;EXPANSION&quot;<br /></div></blockquote> You would never <a href="viewtopic6c27.html?p=8313#p8313" class="postlink">catch me failing to read properly</a>... noooooo, Not me  <img class="smilies" src="images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" /> </div></blockquote><br />In fact, I am pretty sure I've noticed that during an unrelated search, and it must have somehow stuck &quot;disableextensions&quot; in my memory cache <img class="smilies" src="images/smilies/icon_wink.gif" alt=";-)" title="Wink" /> Had never used it before, or thought I'd (need to) ever use it, until this case here where it fit just right. Thanks to both of you, again, and to dostips contributors at large.<br /><br />Liviu</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: foolproof counting of arguments</h3>
				<div class="date">Posted: <strong>14 Feb 2012 04:12</strong></div>
				<div class="author">by <strong>jeb</strong></div>
				<div class="content">In my opinion there are only two problems left.<br /><br />We need a temporary file, it would be nicer if we could avoid this.<br /><br />The REM technic currently fails with embedded linefeeds in the parameters %*.<br /><br />I create a completly other way of capturing the parameters into a file<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo on<br />@echo Hello1 1&gt;stream1.txt 2&gt;stream2.txt 3&gt;stream3.txt 4&gt;stream4.txt<br />rem # %* #<br />@echo off<br />type stream3.txt &gt; con<br />exit /b<br /></code></pre></div><br /><br />This is adapted from the code of walid2me <a href="http://stackoverflow.com/a/8533464/463115" class="postlink">SO: Commenting multiple lines in DOS batch file</a><br /><br />The only problem is to restore the standard handles <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br />As after the code even the prompt isn't visible anymore<br /><br />jeb</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: foolproof counting of arguments</h3>
				<div class="date">Posted: <strong>14 Feb 2012 11:26</strong></div>
				<div class="author">by <strong>Liviu</strong></div>
				<div class="content"><blockquote><div><cite>jeb wrote:</cite>In my opinion there are only two problems left.<br /><br />We need a temporary file, it would be nicer if we could avoid this.</div></blockquote>Right. The other unfortunate side effect of using a temp file is that characters outside the current code page cannot be handled (while a straightforward &quot;set arg1=%1&quot; works, barring of course poison characters in %1).<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\&gt;eccoargs ‹αß©∂€›<br /><br />---- copied from %? ----<br /><br />args&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { &lt;αßc??&gt; }<br />arg1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; { &lt;αßc??&gt; }<br /><br />---- chopped off %* ----<br /><br />args&nbsp; &nbsp; ~0,7&nbsp; &nbsp; { &lt;αßc??&gt; }<br />&nbsp; &nbsp; &nbsp; &nbsp; ~0,0&nbsp; &nbsp; {&nbsp; }<br />arg1&nbsp; &nbsp; ~0,7&nbsp; &nbsp; { &lt;αßc??&gt; }<br />&nbsp; &nbsp; &nbsp; &nbsp; ~7,0&nbsp; &nbsp; {&nbsp; }</code></pre></div><br /><blockquote><div><cite>jeb wrote:</cite>The REM technic currently fails with embedded linefeeds in the parameters %*.</div></blockquote>True, and worth noting. Though in practice it only becomes a problem in rather uncommon cases.<br /><br /><blockquote><div><cite>jeb wrote:</cite>I create a completly other way of capturing the parameters into a file<br />...<br />The only problem is to restore the standard handles <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br />As after the code even the prompt isn't visible anymore</div></blockquote>Oddly enough, piping the command &quot;| more&quot; brings back the prompt and the &quot;&gt;con&quot; output. That said, I know (and found) virtually no information on handles 3 and 4, so I can't even begin to guess how cmd uses them internally.<br /><br />Liviu</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: foolproof counting of arguments</h3>
				<div class="date">Posted: <strong>14 Feb 2012 12:24</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><blockquote><div><cite>Liviu wrote:</cite>Oddly enough, piping the command &quot;| more&quot; brings back the prompt and the &quot;&gt;con&quot; output.</div></blockquote> <img class="smilies" src="images/smilies/icon_question.gif" alt=":?:" title="Question" />  <img class="smilies" src="images/smilies/icon_confused.gif" alt=":?" title="Confused" /><br />I can't figure out what you mean. What is the exact syntax in context?<br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: foolproof counting of arguments</h3>
				<div class="date">Posted: <strong>14 Feb 2012 12:41</strong></div>
				<div class="author">by <strong>Liviu</strong></div>
				<div class="content"><blockquote><div><cite>dbenham wrote:</cite>What is the exact syntax in context?</div></blockquote><br />Save Jeb's snippet as, say, stream3.cmd. Running it as such results in...<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\&gt;stream3<br /><br />C:\&gt;rem #&nbsp; #<br />cls<br />exit</code></pre></div>...where the prompt remains in an odd input state. The last two lines were typed in, 'cls' did nothing, and 'exit' does in fact close the console window once Enter is pressed.<br /><br />However, piping into &quot;| more&quot; returns to the cmd prompt normally.<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\&gt;stream3 | more<br /><br />C:\&gt;rem #&nbsp; #<br /><br /><br />C:\&gt;</code></pre></div><br />Liviu</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: foolproof counting of arguments</h3>
				<div class="date">Posted: <strong>15 Feb 2012 00:18</strong></div>
				<div class="author">by <strong>jeb</strong></div>
				<div class="content"><blockquote><div><cite>Liviu wrote:</cite>...where the prompt remains in an odd input state. The last two lines were typed in, 'cls' did nothing, and 'exit' does in fact close the console window once Enter is pressed.<br /><br />However, piping into &quot;| more&quot; returns to the cmd prompt normally.</div></blockquote><br /><br />But piping do the same as the exit, as the pipe itself creates two seperate sub-tasks for each side.<br />The prompt disappears in the child task which is never visible.<br /><br />So the pipe doesn't solve the problem this way.<br /><br />jeb</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: foolproof counting of arguments</h3>
				<div class="date">Posted: <strong>15 Feb 2012 00:39</strong></div>
				<div class="author">by <strong>Liviu</strong></div>
				<div class="content"><blockquote><div><cite>jeb wrote:</cite>But piping do the same as the exit, as the pipe itself creates two seperate sub-tasks for each side.<br />The prompt disappears in the child task which is never visible.</div></blockquote>Haven't followed this in any depth, but it doesn't look quite the same. The pipe closes both ends without any obvious 'exit' being typed in and/or piped through.<br /><blockquote><div><cite>jeb wrote:</cite>So the pipe doesn't solve the problem this way.</div></blockquote>Streams 3/4 redirection is foggy enough to me that I can't even spell out what the &quot;problem&quot; might be, let alone solve it <img class="smilies" src="images/smilies/icon_wink.gif" alt=";-)" title="Wink" /><br /><br />Liviu</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="UTC-6">UTC-06:00</span><br />Page <strong>2</strong> of <strong>4</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Limited<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=2836&start=15&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:20:54 GMT -->
</html>
