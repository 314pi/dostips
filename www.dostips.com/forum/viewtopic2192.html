<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=6133&start=30 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:23:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Detecting Process ID of the current cmd.exe - Page 3 - DosTips.com</title>


	<link rel="canonical" href="viewtopic0830.html?t=6133&amp;start=30">

<!--
	phpBB style name: Allan Style - SUBSILVER
	Based on style:   prosilver (this is the default phpBB3 style)
	Based on style:   subsilver2 (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:  Allan ( http://x-tk.ru/ )
-->

<link href="assets/css/font-awesome.mind772.css?assets_version=34" rel="stylesheet">
<link href="styles/AllanStyle-SUBSILVER/theme/stylesheetd772.css?assets_version=34" rel="stylesheet">
<link href="styles/AllanStyle-SUBSILVER/theme/en/stylesheetd772.css?assets_version=34" rel="stylesheet">




<!--[if lte IE 9]>
	<link href="./styles/AllanStyle-SUBSILVER/theme/tweaks.css?assets_version=34" rel="stylesheet">
<![endif]-->




<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','../../www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-280191-1', 'auto');
	ga('send', 'pageview');
</script>

</head>
<body id="phpbb" class="nojs notouch section-viewtopic ltr ">

<div id="header-subsilver">
	<a id="top" class="top-anchor" accesskey="t"></a>
		<div class="headerbar" role="banner">
					<div class="inner">

			<div id="site-description" class="site-description">
				<a id="logo" class="logo" href="../index.html" title="DosTips.com"><span class="site_logo"></span></a>
				<h1>DosTips.com</h1>
				<p>A Forum all about DOS Batch</p>
				<p class="skiplink"><a href="#start_here">Skip to content</a></p>
			</div>

									<div id="search-box" class="search-box search-header" role="search">
				<form action="https://www.dostips.com/forum/search.php" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="search" maxlength="128" title="Search for keywords" class="inputbox search tiny" size="20" value="" placeholder="Search…" />
					<button class="button button-search" type="submit" title="Search">
						<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
					</button>
					<a href="search.html" class="button button-search-end" title="Advanced search">
						<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
					</a>
					
				</fieldset>
				</form>
			</div>
						
			</div>
					</div>
</div>


<div id="wrap" class="wrap">
	<div id="page-header">
				<div class="navbar-top" role="navigation">
	<div class="inner">

	<ul id="nav-main" class="nav-main linklist" role="menubar">

		<li id="quick-links" class="quick-links dropdown-container responsive-menu" data-skip-responsive="true">
			<a href="#" class="dropdown-trigger">
				<i class="icon fa-bars fa-fw" aria-hidden="true"></i><span>Quick links</span>
			</a>
			<div class="dropdown">
				<div class="pointer"><div class="pointer-inner"></div></div>
				<ul class="dropdown-contents" role="menu">
					
											<li class="separator"></li>
																									<li>
								<a href="search33a7.html?search_id=unanswered" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-gray" aria-hidden="true"></i><span>Unanswered topics</span>
								</a>
							</li>
							<li>
								<a href="search526f.html?search_id=active_topics" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-blue" aria-hidden="true"></i><span>Active topics</span>
								</a>
							</li>
							<li class="separator"></li>
							<li>
								<a href="search.html" role="menuitem">
									<i class="icon fa-search fa-fw" aria-hidden="true"></i><span>Search</span>
								</a>
							</li>
					
											<li class="separator"></li>
																			<li>
								<a href="memberlist4bfd.html?mode=team" role="menuitem">
									<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
								</a>
							</li>
																<li class="separator"></li>

									</ul>
			</div>
		</li>

				<li data-skip-responsive="true">
			<a href="app.php/help/faq.html" rel="help" title="Frequently Asked Questions" role="menuitem">
				<i class="icon fa-question-circle fa-fw" aria-hidden="true"></i><span>FAQ</span>
			</a>
		</li>
						
			<li class="rightside"  data-skip-responsive="true">
			<a href="ucp26c3.html?mode=login" title="Login" accesskey="x" role="menuitem">
				<i class="icon fa-power-off fa-fw" aria-hidden="true"></i><span>Login</span>
			</a>
		</li>
					<li class="rightside" data-skip-responsive="true">
				<a href="ucp8319.html?mode=register" role="menuitem">
					<i class="icon fa-pencil-square-o  fa-fw" aria-hidden="true"></i><span>Register</span>
				</a>
			</li>
						</ul>

	</div>
</div>

<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks" role="menubar">
						<li class="breadcrumbs">
							<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope=""><a href="../index.html" itemprop="url" data-navbar-reference="home"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span itemprop="title">DosTips.com</span></a></span>
										<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope=""><a href="index.html" itemprop="url" accesskey="h" data-navbar-reference="index"><span itemprop="title">Board index</span></a></span>

											<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="4"><a href="viewforum31e6.html?f=4" itemprop="url"><span itemprop="title">DosTips - Dos Batch</span></a></span>
															<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="3"><a href="viewforum4d6b.html?f=3" itemprop="url"><span itemprop="title">DOS Batch Forum</span></a></span>
												</li>
		
					<li class="rightside responsive-search">
				<a href="search.html" title="View the advanced search options" role="menuitem">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</a>
			</li>
			</ul>

	</div>
</div>

<div class="navbar-top-link">
	<div class="inner">
		<ul>
			<li class="navbar-top-link-left"><a href="search33a7.html?search_id=unanswered">Unanswered topics</a></li>
			<li class="navbar-top-link-left"><a href="search526f.html?search_id=active_topics">Active topics</a></li>

											</ul>
	</div>
</div>
	</div>

	
	<a id="start_here" class="anchor"></a>
	<div id="page-body" class="page-body" role="main">
		
		
<h2 class="topic-title"><a href="viewtopic2192.html?f=3&amp;t=6133&amp;start=30">Detecting Process ID of the current cmd.exe</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Discussion forum for all Windows batch related topics.<br /></div>
<p>
	<strong>Moderator:</strong> <a href="memberlista6a8.html?mode=viewprofile&amp;u=5" class="username">DosItHelp</a>
</p>


<div class="action-bar bar-top">
	
			<a href="posting5498.html?mode=reply&amp;f=3&amp;t=6133" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
	
			<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic7b1c.html?f=3&amp;t=6133&amp;start=30&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>
	
			<div class="search-box" role="search">
			<form method="get" id="topic-search" action="https://www.dostips.com/forum/search.php">
			<fieldset>
				<input class="inputbox search tiny"  type="search" name="keywords" id="search_keywords" size="20" placeholder="Search this topic…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="search.html" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				<input type="hidden" name="t" value="6133" />
<input type="hidden" name="sf" value="msgonly" />

			</fieldset>
			</form>
		</div>
	
			<div class="pagination">
			47 posts
							<ul>
			<li class="arrow previous"><a class="button button-icon-only" href="viewtopicab3d-2.html?f=3&amp;t=6133&amp;start=15" rel="prev" role="button"><i class="icon fa-chevron-left fa-fw" aria-hidden="true"></i><span class="sr-only">Previous</span></a></li>
				<li><a class="button" href="viewtopic5789.html?f=3&amp;t=6133" role="button">1</a></li>
				<li><a class="button" href="viewtopicab3d-2.html?f=3&amp;t=6133&amp;start=15" role="button">2</a></li>
			<li class="active"><span>3</span></li>
				<li><a class="button" href="viewtopicad89.html?f=3&amp;t=6133&amp;start=45" role="button">4</a></li>
				<li class="arrow next"><a class="button button-icon-only" href="viewtopicad89.html?f=3&amp;t=6133&amp;start=45" rel="next" role="button"><i class="icon fa-chevron-right fa-fw" aria-hidden="true"></i><span class="sr-only">Next</span></a></li>
	</ul>
					</div>
		</div>




<div id="subsilver-nav-topic">
	<div class="inner"><div class="post has-profile">
		<div class="leftsided postbody subsilver-topic-title">Message</div>
		<div class="leftsided postprofile subsilver-topic-author">Author</div>
	</div></div>
</div>

			<div id="p38848" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile38848">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist5152.html?mode=viewprofile&amp;u=5284" class="username">siberia-man</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search7f01.html?author_id=5284&amp;sr=posts">108</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 26 Dec 2013 09:28</dd>		
		
											
							<dd class="profile-contact">
				<strong>Contact:</strong>
				<div class="dropdown-container dropdown-left">
					<a href="#" class="dropdown-trigger" title="Contact siberia-man">
						<i class="icon fa-commenting-o fa-fw icon-lg" aria-hidden="true"></i><span class="sr-only">Contact siberia-man</span>
					</a>
					<div class="dropdown">
						<div class="pointer"><div class="pointer-inner"></div></div>
						<div class="dropdown-contents contact-icons">
																																								<div>
																	<a href="http://with-love-from-siberia.blogspot.com/" title="Website" class="last-cell">
										<span class="contact-icon phpbb_website-icon">Website</span>
									</a>
																	</div>
																					</div>
					</div>
				</div>
			</dd>
				
		</dl>

		<div class="postbody">
						<div id="post_content38848">

						<h3 class="first"><a href="#p38848">Re: Detecting Process ID of the current cmd.exe</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting7bee.html?mode=quote&amp;f=3&amp;p=38848" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic1722.html?p=38848#p38848" onclick="prompt('Message #31',this.href); return false;">#31</a></span> 
									<a class="unread" href="viewtopic1722.html?p=38848#p38848" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist5152.html?mode=viewprofile&amp;u=5284" class="username">siberia-man</a></strong> &raquo; </span>22 Dec 2014 14:24
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>dbenham wrote:</cite>The full lock file path is transformed into a unique ID - certain characters must be encoded to be valid in the WMIC query string. I use : for encoding because it cannot appear in the path other than after the drive letter.<br /></div></blockquote><br /><br />I have two and half questions regarding your suggestion.<br /><br />1. Could you explain in more details why do you transform %lock% into %uid%? I see the resulting command is as follows<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>wmic process where &quot;name='cmd.exe' and CommandLine like '%&lt;c::bTemp:bcmdpid.bat.23.19.21.93.lock&gt;%'&quot; get ParentProcessID</code></pre></div><br />but I can't understand how <strong class="text-strong">CommandLine like '...'</strong> can help in searching our cmd instance? How does it work?<br /><br />2. Why do you clean the %TIME% variable? Also I think only <strong class="text-strong">setlocal</strong> is enough. Correct?</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p38852" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile38852">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist5449.html?mode=viewprofile&amp;u=5288" class="username">Yury</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha077.html?author_id=5288&amp;sr=posts">115</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 28 Dec 2013 07:54</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content38852">

						<h3 ><a href="#p38852">Re: Detecting Process ID of the current cmd.exe</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting7881.html?mode=quote&amp;f=3&amp;p=38852" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicfc24.html?p=38852#p38852" onclick="prompt('Message #32',this.href); return false;">#32</a></span> 
									<a class="unread" href="viewtopicfc24.html?p=38852#p38852" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist5449.html?mode=viewprofile&amp;u=5288" class="username">Yury</a></strong> &raquo; </span>22 Dec 2014 16:13
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>dbenham wrote:</cite><blockquote><div><cite>Yury wrote:</cite><strong class="text-strong">dbenham</strong>, what should I do with your code to run it in a batch file that has the name &quot;<em class="text-italics"><strong class="text-strong">&amp;ABC.bat</strong></em>&quot;?</div></blockquote><br />I put my posted code within a file named &quot;&amp;abc.bat&quot; and it works fine for me. I can run the script using either CALL &quot;&amp;ABC&quot; or CALL ^&amp;ABC.</div></blockquote><br /><br /><br />I found the reason. I tried to create a lock file in the directory from where the batch file was launched: <div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set &quot;lock=%~nx0.%time::=.%.lock&quot;</code></pre></div>.<br />But the question remains: what to do with an ampersand at the beginning of the file name in this case?</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p38853" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile38853">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistfcd5.html?mode=viewprofile&amp;u=4915" style="color: #00AA00;" class="username-coloured">penpen</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search1bf7.html?author_id=4915&amp;sr=posts">1612</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 23 Jun 2013 06:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Germany</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content38853">

						<h3 ><a href="#p38853">Re: Detecting Process ID of the current cmd.exe</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingdfe7.html?mode=quote&amp;f=3&amp;p=38853" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicb7bc-2.html?p=38853#p38853" onclick="prompt('Message #33',this.href); return false;">#33</a></span> 
									<a class="unread" href="viewtopicb7bc-2.html?p=38853#p38853" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistfcd5.html?mode=viewprofile&amp;u=4915" style="color: #00AA00;" class="username-coloured">penpen</a></strong> &raquo; </span>22 Dec 2014 18:28
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>npocmaka_ wrote:</cite>According to me there's no point to use WMI and C#  in this case. C# if far more powerful than jscript (which I prefer only because you can create self-compiled file without toxic output and is a little bit less verbose) and you can use dll import - this should work faster than WMI queries:<br /><br /><!-- m --><a class="postlink" href="http://dotbay.blogspot.com/2009/07/finding-parent-of-process-in-c.html">http://dotbay.blogspot.com/2009/07/find ... -in-c.html</a><!-- m --></div></blockquote>I only wanted to get a result fast (and not a fast result).<br />If i wanted to speed it up, i would also have done it the c++ way.<br /><br />Sidenote:<br />I'm think there is a flaw in the linked (not optimized) source:<br />There is missing a &quot;CloseHandle(hSnapshot)&quot; before returning from the function &quot;ParentProcess(...)&quot;.<br />Even if that would not speed up much (if any), i would reorder the code.<br />It then should look similar to this:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp;// dllImport: kernel32.dll<br />&nbsp; &nbsp;using DWORD = System.Int32;<br />&nbsp; &nbsp;using LONG = System.Int32;<br />// (...)<br />&nbsp; &nbsp;&nbsp; &nbsp;public static Process ParentProcess (this Process process) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;DWORD&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ppid = -1;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;DWORD&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pid&nbsp; = process.Id;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;HANDLE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;h&nbsp; &nbsp; = CreateToolhelp32Snapshot (TH32CS_SNAPPROCESS, 0);<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;PROCESSENTRY32 pe&nbsp; &nbsp;= new PROCESSENTRY32 ();<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;//&nbsp; &nbsp; &nbsp; &nbsp; = sizeof (PROCESSENTRY32)&nbsp; &nbsp;// c++<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;pe.dwSize = Marshal.SizeOf (typeof (PROCESSENTRY32));<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if (Process32First (h, ref pe)) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;do {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;if (pe.th32ProcessID == pid) {<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;ppid = (int) pe.th32ParentProcessID;<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;} while ((ppid == -1) &amp;&amp; Process32Next (h, ref pe));<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;}<br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;CloseHandle (h);<br /><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;return Process.GetProcessById (ppid);<br />&nbsp; &nbsp;&nbsp; &nbsp;}<br />// (...)<br /></code></pre></div><br />penpen</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p38854" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile38854">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha86d.html?author_id=2258&amp;sr=posts">2152</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 Feb 2011 21:02</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> United States (east coast)</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content38854">

						<h3 ><a href="#p38854">Re: Detecting Process ID of the current cmd.exe</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingd1e6.html?mode=quote&amp;f=3&amp;p=38854" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic436c-2.html?p=38854#p38854" onclick="prompt('Message #34',this.href); return false;">#34</a></span> 
									<a class="unread" href="viewtopic436c-2.html?p=38854#p38854" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a></strong> &raquo; </span>22 Dec 2014 22:06
			</p>
			
			
			
			<div class="content">I discovered a minor bug in my code - Percent is a legal character in a file path, and it is also the wildcard character in a WMIC LIKE query. So any percents within the UID should be encoded.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br /><br />:getPID&nbsp; &#91;RtnVar&#93;<br />::<br />:: Store the Process ID (PID) of the currently running script in environment variable<br />:: RtnVar. If called without any argument, then simply write the PID to stdout.<br />::<br />setlocal disableDelayedExpansion<br />:getLock<br />set &quot;lock=%temp%\%~nx0.%time::=.%.lock&quot;<br />set &quot;uid=%lock:\=:b%&quot;<br />set &quot;uid=%uid:,=:c%&quot;<br />set &quot;uid=%uid:'=:q%&quot;<br />set &quot;uid=%uid:_=:u%&quot;<br />setlocal enableDelayedExpansion<br />set &quot;uid=!uid:%%=:p!&quot;<br />endlocal &amp; set &quot;uid=%uid%&quot;<br />2&gt;nul ( 9&gt;&quot;%lock%&quot; (<br />&nbsp; for /f &quot;skip=1 delims=&quot; %%A in (<br />&nbsp; &nbsp; 'wmic process where &quot;name='cmd.exe' and CommandLine like '%%&lt;%uid%&gt;%%'&quot; get ParentProcessID'<br />&nbsp; ) do for /f &quot;delims=&quot; %%B in (&quot;%%A&quot;) do set &quot;PID=%%B&quot;<br />&nbsp; (call )<br />))||goto :getLock<br />del &quot;%lock%&quot; 2&gt;nul<br />endlocal &amp; if &quot;%~1&quot; equ &quot;&quot; (echo(%PID%) else set &quot;%~1=%PID%&quot;<br />exit /b<br /></code></pre></div><br /><br /><blockquote><div><cite>siberia-man wrote:</cite>1. Could you explain in more details why do you transform %lock% into %uid%? I see the resulting command is as follows<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>wmic process where &quot;name='cmd.exe' and CommandLine like '%&lt;c::bTemp:bcmdpid.bat.23.19.21.93.lock&gt;%'&quot; get ParentProcessID</code></pre></div><br />but I can't understand how <strong class="text-strong">CommandLine like '...'</strong> can help in searching our cmd instance? How does it work?<br /></div></blockquote><br />The WMIC command is executed via a new cmd.exe launched by FOR /F. The WMIC command is performing a search. The search is passed in as a parameter. The search parameter must first be passed as a parameter through cmd - somethiing like:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; C:\Windows\system32\cmd.exe /c wmic process where &quot;name='cmd.exe' and CommandLine like '%&lt;c::bTemp:bcmdpid.bat.23.19.21.93.lock&gt;%'&quot; get ParentProcessID<br /></code></pre></div><br />So the uid we are looking for is part of the command line - the query is effectively searching for itself <img class="smilies" src="images/smilies/icon_twisted.gif" alt=":twisted:" title="Twisted Evil" /> <br /><br />Some characters that may appear in the lock file path cause problems in a WMIC query - namely backslash, comma, and single quote. So they must be encoded. Also, the underscore and percent characters are valid path characters, but they are also wildcards for the LIKE operator. We want to treat them as literals, not wildcards, so they also must be encoded.<br /><br /><blockquote><div><cite>siberia-man wrote:</cite>2. Why do you clean the %TIME% variable? Also I think only <strong class="text-strong">setlocal</strong> is enough. Correct?</div></blockquote><br />The time is incorporated into the temporary lock file name - but %TIME% contains colons, and colons are not allowed in file names. So I substitute a dot for each colon.<br /><br />My code requires that delayed expansion be disabled when %~nx0 is expanded, just in case the batch script name contains an exclamation point. Delayed expansion is typically disabled when a script it started, but there are no guarantees - I explicitly disable it just to be sure.<br /><br /><blockquote><div><cite>Yury wrote:</cite><blockquote><div><cite>dbenham wrote:</cite><blockquote><div><cite>Yury wrote:</cite>dbenham, what should I do with your code to run it in a batch file that has the name &quot;&amp;ABC.bat&quot;?<br /></div></blockquote><br />I put my posted code within a file named &quot;&amp;abc.bat&quot; and it works fine for me. I can run the script using either CALL &quot;&amp;ABC&quot; or CALL ^&amp;ABC.<br /></div></blockquote><br />I found the reason. I tried to create a lock file in the directory from where the batch file was launched:<br />Code:<br />set &quot;lock=%~nx0.%time::=.%.lock&quot;<br />.<br />But the question remains: what to do with an ampersand at the beginning of the file name in this case?<br /></div></blockquote><br />I don't understand where you are having problems. My code simply works, even if there is an ampersand in the name. What isn't working for your? Are you using my code?<br /><br /><br />Dave Benham</div>

			
													<div class="notice">
					Last edited by <a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a> on 23 Dec 2014 12:15, edited 2 times in total.
									</div>
			
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p38856" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile38856">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist5152.html?mode=viewprofile&amp;u=5284" class="username">siberia-man</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search7f01.html?author_id=5284&amp;sr=posts">108</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 26 Dec 2013 09:28</dd>		
		
											
							<dd class="profile-contact">
				<strong>Contact:</strong>
				<div class="dropdown-container dropdown-left">
					<a href="#" class="dropdown-trigger" title="Contact siberia-man">
						<i class="icon fa-commenting-o fa-fw icon-lg" aria-hidden="true"></i><span class="sr-only">Contact siberia-man</span>
					</a>
					<div class="dropdown">
						<div class="pointer"><div class="pointer-inner"></div></div>
						<div class="dropdown-contents contact-icons">
																																								<div>
																	<a href="http://with-love-from-siberia.blogspot.com/" title="Website" class="last-cell">
										<span class="contact-icon phpbb_website-icon">Website</span>
									</a>
																	</div>
																					</div>
					</div>
				</div>
			</dd>
				
		</dl>

		<div class="postbody">
						<div id="post_content38856">

						<h3 ><a href="#p38856">Re: Detecting Process ID of the current cmd.exe</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting4322.html?mode=quote&amp;f=3&amp;p=38856" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopice13a.html?p=38856#p38856" onclick="prompt('Message #35',this.href); return false;">#35</a></span> 
									<a class="unread" href="viewtopice13a.html?p=38856#p38856" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist5152.html?mode=viewprofile&amp;u=5284" class="username">siberia-man</a></strong> &raquo; </span>23 Dec 2014 10:28
			</p>
			
			
			
			<div class="content"><strong class="text-strong">Dave</strong><br /><br />This one<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>setlocal enableDelayedExpansion<br />set &quot;uid=!uid:%%=:p!&quot;<br />...<br /></code></pre></div><br />is executed in the loop. Potentially it could raise the stack overflow error. <br /><br />I guess, this one could be better (with additional changes in the code below. but it should be checked carefully):<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>setlocal enableDelayedExpansion<br />set &quot;uid=!uid:%%=:p!&quot;<br />endlocal &amp; set &quot;uid=%uid%&quot;<br />...<br /></code></pre></div></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p38858" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile38858">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha86d.html?author_id=2258&amp;sr=posts">2152</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 Feb 2011 21:02</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> United States (east coast)</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content38858">

						<h3 ><a href="#p38858">Re: Detecting Process ID of the current cmd.exe</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingc31c.html?mode=quote&amp;f=3&amp;p=38858" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic414a.html?p=38858#p38858" onclick="prompt('Message #36',this.href); return false;">#36</a></span> 
									<a class="unread" href="viewtopic414a.html?p=38858#p38858" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a></strong> &raquo; </span>23 Dec 2014 11:03
			</p>
			
			
			
			<div class="content">@siberia-man - you are absolutely correct - good catch <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /><br /><br />I've fixed the code in my prior post. Thanks  <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> <br /><br /><br />Dave Benham</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p38862" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile38862">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistfcd5.html?mode=viewprofile&amp;u=4915" style="color: #00AA00;" class="username-coloured">penpen</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search1bf7.html?author_id=4915&amp;sr=posts">1612</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 23 Jun 2013 06:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Germany</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content38862">

						<h3 ><a href="#p38862">Re: Detecting Process ID of the current cmd.exe</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingdbac.html?mode=quote&amp;f=3&amp;p=38862" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic98dc.html?p=38862#p38862" onclick="prompt('Message #37',this.href); return false;">#37</a></span> 
									<a class="unread" href="viewtopic98dc.html?p=38862#p38862" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistfcd5.html?mode=viewprofile&amp;u=4915" style="color: #00AA00;" class="username-coloured">penpen</a></strong> &raquo; </span>23 Dec 2014 11:44
			</p>
			
			
			
			<div class="content">What i don't understand: Why are you using !uid! within the for loop ('wmic process ... !uid!...'):<br />I always thought delayed expansion is disabled by default within the for/F loop, so then there should be no need to initialize this variable.<br /><br />penpen</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p38865" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile38865">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist5152.html?mode=viewprofile&amp;u=5284" class="username">siberia-man</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search7f01.html?author_id=5284&amp;sr=posts">108</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 26 Dec 2013 09:28</dd>		
		
											
							<dd class="profile-contact">
				<strong>Contact:</strong>
				<div class="dropdown-container dropdown-left">
					<a href="#" class="dropdown-trigger" title="Contact siberia-man">
						<i class="icon fa-commenting-o fa-fw icon-lg" aria-hidden="true"></i><span class="sr-only">Contact siberia-man</span>
					</a>
					<div class="dropdown">
						<div class="pointer"><div class="pointer-inner"></div></div>
						<div class="dropdown-contents contact-icons">
																																								<div>
																	<a href="http://with-love-from-siberia.blogspot.com/" title="Website" class="last-cell">
										<span class="contact-icon phpbb_website-icon">Website</span>
									</a>
																	</div>
																					</div>
					</div>
				</div>
			</dd>
				
		</dl>

		<div class="postbody">
						<div id="post_content38865">

						<h3 ><a href="#p38865">Re: Detecting Process ID of the current cmd.exe</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting7961.html?mode=quote&amp;f=3&amp;p=38865" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic54a1.html?p=38865#p38865" onclick="prompt('Message #38',this.href); return false;">#38</a></span> 
									<a class="unread" href="viewtopic54a1.html?p=38865#p38865" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist5152.html?mode=viewprofile&amp;u=5284" class="username">siberia-man</a></strong> &raquo; </span>23 Dec 2014 11:55
			</p>
			
			
			
			<div class="content">Couple of issues<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>wmic process where &quot;Name='cmd.exe' and CommandLine like '%%&lt;!uid!&gt;%%'&quot; get ParentProcessID<br />...<br />do for /f &quot;delims=&quot; %%B in (&quot;%%A&quot;) do set &quot;PID=%%B&quot;<br /></code></pre></div><br /><br />In this code above <br />-- maybe !uid! should be replaced with %uid%<br />-- the extra trailing whitespaces come to the resulting string. I'd like to suppose the following wrokaround:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>wmic process where &quot;Name='cmd.exe' and CommandLine like '%%&lt;%uid%&gt;%%'&quot; get ParentProcessID<br />...<br />do for %%B in (%%A) do set &quot;PID=%%B&quot;<br /></code></pre></div></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p38870" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile38870">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha86d.html?author_id=2258&amp;sr=posts">2152</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 Feb 2011 21:02</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> United States (east coast)</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content38870">

						<h3 ><a href="#p38870">Re: Detecting Process ID of the current cmd.exe</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingb120.html?mode=quote&amp;f=3&amp;p=38870" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic7b3a.html?p=38870#p38870" onclick="prompt('Message #39',this.href); return false;">#39</a></span> 
									<a class="unread" href="viewtopic7b3a.html?p=38870#p38870" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a></strong> &raquo; </span>23 Dec 2014 12:38
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>penpen wrote:</cite>What i don't understand: Why are you using !uid! within the for loop ('wmic process ... !uid!...'):</div></blockquote><blockquote><div><cite>siberia-man wrote:</cite>Couple of issues<br />maybe !uid! should be replaced with %uid%<br /></div></blockquote>Aaargh <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" />  <img class="smilies" src="images/smilies/icon_redface.gif" alt=":oops:" title="Embarassed" /> <br />My intent was to eliminate all use of delayed expansion after the first ENDLOCAL, but I missed one. <img class="smilies" src="images/smilies/icon_sad.gif" alt=":(" title="Sad" /> <br /><br /><br /><blockquote><div><cite>siberia-man wrote:</cite>the extra trailing whitespaces come to the resulting string. I'd like to propose the following wrokaround:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>wmic process where &quot;Name='cmd.exe' and CommandLine like '%%&lt;%uid%&gt;%%'&quot; get ParentProcessID<br />...<br />do for %%B in (%%A) do set &quot;PID=%%B&quot;<br /></code></pre></div></div></blockquote>Another good find. I'm a bit embarrased that I didn't anticipate this one.<br /><br /><br />OK, this should be a final good version (sigh):<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br /><br />:getPID&nbsp; &#91;RtnVar&#93;<br />::<br />:: Store the Process ID (PID) of the currently running script in environment variable<br />:: RtnVar. If called without any argument, then simply write the PID to stdout.<br />::<br />setlocal disableDelayedExpansion<br />:getLock<br />set &quot;lock=%temp%\%~nx0.%time::=.%.lock&quot;<br />set &quot;uid=%lock:\=:b%&quot;<br />set &quot;uid=%uid:,=:c%&quot;<br />set &quot;uid=%uid:'=:q%&quot;<br />set &quot;uid=%uid:_=:u%&quot;<br />setlocal enableDelayedExpansion<br />set &quot;uid=!uid:%%=:p!&quot;<br />endlocal &amp; set &quot;uid=%uid%&quot;<br />2&gt;nul ( 9&gt;&quot;%lock%&quot; (<br />&nbsp; for /f &quot;skip=1&quot; %%A in (<br />&nbsp; &nbsp; 'wmic process where &quot;name='cmd.exe' and CommandLine like '%%&lt;%uid%&gt;%%'&quot; get ParentProcessID'<br />&nbsp; ) do for %%B in (%%A) do set &quot;PID=%%B&quot;<br />&nbsp; (call )<br />))||goto :getLock<br />del &quot;%lock%&quot; 2&gt;nul<br />endlocal &amp; if &quot;%~1&quot; equ &quot;&quot; (echo(%PID%) else set &quot;%~1=%PID%&quot;<br />exit /b<br /></code></pre></div><br /><br />Dave Benham</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p38874" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile38874">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist2675.html?mode=viewprofile&amp;u=2988" style="color: #00AA00;" class="username-coloured">Squashman</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search1322.html?author_id=2988&amp;sr=posts">3970</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 23 Dec 2011 13:59</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content38874">

						<h3 ><a href="#p38874">Re: Detecting Process ID of the current cmd.exe</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting2706.html?mode=quote&amp;f=3&amp;p=38874" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic80a6.html?p=38874#p38874" onclick="prompt('Message #40',this.href); return false;">#40</a></span> 
									<a class="unread" href="viewtopic80a6.html?p=38874#p38874" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist2675.html?mode=viewprofile&amp;u=2988" style="color: #00AA00;" class="username-coloured">Squashman</a></strong> &raquo; </span>23 Dec 2014 12:55
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>dbenham wrote:</cite>My intent was to eliminate all use of delayed expansion after the first ENDLOCAL, but I missed one. <img class="smilies" src="images/smilies/icon_sad.gif" alt=":(" title="Sad" /> <br />Another good find. I'm a bit embarrased that I didn't anticipate this one.<br /></div></blockquote><br />Just say a few Hail Marys and a few Our Fathers and all will be absolved.  <img class="smilies" src="images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" /></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p38911" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile38911">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistfcd9.html?mode=viewprofile&amp;u=4919" class="username">npocmaka_</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha36f.php?author_id=4919&amp;sr=posts">473</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 24 Jun 2013 17:10</dd>		
		
																<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Bulgaria</dd>
							
							<dd class="profile-contact">
				<strong>Contact:</strong>
				<div class="dropdown-container dropdown-left">
					<a href="#" class="dropdown-trigger" title="Contact npocmaka_">
						<i class="icon fa-commenting-o fa-fw icon-lg" aria-hidden="true"></i><span class="sr-only">Contact npocmaka_</span>
					</a>
					<div class="dropdown">
						<div class="pointer"><div class="pointer-inner"></div></div>
						<div class="dropdown-contents contact-icons">
																																								<div>
																	<a href="http://stackoverflow.com/questions/28043589/how-can-i-compres-zip-and-uncopress-unzip-files-and-folders-with-batch-f" title="Website" class="last-cell">
										<span class="contact-icon phpbb_website-icon">Website</span>
									</a>
																	</div>
																					</div>
					</div>
				</div>
			</dd>
				
		</dl>

		<div class="postbody">
						<div id="post_content38911">

						<h3 ><a href="#p38911">Re: Detecting Process ID of the current cmd.exe</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingf7a2.html?mode=quote&amp;f=3&amp;p=38911" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicd1a0-2.html?p=38911#p38911" onclick="prompt('Message #41',this.href); return false;">#41</a></span> 
									<a class="unread" href="viewtopicd1a0-2.html?p=38911#p38911" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistfcd9.html?mode=viewprofile&amp;u=4919" class="username">npocmaka_</a></strong> &raquo; </span>24 Dec 2014 12:29
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>carlos wrote:</cite>npocmaka, In my utility sound.exe source code found here I adapted the function for get the pid of parent cmd. <div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>http://www.consolesoft.com/p/bg/index.html</code></pre></div><br /><br />This is the pure c no c#:<br /><br />getpid.c<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>#include &lt;windows.h&gt;<br /><br />// compile with tdm-gcc<br />// gcc -Wl,-e,__start -nostartfiles -O3 -s getpid.c -o getpid.exe -Wall -Wextra<br /><br />typedef struct tagPROCESSENTRY32 {<br />&nbsp; &nbsp; DWORD dwSize;<br />&nbsp; &nbsp; DWORD cntUsage;<br />&nbsp; &nbsp; DWORD th32ProcessID;<br />&nbsp; &nbsp; ULONG_PTR th32DefaultHeapID;<br />&nbsp; &nbsp; DWORD th32ModuleID;<br />&nbsp; &nbsp; DWORD cntThreads;<br />&nbsp; &nbsp; DWORD th32ParentProcessID;<br />&nbsp; &nbsp; LONG pcPriClassBase;<br />&nbsp; &nbsp; DWORD dwFlags;<br />&nbsp; &nbsp; WCHAR szExeFile&#91;MAX_PATH&#93;;<br />} PROCESSENTRY32W, *LPPROCESSENTRY32W;<br /><br />HANDLE WINAPI CreateToolhelp32Snapshot(DWORD dwFlags, DWORD th32ProcessID);<br />BOOL WINAPI Process32FirstW(HANDLE hSnapshot, LPPROCESSENTRY32W lppe);<br />BOOL WINAPI Process32NextW(HANDLE hSnapshot, LPPROCESSENTRY32W lppe);<br />#define TH32CS_SNAPPROCESS&nbsp; &nbsp;0x2<br /><br /><br />DWORD GetIdOfParentProcess(void);<br />void _start(void);<br /><br />void _start(void)<br />{<br />&nbsp; &nbsp;ExitProcess(GetIdOfParentProcess());<br />}<br /><br />// Return the pid of parent process<br />// Return 0 if fails getting it<br />DWORD GetIdOfParentProcess(void)<br />{<br />&nbsp; &nbsp; HANDLE hSnap;<br />&nbsp; &nbsp; DWORD currentProcessId;<br />&nbsp; &nbsp; PROCESSENTRY32W pe;<br />&nbsp; &nbsp; BOOL fOk;<br /><br />&nbsp; &nbsp; hSnap = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);<br />&nbsp; &nbsp; if (hSnap == INVALID_HANDLE_VALUE) {<br />&nbsp; &nbsp;return 0;<br />&nbsp; &nbsp; }<br /><br />&nbsp; &nbsp; currentProcessId = GetCurrentProcessId();<br /><br />&nbsp; &nbsp; pe.dwSize = sizeof(PROCESSENTRY32W);<br /><br />&nbsp; &nbsp; for (fOk = Process32FirstW(hSnap, &amp;pe); fOk;<br />&nbsp; &nbsp; fOk = Process32NextW(hSnap, &amp;pe)) {<br />&nbsp; &nbsp;if (pe.th32ProcessID == currentProcessId) {<br />&nbsp; &nbsp;&nbsp; &nbsp; break;<br />&nbsp; &nbsp;}<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; CloseHandle(hSnap);<br />&nbsp; &nbsp; if (!fOk) {<br />&nbsp; &nbsp;return 0;<br />&nbsp; &nbsp; }<br /><br />&nbsp; &nbsp; return (pe.th32ParentProcessID);<br />}<br /><br /></code></pre></div><br /><br />You execute it and return in the errorlevel the pid.<br />This is the executable:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@Echo Off<br />Rem Script made using BHX { consolesoft.com/p/bhx }<br />SetLocal EnableExtensions EnableDelayedExpansion<br />Set &quot;bin=getpid.ex_&quot;<br />Set &quot;size=643&quot;<br />For %%# In (<br />&quot;getpid.exe&quot;<br />&quot;!bin!&quot; &quot;!bin!.da&quot; &quot;!bin!.tmp&quot;<br />) Do If Exist &quot;%%#&quot; (Del /A /F /Q &quot;%%#&quot; &gt;Nul<br />If ErrorLevel 1 Exit /B 1 )<br />Findstr /B /N &quot;:+res:!bin!:&quot; &quot;%~f0&quot; &gt;&quot;!bin!.tmp&quot;<br />(Set /P &quot;inioff=&quot; &amp;Set /P &quot;endoff=&quot;) &lt;&quot;!bin!.tmp&quot;<br />For /F &quot;delims=:&quot; %%# In (&quot;!inioff!&quot;) Do Set &quot;inioff=%%#&quot;<br />For /F &quot;delims=:&quot; %%# In (&quot;!endoff!&quot;) Do Set &quot;endoff=%%#&quot;<br />Set &quot;.=set o=createobject(#scripting.filesystemobject#)&quot;<br />Set &quot;.=!.!: set w=createobject(#adodb.stream#)&quot;<br />Set &quot;.=!.!: set r=o.opentextfile(#%~f0#,1,0,0)&quot;<br />Set &quot;.=!.!: w.charset=#windows-1252# : w.type=2 : w.open&quot;<br />Set &quot;.=!.!: for i=1 to !inioff! step 1 : r.readline : next&quot;<br />Set &quot;.=!.!: do while i&lt;!endoff! : d=r.readline&quot;<br />Set &quot;.=!.!: for j=1 to len(d) step 2&quot;<br />Set &quot;.=!.!: w.writetext chr(cbyte(#&amp;h#&amp;mid(d,j,2)))&quot;<br />Set &quot;.=!.!: next : i=i+1 : loop&quot;<br />Set &quot;.=!.!: w.savetofile #!bin!#,2&quot;<br />Set &quot;.=!.!: w.close : r.close&quot;<br />Set &quot;.=!.!: set w=nothing : set r=nothing : set o=nothing&quot;<br />Set &quot;.=!.:#=&quot;!&quot;<br />Echo !.!&gt;&quot;!bin!.da&quot;<br />Set &quot;ret=1&quot;<br />Cscript.exe /B /E:vbs &quot;!bin!.da&quot; &gt;Nul<br />For %%# In (&quot;!bin!&quot;) Do If &quot;%%~z#&quot;==&quot;!size!&quot; Set &quot;ret=0&quot;<br />If &quot;0&quot;==&quot;!ret!&quot; Expand.exe -r &quot;!bin!&quot; -F:* . &gt;Nul<br />If ErrorLevel 1 Set &quot;ret=1&quot;<br />Del /A /F &quot;!bin!&quot; &quot;!bin!.da&quot; &quot;!bin!.tmp&quot; &gt;Nul<br />Exit /B !ret!<br /><br />:+res:getpid.ex_:<br />4D5343460000000083020000000000002C000000000000000301010001000000<br />000000004700000001000100000800000000000000009645357D200067657470<br />69642E65786500DD597C9934020008434BF38D9AC0C0CCC0C0C002C4FFFF3330<br />EC6080000706C2A00188F9E477F1316CE13CABB883D1E7AC62484666B1424151<br />7E7A5162AE4272625E5E7E894252AA4251699E42669E828B7FB0426E7E4AAA1E<br />2F2F970AD48C005706061F466686A7A9334260E63E60E067E66664126760823A<br />0C0836080009010684EB406C268834234219C4E140F1E21606B0BF181814A0FA<br />04E0FA05903D61C0C0F08708BF920A5C80E6CAE091D72B49AD2801B9859101EE<br />173046020A0C01097A45298925890C0C2250AF208709C2CB060E7A9910757FA0<br />7E02AB63C3507700DD1DA19D4FC3C3821BDFF800D51F7751019B7C9C4505A4FB<br />C50620D179B8F90D87E181E6DFFF4B225E2C070AF46EDDF3F7FFFFCE1215964E<br />1995E3AD208E0E5075E7F1171381B240C5AD074A455F5B4015BC68810996A85A<br />EE3D02545CFA14245C0A14EE6EBD02E437BF61E94DFD121D171F7BB8B7448D01<br />24190194045A892AD1BB471DEADEE637122F5CFF03DDC0A2F2C21428340119FC<br />57F530706000D101503A044A4740691728ED03A1FF83523D28ED43E89106DC9D<br />9DAD14344A5272758D34154CF42CF40C4762288C5CA0618060BF3180945BD840<br />02503C0F88BB80780610AF03E2030684E582189C73F28B533D12F352725219F6<br />303817A52696A486E4E7E764A4E614181B05E725161467E4038B427146D78ACC<br />9280A2FCE4D4E26286FD8CEEA925CEA54545A9793031CF14864E6628DBD8C82D<br />B3A8B8249CA11B21E2072C51C361653A36ECED1AE4E7EA636CA4979293331AF3<br />100000<br />:+res:getpid.ex_:<br /><br /></code></pre></div></div></blockquote><br /><br />I've just ran this. It creates getpid.exe but when I run it there's no output (Win8.1x64).  <img class="smilies" src="images/smilies/icon_confused.gif" alt=":?" title="Confused" /></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p38916" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile38916">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist5b5d.html?mode=viewprofile&amp;u=3221" style="color: #00AA00;" class="username-coloured">foxidrive</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchf147.html?author_id=3221&amp;sr=posts">6033</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 10 Feb 2012 02:20</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content38916">

						<h3 ><a href="#p38916">Re: Detecting Process ID of the current cmd.exe</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting19d0.html?mode=quote&amp;f=3&amp;p=38916" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicd562.html?p=38916#p38916" onclick="prompt('Message #42',this.href); return false;">#42</a></span> 
									<a class="unread" href="viewtopicd562.html?p=38916#p38916" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist5b5d.html?mode=viewprofile&amp;u=3221" style="color: #00AA00;" class="username-coloured">foxidrive</a></strong> &raquo; </span>24 Dec 2014 20:04
			</p>
			
			
			
			<div class="content">Add the top three lines and try it: it works in Win 8.1 32 bit<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>getpid<br />echo %errorlevel%<br />pause<br />Exit /B !ret!<br /><br />:+res:getpid.ex_:<br /></code></pre></div></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p38919" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile38919">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistfcd9.html?mode=viewprofile&amp;u=4919" class="username">npocmaka_</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha36f.php?author_id=4919&amp;sr=posts">473</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 24 Jun 2013 17:10</dd>		
		
																<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Bulgaria</dd>
							
							<dd class="profile-contact">
				<strong>Contact:</strong>
				<div class="dropdown-container dropdown-left">
					<a href="#" class="dropdown-trigger" title="Contact npocmaka_">
						<i class="icon fa-commenting-o fa-fw icon-lg" aria-hidden="true"></i><span class="sr-only">Contact npocmaka_</span>
					</a>
					<div class="dropdown">
						<div class="pointer"><div class="pointer-inner"></div></div>
						<div class="dropdown-contents contact-icons">
																																								<div>
																	<a href="http://stackoverflow.com/questions/28043589/how-can-i-compres-zip-and-uncopress-unzip-files-and-folders-with-batch-f" title="Website" class="last-cell">
										<span class="contact-icon phpbb_website-icon">Website</span>
									</a>
																	</div>
																					</div>
					</div>
				</div>
			</dd>
				
		</dl>

		<div class="postbody">
						<div id="post_content38919">

						<h3 ><a href="#p38919">Re: Detecting Process ID of the current cmd.exe</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingb191.html?mode=quote&amp;f=3&amp;p=38919" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicfada.html?p=38919#p38919" onclick="prompt('Message #43',this.href); return false;">#43</a></span> 
									<a class="unread" href="viewtopicfada.html?p=38919#p38919" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistfcd9.html?mode=viewprofile&amp;u=4919" class="username">npocmaka_</a></strong> &raquo; </span>25 Dec 2014 02:40
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>foxidrive wrote:</cite>Add the top three lines and try it: it works in Win 8.1 32 bit<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>...<br /></code></pre></div></div></blockquote><br /><br />Aghh. The PID is returned in the exitcode. Thanks.</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54402" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile54402">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist2675.html?mode=viewprofile&amp;u=2988" style="color: #00AA00;" class="username-coloured">Squashman</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search1322.html?author_id=2988&amp;sr=posts">3970</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 23 Dec 2011 13:59</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content54402">

						<h3 ><a href="#p54402">Re: Detecting Process ID of the current cmd.exe</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingda6a.html?mode=quote&amp;f=3&amp;p=54402" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic0aff.html?p=54402#p54402" onclick="prompt('Message #44',this.href); return false;">#44</a></span> 
									<a class="unread" href="viewtopic0aff.html?p=54402#p54402" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist2675.html?mode=viewprofile&amp;u=2988" style="color: #00AA00;" class="username-coloured">Squashman</a></strong> &raquo; </span>14 Oct 2017 14:37
			</p>
			
			
			
			<div class="content">Could this be done in a batch file?<br /><a href="https://stackoverflow.com/questions/27379693/how-can-i-find-out-from-within-a-bat-or-ps1-script-if-it-was-started-by" class="postlink">How can I find out, from within a .bat- (or .ps1-) script, if it was started by the task scheduler?</a><br /><br />One thing I did test was to see what the variable CMDCMDLINE output.<br /><br />On Windows 10 I noticed that when Task Scheduler Launched the batch file CMDCMDLINE only had one set of quotes.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\WINDOWS\SYSTEM32\cmd.exe /c &quot;C:\Batch\cmdline.bat&quot;</code></pre></div><br /><br />But when I double click the batch file CMDCMDLINE had two sets of quotes.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\WINDOWS\system32\cmd.exe /c &quot;&quot;C:\Batch\cmdline.bat&quot; &quot;</code></pre></div><br /><br />When the batch file is run from a CMD prompt.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\Batch&gt;cmdline.bat<br />&quot;C:\WINDOWS\System32\cmd.exe&quot;</code></pre></div><br /><br />Or would there be a way to find the parent process to determine if it was launched by Task Scheduler?</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54403" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile54403">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search661c.html?author_id=1265&amp;sr=posts">3386</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 22 Jan 2010 18:01</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Germany</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54403">

						<h3 ><a href="#p54403">Re: Detecting Process ID of the current cmd.exe</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting7cc9.html?mode=quote&amp;f=3&amp;p=54403" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicf41d.html?p=54403#p54403" onclick="prompt('Message #45',this.href); return false;">#45</a></span> 
									<a class="unread" href="viewtopicf41d.html?p=54403#p54403" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a></strong> &raquo; </span>14 Oct 2017 15:33
			</p>
			
			
			
			<div class="content">I created a scheduled task in order to quickly get an elevalted prompt.<br />&quot;Program&quot; is set to<br /><em class="text-italics">C:\WINDOWS\System32\cmd.exe</em><br />and &quot;Arguments&quot; to<br /><em class="text-italics">/c start cmd /k &quot;cd /d &quot;C:\Users\steffen\Desktop&quot;&amp;color 1f&quot;</em><br />Guess what the content of cmdcmdline is<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\Users\steffen\Desktop&gt;echo %cmdcmdline%<br />cmd&nbsp; /k &quot;cd /d &quot;C:\Users\steffen\Desktop&quot;&amp;color 1f&quot;<br /><br />C:\Users\steffen\Desktop&gt;</code></pre></div><br /><br />However as soon as you found the current PID (and Dave's approach seems to be working) it's just the same procedure as in the SO thread.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />call :getPID currentPID<br /><br />for /f &quot;tokens=2 delims==&quot; %%i in (<br />&nbsp; 'wmic process where &quot;ProcessID=%currentPID%&quot; get ParentProcessID /value'<br />) do for /f %%j in (&quot;%%i&quot;) do for /f &quot;skip=1 tokens=* eol=&quot; %%k in (<br />&nbsp; 'wmic process where &quot;ProcessID=%%j&quot; get Caption'<br />) do for /f &quot;tokens=* eol=&quot; %%l in (&quot;%%k&quot;) do set &quot;parentProc=%%~nxl&quot;<br /><br />echo &quot;%parentProc%&quot;<br />pause<br />exit /b<br /><br /><br />:getPID&nbsp; &#91;RtnVar&#93;<br />::<br />:: Store the Process ID (PID) of the currently running script in environment variable<br />:: RtnVar. If called without any argument, then simply write the PID to stdout.<br />::<br />setlocal disableDelayedExpansion<br />:getLock<br />set &quot;lock=%temp%\%~nx0.%time::=.%.lock&quot;<br />set &quot;uid=%lock:\=:b%&quot;<br />set &quot;uid=%uid:,=:c%&quot;<br />set &quot;uid=%uid:'=:q%&quot;<br />set &quot;uid=%uid:_=:u%&quot;<br />setlocal enableDelayedExpansion<br />set &quot;uid=!uid:%%=:p!&quot;<br />endlocal &amp; set &quot;uid=%uid%&quot;<br />2&gt;nul ( 9&gt;&quot;%lock%&quot; (<br />&nbsp; for /f &quot;skip=1&quot; %%A in (<br />&nbsp; &nbsp; 'wmic process where &quot;name='cmd.exe' and CommandLine like '%%&lt;%uid%&gt;%%'&quot; get ParentProcessID'<br />&nbsp; ) do for %%B in (%%A) do set &quot;PID=%%B&quot;<br />&nbsp; (call )<br />))||goto :getLock<br />del &quot;%lock%&quot; 2&gt;nul<br />endlocal &amp; if &quot;%~1&quot; equ &quot;&quot; (echo(%PID%) else set &quot;%~1=%PID%&quot;<br />exit /b</code></pre></div><br />Steffen</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
	

	<div class="action-bar bar-bottom">
	
			<a href="posting5498.html?mode=reply&amp;f=3&amp;t=6133" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
		
		<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic7b1c.html?f=3&amp;t=6133&amp;start=30&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>

			<form method="post" action="https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=6133&amp;start=30">
		<div class="dropdown-container dropdown-container-left dropdown-button-control sort-tools">
	<span title="Display and sorting options" class="button button-secondary dropdown-trigger dropdown-select">
		<i class="icon fa-sort-amount-asc fa-fw" aria-hidden="true"></i>
		<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
	</span>
	<div class="dropdown hidden">
		<div class="pointer"><div class="pointer-inner"></div></div>
		<div class="dropdown-contents">
			<fieldset class="display-options">
							<label>Display: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
								<label>Sort by: <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label>
				<label>Direction: <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select></label>
								<hr class="dashed" />
				<input type="submit" class="button2" name="sort" value="Go" />
						</fieldset>
		</div>
	</div>
</div>
		</form>
	
	
	
			<div class="pagination">
			47 posts
							<ul>
			<li class="arrow previous"><a class="button button-icon-only" href="viewtopicab3d-2.html?f=3&amp;t=6133&amp;start=15" rel="prev" role="button"><i class="icon fa-chevron-left fa-fw" aria-hidden="true"></i><span class="sr-only">Previous</span></a></li>
				<li><a class="button" href="viewtopic5789.html?f=3&amp;t=6133" role="button">1</a></li>
				<li><a class="button" href="viewtopicab3d-2.html?f=3&amp;t=6133&amp;start=15" role="button">2</a></li>
			<li class="active"><span>3</span></li>
				<li><a class="button" href="viewtopicad89.html?f=3&amp;t=6133&amp;start=45" role="button">4</a></li>
				<li class="arrow next"><a class="button button-icon-only" href="viewtopicad89.html?f=3&amp;t=6133&amp;start=45" rel="next" role="button"><i class="icon fa-chevron-right fa-fw" aria-hidden="true"></i><span class="sr-only">Next</span></a></li>
	</ul>
					</div>
	</div>


<div class="action-bar actions-jump">
		<p class="jumpbox-return">
		<a href="viewforum4d6b.html?f=3" class="left-box arrow-left" accesskey="r">
			<i class="icon fa-angle-left fa-fw icon-black" aria-hidden="true"></i><span>Return to “DOS Batch Forum”</span>
		</a>
	</p>
	
		<div class="jumpbox dropdown-container dropdown-container-right dropdown-up dropdown-left dropdown-button-control" id="jumpbox">
			<span title="Jump to" class="button button-secondary dropdown-trigger dropdown-select">
				<span>Jump to</span>
				<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
			</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																				<li><a href="viewforum31e6.html?f=4" class="jumpbox-cat-link"> <span> DosTips - Dos Batch</span></a></li>
																<li><a href="viewforum4d6b.html?f=3" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; DOS Batch Forum</span></a></li>
											</ul>
		</div>
	</div>

	</div>


			</div>


<div id="page-footer" class="page-footer" role="contentinfo">
	<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-footer" class="nav-footer linklist" role="menubar">
		<li class="breadcrumbs">
							<span class="crumb"><a href="../index.html" data-navbar-reference="home"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span>DosTips.com</span></a></span>									<span class="crumb"><a href="index.html" data-navbar-reference="index"><span>Board index</span></a></span>					</li>
		
				<li class="rightside">All times are <span title="UTC-6">UTC-06:00</span></li>
							<li class="rightside">
				<a href="ucp033a.html?mode=delete_cookies" data-ajax="true" data-refresh="true" role="menuitem">
					<i class="icon fa-trash fa-fw" aria-hidden="true"></i><span>Delete all board cookies</span>
				</a>
			</li>
												<li class="rightside" data-last-responsive="true">
				<a href="memberlist4bfd.html?mode=team" role="menuitem">
					<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
				</a>
			</li>
									<li class="rightside" data-last-responsive="true">
				<a href="memberlist8733.html?mode=contactadmin" role="menuitem">
					<i class="icon fa-envelope fa-fw" aria-hidden="true"></i><span>Contact us</span>
				</a>
			</li>
			</ul>

	</div>
</div>

	<div class="copyright">
				<!-- WARNING NO DELETE -->Style developer by <a href="http://tricolor.x-tk.ru/">support forum tricolor</a>, <!-- END WARNING NO DELETE -->Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
									</div>

	<div id="darkenwrapper" class="darkenwrapper" data-ajax-error-title="AJAX error" data-ajax-error-text="Something went wrong when processing your request." data-ajax-error-text-abort="User aborted request." data-ajax-error-text-timeout="Your request timed out; please try again." data-ajax-error-text-parsererror="Something went wrong with the request and the server returned an invalid reply.">
		<div id="darken" class="darken">&nbsp;</div>
	</div>

	<div id="phpbb_alert" class="phpbb_alert" data-l-err="Error" data-l-timeout-processing-req="Request timed out.">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<h3 class="alert_title">&nbsp;</h3><p class="alert_text"></p>
	</div>
	<div id="phpbb_confirm" class="phpbb_alert">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<div class="alert_text"></div>
	</div>
</div>

</div>

<div>
	<a id="bottom" class="anchor" accesskey="z"></a>
	<img src="cron5897.gif?cron_type=cron.task.text_reparser.poll_option" width="1" height="1" alt="cron" /></div>

<script type="text/javascript" src="assets/javascript/jquery.mind772.js?assets_version=34"></script>
<script type="text/javascript" src="assets/javascript/cored772.js?assets_version=34"></script>



<script type="text/javascript" src="styles/prosilver/template/forum_fnd772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/prosilver/template/ajaxd772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/AllanStyle-SUBSILVER/template/jquery-uid772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/AllanStyle-SUBSILVER/template/collapsed772.js?assets_version=34"></script>



</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=6133&start=30 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:23:57 GMT -->
</html>
