<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=6044&start=375&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 05:09:29 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>DosTips.com &bull; JREPL.BAT v7.14 - regex text processor now with Unicode and XRegExp support - Page 26</title>

<link href="styles/AllanStyle-SUBSILVER/theme/print.css" rel="stylesheet">
</head>
<body id="phpbb">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>DosTips.com</h1>
		<p>A Forum all about DOS Batch<br /><a href="index-2.html">https://www.dostips.com/forum/</a></p>

		<h2>JREPL.BAT v7.14 - regex text processor now with Unicode and XRegExp support</h2>
		<p><a href="viewtopicb16d.html?f=3&amp;t=6044">https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=6044</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>26</strong> of <strong>27</strong></div>
					<div class="post">
				<h3>Re: JREPL.BAT v7.13 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>20 Jul 2018 02:39</strong></div>
				<div class="author">by <strong>aGerman</strong></div>
				<div class="content">I see. To be honest I really expected to have ADO by default at least on XP and onwards because it was already introduced in the late 1990's and I never worked on a machine where it wasn't installed. I'll keep my eyes open. If I find something about its availability then I'll get back to you.<br>
<br>
Steffen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.13 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>20 Jul 2018 06:04</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">There may be confusion over ADO vs ADO.NET.<br>
<br>
ADO.NET certainly is not guaranteed to be present, and I may have read something that confused the two, or I may have misinterpreted what I read.<br>
<br>
I can't find anything that indicates ADO is not standard, even for XP Home. I see articles about it not working in some cases, but they seem to be about compatibility issues that are solved by standard updates.<br>
<br>
My StackOverflow tester was on XP SP3 without .NET, and 7.13 worked just fine. But he did not specify Home or Pro.<br>
<br>
I'm almost ready to pull the trigger and drop the CERTUTIL code, but not quite there.<br>
<br>
<br>
Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.13 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>20 Jul 2018 13:52</strong></div>
				<div class="author">by <strong>aGerman</strong></div>
				<div class="content"><blockquote><div><cite><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258">dbenham</a> wrote: <a href="viewtopic3b24.html?p=57512#p57512" data-post-id="57512" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">20 Jul 2018 06:04</div></cite>ADO vs ADO.NET</div></blockquote>
I think you nailed it.<br>
Finally you need to worry about upward compatibility rather than downward compatibility. Microsoft already tries forcing us to use .NET. Powershell is set as default console on Win 10. They want us to use C#.NET rather than C/Win32 API and thus, it's a logical consequence to have ADO.NET as successor of ADO ... <br>
<br>
Steffen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.13 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>18 Sep 2018 11:32</strong></div>
				<div class="author">by <strong>fdart17</strong></div>
				<div class="content">Hi dbenham,<br>
<br>
Thank you very much for writing and maintaining this script.<br>
<br>
Within the context of a cmd.exe in Windows 10, I'm calling a batch script which then invokes an exe to do a C++ build.  I want to modify the output to the cmd prompt to color warnings in yellow and errors in red.  This seems like a good application of this script.  Is it possible to invoke jrepl in such a way that it will attach itself to the existing cmd prompt, running continuously to intercept incoming output and modify it before it is displayed to add ansi escape characters, while still allowing the user to interact with the existing cmd prompt to invoke more commands?<br>
<br>
Thanks,<br>
Justin</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.13 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>18 Sep 2018 14:21</strong></div>
				<div class="author">by <strong>Squashman</strong></div>
				<div class="content"><blockquote><div><cite><a href="memberlist4b4f.html?mode=viewprofile&amp;u=9387">fdart17</a> wrote: <a href="viewtopic6e12.html?p=58006#p58006" data-post-id="58006" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">18 Sep 2018 11:32</div></cite>
Hi dbenham,<br>
<br>
Thank you very much for writing and maintaining this script.<br>
<br>
Within the context of a cmd.exe in Windows 10, I'm calling a batch script which then invokes an exe to do a C++ build.  I want to modify the output to the cmd prompt to color warnings in yellow and errors in red.  This seems like a good application of this script.  Is it possible to invoke jrepl in such a way that it will attach itself to the existing cmd prompt, running continuously to intercept incoming output and modify it before it is displayed to add ansi escape characters, while still allowing the user to interact with the existing cmd prompt to invoke more commands?<br>
<br>
Thanks,<br>
Justin
</div></blockquote>
Going to assume this is you: <a href="https://stackoverflow.com/questions/52392242/how-to-intercept-output-to-windows-10-cmd-exe-and-modify-to-add-color" class="postlink">https://stackoverflow.com/questions/523 ... -add-color</a></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.13 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>18 Sep 2018 15:12</strong></div>
				<div class="author">by <strong>fdart17</strong></div>
				<div class="content">Yes, that is me.<br>
<br>
I wanted to post an update here to not waste anyone's time.  I've found another solution to the problem which happens to not leverage JREPL.BAT.<br>
<a href="https://stackoverflow.com/questions/52392242/how-to-intercept-output-to-windows-10-cmd-exe-and-modify-to-add-color" class="postlink">https://stackoverflow.com/questions/523 ... -add-color</a><br>
<br>
It's still not as good as I would like, so I will keep searching for a better solution <img class="smilies" src="images/smilies/icon_smile.gif" width="15" height="15" alt=":)" title="Smile"></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.13 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>12 Oct 2018 19:10</strong></div>
				<div class="author">by <strong>Michael.Uray</strong></div>
				<div class="content">I got the message
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>JScript runtime error: Nicht genügend Arbeitsspeicher.</code></pre></div> (means not enough RAM / memory)<br>
<br>
when I did run a regex search/replace:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>JREPL.BAT "^\d+ 0 obj \n(?:(?!endobj $).*\n)*?\/Name \/Paragraph(?:.*\n)*?endobj ?$" "" /F input.pdf /M /O output.pdf</code></pre></div>

It happens when the cscript.exe process memor runs up to 3GB.<br>
<br>
There is actually enough free RAM.<br>
Any ideas?</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.13 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>12 Oct 2018 20:03</strong></div>
				<div class="author">by <strong>Squashman</strong></div>
				<div class="content">You are using the /M option.  You are limited to 2GB of ram for 32 bit applications.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.13 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>13 Oct 2018 03:07</strong></div>
				<div class="author">by <strong>Michael.Uray</strong></div>
				<div class="content"><blockquote><div><cite><a href="memberlist2675.html?mode=viewprofile&amp;u=2988">Squashman</a> wrote: <a href="viewtopic553f.html?p=58131#p58131" data-post-id="58131" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">12 Oct 2018 20:03</div></cite>
You are using the /M option.  You are limited to 2GB of ram for 32 bit applications.
</div></blockquote>
I need to parse multi line files like this <a href="https://regex101.com/r/fA6wE2/155" class="postlink">https://regex101.com/r/fA6wE2/155</a> to search for objects which contain "Name /Paragraph".<br>
The file has about 1.5 GB.<br>
<br>
Any idea how to get around this issue?</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.13 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>14 Oct 2018 17:36</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">Unfortunately there is no way to circumvent the file size limit when using the /M option. I'm not sure the exact limit, but it is actually less than 1 GB.<br>
<br>
You may still be able to use JREPL if you ditch the /M option and combine the /T option with /JMATCH and custom JScript. You don't state what your end goal is. The code below simply preserves object entries that contain a "/Name /Paragraph" line, and throws everything else away.
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off
setlocal

set "init=var obj=false, keep=false, eol='\n'"

set "find1=^\d+ 0 obj\s*$"
set "repl1=obj=$0+eol;$txt=false;"

set "find2=^/Name /Paragraph\s*$"
set "repl2=if (obj){obj+=$0+eol;keep=true;}$txt=false;"

set "find3=^endobj\s*$"
set "repl3=$txt=keep?obj+$0:false;obj=keep=false;"

set "find4=^.*$"
set "repl4=if (obj){obj+=$0+eol;}$txt=false;"

set "find=%find1%|%find2%|%find3%|%find4%"
set "repl=%repl1%|%repl2%|%repl3%|%repl4%"

call jrepl find repl /t "|" /jmatchq /jbeg init /v /u /f input.pdf /o output.pdf

exit /b
</code></pre></div>

Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.13 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>15 Oct 2018 05:58</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">Upon looking closer at your original code, it looks like you are trying to remove all the objects that contain "/Name /Paragraph".
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off
setlocal

set "init=var obj='', keep=true, eol='\n'"

set "find1=^\d+ 0 obj\s*$"
set "repl1=obj=$0+eol;$txt=false;"

set "find2=^/Name /Paragraph\s*$"
set "repl2=if (obj)keep=$txt=false; else $txt=$0;"

set "find3=^endobj\s*$"
set "repl3=$txt=keep?obj+$0:false;obj='';keep=true;"

set "find4=^.*$"
set "repl4=if (obj){$txt=false;if (keep)obj+=$0+eol;}else $txt=$0;"

set "find=%find1%|%find2%|%find3%|%find4%"
set "repl=%repl1%|%repl2%|%repl3%|%repl4%"

call jrepl find repl /t "|" /jmatchq /jbeg init /v /u /f input.pdf /o output.pdf

exit /b
</code></pre></div>

Note - It would probably be just as easy to write a custom JScript script as it is to use JREPL as I have done. And custom JScript would probably be a bit faster.<br>
<br>
<br>
Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.13 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>15 Oct 2018 07:05</strong></div>
				<div class="author">by <strong>Michael.Uray</strong></div>
				<div class="content"><blockquote><div><cite><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258">dbenham</a> wrote: <a href="viewtopic349a.html?p=58139#p58139" data-post-id="58139" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">15 Oct 2018 05:58</div></cite>
Upon looking closer at your original code, it looks like you are trying to remove all the objects that contain "/Name /Paragraph".
</div></blockquote>
This is correct.<br>
<br>
I had to replace the variable assignment to the command to run it, but it does not create the expected output.
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>call jrepl "%find%" "%repl%" /t "|" /jmatchq /jbeg init /v /u /f input.pdf /o output.pdf
</code></pre></div>

The output file (71MB) gets much larger than the input file (7MB) for some reason.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.13 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>15 Oct 2018 08:21</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><blockquote><div><cite><a href="memberlistaa1a.html?mode=viewprofile&amp;u=9422">Michael.Uray</a> wrote: <a href="viewtopic678a.html?p=58140#p58140" data-post-id="58140" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">15 Oct 2018 07:05</div></cite>
I had to replace the variable assignment to the command to run it, but it does not create the expected output.
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>call jrepl "%find%" "%repl%" /t "|" /jmatchq /jbeg init /v /u /f input.pdf /o output.pdf
</code></pre></div>

The output file (71MB) gets much larger than the input file (7MB) for some reason.
</div></blockquote>
No, the find and repl must not be enclosed by percents in the JREPL call.<br>
<br>
I tested the code against the input that you provided in the link, and it worked perfectly for me. But then I added some additional lines at the top of the input that were not contained in an "object", and it began behaving badly. I did some testing, and it appears there is a newly discovered bug - there are internal str and obj objects within the code that interfere with the user supplied JScript if /JBEG defines a variable named str or obj.<br>
<br>
I was able to get the code to work properly if I changed obj to Obj:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off
setlocal

set "init=var Obj='', keep=true, eol='\n';"

set "find1=^\d+ 0 obj\s*$"
set "repl1=Obj=$0+eol;$txt=false;"

set "find2=^/Name /Paragraph\s*$"
set "repl2=if (Obj)keep=$txt=false; else $txt=$0;"

set "find3=^endobj\s*$"
set "repl3=$txt=keep?Obj+$0:false;Obj='';keep=true;"

set "find4=^.*$"
set "repl4=if (Obj!==''){$txt=false;if (keep)Obj+=$0+eol;}else $txt=$0;"

set "find=%find1%|%find2%|%find3%|%find4%"
set "repl=%repl1%|%repl2%|%repl3%|%repl4%"

call jrepl find repl /t "|" /jmatchq /jbeg init /v /u /f input.pdf /o output.pdf

exit /b
</code></pre></div>

<br>
<strong class="text-strong">Update</strong> - I fixed the bug and released version 7.14. The original code using obj should now work.<br>
<br>
Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.14 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>15 Oct 2018 13:21</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><span style="font-size: 150%; line-height: normal">Here is version 7.14</span>
<div class="inline-attachment">
			
		
		
				<dl class="file">
			<dt><span class="imageset icon_topic_attach"></span> <a class="postlink" href="download/filed08d.php?id=386">JREPL7.14.zip</a></dt>
						<dd>(27.24 KiB) Downloaded 6 times</dd>
		</dl>
		
		
			</div>

<br>
This is simply a bug fix to allow user defined variables named str and/or obj, and to hide the internal xbytes variable from user code.
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>    2018-10-15 v7.14: Bug fix - User defined variables declared in /JBEG named
                      str and/or obj were getting clobbered.
                      Bug fix - Internal variable xbytes was visibile to user
                      supplied JScript.
</code></pre></div>

<br>
Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.13 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>15 Oct 2018 14:33</strong></div>
				<div class="author">by <strong>Michael.Uray</strong></div>
				<div class="content"><blockquote><div><cite><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258">dbenham</a> wrote: <a href="viewtopic4b3b.html?p=58141#p58141" data-post-id="58141" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">15 Oct 2018 08:21</div></cite>
<blockquote><div><cite><a href="memberlistaa1a.html?mode=viewprofile&amp;u=9422">Michael.Uray</a> wrote: <a href="viewtopic678a.html?p=58140#p58140" data-post-id="58140" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">15 Oct 2018 07:05</div></cite>
I had to replace the variable assignment to the command to run it, but it does not create the expected output.
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>call jrepl "%find%" "%repl%" /t "|" /jmatchq /jbeg init /v /u /f input.pdf /o output.pdf
</code></pre></div>
</div></blockquote>
No, the find and repl must not be enclosed by percents in the JREPL call.
</div></blockquote>
Hmm, I had to add that again in the .cmd file.<br>
"find" and "repl" are envirnment variables so I have to use them with "%" on the beginn and on the end, right?<br>
I have to also put it under quotes because the string (^\d+ 0 obj\s*$|^/Name /Paragraph\s*$|^endobj\s*$|^.*$) contains empty spaces, right?<br>
<br>
The output is still a 70 MB file, maybe I should send you the input file via PM that you are able to recreate the problem.</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="UTC-6">UTC-06:00</span><br />Page <strong>26</strong> of <strong>27</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Limited<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=6044&start=375&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 05:09:29 GMT -->
</html>
