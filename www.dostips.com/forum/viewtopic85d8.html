<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=5819&start=45&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 07:05:08 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>DosTips.com &bull; Dos Batch Math Library - Page 4</title>

<link href="styles/AllanStyle-SUBSILVER/theme/print.css" rel="stylesheet">
</head>
<body id="phpbb">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>DosTips.com</h1>
		<p>A Forum all about DOS Batch<br /><a href="index-2.html">https://www.dostips.com/forum/</a></p>

		<h2>Dos Batch Math Library</h2>
		<p><a href="viewtopic8d84.html?f=3&amp;t=5819">https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=5819</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>4</strong> of <strong>4</strong></div>
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>18 Nov 2015 15:22</strong></div>
				<div class="author">by <strong>Squashman</strong></div>
				<div class="content">I see it as a unary operator in my help.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>The /A switch specifies that the string to the right of the equal sign<br />is a numerical expression that is evaluated.&nbsp; The expression evaluator<br />is pretty simple and supports the following operations, in decreasing<br />order of precedence:<br /><br />&nbsp; &nbsp; ()&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - grouping<br />&nbsp; &nbsp; ! ~ -&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- unary operators<br />&nbsp; &nbsp; * / %&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- arithmetic operators<br />&nbsp; &nbsp; + -&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- arithmetic operators<br />&nbsp; &nbsp; &lt;&lt; &gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- logical shift<br />&nbsp; &nbsp; &amp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- bitwise and<br />&nbsp; &nbsp; ^&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- bitwise exclusive or<br />&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- bitwise or<br />&nbsp; &nbsp; = *= /= %= += -=&nbsp; &nbsp; - assignment<br />&nbsp; &nbsp; &nbsp; &amp;= ^= |= &lt;&lt;= &gt;&gt;=<br />&nbsp; &nbsp; ,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- expression separator</code></pre></div></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>18 Nov 2015 15:42</strong></div>
				<div class="author">by <strong>Ed Dyreen</strong></div>
				<div class="content">Good for you, as you see not in my help but implemented luckily<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Microsoft Windows XP &#91;versie 5.1.2600&#93;<br />(C) Copyright 1985-2001 Microsoft Corp.<br /><br />C:\profSys\ADMIN&gt;set /?<br />...<br />&nbsp; &nbsp; ()&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - groepering<br />&nbsp; &nbsp; * / %&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - rekenkundige operators<br />&nbsp; &nbsp; + -&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- rekenkundige operators<br />&nbsp; &nbsp; &lt;&lt; &gt;&gt;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- logische verschuiving<br />&nbsp; &nbsp; &amp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- And per bit<br />&nbsp; &nbsp; ^&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- Uitsluitende Or per bit<br />&nbsp; &nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- Or per bit<br />&nbsp; &nbsp; = *= /= %= += -=&nbsp; &nbsp;- toewijzing<br />&nbsp; &nbsp; &nbsp; &amp;= ^= |= &lt;&lt;= &gt;&gt;=<br />&nbsp; &nbsp; ,&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- expressie-scheidingsteken<br />...<br /></code></pre></div></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>18 Nov 2015 15:46</strong></div>
				<div class="author">by <strong>Squashman</strong></div>
				<div class="content">I would ask Microsoft for a patch to fix that!</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>18 Nov 2015 15:49</strong></div>
				<div class="author">by <strong>Ed Dyreen</strong></div>
				<div class="content">I take, is ok <img class="smilies" src="images/smilies/icon_mrgreen.gif" alt=":mrgreen:" title="Mr. Green" /></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>18 Nov 2015 17:01</strong></div>
				<div class="author">by <strong>penpen</strong></div>
				<div class="content">Sad to say:<br />I could not find the sqrt algorithm, i was talking about above... .<br /><br />All i could remember was, it bases on this one...<br />but somehow the appending is fixed, so that the in between results fit in signed int 32 bit numbers...<br />maybe someone could remember(/find?) it, when i post the scetch of the easier one:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Example:<br />sqrt(201918) =<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 digits groups&nbsp; &lt;- from decimal .<br />&nbsp; &nbsp; &nbsp;20|19|18. = 449.35286(80...)<br />&nbsp; &nbsp; - 1&nbsp; &nbsp;&lt;- topleft 1<br />&nbsp; &nbsp; - 3&nbsp; &nbsp;&lt;- +2<br />&nbsp; &nbsp; - 5&nbsp; &nbsp;&lt;- +2&nbsp; &nbsp;(+2 as long as result &gt;=0)<br />&nbsp; &nbsp; - 7&nbsp; &nbsp;&lt;- +2&nbsp; &nbsp;(4 numbers: 1, 3, 5, 7 =&gt; 4 is the first digit of the result)<br />&nbsp; &nbsp; &nbsp;------<br />&nbsp; &nbsp;=&nbsp; 419&nbsp; &nbsp;&lt;- substract; append next group at the end<br />&nbsp; &nbsp; &nbsp;- 81&nbsp; &nbsp;&lt;- current result * 2 *10 + 1 (. ignored)<br />&nbsp; &nbsp; &nbsp;- 83&nbsp; &nbsp;&lt;- +2<br />&nbsp; &nbsp; &nbsp;- 85&nbsp; &nbsp;&lt;- +2<br />&nbsp; &nbsp; &nbsp;- 87&nbsp; &nbsp;&lt;- +2 (4 numbers=&gt; next result digit: 4)<br />&nbsp; &nbsp; &nbsp;--------<br />&nbsp; &nbsp; &nbsp; &nbsp;8318&nbsp; &nbsp;&lt;- substract; append next group at the end<br />&nbsp; &nbsp; &nbsp; - 881&nbsp; &nbsp;&lt;- current result * 2 *10 + 1 (. ignored)<br />&nbsp; &nbsp; &nbsp; - 883&nbsp; &nbsp;&lt;- +2<br />&nbsp; &nbsp; &nbsp; - 885&nbsp; &nbsp;&lt;- +2<br />&nbsp; &nbsp; &nbsp; - 887&nbsp; &nbsp;&lt;- +2<br />&nbsp; &nbsp; &nbsp; - 889&nbsp; &nbsp;&lt;- +2<br />&nbsp; &nbsp; &nbsp; - 891&nbsp; &nbsp;&lt;- +2<br />&nbsp; &nbsp; &nbsp; - 893&nbsp; &nbsp;&lt;- +2<br />&nbsp; &nbsp; &nbsp; - 895&nbsp; &nbsp;&lt;- +2<br />&nbsp; &nbsp; &nbsp; - 897&nbsp; &nbsp;&lt;- +2 (9 numbers=&gt; next result digit: 9)<br />&nbsp; &nbsp; &nbsp; --------<br />&nbsp; &nbsp; &nbsp; &nbsp; 31700 &lt;- substract; append next group (add . to result, as next group is after decimal digit first time &quot;00&quot; default)<br />&nbsp; &nbsp; &nbsp; &nbsp;- 8981 &lt;- current result * 2 *10 + 1 (. ignored)<br />&nbsp; &nbsp; &nbsp; &nbsp;- 8983 &lt;- +2<br />&nbsp; &nbsp; &nbsp; &nbsp;- 8985 &lt;- +2 (3 numbers=&gt; next result digit: 3)<br />&nbsp; &nbsp; &nbsp; &nbsp;---------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;475100 ...<br />&nbsp; &nbsp; &nbsp; &nbsp; - 89861<br />&nbsp; &nbsp; &nbsp; &nbsp; - 89863<br />&nbsp; &nbsp; &nbsp; &nbsp; - 89865<br />&nbsp; &nbsp; &nbsp; &nbsp; - 89867<br />&nbsp; &nbsp; &nbsp; &nbsp; - 89869<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ----------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2577500<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- 898701<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- 898703<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;78009600<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 8987041<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 8987043<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 8987045<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 8987047<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 8987049<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 8987051<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 8987053<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 8987055<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 611321600<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- 89870561<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- 89870563<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- 89870565<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- 89870567<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- 89870569<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;- 89870571<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7209820400&nbsp; &nbsp;&lt;- (&gt;= 2^31-1; so last digit using signed int 32bit math)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 898705721<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 898705723<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 898705725<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 898705727<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 898705731<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 898705733<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 898705735<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - 898705737<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2017472100 (&lt; 8987057361 ==&gt; next digit 0)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;201747210000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ...<br /></code></pre></div>(If i only could remember its name... then it would be easy.)<br />(I hope the above is clear enough to be understand easily.)<br /><br /><br />penpen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>18 Nov 2015 21:30</strong></div>
				<div class="author">by <strong>Aacini</strong></div>
				<div class="content">I recently wrote a fixed point square root Batch program based on the classical <a href="https://en.wikipedia.org/wiki/Shifting_nth_root_algorithm" class="postlink">&quot;long division&quot; method</a> that I posted in <a href="http://stackoverflow.com/questions/33271223/batch-does-not-compute-equations-properly/33286207#33286207" class="postlink">this SO question</a>. This is the code:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal<br /><br />:nextNumber<br />&nbsp; &nbsp;set &quot;number=&quot;<br />&nbsp; &nbsp;set /P &quot;number=Number:&nbsp; &nbsp; &nbsp; &quot;<br />&nbsp; &nbsp;if not defined number goto :EOF<br />&nbsp; &nbsp;call :SquareRoot %number% sqrt=<br />&nbsp; &nbsp;echo Square root: %sqrt%<br />&nbsp; &nbsp;echo/<br />goto nextNumber<br /><br /><br />:SquareRoot number result=<br />setlocal EnableDelayedExpansion<br /><br />rem Separate the number in aligned blocks of 2 digits each<br />for /F &quot;tokens=1,2 delims=.&quot; %%a in (&quot;%1&quot;) do set &quot;int=%%a&quot; &amp; set &quot;frac=%%b&quot;<br />set /A i=11, f=10<br />:nextInt<br />&nbsp; &nbsp;if not defined int goto nextFrac<br />&nbsp; &nbsp;set /A i-=1<br />&nbsp; &nbsp;set &quot;block&#91;%i%&#93;=%int:~-2%&quot;<br />&nbsp; &nbsp;set &quot;int=%int:~0,-2%&quot;<br />goto nextInt<br />:nextFrac<br />&nbsp; &nbsp;if not defined frac goto checkLastBlock<br />&nbsp; &nbsp;set /A f+=1<br />&nbsp; &nbsp;set &quot;block&#91;%f%&#93;=%frac:~0,2%&quot;<br />&nbsp; &nbsp;set &quot;frac=%frac:~2%&quot;<br />goto nextFrac<br />:checkLastBlock<br />if %f% gtr 10 if &quot;!block&#91;%f%&#93;:~1!&quot; equ &quot;&quot; set &quot;block&#91;%f%&#93;=!block&#91;%f%&#93;!0&quot;<br /><br />rem Get square root of first block: digit between 0 and 9<br />set /A num=block&#91;%i%&#93;, iP1=i+1, addZeros=0<br />for /L %%r in (0,1,9) do (<br />&nbsp; &nbsp;set /A r2=%%r*%%r<br />&nbsp; &nbsp;if !r2! leq %num% set /A sqrt=%%r, remainder=num-r2<br />)<br /><br />rem Get square root of next blocks<br />for /L %%i in (%iP1%,1,%f%) do (<br />&nbsp; &nbsp;set /A remainder1=remainder*10+!block&#91;%%i&#93;:~0,1!, remainder2=remainder*100+1!block&#91;%%i&#93;!-100, sqrtT2=sqrt*2<br />&nbsp; &nbsp;if !sqrtT2! equ 0 (<br />&nbsp; &nbsp; &nbsp; rem The number started with zeros: no sqrt yet<br />&nbsp; &nbsp; &nbsp; set &quot;sqrt=&quot;<br />&nbsp; &nbsp; &nbsp; set /A addZeros+=1<br />&nbsp; &nbsp; &nbsp; for /L %%r in (0,1,9) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A r2=%%r*%%r<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if !r2! leq !remainder2! set /A nextDigit=%%r, remainder=remainder2-r2<br />&nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp;) else if !remainder1! lss !sqrtT2! (<br />&nbsp; &nbsp; &nbsp; rem There is no sqrt for this block<br />&nbsp; &nbsp; &nbsp; set /A nextDigit=0, remainder=remainder2<br />&nbsp; &nbsp;) else (<br />&nbsp; &nbsp; &nbsp; set /A nextDigit=remainder1/sqrtT2, test=sqrtT2*10+nextDigit, this=test*nextDigit<br />&nbsp; &nbsp; &nbsp; if !this! gtr !remainder2! (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Next digit is too large: decrease it<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A &quot;times=(this-remainder2)/test+1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%t in (1,1,!times!) do if !this! gtr !remainder2! (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A nextDigit-=1, test=sqrtT2*10+nextDigit, this=test*nextDigit<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; set /A remainder=remainder2-this<br />&nbsp; &nbsp;)<br />&nbsp; &nbsp;set &quot;sqrt=!sqrt!!nextDigit!&quot;<br />)<br /><br />for /L %%i in (1,1,%addZeros%) do set &quot;sqrt=0!sqrt!&quot;<br />set /A point=11-i<br />set &quot;sqrt=!sqrt:~0,%point%!.!sqrt:~%point%!&quot;<br />endlocal &amp; set &quot;%2=%sqrt%&quot;<br />exit /B<br /></code></pre></div><br />In this program the precision is set to the number of decimals / 2 of the input number, but a very simple modification would allow to set it to a fixed number. Some examples:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Number:&nbsp; &nbsp; &nbsp; 15625.000000<br />Square root: 125.000<br /><br />Number:&nbsp; &nbsp; &nbsp; 625<br />Square root: 25.<br /><br />Number:&nbsp; &nbsp; &nbsp; 64<br />Square root: 8.<br /><br />Number:&nbsp; &nbsp; &nbsp; 9<br />Square root: 3.<br /><br />Number:&nbsp; &nbsp; &nbsp; 0.25<br />Square root: 0.5<br /><br />Number:&nbsp; &nbsp; &nbsp; 987654321987654321<br />Square root: 993807990.<br /><br />Number:&nbsp; &nbsp; &nbsp; 1234567890123456789<br />Square root: 1111111106.<br /><br />Number:&nbsp; &nbsp; &nbsp; 2.000000000000000000<br />Square root: 1.414213562<br /></code></pre></div><br />Antonio</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>22 Nov 2015 08:10</strong></div>
				<div class="author">by <strong>einstein1969</strong></div>
				<div class="content">@Penpen<br />Thanks , the algorithm is clear and if I found the source I will post.<br /><br />@Aacini<br />Antonio, The sqrt algorithm with many decimal is very good! I will study for increment my knowledge.<br /><br />The last Integer SQRT 32Bit is very fast and stable. I have try to optimize but for now is unbeatable.<br />The performance is <strong class="text-strong">about 16 seconds for 46000*2 Sqrts</strong><br /><br />For who want to optimize i show my attemp:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion<br /><br />for /f &quot;delims==&quot; %%v in ('set') do set &quot;%%v=&quot;<br />for /F %%a in ('copy /Z &quot;%~F0&quot; NUL') do set &quot;CR=%%a&quot;<br /><br />rem The unbeatable!!<br />set&nbsp; &quot;Sqrt(N)=( M=(N),x=M/(11*1024)+40, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x+=(M-x*x)&gt;&gt;31 )&quot;<br /><br />rem set&nbsp; &quot;Sqrt(N)=( M=(N), guess=x=(((M-1529513880)&gt;&gt;31)+1)*(4096)+(((M-12752040)&gt;&gt;31)+1)*(8192+2048+1024+512+256+128+64+32+4+1)+(((M-29928)&gt;&gt;31)+1)*(512+256+128+32+4+1)+31, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x+=(M-x*x)&gt;&gt;31 )&quot;<br />rem set&nbsp; &quot;Sqrt(N)=( M=(N), x=(((M-1529513880)&gt;&gt;31)+1)*4096+(((M-12752040)&gt;&gt;31)+1)*12261+(((M-29928)&gt;&gt;31)+1)*933+31, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x+=(M-x*x)&gt;&gt;31 )&quot;<br /><br />rem set&nbsp; &quot;Sqrt(N)=( M=(N), guess=x=(((M-798345024)&gt;&gt;31)+1)*(16384)+(((M-84015555)&gt;&gt;31)+1)*(8192+2048+1024+256+128+64+32+16+8+4+2+1)+(((M-5904899)&gt;&gt;31)+1)*(2048+1024+512+128+64+32+16+2+1)+(((M-226575)&gt;&gt;31)+1)*(512+256+128+64+16+8+2+1)+(((M-2915)&gt;&gt;31)+1)*(128+32+16+1)+15, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x+=(M-x*x)&gt;&gt;31 )&quot;<br />rem i guess con intervalli sono più lenti!<br /><br />rem http://www.mathpath.org/Algor/squareroot/algor.square.root.halley.htm<br />rem http://www.mathpages.com/home/kmath190.htm<br />Rem accelerate, 1 accelerate. Se N &lt; 715827882 posso usare la convergenza geometrica. Altrimenti uso quella lineare.<br />set&nbsp; &quot;Sqrt(N)=( M=(N), g0=40+N/7000, q1=(0x7FFFFFFF-g0*g0*g0)/(3*g0), overflow=-(M-q1&gt;&gt;31), guess=x=overflow*( p=(g0*(p1=(g0*g0+3*M))/(3*g0*g0+M)) )+(2200+N/29500)*(1-overflow)+1, x1=x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x+=(M-x*x)&gt;&gt;31 )&quot;<br />Rem questa e' quella stabile.<br />set&nbsp; &quot;Sqrt(N)=( M=(N), g0=40+N/7000, overflow=-(M-(0x7FFFFFFF-g0*g0*g0)/(3*g0)&gt;&gt;31), x=overflow*(g0*(g0*g0+3*M)/(3*g0*g0+M))+(2200+N/29500)*(1-overflow)+1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x+=(M-x*x)&gt;&gt;31 )&quot;<br />rem fisso N=2086000 overflow<br />set&nbsp; &quot;Sqrt(N)=( M=(N), g0=40+N/7000, overflow=-(M-2086000&gt;&gt;31), x=-(M-2086000&gt;&gt;31)*(g0*(g0*g0+3*M)/(3*g0*g0+M))+(2200+N/29500)*(1+(M-2086000&gt;&gt;31))+1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x+=(M-x*x)&gt;&gt;31 )&quot;<br />rem ottimizzo la precedente<br />set&nbsp; &quot;Sqrt(N)=( M=(N), g0=40+N/7000, x=-(M-2086000&gt;&gt;31)*(g0*(g0*g0+3*M)/(3*g0*g0+M))+(2200+N/29500)*(1+(M-2086000&gt;&gt;31))+1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x+=(M-x*x)&gt;&gt;31 )&quot;<br />rem lenta/slow<br /><br />rem provo con meno iterazioni! una semplice nella quadratica<br />set&nbsp; &quot;Sqrt(N)=( M=(N), g0=23+N/1466, q1=(0x7FFFFFFF-g0*g0*g0)/(3*g0), overflow=-(M-q1&gt;&gt;31), guess=x=overflow*( p=(g0*(p1=(g0*g0+3*M))/(3*g0*g0+M)) )+(((M/(2151+N/29265)+(2151+N/29265))&gt;&gt;1 )+1)*(1-overflow), x1=x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x+=(M-x*x)&gt;&gt;31 )&quot;<br />rem ottimizzo precedente<br />set&nbsp; &quot;Sqrt(N)=( M=(N), g0=23+N/1466, x=-(M-(0x7FFFFFFF-g0*g0*g0)/(3*g0)&gt;&gt;31)*( p=(g0*(p1=(g0*g0+3*M))/(3*g0*g0+M)) )+(((M/(2151+N/29265)+(2151+N/29265))&gt;&gt;1 )+1)*(1+(M-(0x7FFFFFFF-g0*g0*g0)/(3*g0)&gt;&gt;31)), x=(M/x+x)&gt;&gt;1, x=(M/x+x)&gt;&gt;1, x+=(M-x*x)&gt;&gt;31 )&quot;<br />rem lenta/slow<br /><br />rem for %%s in (-2147483647, -1, 0, 1, 2, 3, 4, 9, 10, 16, 25, 100, 511, 512, 1000, 10000,<br />for %%s in (0, 1, 2, 3, 4, 9, 10, 16, 25, 100, 511, 512, 1000, 10000,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 65535, 65536, 100000, 131071, 131072, 262143, 262144, 393215, 393216,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1000000, 2085999, 2086000, 5000000, 10000000, 100000000, 200000000, 1000000000, 2147395600, 2147483647) do (<br /><br />&nbsp; set /A &quot;sqrt=!Sqrt(N):N=%%s!&quot;<br />&nbsp; rem echo Sqrt(%%s^)=!sqrt! - g0:!g0! q1:!q1! overflow:!overflow! p=!p! p1:!p1! guess:!guess! x1:!x1!<br />&nbsp; if !overflow! equ 0 echo(<br />&nbsp; echo Sqrt(%%s^)=!sqrt! - g0:!g0! overflow:!overflow! guess:!guess! x1:!x1!<br />)<br /><br />pause<br /><br />set &quot;t1=!time: =0!&quot;<br /><br /><br />rem &lt; NUL (for /L %%n in (2,1,46340) do (<br />(for /L %%n in (2,1,46340) do (<br /><br />&nbsp; &nbsp;rem set /P &quot;=%%n!CR!&quot; &lt;nul<br /><br />&nbsp; &nbsp;set /A &quot;Num2=%%n*%%n, Num2M1=Num2-1, NM1=%%n-1&quot;<br /><br />&nbsp; &nbsp;set /A &quot;sqrt=%Sqrt(N):N=Num2M1%&quot;<br />&nbsp; &nbsp;if !sqrt! neq !NM1! echo failed on %%n- sqrt(!Num2M1!^) = !sqrt! &amp; pause<br />&nbsp; &nbsp;set /A &quot;sqrt=%Sqrt(N):N=Num2%&quot;<br />&nbsp; &nbsp;if !sqrt! neq %%n echo failed on %%n- sqrt(!Num2!^) = !sqrt! &amp; pause<br /><br />))<br />rem if !overflow! equ 0 echo %%n &amp; pause<br /><br /><br />for /F &quot;tokens=1-8 delims=:.,&quot; %%a in (&quot;!t1!:!time: =0!&quot;) do set /a &quot;a=(((1%%e-1%%a)*60)+1%%f-1%%b)*6000+1%%g%%h-1%%c%%d, a+=(a&gt;&gt;31)&amp;8640000, FPS=10000/a&quot;<br />Title Time Elapsed:!a!0ms - FPS: !FPS:~0,-2!.!FPS:~-2!<br />set a=&amp;set t1=&amp;set FPS=<br /><br />pause<br /><br />exit/b<br /></code></pre></div><br /><br />I try to:<br />- Divide the interval to guess in more part. For better Guess.<br />- Accelerate the convergency. Via Halley's method (Householder)<br />- Mix.<br /><br />These work well but the performance are lower.<br /><br />The trick is guessing better. I have found a guess method that use LOG_x(N) (base x logarithm) but I have problem to  implement.<br /><br />This is my progress:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>rem Aacini example<br />set &quot;Sqrt1(Num)=set /A &quot;M=(Num),sqrt=M/(11*1024)+40,sqrt=(M/sqrt+sqrt)/2&quot;&amp;(for /L %%i in (1,1,5) do set /A &quot;x2=(M/sqrt+sqrt)/2&quot;^&amp;if ^!x2^! leq ^!sqrt^! set /A sqrt=x2)&quot;<br /><br />Rem Macros<br />rem Logaritmo <br />Rem http://unija.ac.id/IT/en/indonesian-encyclopedia-2649/Babylonian-method_7399_unija.html<br />Rem http://akd-akuntansi-jayabaya.perut.info/_lain.php?_lain=7399<br />rem http://shipload.musikmart.com/IT/en/indonesian-cyclopedia-1558/Babylonian-method_7399_shipload-musikmart.html<br />rem http://sablon.baju.us/IT/en/pusat-ensiklopedis-1120/Methods-of-computing-square-roots_7399_sablon-baju.html<br />Rem For calculate Lenght(N) and store zero for calcolate 10^I<br />set &quot;Len_Sqrt(N)=$=0000123456789AN&quot;<br />rem calculate L= Lenght(N) = Number of DIGIT of N, if L is ODD L=2*I+1 else L=2*I+2, Q= if L is ODD 2 else 6<br />set &quot;Sqrt(N)=( L=0x^!$:~-11,1^!, I=(L-1)/2, Q=(L&amp;1)*2+((L+1)&amp;1)*6)&quot;<br />rem Calculate 10^I*Q<br />set &quot;Sqrt1(N)=For %%$ in (^!I^!) do set /A &quot;guess=^!q^!^!$:~0,%%$^!&quot;&quot;<br /><br />Rem Execute macros<br />set %Len_Sqrt(N):N=65536%<br />set /A &quot;%Sqrt(N):N=65536%&quot;<br />%Sqrt1(N)%&quot;<br />echo %guess%<br />pause<br /></code></pre></div><br /><br />Can anyone help me?<br /><br />TODO:<br />- Compact two step of newton's method into one.<br /><br />EDIT: The error graphics using LOG + line versus line <a href="http://fooplot.com/#W3sidHlwZSI6MCwiZXEiOiJzcXJ0KHgpIiwiY29sb3IiOiIjMDAwMDAwIn0seyJ0eXBlIjowLCJlcSI6ImxvZyh4KSo4MDAreC8zODAwMCsxNTAwIiwiY29sb3IiOiIjMENFRDI2In0seyJ0eXBlIjowLCJlcSI6ImFicyhzcXJ0KHgpLShsb2coeCkqODAwK3gvMzgwMDArMTUwMCkpIiwiY29sb3IiOiIjRjcwQTBBIn0seyJ0eXBlIjowLCJlcSI6IngvMzkwMDArODAwMCIsImNvbG9yIjoiIzEwMjlFNiJ9LHsidHlwZSI6MCwiZXEiOiJhYnMoc3FydCh4KS0oeC8zOTAwMCs4MDAwKSkiLCJjb2xvciI6IiM5RDBGQkEifSx7InR5cGUiOjIsImVxeCI6IjJeMzEiLCJlcXkiOiJzIiwiY29sb3IiOiIjZmYwMDAwIiwic21pbiI6Ii01MDAwMDAiLCJzbWF4IjoiNTAwMDAwIiwic3N0ZXAiOiIxMDAifSx7InR5cGUiOjEwMDAsIndpbmRvdyI6WyItMTE2Mjk1NzQ4Ljk5MTY0NDE0IiwiMjI3MDM0MTY3Ny42NTk2OTk0IiwiLTEwMTI2LjQwNjkxNTEwOTYxNiIsIjYwODkzLjM1MjAxMjkyMDAzIl0sInNpemUiOls2NTAsNTUwXX1d" class="postlink">here</a><br /><br />Einstein1969</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>24 Nov 2015 12:19</strong></div>
				<div class="author">by <strong>einstein1969</strong></div>
				<div class="content">Hi,<br /><br />I have update the initial post adding other functions.<br />Than I have edit the post number 3 for quick functions reference.<br /><br />I have implementated the <strong class="text-strong">Integer 32bit Cmp(x,y)</strong> function:<br /><br />X&lt;Y   -&gt; -1<br />X=Y   -&gt;  0<br />X&gt;Y   -&gt;  1<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set &quot;Cmp(x,y)=(x-y)&gt;&gt;31|((y-x)&gt;&gt;31&amp;1)&quot;<br />set /a &quot;x=7, y=5, C=%cmp(x,y)%&quot;<br /></code></pre></div><br /><br /><br />I have not implemented the 2 parameter substitute becouse I don't know wich method is better. <br /><br />Einstein1969</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>01 May 2016 08:30</strong></div>
				<div class="author">by <strong>einstein1969</strong></div>
				<div class="content">Hi,<br /><br />I have optimized the Sign(x) removing unnecessary parenthesis and adding an alternate method.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>if %x% lss 0 (set /A &quot;s=-1&quot;) else if %x% gtr 0 (set /A &quot;s=1&quot;) else set /A &quot;s=0&quot;&nbsp; &nbsp;&amp; rem 55 microsec.<br />:: or<br />set &quot;Sign(x)=(x)&gt;&gt;31 | -(x)&gt;&gt;31 &amp; 1&quot;&nbsp; &nbsp; &nbsp;&amp; rem 42 microsec.<br />:: or <br />set &quot;Sign(x)=(x)&gt;&gt;31 | -(-(x)&gt;&gt;31)&quot;&nbsp; &nbsp; &nbsp; &amp; rem 42 microsec.<br /></code></pre></div><br /><br />The average execute time is show in the comment. It's calculated with an environment of standard size.<br /><br />Einstein1969</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>28 Mar 2018 08:08</strong></div>
				<div class="author">by <strong>IcarusLives</strong></div>
				<div class="content">Sorry to dig this up, but I've found use out of this.<br>
<br>
I was also wondering if it were possible to create a POW macro such as this? Thanks in advanced!!</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>30 May 2018 06:58</strong></div>
				<div class="author">by <strong>IcarusLives</strong></div>
				<div class="content">Hey, I wanted to share something I made last night. I thought maybe this would be useful<br>
<br>
FIXED! Accuracy is 100%<br>
<br>
<img src="../../i.gyazo.com/1765c4579c80f2688789b12901d762ad.png" class="postimage" alt="Image"><br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off &amp; setlocal enableDelayedExpansion

for /l %%a in (1,1,20) do (
	set /a "rnd1=!random! %% 49 + 1", "rnd2=!random! %% 49 + 1"
	
	call :floatDIV !rnd1! !rnd2!
)

pause &amp; exit

rem i says divide %~1 by %~2
rem bool says if %~1 is greater than %~2 return 0 if false or 1 if true
rem GY says get the modulus of (%~1-%~2) and %~2 divided by 2
rem LY says get the modulus of %~1 and %~2 divided by 2
:floatDIV
	rem	                                    BOOL                              GY                                                                            BOOL                                    LY
	set /a "i=%~1 / %~2", "f=((   ((~(%~1-%~2)&gt;&gt;31)&amp;1)   *   ((10000 * (%~1 - %~2)) %% ((%~2) * 10000) / %~2)   )|((~  ((~(%~1-%~2)&gt;&gt;31)&amp;1)    &amp;1)*   (((%~1) * 10000) %% ((%~2) * 10000) / %~2)   ))"

	if "!f:~3!" equ "" set "f=0!f!"
	if "%~3" neq "" ( set "%~3=!i!.!f!" ) else ( echo %~1 / %~2 = !i!.!f! )
goto :eof</code></pre></div></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>04 Jun 2018 08:21</strong></div>
				<div class="author">by <strong>einstein1969</strong></div>
				<div class="content"><blockquote><div><cite><a href="memberlist11f0.html?mode=viewprofile&amp;u=8073">IcarusLives</a> wrote: <a href="viewtopic6408.html?p=56120#p56120" data-post-id="56120" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">28 Mar 2018 08:08</div></cite>
Sorry to dig this up, but I've found use out of this.<br>
<br>
I was also wondering if it were possible to create a POW macro such as this? Thanks in advanced!!
</div></blockquote>

the pow function is reconducible to log function and exp function.<br>
<br>
pow( x, y ) =&gt; exp( y * log( x ) )<br>
<br>
I will try to attemp using this article <a href="https://www.quinapalus.com/efunc.html" class="postlink">https://www.quinapalus.com/efunc.html</a><br>
<br>
einstein1969</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>04 Jun 2018 14:02</strong></div>
				<div class="author">by <strong>IcarusLives</strong></div>
				<div class="content">Thank you so much for the resources! I will research this.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Dos Batch Math Library</h3>
				<div class="date">Posted: <strong>05 Jun 2018 08:44</strong></div>
				<div class="author">by <strong>einstein1969</strong></div>
				<div class="content"><blockquote><div><cite><a href="memberlist11f0.html?mode=viewprofile&amp;u=8073">IcarusLives</a> wrote: <a href="viewtopicfee1.html?p=56994#p56994" data-post-id="56994" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">30 May 2018 06:58</div></cite>
Hey, I wanted to share something I made last night. I thought maybe this would be useful<br>
<br>
FIXED! Accuracy is 100%<br>
<br>
<img src="../../i.gyazo.com/1765c4579c80f2688789b12901d762ad.png" class="postimage" alt="Image"><br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off &amp; setlocal enableDelayedExpansion

for /l %%a in (1,1,20) do (
	set /a "rnd1=!random! %% 49 + 1", "rnd2=!random! %% 49 + 1"
	
	call :floatDIV !rnd1! !rnd2!
)

pause &amp; exit

rem i says divide %~1 by %~2
rem bool says if %~1 is greater than %~2 return 0 if false or 1 if true
rem GY says get the modulus of (%~1-%~2) and %~2 divided by 2
rem LY says get the modulus of %~1 and %~2 divided by 2
:floatDIV
	rem	                                    BOOL                              GY                                                                            BOOL                                    LY
	set /a "i=%~1 / %~2", "f=((   ((~(%~1-%~2)&gt;&gt;31)&amp;1)   *   ((10000 * (%~1 - %~2)) %% ((%~2) * 10000) / %~2)   )|((~  ((~(%~1-%~2)&gt;&gt;31)&amp;1)    &amp;1)*   (((%~1) * 10000) %% ((%~2) * 10000) / %~2)   ))"

	if "!f:~3!" equ "" set "f=0!f!"
	if "%~3" neq "" ( set "%~3=!i!.!f!" ) else ( echo %~1 / %~2 = !i!.!f! )
goto :eof</code></pre></div>
</div></blockquote>

for a complete add sub mul div you can view this work <a href="https://ss64.org/viewtopic.php?id=1838" class="postlink">https://ss64.org/viewtopic.php?id=1838</a> I have implemented the karatsuba's multiply.<br>
<br>
einstein1969</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="UTC-6">UTC-06:00</span><br />Page <strong>4</strong> of <strong>4</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Limited<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=5819&start=45&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 07:05:08 GMT -->
</html>
