<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=7898&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 08:31:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>DosTips.com &bull; Move cursor to *any position* using just ECHO command</title>

<link href="styles/AllanStyle-SUBSILVER/theme/print.css" rel="stylesheet">
</head>
<body id="phpbb">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>DosTips.com</h1>
		<p>A Forum all about DOS Batch<br /><a href="index-2.html">https://www.dostips.com/forum/</a></p>

		<h2>Move cursor to *any position* using just ECHO command</h2>
		<p><a href="viewtopic5920.html?f=3&amp;t=7898">https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=7898</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>Move cursor to *any position* using just ECHO command</h3>
				<div class="date">Posted: <strong>26 May 2017 22:46</strong></div>
				<div class="author">by <strong>Aacini</strong></div>
				<div class="content">This topic is based on a strange behavior (I would call it a <em class="text-italics">bug</em>) that happen when TAB (ASCII char 9 ) is combined with BS (ASCII char 8 ) in ECHO or SET /P commands. This behavior was first reported by user neorobin at <a href="viewtopicb140.html?f=3&amp;t=7425" class="postlink">this topic</a>, although he didn't explained it.<br /><br />When a TAB character is displayed in the screen, the Windows screen driver translates it to a series of blank spaces (usually 8 ), so in this case the TAB is <em class="text-italics">destructive</em>: any text previously displayed in the screen is overwritten by the spaces when the TAB is displayed.<br /><br />The number of spaces vary accordingly to the position of the cursor when the TAB is displayed, so the final cusor position after the spaces is always multiple of 8. For example, if the cursor is at first column in a line, a TAB is displayed as 8 spaces, but if the cursor is at column 1, the TAB is displayed as 7 spaces, etc.<br /><br />A behavior that may seems logical at first is that a BS character displayed after the TAB move the cursor back <em class="text-italics">the same number of spaces</em> displayed by the TAB, that is, the BS deletes the action of the TAB. What IMHO is a bug is that another BS displayed after the first one <em class="text-italics">also move the cursor back the same number of spaces</em>, and, if the cursor reach the left margin of the screen, the cursor wrap-around <em class="text-italics">to end of the previous screen line</em>!<br /><br />For example, if the cursor is at first column in a line, a sequence of &lt;TAB&gt;&lt;BS&gt;&lt;BS&gt; characters move the cursor one line above and 7 columns at left of the right screen margin. If the screen have 80 characters wide, each additional group of 10 BS characters moves the cursor one line up more. After that, each additional BS character move the cursor 8 characters more to left in the same line. Finally, if another single standard character is displayed, then the following BS characters will move the cursor just one character to the left.<br /><br />In this way, the cursor can be placed at any previous line and column in the screen by just calculating the proper number of BS characters to show after a TAB one, and after an additional standard char. If the desired position is <em class="text-italics">below</em> the current cursor position, just first place the cursor at the bottom of the screen via several ECHO/ commands, and after that move the cursor up and left to the desired location with this method.<br /><br />The Batch file below is an example of previous procedure. The calculation of the number of BS characters and the ECHO command is really simple and can be added to any program in a very simple way, but this program is large and complex because it display a screen full of coordinates and allows you to enter the position of several marks, that will be displayed in the screen in the proper positions.<br /><br /><strong class="text-strong">EDIT 2017-05-28:</strong> I added the method to correctly get a TAB character in both Windows XP and newer versions.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion<br /><br />echo Enter coordinates in line,col order to move the cursor and show a mark<br />echo/<br />echo The valid ranges are:&nbsp; &nbsp;0 ^&lt;= line ^&lt;= 30&nbsp; &nbsp;and&nbsp; &nbsp;0 ^&lt;= column ^&lt;= 71;<br />echo if a value is out of range, the bell will ring.<br />echo/<br />pause<br /><br />rem Get a BEL, BS and a TAB characters<br />set &quot;BEL=&quot;<br />for /F %%a in ('echo prompt $H ^| cmd') do set &quot;BS=%%a&quot;<br />set &quot;TAB=&quot;<br />rem First, try the method for Windows XP<br />for /F &quot;skip=4 delims=pR tokens=2&quot; %%a in ('reg query hkcu\environment /v temp' ) do set &quot;TAB=%%a&quot;<br />rem Then, the method for newer versions<br />rem http://www.dostips.com/forum/viewtopic.php?f=3&amp;t=1733&amp;p=6840#p6853<br />for /F &quot;tokens=2 delims=0&quot; %%a in ('shutdown /? ^| findstr /BC:E') do if not defined TAB set &quot;TAB=%%a&quot;<br /><br />rem Get a string with 162 BS characters, the maximum used in this program<br />set &quot;BSs=&quot;<br />for /L %%i in (1,1,162) do set &quot;BSs=!BSs!!BS!&quot;<br /><br />mode 80,32<br />set &quot;line1=&quot;<br />for /L %%i in (1,1,8) do set &quot;line1=!line1!0123456789&quot;<br />set &quot;line2=&quot;<br />for /L %%i in (1,1,8) do set &quot;line2=!line2!^!l^!&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;<br />set &quot;line2=!line2:~0,-1!^!l^!&quot;<br />set &quot;line3=&quot;<br />for /L %%i in (1,1,8) do set &quot;line3=!line3!^!l^! 2 4 6 8 &quot;<br />set &quot;line3=!line3:~0,-1!^!l^!&quot;<br />set &quot;twoORthree=23&quot;<br />&lt; NUL (<br />&nbsp; &nbsp;for /L %%a in (1,1,3) do (<br />&nbsp; &nbsp; &nbsp; set /P &quot;=%line1%&quot; &amp; set &quot;l=1&quot;<br />&nbsp; &nbsp; &nbsp; set /P &quot;=%line2%&quot; &amp; set /A &quot;l+=1&quot;<br />&nbsp; &nbsp; &nbsp; for /L %%b in (1,1,4) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if %%a neq 2 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;=%line3%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) else if &quot;!twoORthree:%%b=!&quot; equ &quot;%twoORthree%&quot; (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;=%line3%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%line3:~0,-15%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A &quot;l+=1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /P &quot;=%line2%&quot; &amp; set /A &quot;l+=1&quot;<br />&nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp;)<br />&nbsp; &nbsp;set /P &quot;=%line1:~0,-1%&quot;<br />)<br /><br />rem Initialize cursor position at middle of screen, to read input there<br />echo 9%TAB%!BSs!<br />set &quot;currLine=16&quot;<br /><br />set &quot;letters=_ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;<br />set &quot;num=1&quot;<br /><br />:loop<br />set &quot;position=&quot;<br />set /P &quot;position=Enter line,col for mark !letters:~%num%,1!:&nbsp; &nbsp; &nbsp; !BSs:~0,5!&quot;<br />if not defined position goto end<br /><br />for /F &quot;tokens=1,2 delims=, &quot; %%x in (&quot;%position%&quot;) do set /A y=%%x, x=%%y, error=1<br />if 0 leq %y% if %y% leq 30&nbsp; if 0 leq %x% if %x% leq 71&nbsp; set &quot;error=&quot;<br />if defined error (<br />&nbsp; &nbsp;echo %TAB%!BSs:~0,12!!BEL!<br />&nbsp; &nbsp;goto loop<br />)<br /><br />if %y% leq %currLine% (<br /><br />&nbsp; &nbsp;rem New position above: move cursor up and show point<br />&nbsp; &nbsp;call :MoveCursorupAndShow &quot;(currLine-y-1)&quot; x &quot;!letters:~%num%,1!(%y%,%x%)&quot;<br /><br />&nbsp; &nbsp;rem And move cursor down, back to original input line<br />&nbsp; &nbsp;set /A down=currLine-y-2, cntBSup+=10<br />&nbsp; &nbsp;for /L %%i in (1,1,!down!) do echo/<br />&nbsp; &nbsp;if !down! lss 0 for /F %%i in (&quot;!cntBSup!&quot;) do echo %TAB%!BSs:~0,%%i!<br /><br />) else (<br /><br />&nbsp; &nbsp;rem New position below: first, move cursor to last line<br />&nbsp; &nbsp;for /L %%i in (1,1,15) do echo/<br />&nbsp; &nbsp;rem Then, move cursor up and show point<br />&nbsp; &nbsp;call :MoveCursorupAndShow &quot;(30-y)&quot; x &quot;!letters:~%num%,1!(%y%,%x%)&quot;<br /><br />&nbsp; &nbsp;rem And move cursor up, back to original input line, using the same method<br />&nbsp; &nbsp;set /A down=30-y<br />&nbsp; &nbsp;for /L %%i in (1,1,!down!) do echo/<br />&nbsp; &nbsp;echo %TAB%!BSs!<br /><br />)<br /><br />set /A num+=1<br />if %num% leq 26 goto loop<br />:end<br />cls<br />goto :EOF<br /><br /><br /><br />:MoveCursorupAndShow&nbsp; Linesup&nbsp; Column&nbsp; &quot;Text&quot;<br />set /A &quot;cntBSup = 2 + 10 * %~1 + (9-(%2+6)/8), cntBSleft = 8-(%2+6)%%8&quot;<br />set &quot;BSsLeft=&quot;<br />if %cntBSleft% gtr 0 set &quot;BSsLeft=_!BSs:~0,%cntBSleft%!&quot;<br />echo %TAB%!BSs:~0,%cntBSup%!!BSsLeft!%~3<br />exit /B<br /></code></pre></div><br />The image below is an output example of previous program after 8 marks were displayed at various positions.<br /><br /><img src="../../i.imgur.com/GUoKs35.png" class="postimage" alt="Image" /><br /><br />Tested on Windows 8.1<br /><br />Antonio</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Move cursor to *any position* using just ECHO command</h3>
				<div class="date">Posted: <strong>27 May 2017 10:40</strong></div>
				<div class="author">by <strong>einstein1969</strong></div>
				<div class="content">Good explain Antonio,<br /><br />It's possible create a generic &quot;goto 0,0&quot;/HOME function? How?<br /><br />Einstein1969</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Move cursor to *any position* using just ECHO command</h3>
				<div class="date">Posted: <strong>28 May 2017 02:33</strong></div>
				<div class="author">by <strong>miskox</strong></div>
				<div class="content">Great work!<br /><br />Well, does not work for me. (XP PRO 32 bit)<br /><br />First: 'Enter line' line is not in the middle of the screen:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; 1<br />2 2 4 6 8 2 2 4 6 8 2 2 4 6 8 2 2 4 6 8 2 2 4 6 8 2 2 4 6 8 2 2 4 6 8 2 2 4 6 82<br />3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; 3<br />4 2 4 6 8 4 2 4 6 8 4 2 4 6 8 4 2 4 6 8 4 2 4 6 8 4 2 4 6 8 4 2 4 6 8 4 2 4 6 84<br />5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; 5<br />6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 86<br />7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; 7<br />8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 88<br />9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; 9<br />01234567890123456789012345678901234567890123456789012345678901234567890123456789<br />1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; 1<br />2 2 4 6 8 2 2 4 6 8 2 2 4 6 8 2 2 4 6 8 2 2 4 6 8 2 2 4 6 8 2 2 4 6 8 2 2 4 6 82<br />3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; 3<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4 2 4 6 8 4 2 4 6 8 4 2 4 6 8 4 2 4 6 8 4 2 4 6 8 4 2 4 6 8 4 2 4 6 8<br />5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; 5<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8<br />7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; 7<br />8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 88<br />9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; 9<br />01234567890123456789012345678901234567890123456789012345678901234567890123456789<br />1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; 1<br />2 2 4 6 8 2 2 4 6 8 2 2 4 6 8 2 2 4 6 8 2 2 4 6 8 2 2 4 6 8 2 2 4 6 8 2 2 4 6 82<br />3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; 3<br />4 2 4 6 8 4 2 4 6 8 4 2 4 6 8 4 2 4 6 8 4 2 4 6 8 4 2 4 6 8 4 2 4 6 8 4 2 4 6 84<br />5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5&nbsp; &nbsp; &nbsp; &nbsp; 5<br />6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 86<br />7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; 7<br />8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 88<br />9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; 9<br />01234567890123456789012345678901234567890123456789012345678901234567890123456789<br /><br />Enter line,col for mark A:<br /></code></pre></div><br /><br />Second there is an error if I don't enter both values<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 8 6 2 4 6 86<br />7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;7&nbsp; &nbsp; &nbsp; &nbsp; 7<br />8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 8 8 2 4 6 88<br />9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;9&nbsp; &nbsp; &nbsp; &nbsp; 9<br />01234567890123456789012345678901234567890123456789012345678901234567890123456789<br /><br />Enter line,col for mark A: 5<br />Missing operand.<br />'leq' is not recognized as an internal or external command,<br />operable program or batch file.<br />A(5,)<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />Enter line,col for mark B: 5,5<br />B(5,5)<br /><br /><br /><br /><br /><br /><br /><br /><br /><br />Enter line,col for mark C:<br /></code></pre></div><br /><br />As Einstein suggested: a 0,0/HOME version (the shortest) and another callable something like:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>call movecursor x y<br /></code></pre></div><br /><br />Great work!<br />Saso</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Move cursor to *any position* using just ECHO command</h3>
				<div class="date">Posted: <strong>28 May 2017 02:51</strong></div>
				<div class="author">by <strong>Aacini</strong></div>
				<div class="content"><blockquote><div><cite>miskox wrote:</cite>Great work!<br /><br />Well, does not work for me. (XP PRO 32 bit)<br /><br />First: 'Enter line' line is not in the middle of the screen:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>snip<br /></code></pre></div><br /><br />Second there is an error if I don't enter both values<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>snip<br /></code></pre></div><br /><br />. . .<br /><br />Great work!<br />Saso</div></blockquote><br /><br />Yes. It seems that the method used to create a TAB character doesn't work in Win XP. You may change this line:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>for /F &quot;tokens=2 delims=0&quot; %%a in ('shutdown /? ^| findstr /BC:E') do if not defined TAB set &quot;TAB=%%a&quot;<br /></code></pre></div><br />... by this one:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>for /F &quot;skip=4 delims=pR tokens=1,2&quot; %%a in ('reg query hkcu\environment /v temp' ) do set &quot;TAB=%%b&quot;<br /></code></pre></div><br />... or just directly enter a TAB character in a SET &quot;TAB=here&quot; command.<br /><br /><strong class="text-strong">EDIT 2017-05-28:</strong> I just added both methods in the original code in a way that it should correctly get a TAB in all Windows versions now.<br /><br />This program is just an example of how to use this method to move the cursor, so it lacks some error checking.<br /><br />Antonio</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Move cursor to *any position* using just ECHO command</h3>
				<div class="date">Posted: <strong>28 May 2017 08:54</strong></div>
				<div class="author">by <strong>Aacini</strong></div>
				<div class="content"><blockquote><div><cite>miskox wrote:</cite>As Einstein suggested: a 0,0/HOME version (the shortest) and another callable something like:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>call movecursor x y<br /></code></pre></div><br />. . . .<br /></div></blockquote><br /><br />Well, from the description of how this method works, it should be clear that it can only be used to go to a point in the screen <em class="text-italics">relative</em> to another, known position, and the above program was written with the purpose of exemplify this point.<br /><br />This means that a generic &quot;movecursor x y&quot; subroutine that may work in all cases is just not possible, unless you always know the current cursor position that is the case in animation/game programs.<br /><br />However, you may send an enough number of BS's to the screen in order to assure that the cursor reaches screen home no matter where is placed, but in this case the additional BS's causes a strange &quot;The system can not write on the specified device&quot; error message. Fortunately, we may hide this error if we redirect Stderr to NUL, although the cursor don't ends at (0,0) position, but at column 1 of first line.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion<br /><br />rem Get a BS and TAB characters<br />for /F %%a in ('echo prompt $H ^| cmd') do set &quot;BS=%%a&quot;<br />set &quot;TAB=&quot;<br />for /F &quot;skip=4 delims=pR tokens=2&quot; %%a in ('reg query hkcu\environment /v temp' ) do set &quot;TAB=%%a&quot;<br />for /F &quot;tokens=2 delims=0&quot; %%a in ('shutdown /? ^| findstr /BC:E') do if not defined TAB set &quot;TAB=%%a&quot;<br /><br />rem Get current sizes of screen buffer<br />set &quot;lins=&quot;<br />set &quot;cols=&quot;<br />for /F &quot;tokens=2 delims=:&quot; %%a in ('mode con') do (<br />&nbsp; &nbsp;if not defined lins (<br />&nbsp; &nbsp; &nbsp; set /A &quot;lins=%%a&quot;<br />&nbsp; &nbsp;) else if not defined cols (<br />&nbsp; &nbsp; &nbsp; set /A &quot;cols=%%a&quot;<br />&nbsp; &nbsp;)<br />)<br /><br />rem Go to screen Home from any place<br />set /A &quot;cntBS = 2 + (cols + 7) / 8 * lins&quot;<br />set &quot;BSs=&quot;<br />for /L %%i in (1,1,%cntBS%) do set &quot;BSs=!BSs!!BS!&quot;<br />2&gt;NUL echo %TAB%!BSs!<br />set /P &quot;=Now cursor is at line 0 col 1:&quot;<br /></code></pre></div><br />Antonio</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Move cursor to *any position* using just ECHO command</h3>
				<div class="date">Posted: <strong>28 May 2017 09:17</strong></div>
				<div class="author">by <strong>jeb</strong></div>
				<div class="content">Fascinating!<br /><br />I didn't recognized the originial thread before.<br />But it's so easy with the TAB character. <br />I'm astonished that nobody tries this before, many thankst  to nerobin  <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br /><br />@Aacini<br />I tried your tab creation with reg.exe, but it doesn't work for me with XP32-German.<br /><br />But I build a version with shutdown that works with Wi7x64 and also XP32<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />for /F &quot;tokens=1 delims=abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 &quot; %%a in ('shutdown /?') do set &quot;TAB=%%a&quot;<br />set &quot;tab=%tab:~0,1%&quot;<br />echo -%tab%-</code></pre></div></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Move cursor to *any position* using just ECHO command</h3>
				<div class="date">Posted: <strong>28 May 2017 10:26</strong></div>
				<div class="author">by <strong>aGerman</strong></div>
				<div class="content">As already mentioned in neorobin's thread this technique doesn't work on Win10 by default <img class="smilies" src="images/smilies/icon_sad.gif" alt=":(" title="Sad" /> <br />You would have to turn on Legacy Console (Checkbox &quot;Use Legacy Console&quot; in the &quot;Options&quot; tab).<br /><br />Steffen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Move cursor to *any position* using just ECHO command</h3>
				<div class="date">Posted: <strong>28 May 2017 15:08</strong></div>
				<div class="author">by <strong>aGerman</strong></div>
				<div class="content">Ugly workaround  <img class="smilies" src="images/smilies/icon_neutral.gif" alt=":|" title="Neutral" /> <br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion<br /><br />rem Determine if the new Windows 10 console window is used<br />set &quot;is_new_console=0&quot;<br />for /f &quot;tokens=2 delims=&#91;&quot; %%i in ('ver') do for /f &quot;tokens=2 delims=. &quot; %%j in (&quot;%%i&quot;) do (<br />&nbsp; if %%j geq 10 for /f &quot;tokens=3&quot; %%k in ('2^&gt;nul reg query &quot;HKCU\Console&quot; /v &quot;ForceV2&quot;') do set /a is_new_console=%%k<br />)<br />rem If new console was used<br />if %is_new_console%==1 (<br />&nbsp; rem Change the related registry value<br />&nbsp; &gt;nul reg add &quot;HKCU\Console&quot; /t REG_DWORD /v &quot;ForceV2&quot; /d 0 /f<br />&nbsp; rem Restart the script<br />&nbsp; start cmd /c %~fs0<br />&nbsp; rem Suspend the script execution for a moment<br />&nbsp; &gt;nul timeout /t 1 /nobreak<br />&nbsp; rem Restore the registry value<br />&nbsp; &gt;nul reg add &quot;HKCU\Console&quot; /t REG_DWORD /v &quot;ForceV2&quot; /d 1 /f<br />&nbsp; rem Quit the script<br />&nbsp; goto :EOF<br />)<br /><br />echo Enter coordinates in line,col order to move the cursor and show a mark<br />:: etc ...<br /></code></pre></div><br /><br />Steffen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Move cursor to *any position* using just ECHO command</h3>
				<div class="date">Posted: <strong>29 May 2017 14:34</strong></div>
				<div class="author">by <strong>thefeduke</strong></div>
				<div class="content"><blockquote><div><cite>Aacini wrote:</cite>This means that a generic &quot;movecursor x y&quot; subroutine that may work in all cases is just not possible, unless you always know the current cursor position that is the case in animation/game programs.<br /><br />However, you may send an enough number of BS's to the screen in order to assure that the cursor reaches screen home no matter where is placed, but in this case the additional BS's causes a strange &quot;The system can not write on the specified device&quot; error message. Fortunately, we may hide this error if we redirect Stderr to NUL, although the cursor don't ends at (0,0) position, but at column 1 of first line.</div></blockquote>Given the limitations of &quot;cursor awareness&quot;, I could not resist attempting this:<blockquote><div><cite>Edited: wrote:</cite>My attempt is flawed, but I left the post instead of unsaying it. It was not immediately obvious to me until I tried to generalize the code for column widths other than 80.  I did not take care to return the cursor to a known &quot;safe&quot; area and was leaving destructive blanks in random places.  Antonio's demo has two such areas.  The last line is blanks already and the prompt over-writes the other.  Antonio's explanation was quite clear and means so much more to me after a careful reread.  My apologies if I wasted your time.</div></blockquote>Edit: I shall post again to highlight this change and add more comments.<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br /><br />Call :MoveCsrByEcho %*<br /><br />Exit /B<br /><br />:MoveCsrByEcho Xvalue Yvalue StringValue&#91;opt&#93; <br />@echo off<br />setlocal EnableDelayedExpansion<br /><br />rem Get BS and TAB characters<br />for /F %%a in ('echo prompt $H ^| cmd') do set &quot;BS=%%a&quot;<br />set &quot;TAB=&quot;<br />for /F &quot;skip=4 delims=pR tokens=2&quot; %%a in ('reg query hkcu\environment /v temp' ) do set &quot;TAB=%%a&quot;<br />for /F &quot;tokens=2 delims=0&quot; %%a in ('shutdown /? ^| findstr /BC:E') do if not defined TAB set &quot;TAB=%%a&quot;<br /><br />rem Get current sizes of screen buffer<br />set &quot;lins=&quot;<br />set &quot;cols=&quot;<br />for /F &quot;tokens=2 delims=:&quot; %%a in ('mode con') do (<br />&nbsp; &nbsp;if not defined lins (<br />&nbsp; &nbsp; &nbsp; set /A &quot;lins=%%a&quot;<br />&nbsp; &nbsp;) else if not defined cols (<br />&nbsp; &nbsp; &nbsp; set /A &quot;cols=%%a&quot;<br />&nbsp; &nbsp;)<br />)<br /><br />rem Get target coordinates and display string <br />Set &quot;X=%~1&quot; <br />If Not Defined X Set &quot;X=0&quot;<br />Set &quot;Y=%~2&quot; <br />If Not Defined Y Set &quot;Y=0&quot;<br />rem cannot access 0,0 with this technique - force 1,0<br />If /I &quot;%Y%&quot; EQU &quot;0&quot; IF /I &quot;%X%&quot; EQU &quot;0&quot; Set &quot;X=1&quot;<br />rem next tab for x=72 or more is 1 of next line and backspace cannot traverse <br />Set &quot;X7=0%X%&quot; <br />Set &quot;X7=1%X7:~-2%&quot; <br />If %X7%0 GTR 1710 Set &quot;X=71&quot;<br />Set &quot;string=%~3&quot;<br />If Not Defined string Set &quot;string= &quot;<br /><br />rem Go to screen Home from any place<br />set /A &quot;cntBS = 2 + (cols + 7) / 8 * lins&quot;<br />set &quot;BSs=&quot;<br />for /L %%i in (1,1,%cntBS%) do set &quot;BSs=!BSs!!BS!&quot;<br />2&gt;NUL echo %TAB%!BSs!<br /><br />rem Go one past desired Y<br />for /L %%i in (0,1,%Y%) do Echo.<br /><br />rem backtrack to tab just after desired x<br />set /A &quot;cntBS1 = (cols + 7 - X) / 8&quot;<br />set /A &quot;Xtab= 1 + cols + 8 &quot;<br />set &quot;BSs=&quot;<br />for /L %%i in (1,1,%cntBS1%) do (<br />&nbsp; &nbsp; set &quot;BSs=!BSs!!BS!&quot;<br />&nbsp; &nbsp; set /A &quot;Xtab-=8&quot;<br />)<br /><br />rem break backtabbing with a space and backspace to desired x<br />Set /A &quot;BSx= 1 + Xtab - X&quot;<br />set &quot;BSs=!BSs! &quot;<br />for /L %%i in (1,1,%BSx%) do (<br />&nbsp; &nbsp; set &quot;BSs=!BSs!!BS!&quot;<br />)<br /><br />rem display a string at (x,y) - positioning does nothing without display string <br />If /I &quot;%string%&quot; EQU &quot; &quot; (<br />&nbsp; &nbsp; echo %TAB%%BSs%%string%^&lt;-&#91;%X%,%Y%&#93;<br />) Else ( <br />rem _______________ Required for positioning <br />&nbsp; &nbsp; echo %TAB%%BSs%%string%<br />rem Chosen string&nbsp; ________<br />) <br /><br />Exit /B</code></pre></div>Here is some sample output:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp;Cannot go more left&nbsp; &nbsp; &nbsp; &lt;-&#91;25,0&#93;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;-&#91;66,0&#93;<br />&nbsp; &nbsp; &nbsp; &nbsp; \Yanci\Documents\Scripts&gt;movecsrbyecho 25 0<br />C:\Users\Yanci\Documents\Scripts&gt;movecsrbyecho 66 0<br />C:\Users\Yanci\Documents\Scripts&gt;movecsrbyecho &quot;&quot; 0 &quot;Cannot go more left&quot;<br />C:\Users\Yanci\Documents\Scripts&gt;movecsrbyecho 48 5<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&lt;-&#91;48,5&#93;<br />&nbsp;&lt;-&#91;0,6&#93;<br />&nbsp; &nbsp; &nbsp; &nbsp; \Yanci\Documents\Scripts&gt;MoveCsrByEcho 0 6<br />C:\Users\Yanci\Documents\Scripts&gt;MoveCsrByEcho 57 12<br /><br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;-&#91;57,12&#93;<br /><br />C:\Users\Yanci\Documents\Scripts&gt;</code></pre></div>Is it in the nature of ECHO that leading and trailing blanks are ignored,  so that this script cannot actually leave the cursor positioned without displaying some concrete output which then moves to the next line?<br /><br />Tested using Legacy Prompt on two Windows 10 systems:<br />Win7-based Win10 Anniversary Edition<br />Win8.1-based Win10 Creators Edition<br /><br />Because CE has enhanced DOS prompt support and this technique works with the buffer and not the window dimensions additional care is required to keep up with action outside the visible window.<br /><br />John A</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Move cursor to *any position* using just ECHO command</h3>
				<div class="date">Posted: <strong>02 Jun 2017 15:11</strong></div>
				<div class="author">by <strong>thefeduke</strong></div>
				<div class="content">Please note that I have edited my previous reply. I have more comments here:<blockquote><div><cite>Aacini wrote:</cite>. . .<br />This program is just an example of how to use this method to move the cursor,  . . .<br />. . .</div></blockquote><br />   I observed that the positioning only works if the positioning string is followed by one or more  displayable characters.  So this technique actually displays output at a chosen position, as opposed to leaving the cursor there like &quot;cursorpos&quot; and the like.  If there is no output, the ECHO seems to act like a null operation.  It does not advance a line as in ECHO. of ECHO(, nor does it act like ECHO with no operand.<br /><br />   Antonio,  I draw attention to your output example in the first post for point B(5,10).  It is followed by an underscore; the very character used to break the back-tabbing chain.  This is the tip of an iceberg that confused me a lot during my testing because I tried shorter strings and used blank to break the chain.  The underscore is produced as the next character after each tab in each line, and this behavior seams to be related to outputting a string too short to over-write the underscore.  This will not occur to the right and below (10,10) and will occur in two adjacent places above and to the left of (9,9).  The output string in this demo varies between 6 and 8 characters.  <br /><br />   So this might add another constraint to that of avoiding the last eight positions.   Still a very interesting discovery.<br /><br />John A</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Move cursor to *any position* using just ECHO command</h3>
				<div class="date">Posted: <strong>03 Jun 2017 15:00</strong></div>
				<div class="author">by <strong>Aacini</strong></div>
				<div class="content"><blockquote><div><cite>thefeduke wrote:</cite>I observed that the positioning only works if the positioning string is followed by one or more displayable characters. So this technique actually displays output at a chosen position, as opposed to leaving the cursor there like &quot;cursorpos&quot; and the like. If there is no output, the ECHO seems to act like a null operation. It does not advance a line as in ECHO. of ECHO(, nor does it act like ECHO with no operand.<br /></div></blockquote><br />In order to just position the cursor you need to use a SET /P command instead of an ECHO one, but in this case the first char in SET /P must be a non-space printable character, so this method can only be used if the character at the current cursor position is not a space and you know what character is.<br /><br /><blockquote><div><cite>thefeduke wrote:</cite>Antonio, I draw attention to your output example in the first post for point B(5,10). It is followed by an underscore; the very character used to break the back-tabbing chain. This is the tip of an iceberg that confused me a lot during my testing because I tried shorter strings and used blank to break the chain. The underscore is produced as the next character after each tab in each line, and this behavior seams to be related to outputting a string too short to over-write the underscore.<br /></div></blockquote><br />Yes. You may change the underscore by a space, for example, but the result is the same: the space will overwrite the original character that appear in the screen at such a position if the new displayed string is too short to overwrite the space.<br /><br /><br />For these reasons, this method is best suited for applications in which you always know the contents of the screen in all positions, so the proper character may be used in the positioning string in order to preserve the original screen contents. This type of applications are animations/games. As I said before, there is no way to use this method to create a general-use cursor positioning subroutine that works in all cases.<br /><br />Antonio</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="UTC-6">UTC-06:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Limited<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=7898&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 08:31:30 GMT -->
</html>
