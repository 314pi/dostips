<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=5595&start=30&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:46:14 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>DosTips.com &bull; JSORT.BAT v4.2 - Case sensitive sort with option for numeric sort - Page 3</title>

<link href="styles/AllanStyle-SUBSILVER/theme/print.css" rel="stylesheet">
</head>
<body id="phpbb">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>DosTips.com</h1>
		<p>A Forum all about DOS Batch<br /><a href="index-2.html">https://www.dostips.com/forum/</a></p>

		<h2>JSORT.BAT v4.2 - Case sensitive sort with option for numeric sort</h2>
		<p><a href="viewtopicf1eb.html?f=3&amp;t=5595">https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=5595</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>3</strong> of <strong>4</strong></div>
					<div class="post">
				<h3>Re: JSORT.BAT - Case sensitive sort with option for numeric</h3>
				<div class="date">Posted: <strong>05 Jan 2015 16:38</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">OK - below is release 3.3 that supports negative token numbers, meaning search for tokens from right to left, with -1 being the last token. Note that a negative value will only recognize tokens that occur after the delimiter.<br /><br />The solution for <a href="viewtopicc6f9.html?p=39056#p39056" class="postlink">foxidrives problem</a> is now as simple as:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>jsort test.txt /d &quot;(&quot; /t -1<br /></code></pre></div><br /><br />JSORT.BAT version 3.3<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@if (@X)==(@Y) @end /* Harmless hybrid line that begins a JScript comment<br /><br />::************ Documentation ***********<br />::JSORT.BAT version 3.3<br />:::<br />:::JSORT &#91;File&#93; &#91;/Option &#91;Value&#93;&#93;...<br />:::<br />:::&nbsp; Sort lines of text from stdin and write the result to stdout.<br />:::&nbsp; JSORT uses an ascending, case sensitive text sort by default.<br />:::<br />:::&nbsp; &nbsp; File - If the optional File argument is specified, then JSORT reads lines<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;from the file instead of from stdin. If specified, the File must<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;be the very first argument.<br />:::<br />:::&nbsp; Options:<br />:::<br />:::&nbsp; &nbsp; /C n - Number of sorted lines to print. Skipped lines are always printed<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;and do not contribute to the count. Default is -1 (all lines).<br />:::<br />:::&nbsp; &nbsp; /D String - Specifies the string used to delimit tokens. The delimiter<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string is always case sensitive. A quote literal &quot; must be escaped<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;as \q, and a backslash literal \ must be escaped as \\.<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The default value is an empty string, meaning treat the entire<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;line as a single token.<br />:::<br />:::&nbsp; &nbsp; /I&nbsp; &nbsp;- Ignore case when sorting<br />:::<br />:::&nbsp; &nbsp; /N&nbsp; &nbsp;- Sort consecutive digits as numbers instead of text. The numbers<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;may be embedded within alpha text. JSort supports numbers up to<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20 digits long.<br />:::<br />:::&nbsp; &nbsp; /O File - Writes the output to File instead of stdout.<br />:::<br />:::&nbsp; &nbsp; /P n - Begin sorting at character position n relative to the beginning<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;of the selected token. Lines that do not extend that far are<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;treated as equivalent values, and collate before all other lines.<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The default value is 1 (first character).<br />:::<br />:::&nbsp; &nbsp; /R&nbsp; &nbsp;- Sort the lines in Reverse (descending) order.<br />:::<br />:::&nbsp; &nbsp; /S n - Number of lines to skip - default is 0.<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Skipped lines are not sorted (remain in place)<br />:::<br />:::&nbsp; &nbsp; /T n - Specify the token at which to begin sorting. The sort is not<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;restricted to the selected token, it just helps to identify where<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;to begin sorting. The default value is 1 (first token). A value of<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1 represents the last token, -2 the penultimate token, etc.<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;A value of 0 is invalid. Note that negative values only recognize<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tokens that occur after a delimiter. If the requested token cannot<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;be found, then the line will collate before all other lines.<br />:::<br />:::&nbsp; &nbsp; /V&nbsp; &nbsp;- Display the version of JSORT.BAT.<br />:::<br />:::&nbsp; &nbsp; /?&nbsp; &nbsp;- Display this help<br />:::<br />:::JSORT.BAT was written by Dave Benham and originally posted at<br />:::http://www.dostips.com/forum/viewtopic.php?f=3&amp;t=5595<br />:::<br /><br />::************ Batch portion ***********<br />@echo off<br />setlocal disableDelayedExpansion<br /><br />:: Get optional input file<br />set &quot;infile=&quot;<br />set &quot;test=%~1&quot;<br />setlocal enableDelayedExpansion<br />if defined test if &quot;!test:~0,1!&quot; neq &quot;/&quot; (<br />&nbsp; endlocal<br />&nbsp; set ^&quot;infile=^&lt;&quot;%~1&quot;&quot;<br />&nbsp; shift /1<br />) else endlocal<br /><br />:: Define options<br />set &quot;options= /?: /i: /c:-1 /n: /p:1 /r: /s:0 /v: /d:&quot;&quot; /t:1 /o:&quot;&quot; &quot;<br /><br />:: Set default option values<br />for %%O in (%options%) do for /f &quot;tokens=1,* delims=:&quot; %%A in (&quot;%%O&quot;) do set &quot;%%A=%%~B&quot;<br /><br />:: Get options<br />:loop<br />if not &quot;%~1&quot;==&quot;&quot; (<br />&nbsp; setlocal enableDelayedExpansion<br />&nbsp; set &quot;test=!options:* %~1:=! &quot;<br />&nbsp; if &quot;!test!&quot;==&quot;!options! &quot; (<br />&nbsp; &nbsp; &nbsp; &gt;&amp;2 echo Error: Invalid option %~1<br />&nbsp; &nbsp; &nbsp; exit /b 1<br />&nbsp; ) else if &quot;!test:~0,1!&quot;==&quot; &quot; (<br />&nbsp; &nbsp; &nbsp; endlocal<br />&nbsp; &nbsp; &nbsp; set &quot;%~1=1&quot;<br />&nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; endlocal<br />&nbsp; &nbsp; &nbsp; set &quot;%~1=%~2&quot;<br />&nbsp; &nbsp; &nbsp; shift /1<br />&nbsp; )<br />&nbsp; shift /1<br />&nbsp; goto :loop<br />)<br /><br />:: Display help<br />if defined /? (<br />&nbsp; for /f &quot;delims=: tokens=*&quot; %%A in ('findstr &quot;^:::&quot; &quot;%~f0&quot;') do echo(%%A<br />&nbsp; exit /b 0<br />)<br /><br />:: Display version<br />if defined /v (<br />&nbsp; for /f &quot;delims=: tokens=*&quot; %%A in ('findstr /bc:&quot;::JSORT.BAT version&quot; &quot;%~f0&quot;') do echo %%A<br />&nbsp; exit /b 0<br />)<br /><br />:: Transform and validate options<br />set /a &quot;case=0%/i%, num=0%/n%, pos=%/p%-1, tok=%/t%, order=1-2*0%/r%, 1/!(0x80000000&amp;pos), 1/tok&quot; 2&gt;nul || (<br />&nbsp; &gt;&amp;2 echo Error: Invalid option value.<br />&nbsp; exit /b 1<br />)<br />if %tok% gtr 0 set /a tok-=1<br />set &quot;outfile=&quot;<br />if defined /o set ^&quot;outfile=^&gt;&quot;%/o%&quot;&quot;<br /><br />:: Perform the sort<br />%infile% %outfile% cscript //E:JScript //nologo &quot;%~f0&quot; %case% %num% %pos% %order% %/s% %/c% %tok% &quot;%/d%&quot;<br /><br />exit /b 0<br />************* JScript portion **********/<br />var array=new Array(),<br />&nbsp; &nbsp; nocase =WScript.Arguments.Item(0),<br />&nbsp; &nbsp; numeric=WScript.Arguments.Item(1),<br />&nbsp; &nbsp; pos&nbsp; &nbsp; =WScript.Arguments.Item(2),<br />&nbsp; &nbsp; order&nbsp; =WScript.Arguments.Item(3),<br />&nbsp; &nbsp; skip&nbsp; &nbsp;=WScript.Arguments.Item(4),<br />&nbsp; &nbsp; count&nbsp; =WScript.Arguments.Item(5),<br />&nbsp; &nbsp; token&nbsp; =WScript.Arguments.Item(6),<br />&nbsp; &nbsp; delim&nbsp; =WScript.Arguments.Item(7).replace(/\\(?!q|\\)/g,'').replace(/\\\\/g,'\\s').replace(/\\q/g,'&quot;').replace(/\\s/g,'\\');<br />while (!WScript.StdIn.AtEndOfStream) {<br />&nbsp; if (skip &gt; 0) {<br />&nbsp; &nbsp; WScript.Echo(WScript.StdIn.ReadLine());<br />&nbsp; &nbsp; skip-=1<br />&nbsp; } else {<br />&nbsp; &nbsp; var expanded=&quot;&quot;, num=&quot;&quot;, raw=WScript.StdIn.ReadLine(), upper=((nocase==1)?raw.toUpperCase():raw);<br />&nbsp; &nbsp; for( var i=pos+FindToken(raw,delim,token); i&lt;raw.length; i++ ) {<br />&nbsp; &nbsp; &nbsp; var c=upper.substr(i,1);<br />&nbsp; &nbsp; &nbsp; if (numeric==1 &amp;&amp; c&gt;=&quot;0&quot; &amp;&amp; c&lt;=&quot;9&quot;) {<br />&nbsp; &nbsp; &nbsp; &nbsp; num+=c;<br />&nbsp; &nbsp; &nbsp; } else {<br />&nbsp; &nbsp; &nbsp; &nbsp; if (num != &quot;&quot;) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num=&quot;00000000000000000000&quot; + num;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; expanded+=num.substr(num.length-20);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num=&quot;&quot;;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; expanded+=c;<br />&nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; if (num != &quot;&quot;) {<br />&nbsp; &nbsp; &nbsp; num=&quot;00000000000000000000&quot; + num;<br />&nbsp; &nbsp; &nbsp; expanded+=num.substr(num.length-20);<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; var obj={expanded:expanded, raw:raw};<br />&nbsp; &nbsp; array.push(obj);<br />&nbsp; }<br />}<br />if (count&lt;0) count=array.length;<br />if (count&gt;array.length) count=array.length;<br />array.sort(function(a,b){return order*((a.expanded&gt;b.expanded)-(a.expanded&lt;b.expanded));});<br />for (var i=0; i&lt;count; i++) WScript.Echo(array&#91;i&#93;.raw);<br /><br />function FindToken(str, str2, n) {<br />&nbsp; if (n!=0 &amp;&amp; str2==&quot;&quot;) return str.length;<br />&nbsp; if (n&gt;=0) {<br />&nbsp; &nbsp; var rtn = 0;<br />&nbsp; &nbsp; for( var i=n; i&gt;0; i-- ) {<br />&nbsp; &nbsp; &nbsp; rtn = str.indexOf(str2,rtn);<br />&nbsp; &nbsp; &nbsp; if (rtn&lt;0) return str.length;<br />&nbsp; &nbsp; &nbsp; rtn+=str2.length;<br />&nbsp; &nbsp; }<br />&nbsp; } else {<br />&nbsp; &nbsp; var rtn = str.length;<br />&nbsp; &nbsp; for (var i=n; i&lt;0; i++ ) {<br />&nbsp; &nbsp; &nbsp; rtn-=1;<br />&nbsp; &nbsp; &nbsp; rtn = str.lastIndexOf(str2,rtn);<br />&nbsp; &nbsp; &nbsp; if (rtn&lt;0) return str.length;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; rtn+=str2.length;<br />&nbsp; }<br />&nbsp; return rtn;<br />}<br /></code></pre></div><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JSORT.BAT - Case sensitive sort with option for numeric</h3>
				<div class="date">Posted: <strong>06 Jan 2015 04:08</strong></div>
				<div class="author">by <strong>foxidrive</strong></div>
				<div class="content"><blockquote><div><cite>dbenham wrote:</cite>Just in case the source file alredy contains slashes.<br /></div></blockquote><br />ok, ta.  I gather that slashes treated as regexp characters there too then.<br /><blockquote class="uncited"><div>I don't see the problem. The /T option does not specify that only one token is sorted. It simply is part of the equation that determines the beginning position that is used for sorting. Each line is sorted based on the year through the end of the line. The content before the year is simply ignored.</div></blockquote><br />Oh, I wasn't aware of that last bit.  <br />It's just what I need here so thanks.<br /><blockquote><div><cite>dbenham wrote:</cite>release 3.3 that supports negative token numbers<br /><br />The solution for <a href="viewtopicc6f9.html?p=39056#p39056" class="postlink">foxidrives problem</a> is now as simple as:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>jsort test.txt /d &quot;(&quot; /t -1<br /></code></pre></div><br /></div></blockquote><br />Thanks for that - you're mucho helpful.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JSORT.BAT - Case sensitive sort with option for numeric </h3>
				<div class="date">Posted: <strong>06 Jan 2015 15:18</strong></div>
				<div class="author">by <strong>Squashman</strong></div>
				<div class="content">So is there a way to sort on multiple tokens.  Say token 5 then token 3. Or am I going to have to do it the old fashion way and move those two variables to the beginning of the line and then do a normal sort.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JSORT.BAT - Case sensitive sort with option for numeric </h3>
				<div class="date">Posted: <strong>06 Jan 2015 15:27</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">No, I opted not to implement that feature. Coming up with useful syntax and rules became too messy for my taste.<br /><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JSORT.BAT - Case sensitive sort with option for numeric </h3>
				<div class="date">Posted: <strong>06 Jan 2015 15:38</strong></div>
				<div class="author">by <strong>Squashman</strong></div>
				<div class="content">I guess I will just do it the old fashion way then.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JSORT.BAT - Case sensitive sort with option for numeric</h3>
				<div class="date">Posted: <strong>06 Jan 2015 21:59</strong></div>
				<div class="author">by <strong>carlsomo</strong></div>
				<div class="content">It would be nice to have a date option so that date fields in the format: MM/DD/YYYY or m/d/y could be sorted by year month day? Just a suggestion. I currently have to write to a new file after converting dates to YYYYMMDD, run the sort with the date in the first position, then convert the dates back again and put the date field back where it started. Kind of tedious coding.<br /><br />carl</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JSORT.BAT - Case sensitive sort with option for numeric</h3>
				<div class="date">Posted: <strong>06 Jan 2015 23:39</strong></div>
				<div class="author">by <strong>foxidrive</strong></div>
				<div class="content">carl,  FWIW I think that could be done with a single line using jrepl, also using sort, if the format is predictable.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JSORT.BAT - Case sensitive sort with option for numeric</h3>
				<div class="date">Posted: <strong>08 Jan 2015 00:31</strong></div>
				<div class="author">by <strong>carlsomo</strong></div>
				<div class="content">That would be cool, so sample csv file to sort by date, most recent year on top:<br /><br />Sample CSV File Title line<br />FRUIT,Dish,Date submitted,item<br />apple,taco,12/31/2000,bus ticket<br />banana,fruit pie,3/17/1958,table<br />orange,julius,1/5/1999,stool<br />pea pod,stew,04/9/2014,glider<br />key lime,pie,12/1/2000,ladder<br /><br />Is there a one liner for this?<br /><br />TIA, carl</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JSORT.BAT - Case sensitive sort with option for numeric</h3>
				<div class="date">Posted: <strong>08 Jan 2015 01:35</strong></div>
				<div class="author">by <strong>foxidrive</strong></div>
				<div class="content"><blockquote><div><cite>carlsomo wrote:</cite>Is there a one liner for this?<br /></div></blockquote><br /><br />I'm not quite sure what output you want from that sample data<br /><br /><strong class="text-strong">Edit:</strong> I shortened the code<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />type &quot;file.csv&quot; | jrepl &quot;.*,(\d\d|\d)/(\d\d|\d)/(\d\d\d\d),.*&quot; &quot;$3+lpad($1,'00')+lpad($2,'00')+'|'+$0&quot; /j | sort /r | jrepl &quot;^.*?\|&quot; &quot;&quot;<br /></code></pre></div><br />This uses a helper batch file called `Jrepl.bat` (by dbenham) - download from:  <!-- m --><a class="postlink" href="https://www.dropbox.com/s/4otci4d4s8x5ni4/Jrepl.bat">https://www.dropbox.com/s/4otci4d4s8x5ni4/Jrepl.bat</a><!-- m --><br /><br />Place `Jrepl.bat` in the same folder as the batch file or in a folder that is on the path.<br /><br /><br /><span style="color: blue">Sample CSV File Title line<br />FRUIT,Dish,Date submitted,item<br />pea pod,stew,04/9/2014,glider<br />apple,taco,12/31/2000,bus ticket<br />key lime,pie,12/1/2000,ladder<br />orange,julius,1/5/1999,stool<br />banana,fruit pie,3/17/1958,table</span></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JSORT.BAT - Case sensitive sort with option for numeric</h3>
				<div class="date">Posted: <strong>24 Mar 2015 20:51</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">Here is version 4.1<br /><br />I've added a /U option to write only Unique lines, after sorting. (Discard Duplicates)<br /><br />I've also fixed the option parser so that it properly supports no options. Versions 3.2, 3.3, and 4.0  had a bug that raised an error if no options were given.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@if (@X)==(@Y) @end /* Harmless hybrid line that begins a JScript comment<br />@goto :Batch<br />&nbsp;<br />::************ Documentation ***********<br />::JSORT.BAT version 4.1<br />:::<br />:::JSORT &#91;File&#93; &#91;/Option &#91;Value&#93;&#93;...<br />:::<br />:::&nbsp; Sort lines of text from stdin and write the result to stdout.<br />:::&nbsp; JSORT uses an ascending, case sensitive text sort by default.<br />:::<br />:::&nbsp; &nbsp; File - If the optional File argument is specified, then JSORT reads lines<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;from the file instead of from stdin. If specified, the File must<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;be the very first argument.<br />:::<br />:::&nbsp; Options:<br />:::<br />:::&nbsp; &nbsp; /C n - Number of sorted lines to print. Skipped lines are always printed<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;and do not contribute to the count. Default is -1 (all lines).<br />:::<br />:::&nbsp; &nbsp; /D String - Specifies the string used to delimit tokens. The delimiter<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;string is always case sensitive. A quote literal &quot; must be escaped<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;as \q, and a backslash literal \ must be escaped as \\.<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The default value is an empty string, meaning treat the entire<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;line as a single token.<br />:::<br />:::&nbsp; &nbsp; /I&nbsp; &nbsp;- Ignore case when sorting (or when checking for uniqueness)<br />:::<br />:::&nbsp; &nbsp; /N&nbsp; &nbsp;- Sort consecutive digits as numbers instead of text. The numbers<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;may be embedded within alpha text. JSort supports numbers up to<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;20 digits long.<br />:::<br />:::&nbsp; &nbsp; /O File - Writes the output to File instead of stdout.<br />:::<br />:::&nbsp; &nbsp; /P n - Begin sorting at character position n relative to the beginning<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;of the selected token. Lines that do not extend that far are<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;treated as equivalent values, and collate before all other lines.<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The default value is 1 (first character).<br />:::<br />:::&nbsp; &nbsp; /R&nbsp; &nbsp;- Sort the lines in Reverse (descending) order.<br />:::<br />:::&nbsp; &nbsp; /S n - Number of lines to skip - default is 0.<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Skipped lines are not sorted (remain in place)<br />:::<br />:::&nbsp; &nbsp; /T n - Specify the token at which to begin sorting. The sort is not<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;restricted to the selected token, it just helps to identify where<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;to begin sorting. The default value is 1 (first token). A value of<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-1 represents the last token, -2 the penultimate token, etc.<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;A value of 0 is invalid. Note that negative values only recognize<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;tokens that occur after a delimiter. If the requested token cannot<br />:::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;be found, then the line will collate before all other lines.<br />:::<br />:::&nbsp; &nbsp; /U&nbsp; &nbsp;- Only write unique lines (discard duplicates)<br />:::<br />:::&nbsp; &nbsp; /V&nbsp; &nbsp;- Display the version of JSORT.BAT.<br />:::<br />:::&nbsp; &nbsp; /?&nbsp; &nbsp;- Display this help<br />:::<br />:::JSORT.BAT was written by Dave Benham and originally posted at<br />:::http://www.dostips.com/forum/viewtopic.php?f=3&amp;t=5595<br />:::<br /><br />============== :Batch portion =============<br />@echo off<br />setlocal disableDelayedExpansion<br /><br />:: Get optional input file<br />set &quot;infile=&quot;<br />set &quot;test=%~1&quot;<br />if defined test (<br />&nbsp; setlocal enableDelayedExpansion<br />&nbsp; if &quot;!test:~0,1!&quot; neq &quot;/&quot; (<br />&nbsp; &nbsp; endlocal<br />&nbsp; &nbsp; set ^&quot;infile=^&lt;&quot;%~1&quot;&quot;<br />&nbsp; &nbsp; shift /1<br />&nbsp; ) else endlocal<br />)<br /><br />:: Define options<br />set &quot;options= /?: /c:-1 /d:&quot;&quot; /i: /n: /o:&quot;&quot; /p:1 /r: /s:0 /t:1 /u: /v: &quot;<br /><br />:: Set default option values<br />for %%O in (%options%) do for /f &quot;tokens=1,* delims=:&quot; %%A in (&quot;%%O&quot;) do set &quot;%%A=%%~B&quot;<br /><br />:: Get options<br />:loop<br />if not &quot;%~1&quot;==&quot;&quot; (<br />&nbsp; setlocal enableDelayedExpansion<br />&nbsp; set &quot;test=!options:* %~1:=! &quot;<br />&nbsp; if &quot;!test!&quot;==&quot;!options! &quot; (<br />&nbsp; &nbsp; &nbsp; &gt;&amp;2 echo Error: Invalid option %~1<br />&nbsp; &nbsp; &nbsp; exit /b 1<br />&nbsp; ) else if &quot;!test:~0,1!&quot;==&quot; &quot; (<br />&nbsp; &nbsp; &nbsp; endlocal<br />&nbsp; &nbsp; &nbsp; set &quot;%~1=1&quot;<br />&nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; endlocal<br />&nbsp; &nbsp; &nbsp; set &quot;%~1=%~2&quot;<br />&nbsp; &nbsp; &nbsp; shift /1<br />&nbsp; )<br />&nbsp; shift /1<br />&nbsp; goto :loop<br />)<br /><br />:: Display help<br />if defined /? (<br />&nbsp; for /f &quot;delims=: tokens=*&quot; %%A in ('findstr &quot;^:::&quot; &quot;%~f0&quot;') do echo(%%A<br />&nbsp; exit /b 0<br />)<br /><br />:: Display version<br />if defined /v (<br />&nbsp; for /f &quot;delims=: tokens=*&quot; %%A in ('findstr /bc:&quot;::JSORT.BAT version&quot; &quot;%~f0&quot;') do echo %%A<br />&nbsp; exit /b 0<br />)<br /><br />:: Transform and validate options<br />set /a &quot;case=0%/i%, num=0%/n%, pos=%/p%-1, tok=%/t%, unique=0%/u%, order=1-2*0%/r%, 1/!(0x80000000&amp;pos), 1/tok&quot; 2&gt;nul || (<br />&nbsp; &gt;&amp;2 echo Error: Invalid option value.<br />&nbsp; exit /b 1<br />)<br />if %tok% gtr 0 set /a tok-=1<br />set &quot;outfile=&quot;<br />if defined /o set ^&quot;outfile=^&gt;&quot;%/o%&quot;&quot;<br /><br />:: Perform the sort<br />%infile% %outfile% cscript //E:JScript //nologo &quot;%~f0&quot; %case% %num% %pos% %order% %/s% %/c% %tok% &quot;%/d%&quot; %unique%<br /><br />exit /b 0<br /><br />************* JScript portion **********/<br />var array=new Array(),<br />&nbsp; &nbsp; nocase =WScript.Arguments.Item(0),<br />&nbsp; &nbsp; numeric=WScript.Arguments.Item(1),<br />&nbsp; &nbsp; pos&nbsp; &nbsp; =WScript.Arguments.Item(2),<br />&nbsp; &nbsp; order&nbsp; =WScript.Arguments.Item(3),<br />&nbsp; &nbsp; skip&nbsp; &nbsp;=WScript.Arguments.Item(4),<br />&nbsp; &nbsp; count&nbsp; =WScript.Arguments.Item(5),<br />&nbsp; &nbsp; token&nbsp; =WScript.Arguments.Item(6),<br />&nbsp; &nbsp; delim&nbsp; =WScript.Arguments.Item(7).replace(/\\(?!q|\\)/g,'').replace(/\\\\/g,'\\s').replace(/\\q/g,'&quot;').replace(/\\s/g,'\\'),<br />&nbsp; &nbsp; unique =WScript.Arguments.Item(8);<br />while (!WScript.StdIn.AtEndOfStream) {<br />&nbsp; if (skip &gt; 0) {<br />&nbsp; &nbsp; WScript.Echo(WScript.StdIn.ReadLine());<br />&nbsp; &nbsp; skip-=1<br />&nbsp; } else {<br />&nbsp; &nbsp; var expanded=&quot;&quot;, num=&quot;&quot;, raw=WScript.StdIn.ReadLine(), upper=((nocase==1)?raw.toUpperCase():raw);<br />&nbsp; &nbsp; for( var i=pos+FindToken(raw,delim,token); i&lt;raw.length; i++ ) {<br />&nbsp; &nbsp; &nbsp; var c=upper.substr(i,1);<br />&nbsp; &nbsp; &nbsp; if (numeric==1 &amp;&amp; c&gt;=&quot;0&quot; &amp;&amp; c&lt;=&quot;9&quot;) {<br />&nbsp; &nbsp; &nbsp; &nbsp; num+=c;<br />&nbsp; &nbsp; &nbsp; } else {<br />&nbsp; &nbsp; &nbsp; &nbsp; if (num != &quot;&quot;) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num=&quot;00000000000000000000&quot; + num;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; expanded+=num.substr(num.length-20);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; num=&quot;&quot;;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; expanded+=c;<br />&nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; if (num != &quot;&quot;) {<br />&nbsp; &nbsp; &nbsp; num=&quot;00000000000000000000&quot; + num;<br />&nbsp; &nbsp; &nbsp; expanded+=num.substr(num.length-20);<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; var obj={expanded:expanded, raw:raw};<br />&nbsp; &nbsp; array.push(obj);<br />&nbsp; }<br />}<br />if (count&lt;0) count=array.length;<br />if (count&gt;array.length) count=array.length;<br />if (unique==1) {<br />&nbsp; array.sort( function(a,b){<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var rtn = (a.expanded&gt;b.expanded)-(a.expanded&lt;b.expanded);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if (rtn==0) {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var a2=(nocase==1)?a.raw.toUpperCase():a.raw;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; var b2=(nocase==1)?b.raw.toUpperCase():b.raw;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rtn = (a2&gt;b2)-(a2&lt;b2);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return order*rtn;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; });<br />&nbsp; if (count&gt;=1) WScript.Echo(array&#91;0&#93;.raw);<br />&nbsp; for (var i=1; i&lt;count; i++) {<br />&nbsp; &nbsp; if (nocase==1 &amp;&amp; array&#91;i&#93;.raw.toUpperCase() == array&#91;i-1&#93;.raw.toUpperCase()) continue;<br />&nbsp; &nbsp; if (nocase==0 &amp;&amp; array&#91;i&#93;.raw == array&#91;i-1&#93;.raw) continue;<br />&nbsp; &nbsp; WScript.Echo(array&#91;i&#93;.raw);<br />&nbsp; }<br />} else {<br />&nbsp; array.sort(function(a,b){return order*((a.expanded&gt;b.expanded)-(a.expanded&lt;b.expanded));});<br />&nbsp; for (var i=0; i&lt;count; i++) WScript.Echo(array&#91;i&#93;.raw);<br />}<br /><br />function FindToken(str, str2, n) {<br />&nbsp; if (n!=0 &amp;&amp; str2==&quot;&quot;) return str.length;<br />&nbsp; if (n&gt;=0) {<br />&nbsp; &nbsp; var rtn = 0;<br />&nbsp; &nbsp; for( var i=n; i&gt;0; i-- ) {<br />&nbsp; &nbsp; &nbsp; rtn = str.indexOf(str2,rtn);<br />&nbsp; &nbsp; &nbsp; if (rtn&lt;0) return str.length;<br />&nbsp; &nbsp; &nbsp; rtn+=str2.length;<br />&nbsp; &nbsp; }<br />&nbsp; } else {<br />&nbsp; &nbsp; var rtn = str.length;<br />&nbsp; &nbsp; for (var i=n; i&lt;0; i++ ) {<br />&nbsp; &nbsp; &nbsp; rtn-=1;<br />&nbsp; &nbsp; &nbsp; rtn = str.lastIndexOf(str2,rtn);<br />&nbsp; &nbsp; &nbsp; if (rtn&lt;0) return str.length;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; rtn+=str2.length;<br />&nbsp; }<br />&nbsp; return rtn;<br />}<br /></code></pre></div><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JSORT.BAT - Case sensitive sort with option for numeric</h3>
				<div class="date">Posted: <strong>01 May 2015 01:29</strong></div>
				<div class="author">by <strong>foxidrive</strong></div>
				<div class="content">Dave, What would be the best method to use leading hashes in a line and delete all the same lines, except one line?<br /><br />Can Jsort remove the last (or first line) - in a matching set that only considers field 1?<br /><br />If not would a syntax like this be useful:<br /><span style="color: blue">jsort file.txt /HB</span> or <br /><span style="color: blue">jsort file.txt /HE</span> <br />to filter out the <span style="color: blue">B</span>eginning line or <span style="color: blue">E</span>nd line in a set of leading <span style="color: blue">/H</span>ashs?<br /><br />For example, filter out (or maybe just include) the lines in blue which would be the <span style="color: blue">E</span>nd lines, after sorting the file.<br /><br />007B9E14 Reminderfox backups\Firefox profile-4938hge8.default-2015-03-28_14.28.11\reminderfox.ics.bak2<br />007B9E14 Reminderfox backups\Firefox profile-4938hge8.default-2015-03-28_15.11.09\reminderfox.ics.bak2<br />007B9E14 Reminderfox backups\Firefox profile-4938hge8.default-2015-03-28_16.13.10\reminderfox.ics.bak3<br />007B9E14 Reminderfox backups\Firefox profile-4938hge8.default-2015-03-28_16.15.12\reminderfox.ics.bak3<br />007B9E14 Reminderfox backups\Firefox profile-4938hge8.default-2015-03-28_16.27.24\reminderfox.ics.bak3<br />007B9E14 Reminderfox backups\Firefox profile-4938hge8.default-2015-03-28_16.29.17\reminderfox.ics.bak3<br />007B9E14 Reminderfox backups\Firefox profile-4938hge8.default-2015-03-28_16.29.24\reminderfox.ics.bak3<br /><span style="color: #0000FF">007B9E14 Reminderfox backups\Firefox profile-4938hge8.default-2015-03-28_16.59.08\reminderfox.ics.bak3</span><br />050EB09F Reminderfox backups\Firefox profile-4938hge8.default-2015-02-27_20.08.33\reminderfox.ics<br />050EB09F Reminderfox backups\Firefox profile-4938hge8.default-2015-02-27_21.48.20\reminderfox.ics<br /><span style="color: #0000FF">050EB09F Reminderfox backups\Firefox profile-4938hge8.default-2015-02-27_21.48.20\reminderfox.ics.bak1<br />069D347B Reminderfox backups\Firefox profile-4938hge8.default-2015-02-12_01.01.25\calDAVmap.css<br />07B5268C Reminderfox backups\reminderfox.ics.2014-07-12_03.09</span><br />07C51335 Reminderfox backups\reminderfox.ics.2014-03-31_02.08<br />07C51335 Reminderfox backups\reminderfox.ics.2014-03-31_15.07<br />07C51335 Reminderfox backups\reminderfox.ics.2014-03-31_15.14<br /><span style="color: #0000FF">07C51335 Reminderfox backups\reminderfox.ics.2014-03-31_15.15</span><br />0862C70B Reminderfox backups\reminderfox.ics.2014-12-13_03.54<br /><span style="color: #0000FF">0862C70B Reminderfox backups\reminderfox.ics.2014-12-13_04.19</span><br />0A077988 Reminderfox backups\reminderfox.ics.2014-02-06_15.50<br /><span style="color: #0000FF">0A077988 Reminderfox backups\reminderfox.ics.2014-02-06_17.28</span><br />0AC5D19A Reminderfox backups\reminderfox.ics.2015-01-11_03.56<br />0AC5D19A Reminderfox backups\Thunderbird profile-6978he18.default-2015-01-14_14.42.13\reminderfox.ics.bak2<br />0AC5D19A Reminderfox backups\Thunderbird profile-6978he18.default-2015-01-14_14.46.05\reminderfox.ics.bak2<br /><span style="color: #0000FF">0AC5D19A Reminderfox backups\Thunderbird profile-6978he18.default-2015-01-15_23.31.58\reminderfox.ics.bak3<br />0AFDCCA6 Reminderfox backups\reminderfox.ics.2014-08-10_03.29<br />0B58297D Reminderfox backups\reminderfox.ics.2014-08-19_00.12<br />0BF8B098 Reminderfox backups\reminderfox.ics.2014-02-25_11.08</span><br /><br /><strong class="text-strong">======================================================</strong><br /><br />I have a script that does this task with files, and recursively, but it might be a useful thing and I'm not clever enough to figure out any jscript to do it.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JSORT.BAT - Case sensitive sort with option for numeric </h3>
				<div class="date">Posted: <strong>01 May 2015 05:13</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">I wouldn't mess with JSORT at all. I would use SORT piped to JREPL<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>sort yourfile.log | jrepl &quot;^(.{8} ).*\n(\1.*\n)*(?=\1)&quot; &quot;&quot; /m<br /></code></pre></div><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JSORT.BAT - Case sensitive sort with option for numeric</h3>
				<div class="date">Posted: <strong>01 May 2015 05:23</strong></div>
				<div class="author">by <strong>foxidrive</strong></div>
				<div class="content"><blockquote><div><cite>dbenham wrote:</cite>I wouldn't mess with JSORT at all. I would use SORT piped to JREPL<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>sort yourfile.log | jrepl &quot;^(.{8} ).*\n(\1.*\n)*(?=\1)&quot; &quot;&quot; /m<br /></code></pre></div><br /></div></blockquote><br /><br />My brain just exploded.<br /><br />Two questions though - will sort function effectively when case is taken into consideration, and <br />you may have read one of my edits but I'd like to filter out the matches and return the rest.<br /><br />On re-reading I wasn't clear that filtering out was my preference but that inclusive may have been useful as a secondary option - if it was added to Jsort, was my thinking.<br /><br />Thanks for your code.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JSORT.BAT - Case sensitive sort with option for numeric </h3>
				<div class="date">Posted: <strong>01 May 2015 07:21</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">SORT is not case sensitive. If you need case sensitive, then you can switch to JSORT.<br /><br />As far as the rest of your questions, I'm having trouble understanding the collective meaning of your words (with both your posts). For example, I'm not sure what you mean by &quot;filtering out&quot; - Are the filtered out lines discarded, or preserved? And what do you mean by &quot;inclusive&quot;.<br /><br />The way I derived my code was to look for a way to preserve the blue lines in your first post.<br /><br />The only feature I am thinking of adding to JSORT is the ability to specify a regex search/replace pair. The sort would be performed on the replace result, but the original lines would be preserved (except for duplicate removal if /U specified, though definition of duplicate is a bit hazy yet). But I haven't decided to leap and  develop this feature yet. It would require merging a lot of code from JSORT and JREPL. Perhaps it would be an entirely new utility - REGXSORT.<br /><br />A utility like REGXSORT would easily solve your problem in one step.<br /><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JSORT.BAT - Case sensitive sort with option for numeric</h3>
				<div class="date">Posted: <strong>01 May 2015 16:39</strong></div>
				<div class="author">by <strong>foxidrive</strong></div>
				<div class="content"><blockquote><div><cite>dbenham wrote:</cite>I'm having trouble understanding the collective meaning of your words (with both your posts). For example, I'm not sure what you mean by &quot;filtering out&quot; - Are the filtered out lines discarded, or preserved? And what do you mean by &quot;inclusive&quot;.<br /></div></blockquote><br /><br />Yeah, sometimes I write like a retarded monkey with dyslexia.<br /><br />Filtering out - was meant to mean to discard those lines.<br />Inclusive - was meant to mean only print those lines (which is what your code does well).<br /><br /><blockquote class="uncited"><div>It would require merging a lot of code from JSORT and JREPL. Perhaps it would be an entirely new utility - REGXSORT.<br /><br />A utility like REGXSORT would easily solve your problem in one step.<br /></div></blockquote><br /><br />If you find the time and enthusiasm then it sounds like another great tool for the batch community. :thumbsup:</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="UTC-6">UTC-06:00</span><br />Page <strong>3</strong> of <strong>4</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Limited<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=5595&start=30&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:46:14 GMT -->
</html>
