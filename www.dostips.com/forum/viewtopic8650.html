<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=8152 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:20:25 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>JREPL.BAT, ADO Streams and big files - DosTips.com</title>


	<link rel="canonical" href="viewtopicf1d7.html?t=8152">

<!--
	phpBB style name: Allan Style - SUBSILVER
	Based on style:   prosilver (this is the default phpBB3 style)
	Based on style:   subsilver2 (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:  Allan ( http://x-tk.ru/ )
-->

<link href="assets/css/font-awesome.mind772.css?assets_version=34" rel="stylesheet">
<link href="styles/AllanStyle-SUBSILVER/theme/stylesheetd772.css?assets_version=34" rel="stylesheet">
<link href="styles/AllanStyle-SUBSILVER/theme/en/stylesheetd772.css?assets_version=34" rel="stylesheet">




<!--[if lte IE 9]>
	<link href="./styles/AllanStyle-SUBSILVER/theme/tweaks.css?assets_version=34" rel="stylesheet">
<![endif]-->




<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','../../www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-280191-1', 'auto');
	ga('send', 'pageview');
</script>

</head>
<body id="phpbb" class="nojs notouch section-viewtopic ltr ">

<div id="header-subsilver">
	<a id="top" class="top-anchor" accesskey="t"></a>
		<div class="headerbar" role="banner">
					<div class="inner">

			<div id="site-description" class="site-description">
				<a id="logo" class="logo" href="../index.html" title="DosTips.com"><span class="site_logo"></span></a>
				<h1>DosTips.com</h1>
				<p>A Forum all about DOS Batch</p>
				<p class="skiplink"><a href="#start_here">Skip to content</a></p>
			</div>

									<div id="search-box" class="search-box search-header" role="search">
				<form action="https://www.dostips.com/forum/search.php" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="search" maxlength="128" title="Search for keywords" class="inputbox search tiny" size="20" value="" placeholder="Search…" />
					<button class="button button-search" type="submit" title="Search">
						<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
					</button>
					<a href="search.html" class="button button-search-end" title="Advanced search">
						<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
					</a>
					
				</fieldset>
				</form>
			</div>
						
			</div>
					</div>
</div>


<div id="wrap" class="wrap">
	<div id="page-header">
				<div class="navbar-top" role="navigation">
	<div class="inner">

	<ul id="nav-main" class="nav-main linklist" role="menubar">

		<li id="quick-links" class="quick-links dropdown-container responsive-menu" data-skip-responsive="true">
			<a href="#" class="dropdown-trigger">
				<i class="icon fa-bars fa-fw" aria-hidden="true"></i><span>Quick links</span>
			</a>
			<div class="dropdown">
				<div class="pointer"><div class="pointer-inner"></div></div>
				<ul class="dropdown-contents" role="menu">
					
											<li class="separator"></li>
																									<li>
								<a href="search33a7.html?search_id=unanswered" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-gray" aria-hidden="true"></i><span>Unanswered topics</span>
								</a>
							</li>
							<li>
								<a href="search526f.html?search_id=active_topics" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-blue" aria-hidden="true"></i><span>Active topics</span>
								</a>
							</li>
							<li class="separator"></li>
							<li>
								<a href="search.html" role="menuitem">
									<i class="icon fa-search fa-fw" aria-hidden="true"></i><span>Search</span>
								</a>
							</li>
					
											<li class="separator"></li>
																			<li>
								<a href="memberlist4bfd.html?mode=team" role="menuitem">
									<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
								</a>
							</li>
																<li class="separator"></li>

									</ul>
			</div>
		</li>

				<li data-skip-responsive="true">
			<a href="app.php/help/faq.html" rel="help" title="Frequently Asked Questions" role="menuitem">
				<i class="icon fa-question-circle fa-fw" aria-hidden="true"></i><span>FAQ</span>
			</a>
		</li>
						
			<li class="rightside"  data-skip-responsive="true">
			<a href="ucp26c3.html?mode=login" title="Login" accesskey="x" role="menuitem">
				<i class="icon fa-power-off fa-fw" aria-hidden="true"></i><span>Login</span>
			</a>
		</li>
					<li class="rightside" data-skip-responsive="true">
				<a href="ucp8319.html?mode=register" role="menuitem">
					<i class="icon fa-pencil-square-o  fa-fw" aria-hidden="true"></i><span>Register</span>
				</a>
			</li>
						</ul>

	</div>
</div>

<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks" role="menubar">
						<li class="breadcrumbs">
							<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope=""><a href="../index.html" itemprop="url" data-navbar-reference="home"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span itemprop="title">DosTips.com</span></a></span>
										<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope=""><a href="index.html" itemprop="url" accesskey="h" data-navbar-reference="index"><span itemprop="title">Board index</span></a></span>

											<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="4"><a href="viewforum31e6.html?f=4" itemprop="url"><span itemprop="title">DosTips - Dos Batch</span></a></span>
															<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="3"><a href="viewforum4d6b.html?f=3" itemprop="url"><span itemprop="title">DOS Batch Forum</span></a></span>
												</li>
		
					<li class="rightside responsive-search">
				<a href="search.html" title="View the advanced search options" role="menuitem">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</a>
			</li>
			</ul>

	</div>
</div>

<div class="navbar-top-link">
	<div class="inner">
		<ul>
			<li class="navbar-top-link-left"><a href="search33a7.html?search_id=unanswered">Unanswered topics</a></li>
			<li class="navbar-top-link-left"><a href="search526f.html?search_id=active_topics">Active topics</a></li>

											</ul>
	</div>
</div>
	</div>

	
	<a id="start_here" class="anchor"></a>
	<div id="page-body" class="page-body" role="main">
		
		
<h2 class="topic-title"><a href="viewtopic8650.html?f=3&amp;t=8152">JREPL.BAT, ADO Streams and big files</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Discussion forum for all Windows batch related topics.<br /></div>
<p>
	<strong>Moderator:</strong> <a href="memberlista6a8.html?mode=viewprofile&amp;u=5" class="username">DosItHelp</a>
</p>


<div class="action-bar bar-top">
	
			<a href="posting217c.html?mode=reply&amp;f=3&amp;t=8152" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
	
			<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic7b09.html?f=3&amp;t=8152&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>
	
			<div class="search-box" role="search">
			<form method="get" id="topic-search" action="https://www.dostips.com/forum/search.php">
			<fieldset>
				<input class="inputbox search tiny"  type="search" name="keywords" id="search_keywords" size="20" placeholder="Search this topic…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="search.html" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				<input type="hidden" name="t" value="8152" />
<input type="hidden" name="sf" value="msgonly" />

			</fieldset>
			</form>
		</div>
	
			<div class="pagination">
			8 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
		</div>




<div id="subsilver-nav-topic">
	<div class="inner"><div class="post has-profile">
		<div class="leftsided postbody subsilver-topic-title">Message</div>
		<div class="leftsided postprofile subsilver-topic-author">Author</div>
	</div></div>
</div>

			<div id="p54162" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile54162">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha86d.html?author_id=2258&amp;sr=posts">2152</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 Feb 2011 21:02</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> United States (east coast)</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54162">

						<h3 class="first"><a href="#p54162">JREPL.BAT, ADO Streams and big files</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting4bb1.html?mode=quote&amp;f=3&amp;p=54162" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic12d6.html?p=54162#p54162" onclick="prompt('Message #1',this.href); return false;">#1</a></span> 
									<a class="unread" href="viewtopic12d6.html?p=54162#p54162" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a></strong> &raquo; </span>27 Sep 2017 21:34
			</p>
			
			
			
			<div class="content"><strong class="text-strong"><em class="text-italics">This discussion is a continuation of a topic that was <a href="viewtopice0af.html?f=3&amp;t=7570&amp;start=15#p54152" class="postlink">started here</a>, that became tangential to the CONVERTCP topic.</em></strong><br /><br /><blockquote><div><cite>aGerman wrote:</cite>On the other hand the main scopes of JREPL and CONVERTCP are quite different. This makes that JREPL is able (and designed) to do customized replacements while CONVERTCP can't do that. But this also makes that CONVERTCP is so much faster for big files (307s JREPL vs. 9s CONVERTCP for 360MB text Windows-1252 to UTF-8 in my tests) because it efficiently converts and writes in parallel threads. Converting big files was one of Saso's original requirements.</div></blockquote><br />Thanks for those comparative timings Steffen. The CONVERTCP timings are impressive <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br />In most circumstances, CONVERTCP is clearly the better option.<br /><br />The only reasons I can think for ever using JREPL instead are:<br />1) If your work environment disallows 3rd party exe files<br />2) If you already have JREPL available, and don't want to bother getting CONVERTCP<br />3) If you need custom transformations.<br /><br />I expected JREPL to be slower, but I was a bit shocked to see that JREPL was 30 times slower than CONVERTCP <img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" /> <br /><br />I did some timings to see what effect ADO has on reading and writing vs. using the native FiieSystemObject text stream.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>JREPL timings for reading and writing<br />&nbsp; a 155MB Windows-1252 endoded file<br /><br />&nbsp; &nbsp; &nbsp; &nbsp;Read&nbsp; &nbsp;Write<br />&nbsp; &nbsp; &nbsp; Method&nbsp; Method&nbsp; Seconds<br />&nbsp; &nbsp; &nbsp; -----------------------<br />&nbsp; &nbsp; &nbsp; Native&nbsp; Native&nbsp; &nbsp; &nbsp; 87<br />&nbsp; &nbsp; &nbsp; Native&nbsp; ADO&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;71<br />&nbsp; &nbsp; &nbsp; ADO&nbsp; &nbsp; &nbsp;Native&nbsp; &nbsp; &nbsp;280<br />&nbsp; &nbsp; &nbsp; ADO&nbsp; &nbsp; &nbsp;ADO&nbsp; &nbsp; &nbsp; &nbsp; 245<br /></code></pre></div><br />So there is a severe performance penalty when using ADO to read (factor of 3+). Yet writing with ADO was marginally (but consistently) 10% faster  <img class="smilies" src="images/smilies/icon_confused.gif" alt=":?" title="Confused" />  <br /><br /><br />Dave</div>

			
													<div class="notice">
					Last edited by <a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a> on 28 Sep 2017 11:54, edited 1 time in total.
									</div>
			
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54163" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile54163">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search661c.html?author_id=1265&amp;sr=posts">3386</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 22 Jan 2010 18:01</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Germany</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54163">

						<h3 ><a href="#p54163">Re: CONVERTCP.exe - Convert text from one code page to another</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting8dee-2.html?mode=quote&amp;f=3&amp;p=54163" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic6623.html?p=54163#p54163" onclick="prompt('Message #2',this.href); return false;">#2</a></span> 
									<a class="unread" href="viewtopic6623.html?p=54163#p54163" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a></strong> &raquo; </span>28 Sep 2017 01:40
			</p>
			
			
			
			<div class="content">Dave<br /><br />First of all I think in most cases it doesn't matter much if JREPL is slower. For a lot of people it'll be rather an exception to convert text files with hundreds of MB of text. Although it could be of interest again if you have to convert a bunch of smaller text files. Another problem that Saso faced was that he was running out of memory with the first version I wrote. I read the entire text into memory before I began to convert it. That was the point where I had to begin reading the file chunk-wise. This was also an improvement of speed. Not only that it enabled to convert in parallel threads it also avoided reallocations of RAM space. I think this is one of the main reasons why ADO is slow. I assume that it allocates a certain amount of space. If the file is bigger it reallocates more space again and again. Depending on the internal implementation of the buffer it might require a contiguous range in RAM which will lead to copy all of the already read data to another position in the memory where the system was able to allocate enough space in a single block. In the worst case this will also happen several times.<br />Currently I don't have any good idea how you could work around it. Reading line-wise could be worth a try. If (and only if) ADO does not release the block of memory that it already allocated the speed could be improved tremendously. A little pitfall is that ADO always adds the BOM for multibyte codepages. You have to skip it except for the first line.<br /><br />Steffen</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54164" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile54164">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha86d.html?author_id=2258&amp;sr=posts">2152</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 Feb 2011 21:02</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> United States (east coast)</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54164">

						<h3 ><a href="#p54164">Re: CONVERTCP.exe - Convert text from one code page to another</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingc772.html?mode=quote&amp;f=3&amp;p=54164" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic047e.html?p=54164#p54164" onclick="prompt('Message #3',this.href); return false;">#3</a></span> 
									<a class="unread" href="viewtopic047e.html?p=54164#p54164" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a></strong> &raquo; </span>28 Sep 2017 05:50
			</p>
			
			
			
			<div class="content">JREPL always logically reads and writes one line at a time (unless the /M multi-line option is used)<br /><br />When using the native FileScriptingObject, the physical reads and writes are also one line at a time, though I imagine there may be some buffering going on behind the scene. A text stream is opened either for reading or writing, but never both.<br /><br />But when ADO reads or writes a line, everything is done via memory only (presumably lots of virtual memory with large files). A single ADO stream is always bidirectional, supporting both reads and writes. After JREPL opens an input file with ADO, I explicitly load the file content into ADO memory, and the starting stream position is at the beginning of the data, ready to begin reading lines.<br />Conversely, JREPL writes each output line to memory in a different ADO stream, and then just before closing, I explicitly save the output stream to file.<br /><br />I now realize there is one additional advantage of JREPL when dealing with multi-byte input encodings - I never have to worry about chunk boundaries, so there is no restriction on input size for any of the supported encodings (character sets).<br /><br /><br />Dave Benham</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54165" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile54165">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search661c.html?author_id=1265&amp;sr=posts">3386</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 22 Jan 2010 18:01</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Germany</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54165">

						<h3 ><a href="#p54165">Re: JREPL.BAT, ADO Streams and big files</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting6ed5.html?mode=quote&amp;f=3&amp;p=54165" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic9cb9.html?p=54165#p54165" onclick="prompt('Message #4',this.href); return false;">#4</a></span> 
									<a class="unread" href="viewtopic9cb9.html?p=54165#p54165" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a></strong> &raquo; </span>28 Sep 2017 11:53
			</p>
			
			
			
			<div class="content">I hope you agree with my decision to split the above posts away from the CONVERTCP topic, Dave. I did it for two reasons<br />1) It doesn't make much sense to discuss about JScript and ADO in a thread about a C utility.<br />2) My hope is that we reach some more people with ADO experiences if we have a thread title about our actual discussion.<br /><br />Even if the theme is not directly about Batch I think it's okay to leave it in the public part of the forum because the objective is to improve an excellent command line tool.<br />~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~<br /><br />Back to the topic ...<br /><br />The source code of JREPL is quite long and you know best how you implemented the ADO handling. So I'm a little dependent on your confirmations or denials.<br /><br />My observation was that ADO reads the whole content of the file into memory. At least the memory usage of CSCRIPT grew up the whole time. Please correct me if I'm wrong but as I understand your code it loads the entire text into only one stream object. In my last reply I wrote about my assumptions regarding the implemented memory handling of ADO. So what I believe is that a lot of memory reallocations and additional copy operations are performed internally in order to have the whole stream buffer in a consecutive memory range. That's most likely the reason why it take such a long time and why it could be better to read only chunks of the file. My proposal was to read and write line-wise using always the same stream object. I just hope that reallocations are only performed in case the current line is longer than the line before and the stream buffer will not be allocated every time new. But the more I think about it the more I'm afraid that this won't work. The SaveToFile method has no option to append to an existing file <img class="smilies" src="images/smilies/icon_sad.gif" alt=":(" title="Sad" /> <br /><br />Steffen</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54166" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile54166">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha86d.html?author_id=2258&amp;sr=posts">2152</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 Feb 2011 21:02</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> United States (east coast)</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54166">

						<h3 ><a href="#p54166">Re: JREPL.BAT, ADO Streams and big files</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting8d53.html?mode=quote&amp;f=3&amp;p=54166" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicf7b7.html?p=54166#p54166" onclick="prompt('Message #5',this.href); return false;">#5</a></span> 
									<a class="unread" href="viewtopicf7b7.html?p=54166#p54166" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a></strong> &raquo; </span>28 Sep 2017 18:20
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>aGerman wrote:</cite>I hope you agree with my decision to split the above posts away from the CONVERTCP topic, Dave. I did it for two reasons<br />1) It doesn't make much sense to discuss about JScript and ADO in a thread about a C utility.<br />2) My hope is that we reach some more people with ADO experiences if we have a thread title about our actual discussion.</div></blockquote><br />No problem. I was worried about hijacking your thread when I posted, so I think it is good that the discussion is migrated here. And I also think it is good that there is still a <a href="viewtopice0af.html?f=3&amp;t=7570&amp;start=15#p54152" class="postlink">post within your CONVERTCP topic</a> that references JREPL as a viable alternative, with its own pros and cons.<br /><br /><blockquote><div><cite>aGerman wrote:</cite>Back to the topic ...</div></blockquote><br />I think you missed my point as to how ADO works (or else I have a misconception).<br /><br />When you open up an ADO stream, it starts out empty, and it is not associated with any file. The only way to load file content into the stream is to use adoStream.LoadFromFile(&quot;filename&quot;). This loads the entire file into memory, there is no mechanism to load just a portion of the file. It also destroys any prior content that may have been in the stream prior to loading the file.<br /><br />Once loaded, you can freely position the stream position anywhere within the stream (memory) content. There are methods to read entire lines, or a fixed number of characters, from the current stream position. There are also methods to write to the current stream position, overwriting any existing content that may be at that position.<br /><br />Conversely, the only way to write stream content to a file is to use adoStream.SaveToFile(&quot;filename&quot;). It writes the entire stream content to disk in one operation, with no mechanism to write chunks.<br /><br />There is an alternate way of using ADO that requires you treat the file as a database, with each line representing a record. But I have to believe that would have even more overhead and be less efficient. It also would not be as easy to plug into my existing JREPL architecture. The code for emulating a FileScriptingObject text stream object would be more complex.<br /><br /><br />Dave Benham</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54179" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile54179">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search661c.html?author_id=1265&amp;sr=posts">3386</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 22 Jan 2010 18:01</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Germany</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54179">

						<h3 ><a href="#p54179">Re: JREPL.BAT, ADO Streams and big files</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting765f.html?mode=quote&amp;f=3&amp;p=54179" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic774c.html?p=54179#p54179" onclick="prompt('Message #6',this.href); return false;">#6</a></span> 
									<a class="unread" href="viewtopic774c.html?p=54179#p54179" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a></strong> &raquo; </span>29 Sep 2017 10:40
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>dbenham wrote:</cite>so I think it is good that the discussion is migrated here. And I also think it is good that there is still a <a href="viewtopice0af.html?f=3&amp;t=7570&amp;start=15#p54152" class="postlink">post within your CONVERTCP topic</a> that references JREPL as a viable alternative, with its own pros and cons.</div></blockquote><br />Thanks for adding the cross references to the posts. Please feel free to post updates for any new JREPL feature. As I said - I like to give the users the informations to choose the right tool to meet their needs.<br /><br /><blockquote><div><cite>dbenham wrote:</cite>I think you missed my point as to how ADO works (or else I have a misconception).</div></blockquote><br />I'm quite certain I understood how it works, Dave. Admittedly I don't know how the ADO stream class was implemented because it's not open-source. That's why all I wrote are only attemptions.<br />As to my suggestion - most likely I wasn't quite clear. I assume my wording doesn't sound correct to a native speaker <img class="smilies" src="images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" /> (and the different time zones don't make it easier to clearify things quickly). So I'll try to write some lines of code to illustrate what I was thinking about (even though it's not working).<br /><br />*.js<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>var inName = 'source.txt',<br />&nbsp; &nbsp; outName = 'destination.txt',<br />&nbsp; &nbsp; outCp = 'UTF-8',<br />&nbsp; &nbsp; utf8BomLen = 3;<br /><br />var objInfile = WScript.CreateObject('Scripting.FileSystemObject').OpenTextFile(inName),<br />&nbsp; &nbsp; objAdoS = WScript.CreateObject('ADODB.Stream'),<br />&nbsp; &nbsp; isFirst = true;<br /><br />objAdoS.Type = 1; // adTypeText<br />objAdoS.CharSet = outCp;<br />objAdoS.LineSeparator = -1; // CrLf<br />objAdoS.Open();<br /><br />while (!objInfile.AtEndOfStream) {<br />&nbsp; // the disadvantage of ReadLine is that you can't specify the codepage of the text read<br />&nbsp; objAdoS.WriteText(objInfile.ReadLine(), 1); // adWriteLine<br />&nbsp; if (isFirst) {<br />&nbsp; &nbsp; objAdoS.SaveToFile(outName, 2); // adSaveCreateOverWrite<br />&nbsp; &nbsp; isFirst = false;<br />&nbsp; } else {<br />&nbsp; &nbsp; // doesn't work, always the whole stream will be written<br />&nbsp; &nbsp; objAdoS.Position = utf8BomLen;<br />&nbsp; &nbsp; // doesn't work because either adSaveCreateOverWrite truncates the content<br />&nbsp; &nbsp; //&nbsp; or adSaveCreateNotExist creates a new file<br />&nbsp; &nbsp; //&nbsp; there's no option to append to an existing file<br />&nbsp; &nbsp; objAdoS.SaveToFile(outName, 1); // adSaveCreateNotExist<br />&nbsp; }<br />&nbsp; objAdoS.Position = 0;<br />}</code></pre></div><br />Steffen</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54182" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile54182">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha86d.html?author_id=2258&amp;sr=posts">2152</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 Feb 2011 21:02</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> United States (east coast)</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54182">

						<h3 ><a href="#p54182">Re: JREPL.BAT, ADO Streams and big files</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting157f.html?mode=quote&amp;f=3&amp;p=54182" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic4df9.html?p=54182#p54182" onclick="prompt('Message #7',this.href); return false;">#7</a></span> 
									<a class="unread" href="viewtopic4df9.html?p=54182#p54182" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a></strong> &raquo; </span>29 Sep 2017 12:48
			</p>
			
			
			
			<div class="content">Yes. Based on your code comments, we seem to be in agreement as to ADO limitations regarding reading/writing text files.<br /><br />ADO always reads or writes the entire file. There is no way to work with a chunk or line at the file level. Only within memory.<br /><br />Given that limitation, I don't see any avenue for read/write optimization.</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54183" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile54183">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search661c.html?author_id=1265&amp;sr=posts">3386</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 22 Jan 2010 18:01</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Germany</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54183">

						<h3 ><a href="#p54183">Re: JREPL.BAT, ADO Streams and big files</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingb9c2.html?mode=quote&amp;f=3&amp;p=54183" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic8f3b.html?p=54183#p54183" onclick="prompt('Message #8',this.href); return false;">#8</a></span> 
									<a class="unread" href="viewtopic8f3b.html?p=54183#p54183" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a></strong> &raquo; </span>29 Sep 2017 14:34
			</p>
			
			
			
			<div class="content">Too bad <img class="smilies" src="images/smilies/icon_sad.gif" alt=":(" title="Sad" /></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
	

	<div class="action-bar bar-bottom">
	
			<a href="posting217c.html?mode=reply&amp;f=3&amp;t=8152" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
		
		<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic7b09.html?f=3&amp;t=8152&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>

			<form method="post" action="https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=8152">
		<div class="dropdown-container dropdown-container-left dropdown-button-control sort-tools">
	<span title="Display and sorting options" class="button button-secondary dropdown-trigger dropdown-select">
		<i class="icon fa-sort-amount-asc fa-fw" aria-hidden="true"></i>
		<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
	</span>
	<div class="dropdown hidden">
		<div class="pointer"><div class="pointer-inner"></div></div>
		<div class="dropdown-contents">
			<fieldset class="display-options">
							<label>Display: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
								<label>Sort by: <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label>
				<label>Direction: <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select></label>
								<hr class="dashed" />
				<input type="submit" class="button2" name="sort" value="Go" />
						</fieldset>
		</div>
	</div>
</div>
		</form>
	
	
	
			<div class="pagination">
			8 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
	</div>


<div class="action-bar actions-jump">
		<p class="jumpbox-return">
		<a href="viewforum4d6b.html?f=3" class="left-box arrow-left" accesskey="r">
			<i class="icon fa-angle-left fa-fw icon-black" aria-hidden="true"></i><span>Return to “DOS Batch Forum”</span>
		</a>
	</p>
	
		<div class="jumpbox dropdown-container dropdown-container-right dropdown-up dropdown-left dropdown-button-control" id="jumpbox">
			<span title="Jump to" class="button button-secondary dropdown-trigger dropdown-select">
				<span>Jump to</span>
				<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
			</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																				<li><a href="viewforum31e6.html?f=4" class="jumpbox-cat-link"> <span> DosTips - Dos Batch</span></a></li>
																<li><a href="viewforum4d6b.html?f=3" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; DOS Batch Forum</span></a></li>
											</ul>
		</div>
	</div>

	</div>


			</div>


<div id="page-footer" class="page-footer" role="contentinfo">
	<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-footer" class="nav-footer linklist" role="menubar">
		<li class="breadcrumbs">
							<span class="crumb"><a href="../index.html" data-navbar-reference="home"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span>DosTips.com</span></a></span>									<span class="crumb"><a href="index.html" data-navbar-reference="index"><span>Board index</span></a></span>					</li>
		
				<li class="rightside">All times are <span title="UTC-6">UTC-06:00</span></li>
							<li class="rightside">
				<a href="ucp033a.html?mode=delete_cookies" data-ajax="true" data-refresh="true" role="menuitem">
					<i class="icon fa-trash fa-fw" aria-hidden="true"></i><span>Delete all board cookies</span>
				</a>
			</li>
												<li class="rightside" data-last-responsive="true">
				<a href="memberlist4bfd.html?mode=team" role="menuitem">
					<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
				</a>
			</li>
									<li class="rightside" data-last-responsive="true">
				<a href="memberlist8733.html?mode=contactadmin" role="menuitem">
					<i class="icon fa-envelope fa-fw" aria-hidden="true"></i><span>Contact us</span>
				</a>
			</li>
			</ul>

	</div>
</div>

	<div class="copyright">
				<!-- WARNING NO DELETE -->Style developer by <a href="http://tricolor.x-tk.ru/">support forum tricolor</a>, <!-- END WARNING NO DELETE -->Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
									</div>

	<div id="darkenwrapper" class="darkenwrapper" data-ajax-error-title="AJAX error" data-ajax-error-text="Something went wrong when processing your request." data-ajax-error-text-abort="User aborted request." data-ajax-error-text-timeout="Your request timed out; please try again." data-ajax-error-text-parsererror="Something went wrong with the request and the server returned an invalid reply.">
		<div id="darken" class="darken">&nbsp;</div>
	</div>

	<div id="phpbb_alert" class="phpbb_alert" data-l-err="Error" data-l-timeout-processing-req="Request timed out.">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<h3 class="alert_title">&nbsp;</h3><p class="alert_text"></p>
	</div>
	<div id="phpbb_confirm" class="phpbb_alert">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<div class="alert_text"></div>
	</div>
</div>

</div>

<div>
	<a id="bottom" class="anchor" accesskey="z"></a>
	<img src="cron4049.gif?cron_type=cron.task.core.tidy_search" width="1" height="1" alt="cron" /></div>

<script type="text/javascript" src="assets/javascript/jquery.mind772.js?assets_version=34"></script>
<script type="text/javascript" src="assets/javascript/cored772.js?assets_version=34"></script>



<script type="text/javascript" src="styles/prosilver/template/forum_fnd772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/prosilver/template/ajaxd772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/AllanStyle-SUBSILVER/template/jquery-uid772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/AllanStyle-SUBSILVER/template/collapsed772.js?assets_version=34"></script>



</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=8152 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:20:38 GMT -->
</html>
