<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=6936 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:22:46 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Read arrow keys and show color text in an efficient way - DosTips.com</title>


	<link rel="canonical" href="viewtopic950f-2.html?t=6936">

<!--
	phpBB style name: Allan Style - SUBSILVER
	Based on style:   prosilver (this is the default phpBB3 style)
	Based on style:   subsilver2 (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:  Allan ( http://x-tk.ru/ )
-->

<link href="assets/css/font-awesome.mind772.css?assets_version=34" rel="stylesheet">
<link href="styles/AllanStyle-SUBSILVER/theme/stylesheetd772.css?assets_version=34" rel="stylesheet">
<link href="styles/AllanStyle-SUBSILVER/theme/en/stylesheetd772.css?assets_version=34" rel="stylesheet">




<!--[if lte IE 9]>
	<link href="./styles/AllanStyle-SUBSILVER/theme/tweaks.css?assets_version=34" rel="stylesheet">
<![endif]-->




<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','../../www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-280191-1', 'auto');
	ga('send', 'pageview');
</script>

</head>
<body id="phpbb" class="nojs notouch section-viewtopic ltr ">

<div id="header-subsilver">
	<a id="top" class="top-anchor" accesskey="t"></a>
		<div class="headerbar" role="banner">
					<div class="inner">

			<div id="site-description" class="site-description">
				<a id="logo" class="logo" href="../index.html" title="DosTips.com"><span class="site_logo"></span></a>
				<h1>DosTips.com</h1>
				<p>A Forum all about DOS Batch</p>
				<p class="skiplink"><a href="#start_here">Skip to content</a></p>
			</div>

									<div id="search-box" class="search-box search-header" role="search">
				<form action="https://www.dostips.com/forum/search.php" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="search" maxlength="128" title="Search for keywords" class="inputbox search tiny" size="20" value="" placeholder="Search…" />
					<button class="button button-search" type="submit" title="Search">
						<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
					</button>
					<a href="search.html" class="button button-search-end" title="Advanced search">
						<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
					</a>
					
				</fieldset>
				</form>
			</div>
						
			</div>
					</div>
</div>


<div id="wrap" class="wrap">
	<div id="page-header">
				<div class="navbar-top" role="navigation">
	<div class="inner">

	<ul id="nav-main" class="nav-main linklist" role="menubar">

		<li id="quick-links" class="quick-links dropdown-container responsive-menu" data-skip-responsive="true">
			<a href="#" class="dropdown-trigger">
				<i class="icon fa-bars fa-fw" aria-hidden="true"></i><span>Quick links</span>
			</a>
			<div class="dropdown">
				<div class="pointer"><div class="pointer-inner"></div></div>
				<ul class="dropdown-contents" role="menu">
					
											<li class="separator"></li>
																									<li>
								<a href="search33a7.html?search_id=unanswered" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-gray" aria-hidden="true"></i><span>Unanswered topics</span>
								</a>
							</li>
							<li>
								<a href="search526f.html?search_id=active_topics" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-blue" aria-hidden="true"></i><span>Active topics</span>
								</a>
							</li>
							<li class="separator"></li>
							<li>
								<a href="search.html" role="menuitem">
									<i class="icon fa-search fa-fw" aria-hidden="true"></i><span>Search</span>
								</a>
							</li>
					
											<li class="separator"></li>
																			<li>
								<a href="memberlist4bfd.html?mode=team" role="menuitem">
									<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
								</a>
							</li>
																<li class="separator"></li>

									</ul>
			</div>
		</li>

				<li data-skip-responsive="true">
			<a href="app.php/help/faq.html" rel="help" title="Frequently Asked Questions" role="menuitem">
				<i class="icon fa-question-circle fa-fw" aria-hidden="true"></i><span>FAQ</span>
			</a>
		</li>
						
			<li class="rightside"  data-skip-responsive="true">
			<a href="ucp26c3.html?mode=login" title="Login" accesskey="x" role="menuitem">
				<i class="icon fa-power-off fa-fw" aria-hidden="true"></i><span>Login</span>
			</a>
		</li>
					<li class="rightside" data-skip-responsive="true">
				<a href="ucp8319.html?mode=register" role="menuitem">
					<i class="icon fa-pencil-square-o  fa-fw" aria-hidden="true"></i><span>Register</span>
				</a>
			</li>
						</ul>

	</div>
</div>

<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks" role="menubar">
						<li class="breadcrumbs">
							<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope=""><a href="../index.html" itemprop="url" data-navbar-reference="home"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span itemprop="title">DosTips.com</span></a></span>
										<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope=""><a href="index.html" itemprop="url" accesskey="h" data-navbar-reference="index"><span itemprop="title">Board index</span></a></span>

											<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="4"><a href="viewforum31e6.html?f=4" itemprop="url"><span itemprop="title">DosTips - Dos Batch</span></a></span>
															<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="3"><a href="viewforum4d6b.html?f=3" itemprop="url"><span itemprop="title">DOS Batch Forum</span></a></span>
												</li>
		
					<li class="rightside responsive-search">
				<a href="search.html" title="View the advanced search options" role="menuitem">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</a>
			</li>
			</ul>

	</div>
</div>

<div class="navbar-top-link">
	<div class="inner">
		<ul>
			<li class="navbar-top-link-left"><a href="search33a7.html?search_id=unanswered">Unanswered topics</a></li>
			<li class="navbar-top-link-left"><a href="search526f.html?search_id=active_topics">Active topics</a></li>

											</ul>
	</div>
</div>
	</div>

	
	<a id="start_here" class="anchor"></a>
	<div id="page-body" class="page-body" role="main">
		
		
<h2 class="topic-title"><a href="viewtopiceba8.html?f=3&amp;t=6936">Read arrow keys and show color text in an efficient way</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Discussion forum for all Windows batch related topics.<br /></div>
<p>
	<strong>Moderator:</strong> <a href="memberlista6a8.html?mode=viewprofile&amp;u=5" class="username">DosItHelp</a>
</p>


<div class="action-bar bar-top">
	
			<a href="posting7657-2.html?mode=reply&amp;f=3&amp;t=6936" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
	
			<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic8cff.html?f=3&amp;t=6936&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>
	
			<div class="search-box" role="search">
			<form method="get" id="topic-search" action="https://www.dostips.com/forum/search.php">
			<fieldset>
				<input class="inputbox search tiny"  type="search" name="keywords" id="search_keywords" size="20" placeholder="Search this topic…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="search.html" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				<input type="hidden" name="t" value="6936" />
<input type="hidden" name="sf" value="msgonly" />

			</fieldset>
			</form>
		</div>
	
			<div class="pagination">
			16 posts
							<ul>
		<li class="active"><span>1</span></li>
				<li><a class="button" href="viewtopic7a33.html?f=3&amp;t=6936&amp;start=15" role="button">2</a></li>
				<li class="arrow next"><a class="button button-icon-only" href="viewtopic7a33.html?f=3&amp;t=6936&amp;start=15" rel="next" role="button"><i class="icon fa-chevron-right fa-fw" aria-hidden="true"></i><span class="sr-only">Next</span></a></li>
	</ul>
					</div>
		</div>




<div id="subsilver-nav-topic">
	<div class="inner"><div class="post has-profile">
		<div class="leftsided postbody subsilver-topic-title">Message</div>
		<div class="leftsided postprofile subsilver-topic-author">Author</div>
	</div></div>
</div>

			<div id="p45102" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile45102">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content45102">

						<h3 class="first"><a href="#p45102">Read arrow keys and show color text in an efficient way</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting3178.html?mode=quote&amp;f=3&amp;p=45102" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopice007.html?p=45102#p45102" onclick="prompt('Message #1',this.href); return false;">#1</a></span> 
									<a class="unread" href="viewtopice007.html?p=45102#p45102" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>30 Jan 2016 20:56
			</p>
			
			
			
			<div class="content">This topic has been a long request from Batch file programmers: read arrow and other extended keys (like function keys) and process they in efficient way. The conclusion from previous experiences is that read extended keys is not possible using just native Batch commands, so an additional application is required and the most used one is PowerShell. However, current solutions based on PowerShell are very inefficient because the whole PS environment must be executed <em class="text-italics">each time</em> that a key is read, so these programs are slow and unresponsive. Of course, another possible solution would be to write the complete process just in PowerShell, but we all know that this is not the solution we are looking for; we want a Batch-file based solution with the minimal part of non native code.<br /><br />I developed a method that allows to use PowerShell in a Batch file in a very efficient way: the PS engine is loaded <em class="text-italics">just one time</em> and then repeatedly used to read all keys. The result is a Batch file that must wait just once, when PowerShell is loaded the first time, but that is very responsive after that. This key-entry method may be used in a wide range of applications. For example, the first program below show an horizontal one-line menu that allows to select their options via Home/LeftArrow/RightArrow/End keys:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />if &quot;%~1&quot; equ &quot;OptionSelection&quot; goto %1<br /><br />rem Activate an horizontal menu controlled by cursor keys<br />rem Antonio Perez Ayala<br /><br />setlocal EnableDelayedExpansion<br />cls<br />echo/<br />echo Example of horizontal menu<br />echo/<br />echo Change selected option with these cursor keys:<br />echo Home/End = First/Last, Left/Right = Prev/Next.<br />:loop<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;call :HMenu select=&quot;Press Enter to continue, Esc to cancel: &quot; Insert/Append/Update/Delete<br />&nbsp; &nbsp;echo Option selected: %select%<br />if %select% neq 0 goto Loop<br />echo End of menu example<br />goto :EOF<br /><br /><br />This subroutine activate a one-line selection menu controlled by cursor control keys<br /><br />:HMenu&nbsp; select=&nbsp; prompt&nbsp; option1/option2/...<br />setlocal EnableDelayedExpansion<br /><br />rem Separate options<br />set &quot;options=%~3&quot;<br />set &quot;lastOption=0&quot;<br />(<br />&nbsp; &nbsp;set &quot;options=&quot;<br />&nbsp; &nbsp;for %%a in (&quot;%options:/=&quot; &quot;%&quot;) do (<br />&nbsp; &nbsp; &nbsp; set /A lastOption+=1<br />&nbsp; &nbsp; &nbsp; set &quot;option&#91;!lastOption!&#93;=%%~a&quot;<br />&nbsp; &nbsp; &nbsp; set &quot;options=!options! %%~a &quot;<br />&nbsp; &nbsp;)<br />)<br /><br />rem Define working variables<br />for %%a in (&quot;Enter=13&quot; &quot;Esc=27&quot; &quot;End=35&quot; &quot;Home=36&quot; &quot;LeftArrow=37&quot; &quot;RightArrow=39&quot;) do set %%a<br />for /F %%a in ('copy /Z &quot;%~F0&quot; NUL') do set &quot;CR=%%a&quot;<br />for /F %%a in ('echo prompt $H ^| cmd') do set &quot;BS=%%a&quot;<br /><br />rem Define movements for standard keys<br />set &quot;sel=1&quot;<br />set &quot;moveSel&#91;%Home%&#93;=set sel=1&quot;<br />set &quot;moveSel&#91;%End%&#93;=set sel=%lastOption%&quot;<br />set &quot;moveSel&#91;%LeftArrow%&#93;=set /A sel-=^!^!(sel-1)&quot;<br />set &quot;moveSel&#91;%RightArrow%&#93;=set /A sel+=^!^!(sel-lastOption)&quot;<br /><br />rem Read keys via PowerShell&nbsp; -&gt;&nbsp; Process keys in Batch<br />set /P &quot;=Loading menu...&quot; &lt; NUL<br />PowerShell&nbsp; ^<br />&nbsp; &nbsp;Write-Host 0;&nbsp; ^<br />&nbsp; &nbsp;$validKeys = %End%..%LeftArrow%+%RightArrow%+%Enter%+%Esc%;&nbsp; ^<br />&nbsp; &nbsp;while ($key -ne %Enter% -and $key -ne %Esc%) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; $key = $Host.UI.RawUI.ReadKey('NoEcho,IncludeKeyDown').VirtualKeyCode;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; if ($validKeys.contains($key)) {Write-Host $key}&nbsp; ^<br />&nbsp; &nbsp;}&nbsp; ^<br />%End PowerShell%&nbsp; |&nbsp; &quot;%~F0&quot; OptionSelection %2<br />endlocal &amp; set &quot;%~1=%errorlevel%&quot;<br />echo/<br />exit /B<br /><br /><br />:OptionSelection<br />setlocal EnableDelayedExpansion<br /><br />rem Wait for PS code start signal<br />set /P &quot;keyCode=&quot;<br />set /P &quot;=&quot;<br /><br />:nextSelection<br /><br />&nbsp; &nbsp;rem Show prompt: options<br />&nbsp; &nbsp;for %%s in (&quot;!option&#91;%sel%&#93;!&quot;) do set /P &quot;=%BS%!CR!%~2!options: %%~s =&#91;%%~s&#93;!&quot; &lt; NUL<br /><br />&nbsp; &nbsp;rem Get a keycode from PowerShell<br />&nbsp; &nbsp;set /P &quot;keyCode=&quot;<br />&nbsp; &nbsp;set /P &quot;=&quot;<br /><br />&nbsp; &nbsp;rem Process it<br />&nbsp; &nbsp;if %keyCode% equ %Enter% goto endSelection<br />&nbsp; &nbsp;if %keyCode% equ %Esc% set &quot;sel=0&quot; &amp; goto endSelection<br />&nbsp; &nbsp;!moveSel&#91;%keyCode%&#93;!<br /><br />goto nextSelection<br />:endSelection<br />exit %sel%<br /></code></pre></div><br />We may add the findstr color text method in order to highlight the selected option. The next example is a standard CheckList/RadioButton selection form with the options placed vertically; this code also features the selection of options via the first letter of each one.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />if &quot;%~1&quot; equ &quot;OptionSelection&quot; goto %1<br /><br />rem Activate a CheckList/RadioButton controlled by cursor keys<br />rem Antonio Perez Ayala<br /><br />setlocal<br />set &quot;switch=&quot;<br />set &quot;endHeader=&quot;<br />:header<br />&nbsp; &nbsp;cls<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;echo Example of Check List / Radio Button<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;echo Move selection lightbar with these cursor keys:<br />&nbsp; &nbsp;echo Home/End = First/Last, Up/Down = Prev/Next; or via option's first letter.<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;%endHeader%<br />&nbsp; &nbsp;if not defined switch (set &quot;switch=/R&quot;) else set &quot;switch=&quot;<br />&nbsp; &nbsp;call :CheckList select=&quot;First option/Second option/Third option/Last option&quot; %switch%<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;if &quot;%select%&quot; equ &quot;0&quot; goto endProg<br />&nbsp; &nbsp;echo Option(s) selected: %select%<br />&nbsp; &nbsp;pause<br />goto header<br />:endProg<br />echo End of example<br />goto :EOF<br /><br /><br />This subroutine activate a CheckList/RadioButton form controlled by cursor control keys<br /><br />%1 = Variable that receive the selection<br />%2 = Options list separated by slash<br />%3 = /R (switch) = Radio Button (instead of Check List)<br /><br />:CheckList select= &quot;option1/option2/...&quot; &#91;/R&#93;<br />setlocal EnableDelayedExpansion<br /><br />rem Process /R switch<br />if /I &quot;%~3&quot; equ &quot;/R&quot; (<br />&nbsp; &nbsp;set &quot;Radio=1&quot;<br />&nbsp; &nbsp;set &quot;unmark=( )&quot; &amp; set &quot;mark=(o)&quot;<br />) else (<br />&nbsp; &nbsp;set &quot;Radio=&quot;<br />&nbsp; &nbsp;set &quot;unmark=&#91; &#93;&quot; &amp; set &quot;mark=&#91;X&#93;&quot;<br />)<br /><br />rem Separate options<br />set &quot;options=%~2&quot;<br />set &quot;lastOption=0&quot;<br />for %%a in (&quot;%options:/=&quot; &quot;%&quot;) do (<br />&nbsp; &nbsp;set /A lastOption+=1<br />&nbsp; &nbsp;set &quot;option&#91;!lastOption!&#93;=%%~a&quot;<br />&nbsp; &nbsp;set &quot;select&#91;!lastOption!&#93;=%unmark%&quot;<br />&nbsp; &nbsp;call set &quot;moveSel&#91;%%option&#91;!lastOption!&#93;:~0,1%%&#93;=set sel=!lastOption!&quot;<br />)<br />if defined Radio set &quot;select&#91;1&#93;=%mark%&quot;<br /><br />rem Define working variables<br />for %%a in (&quot;Enter=13&quot; &quot;Esc=27&quot; &quot;Space=32&quot; &quot;End=35&quot; &quot;Home=36&quot; &quot;UpArrow=38&quot; &quot;DownArrow=40&quot; &quot;LetterA=65&quot; &quot;LetterZ=90&quot;) do set %%a<br />set &quot;letter=ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;<br />for /F %%a in ('echo prompt $H ^| cmd') do set &quot;BS=%%a&quot;<br />echo %BS%%BS%%BS%%BS%%BS%%BS%&nbsp; &nbsp; &nbsp; &gt;_<br /><br />rem Define movements for standard keys<br />set &quot;sel=1&quot;<br />set &quot;moveSel&#91;%Home%&#93;=set sel=1&quot;<br />set &quot;moveSel&#91;%End%&#93;=set sel=%lastOption%&quot;<br />set &quot;moveSel&#91;%UpArrow%&#93;=set /A sel-=^!^!(sel-1)&quot;<br />set &quot;moveSel&#91;%DownArrow%&#93;=set /A sel+=^!^!(sel-lastOption)&quot;<br /><br />rem Read keys via PowerShell&nbsp; -&gt;&nbsp; Process keys in Batch<br />set /P &quot;=Loading menu...&quot; &lt; NUL<br />PowerShell&nbsp; ^<br />&nbsp; &nbsp;Write-Host 0;&nbsp; ^<br />&nbsp; &nbsp;$validKeys = %End%..%Home%+%UpArrow%+%DownArrow%+%Space%+%Enter%+%Esc%+%LetterA%..%LetterZ%;&nbsp; ^<br />&nbsp; &nbsp;while ($key -ne %Enter% -and $key -ne %Esc%) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; $key = $Host.UI.RawUI.ReadKey('NoEcho,IncludeKeyDown').VirtualKeyCode;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; if ($validKeys.contains($key)) {Write-Host $key}&nbsp; ^<br />&nbsp; &nbsp;}&nbsp; ^<br />%End PowerShell%&nbsp; |&nbsp; &quot;%~F0&quot; OptionSelection<br />endlocal &amp; set &quot;%~1=%errorlevel%&quot;<br />del _<br />exit /B<br /><br /><br />:OptionSelection<br />setlocal EnableDelayedExpansion<br /><br />rem Wait for PS code start signal<br />set /P &quot;keyCode=&quot;<br />set /P &quot;=&quot;<br /><br />set &quot;endHeader=exit /B&quot;<br />:nextSelection<br /><br />&nbsp; &nbsp;rem Clear the screen and show the list<br />&nbsp; &nbsp;call :header<br />&nbsp; &nbsp;&lt; NUL (for /L %%i in (1,1,%lastOption%) do (<br />&nbsp; &nbsp; &nbsp; if %%i equ %sel% (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /P &quot;=!select&#91;%%i&#93;!&nbsp; &quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;findstr /A:70 . &quot;!option&#91;%%i&#93;!\..\_&quot; NUL<br />&nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo !select&#91;%%i&#93;!&nbsp; !option&#91;%%i&#93;!<br />&nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp;))<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;set /P &quot;=Space=(De)Select, Enter=Continue, Esc=Cancel&quot; &lt; NUL<br /><br />&nbsp; &nbsp;rem Get a keycode from PowerShell<br />&nbsp; &nbsp;set /P &quot;keyCode=&quot;<br />&nbsp; &nbsp;set /P &quot;=&quot;<br /><br />&nbsp; &nbsp;rem Process it<br />&nbsp; &nbsp;if %keyCode% equ %Enter% goto endSelection<br />&nbsp; &nbsp;if %keyCode% equ %Esc% exit 0<br />&nbsp; &nbsp;if %keyCode% equ %Space% (<br />&nbsp; &nbsp; &nbsp; if defined Radio (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;select&#91;%Radio%&#93;=%unmark%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;select&#91;%sel%&#93;=%mark%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;Radio=%sel%&quot;<br />&nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &quot;!select&#91;%sel%&#93;!&quot; equ &quot;%unmark%&quot; (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;select&#91;%sel%&#93;=%mark%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;select&#91;%sel%&#93;=%unmark%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; goto nextSelection<br />&nbsp; &nbsp;)<br />&nbsp; &nbsp;if %keyCode% lss %LetterA% goto moveSelection<br />&nbsp; &nbsp; &nbsp; set /A keyCode-=LetterA<br />&nbsp; &nbsp; &nbsp; set &quot;keyCode=!letter:~%keyCode%,1!&quot;<br />&nbsp; &nbsp;:moveSelection<br />&nbsp; &nbsp;!moveSel&#91;%keyCode%&#93;!<br /><br />goto nextSelection<br />:endSelection<br />set &quot;sel=&quot;<br />for /L %%i in (1,1,%lastOption%) do (<br />&nbsp; &nbsp;if &quot;!select&#91;%%i&#93;!&quot; equ &quot;%mark%&quot; set &quot;sel=!sel!%%i&quot;<br />)<br />if not defined sel set &quot;sel=0&quot;<br />exit %sel%<br /></code></pre></div><br />If we already used PS code to read keys, we may also use it for a very small additional point: move the cursor to a certain &quot;screen home&quot; position after each key is read. This simple detail add two important features to the whole application:<br /><br /><ul><li> It completelly eliminates screen flicker because the screen is <em class="text-italics">not</em> cleared in each screen refresh. Instead, the original screen contents is preserved and the refresh just change the parts that needs to be changed. This method presents a very pleasant movement/animation to the user, even if the screen contents is large.</li><li> It allows to update/refresh just those parts of the screen that needs to be refreshed; this point decrease the time the screen refresh takes and allows faster animations and larger sprites.</li></ul><br />Below there is the classical vertical selection menu application; this example add a couple new features: the cursor is hidden while the menu is active in order to present a cleaner screen, and the menu may be displayed at any place in the screen preserving the text above it.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />if &quot;%~1&quot; equ &quot;OptionSelection&quot; goto %1<br /><br />rem Activate a vertical selection menu controlled by cursor keys<br />rem Antonio Perez Ayala<br /><br />rem Example: define menu options, menu messages and first letter of options (see description below)<br />setlocal EnableDelayedExpansion<br />set &quot;option.length=0&quot;<br />for %%a in (&quot;First option =Description of first option&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;Second option=The option below don't have description&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;Third option =&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;Last option&nbsp; =Description of last option&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;) do (<br />&nbsp; &nbsp;for /F &quot;tokens=1,2 delims==&quot; %%b in (%%a) do (<br />&nbsp; &nbsp; &nbsp; set /A option.length+=1<br />&nbsp; &nbsp; &nbsp; set &quot;option&#91;!option.length!&#93;=%%b&quot;<br />&nbsp; &nbsp; &nbsp; set &quot;message&#91;!option.length!&#93;=%%c&quot;<br />&nbsp; &nbsp; &nbsp; call set &quot;moveSel&#91;%%option&#91;!option.length!&#93;:~0,1%%&#93;=set sel=!option.length!&quot;<br />&nbsp; &nbsp;)<br />)<br /><br />:loop<br />&nbsp; &nbsp;cls<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;echo Description of :VMenu subroutine: how to show a vertical selection menu.<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;echo call :VMenu select options &#91;messages&#93;<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;echo&nbsp; &nbsp; &nbsp;select&nbsp; &nbsp; &nbsp;Variable that receives the number of selected option<br />&nbsp; &nbsp;echo&nbsp; &nbsp; &nbsp;options&nbsp; &nbsp; Name of array with the options<br />&nbsp; &nbsp;echo&nbsp; &nbsp; &nbsp;messages&nbsp; &nbsp;Name of array with messages, optional<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;echo &quot;options&quot; is an array with the text to show for each menu option;<br />&nbsp; &nbsp;echo all texts must be aligned (filled with spaces) to the same lenght.<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;echo A variable with same &quot;options&quot; name and &quot;.length&quot; postfix must contain<br />&nbsp; &nbsp;echo the number of options in the menu; for example: set options.length=4<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;echo &quot;messages&quot; is an optional array with companion descriptions for each option;<br />&nbsp; &nbsp;echo all descriptions must be aligned to the same lenght (even the empty ones).<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;echo The highlighted option can be changed with these cursor keys:<br />&nbsp; &nbsp;echo Home/End = First/Last, Up/Down = Prev/Next, or via option's first letter;<br />&nbsp; &nbsp;echo Enter = Select option and continue, Esc = Cancel selection (return zero).<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;rem&nbsp; For example:<br /><br />&nbsp; &nbsp;call :VMenu select=option message<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;if %select% equ 0 goto exitLoop<br />&nbsp; &nbsp;echo Option selected: %select%<br />&nbsp; &nbsp;pause<br />goto loop<br />:exitLoop<br />echo End of menu example<br />goto :EOF<br />&nbsp; &nbsp;<br /><br />This subroutine activate a selection menu controlled by cursor control keys<br /><br />:VMenu select= option &#91;message&#93;<br />setlocal<br /><br />rem Define working variables<br />for %%a in (&quot;Enter=13&quot; &quot;Esc=27&quot; &quot;End=35&quot; &quot;Home=36&quot; &quot;UpArrow=38&quot; &quot;DownArrow=40&quot; &quot;LetterA=65&quot; &quot;LetterZ=90&quot;) do set %%a<br />set &quot;letter=ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;<br />for /F %%a in ('echo prompt $H ^| cmd') do set &quot;BS=%%a&quot;<br />echo %BS%%BS%%BS%%BS%%BS%%BS%&nbsp; &nbsp; &nbsp; &gt;_<br /><br />rem Define selection bar movements for standard keys<br />set &quot;sel=1&quot;<br />set &quot;moveSel&#91;%Home%&#93;=set sel=1&quot;<br />set &quot;moveSel&#91;%End%&#93;=set sel=!%2.length!&quot;<br />set &quot;moveSel&#91;%UpArrow%&#93;=set /A sel-=^!^!(sel-1)&quot;<br />set &quot;moveSel&#91;%DownArrow%&#93;=set /A sel+=^!^!(sel-%2.length)&quot;<br /><br />rem Read keys via PowerShell&nbsp; -&gt;&nbsp; Process keys in Batch<br />set /P &quot;=Loading menu...&quot; &lt; NUL<br />PowerShell&nbsp; ^<br />&nbsp; &nbsp;$console = $Host.UI.RawUI;&nbsp; ^<br />&nbsp; &nbsp;$curSize = $console.CursorSize;&nbsp; ^<br />&nbsp; &nbsp;$console.CursorSize = 0;&nbsp; ^<br />&nbsp; &nbsp;$curPos = $console.CursorPosition;&nbsp; ^<br />&nbsp; &nbsp;$curPos.X = 0;&nbsp; ^<br />&nbsp; &nbsp;$console.CursorPosition = $curPos;&nbsp; ^<br />&nbsp; &nbsp;Write-Host 0;&nbsp; ^<br />&nbsp; &nbsp;$validKeys = %End%..%Home%+%UpArrow%+%DownArrow%+%Enter%+%Esc%+%LetterA%..%LetterZ%;&nbsp; ^<br />&nbsp; &nbsp;while ($key -ne %Enter% -and $key -ne %Esc%) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; $key = $console.ReadKey('NoEcho,IncludeKeyDown').VirtualKeyCode;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; if ($validKeys.contains($key)) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ($key -ne %Enter% -and $key -ne %Esc%) {$console.CursorPosition = $curPos}&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Write-Host $key&nbsp; ^<br />&nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp;$console.CursorSize = $curSize;&nbsp; ^<br />%End PowerShell%&nbsp; |&nbsp; &quot;%~F0&quot; OptionSelection %2 %3<br />endlocal &amp; set &quot;%1=%errorlevel%&quot;<br />del _<br />exit /B<br /><br /><br />:OptionSelection %1 option &#91;message&#93;<br />setlocal EnableDelayedExpansion<br /><br />rem Wait for PS code start signal<br />set /P &quot;keyCode=&quot;<br />set /P &quot;=&quot;<br /><br />:nextSelection<br /><br />&nbsp; &nbsp;rem Show menu options<br />&nbsp; &nbsp;for /L %%i in (1,1,!%2.length!) do (<br />&nbsp; &nbsp; &nbsp; if %%i equ %sel% (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /P &quot;=.%BS%&nbsp; &nbsp; &quot; &lt; NUL<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;findstr /A:70 . &quot;!%2&#91;%%i&#93;!\..\_&quot; NUL<br />&nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo&nbsp; &nbsp; &nbsp;!%2&#91;%%i&#93;!<br />&nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp;)<br />&nbsp; &nbsp;if defined %3&#91;%sel%&#93; (<br />&nbsp; &nbsp; &nbsp; echo/<br />&nbsp; &nbsp; &nbsp; echo(!%3&#91;%sel%&#93;!<br />&nbsp; &nbsp;)<br /><br />&nbsp; &nbsp;rem Get a keycode from PowerShell<br />&nbsp; &nbsp;set /P &quot;keyCode=&quot;<br />&nbsp; &nbsp;set /P &quot;=&quot;<br /><br />&nbsp; &nbsp;rem Process it<br />&nbsp; &nbsp;if %keyCode% equ %Enter% goto endSelection<br />&nbsp; &nbsp;if %keyCode% equ %Esc% set &quot;sel=0&quot; &amp; goto endSelection<br />&nbsp; &nbsp;if %keyCode% lss %LetterA% goto moveSelection<br />&nbsp; &nbsp; &nbsp; set /A keyCode-=LetterA<br />&nbsp; &nbsp; &nbsp; set &quot;keyCode=!letter:~%keyCode%,1!&quot;<br />&nbsp; &nbsp;:moveSelection<br />&nbsp; &nbsp;!moveSel&#91;%keyCode%&#93;!<br /><br />goto nextSelection<br />:endSelection<br />exit %sel%<br /></code></pre></div><br />Finally, if we already accepted to use PS code to read keys and move the cursor to a home position, we may accept to also use it for two small additional points: move the cursor to <em class="text-italics">any place</em> in the screen, and show text in color. This way, this method would provide the features of my GetKey.exe, CursorPos.exe and ColorShow.exe <a href="viewtopic9635.html?f=3&amp;t=3428" class="postlink">auxiliary programs</a>, so it would allow to write very fast animated games in color using just original Windows features. I will modify my original <a href="viewtopicba56.html?f=3&amp;t=3428&amp;p=17216#p17216" class="postlink">Snake.bat</a>, <a href="viewtopic713d.html?f=3&amp;t=5701&amp;p=35407#p35407" class="postlink">2048.bat</a>, <a href="viewtopic6fba.html?f=3&amp;t=6812" class="postlink">Tetris.bat</a> and other animated games in order to use the PowerShell features described in this topic; I will post the new versions as soon as they are ready.<br /><br />Enjoy! <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> <br /><br />Antonio</div>

			
													<div class="notice">
					Last edited by <a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a> on 11 Apr 2016 23:04, edited 1 time in total.
									</div>
			
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p45980" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile45980">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content45980">

						<h3 ><a href="#p45980">Re: Process arrow keys in Batch in an efficient way</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting86ba.html?mode=quote&amp;f=3&amp;p=45980" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicd796.html?p=45980#p45980" onclick="prompt('Message #2',this.href); return false;">#2</a></span> 
									<a class="unread" href="viewtopicd796.html?p=45980#p45980" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>31 Mar 2016 14:36
			</p>
			
			
			
			<div class="content">I modified <a href="viewtopic6fba.html?f=3&amp;t=6812" class="postlink">my Tetris.bat game</a> in order to make good use of the PowerShell features previously described. The first step was to change the original Batch's xcopy read keys method by the equivalent PowerShell's one; to do that, I changed this section:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:Input<br />set &quot;com&#91;J&#93;=Dx=-1&quot;<br />set &quot;com&#91;L&#93;=Dx=1&quot;<br />set &quot;com&#91;K&#93;=del=3&quot;<br />set &quot;com&#91;I&#93;=R=-1&quot;<br />set &quot;com&#91;A&#93;=R=1&quot;<br />set &quot;com&#91;D&#93;=R=-1&quot;<br />set &quot;com&#91;S&#93;=Dy=-1&quot;<br />set &quot;com&#91;Y&#93;=Y&quot;<br />set &quot;com&#91;N&#93;=N=1&quot;<br />set &quot;com&#91;P&#93;=pause=1&quot;<br /><br />for /L %%# in () do (<br />&nbsp; &nbsp;set &quot;key=&quot;<br />&nbsp; &nbsp;for /F &quot;delims=&quot; %%k in ('xcopy /W &quot;%~F0&quot; &quot;%~F0&quot; 2^&gt;NUL') do if not defined key set &quot;key=%%k&quot;<br />&nbsp; &nbsp;for /F %%k in (&quot;!key:~-1!&quot;) do (<br />&nbsp; &nbsp; &nbsp; echo(!com&#91;%%k&#93;!<br />&nbsp; &nbsp; &nbsp; if /I &quot;%%k&quot; equ &quot;N&quot; exit<br />&nbsp; &nbsp;)<br />)<br />exit<br /></code></pre></div><br />by this one:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:Input<br />set &quot;letter=ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;<br />for /L %%i in (0,1,25) do (<br />&nbsp; &nbsp;set /A &quot;Letter!letter:~%%i,1!=%%i+65&quot;<br />)<br />PowerShell&nbsp; &nbsp; ^<br />&nbsp; &nbsp;$command = @{&nbsp; ^<br />&nbsp; &nbsp; &nbsp; %LetterJ% = 'Dx=-1';&nbsp; ^<br />&nbsp; &nbsp; &nbsp; %LetterL% = 'Dx=1';&nbsp; &nbsp;^<br />&nbsp; &nbsp; &nbsp; %LetterK% = 'del=3';&nbsp; ^<br />&nbsp; &nbsp; &nbsp; %LetterI% = 'R=-1';&nbsp; &nbsp;^<br />&nbsp; &nbsp; &nbsp; %LetterA% = 'R=1';&nbsp; &nbsp; ^<br />&nbsp; &nbsp; &nbsp; %LetterD% = 'R=-1';&nbsp; &nbsp;^<br />&nbsp; &nbsp; &nbsp; %LetterS% = 'Dy=-1';&nbsp; ^<br />&nbsp; &nbsp; &nbsp; %LetterY% = 'Y';&nbsp; &nbsp; &nbsp; ^<br />&nbsp; &nbsp; &nbsp; %LetterN% = 'N=1';&nbsp; &nbsp; ^<br />&nbsp; &nbsp; &nbsp; %LetterP% = 'pause=1';&nbsp; ^<br />&nbsp; &nbsp;};&nbsp; ^<br />&nbsp; &nbsp;while ($key -ne %LetterN%) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; $key = $Host.UI.RawUI.ReadKey('NoEcho,IncludeKeyDown').VirtualKeyCode;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; Write-Output $command&#91;$key&#93;;&nbsp; &nbsp;^<br />&nbsp; &nbsp;}<br />%End PowerShell%<br />exit<br /></code></pre></div><br />After this change the program behaves exactly the same than before, but the reading of keys is now performed by PowerShell so it is very easy to replace the %LetterJ%/%LetterL%/%LetterK%/%LetterI% values by the new %LeftArrow%/%RightArrow%/%DownArrow%/%UpArrow% cursor control keys. After tested the new method, I think that the reading of keys via PowerShell is <em class="text-italics">slightly faster</em> than Batch's xcopy method, so the game seems more responsive than before.<br /><br />I also added the possibility of control the Tetris pieces via movements of the mouse, just as a proof of concept; the direction of the mouse movement emulate the corresponding arrow key. Playing the game using the mouse this way is very funny! <img class="smilies" src="images/smilies/icon_razz.gif" alt=":P" title="Razz" />  You may adjust the mouse sensitivity via $mouseSens variable with an inverse value: smaller numbers produce a more responsive mouse.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion<br /><br />if &quot;%~1&quot; neq &quot;&quot; goto %1<br /><br />title Tetris.BAT by Aacini<br />rem Written by Antonio Perez Ayala<br />rem http://www.dostips.com/forum/viewtopic.php?f=3&amp;t=6812<br />rem Reference: http://colinfahey.com/tetris/tetris.html<br />rem 2015/11/27 - version 1.0<br />rem 2016/03/31 - version 2.0: Use PowerShell to read arrow keys and mouse movements<br />rem http://www.dostips.com/forum/viewtopic.php?f=3&amp;t=6936&amp;p=45980#p45980<br /><br />cls<br />echo/<br />echo ===&nbsp; Pure .BATch-file Tetris game by Aacini&nbsp; ===<br />echo/<br />echo/<br />echo Tetris pieces are controlled with these keys:<br />echo/<br />echo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rot.right<br />echo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^^<br />echo rot.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rot.&nbsp; &nbsp; &nbsp;move&nbsp; &nbsp;^|&nbsp; &nbsp; move<br />echo left ^&lt;- A S D -^&gt; right&nbsp; &nbsp; left ^&lt;- -^&gt; right<br />echo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^|<br />echo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;v&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v<br />echo&nbsp; &nbsp; &nbsp; &nbsp;soft drop&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hard drop<br />echo/<br />echo ... and also via mouse movements.<br />echo/<br />echo/<br />echo Press P to pause the game; press N to end game<br />echo/<br />echo/<br />pause<br />cls<br /><br />rem Field dimensions<br />set /A cols=10, lines=20<br /><br />set /A col=cols+6, lin=lines+8,&nbsp; lin+=lines+2<br />mode CON: cols=%col% lines=%lin%<br />chcp 850 &gt; NUL<br />cd . &gt; pipeFile.txt<br /><br />set /P &quot;=Loading PS engine...&quot; &lt; NUL<br />&quot;%~F0&quot; Input &gt;&gt; pipeFile.txt&nbsp; |&nbsp; &quot;%~F0&quot; Main &lt; pipeFile.txt<br />ping localhost -n 2 &gt; NUL<br />del pipeFile.txt<br />goto :EOF<br /><br /><br /><br />:Input<br />set &quot;letter=ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;<br />for /L %%i in (0,1,25) do (<br />&nbsp; &nbsp;set /A &quot;Letter!letter:~%%i,1!=%%i+65&quot;<br />)<br />set /A &quot;LeftArrow=37, UpArrow=38, RightArrow=39, DownArrow=40&quot;<br />PowerShell&nbsp; ^<br />&nbsp; &nbsp;$mouseSens = 10;&nbsp; ^<br />&nbsp; &nbsp;$command = @{&nbsp; &nbsp; &nbsp;^<br />&nbsp; &nbsp; &nbsp; %LeftArrow%&nbsp; = 'Dx=-1';&nbsp; ^<br />&nbsp; &nbsp; &nbsp; %RightArrow% = 'Dx=1';&nbsp; &nbsp;^<br />&nbsp; &nbsp; &nbsp; %DownArrow%&nbsp; = 'del=3';&nbsp; ^<br />&nbsp; &nbsp; &nbsp; %UpArrow%&nbsp; &nbsp; = 'R=-1';&nbsp; &nbsp;^<br />&nbsp; &nbsp; &nbsp; %LetterA%&nbsp; &nbsp; = 'R=1';&nbsp; &nbsp; ^<br />&nbsp; &nbsp; &nbsp; %LetterD%&nbsp; &nbsp; = 'R=-1';&nbsp; &nbsp;^<br />&nbsp; &nbsp; &nbsp; %LetterS%&nbsp; &nbsp; = 'Dy=-1';&nbsp; ^<br />&nbsp; &nbsp; &nbsp; %LetterY%&nbsp; &nbsp; = 'Y';&nbsp; &nbsp; &nbsp; ^<br />&nbsp; &nbsp; &nbsp; %LetterN%&nbsp; &nbsp; = 'N=1';&nbsp; &nbsp; ^<br />&nbsp; &nbsp; &nbsp; %LetterP%&nbsp; &nbsp; = 'pause=1';&nbsp; ^<br />&nbsp; &nbsp;};&nbsp; ^<br />&nbsp; &nbsp;&#91;System.Reflection.Assembly&#93;::LoadWithPartialName('System.Windows.Forms') ^| %%{}; ^<br />&nbsp; &nbsp;$lX = (&#91;System.Windows.Forms.Control&#93;::MousePosition.X); ^<br />&nbsp; &nbsp;$lY = (&#91;System.Windows.Forms.Control&#93;::MousePosition.Y); ^<br />&nbsp; &nbsp;Write-Output 0;&nbsp; ^<br />&nbsp; &nbsp;while ( $key -ne %LetterN% ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; if ( $Host.UI.RawUI.KeyAvailable ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$key = $Host.UI.RawUI.ReadKey('NoEcho,IncludeKeyUp').VirtualKeyCode;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Write-Output $command&#91;$key&#93;;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; } else {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; $mX = (&#91;System.Windows.Forms.Control&#93;::MousePosition.X);&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; $mY = (&#91;System.Windows.Forms.Control&#93;::MousePosition.Y);&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; $dX = $mX - $lX;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; $dY = $mY - $lY;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; if ( &#91;math&#93;::abs($dX) -gt $mouseSens ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( $dX -lt 0 ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write-Output $command&#91;%LeftArrow%&#93;;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write-Output $command&#91;%RightArrow%&#93;;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$lX = $mX; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$lY = $mY; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; if ( &#91;math&#93;::abs($dY) -gt $mouseSens ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( $dY -lt 0 ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write-Output $command&#91;%UpArrow%&#93;;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write-Output $command&#91;%DownArrow%&#93;;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$lX = $mX; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$lY = $mY; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; Start-Sleep -m 100;&nbsp; ^<br />&nbsp; &nbsp;}<br />%End PowerShell%<br />echo Ending game... &gt; CON<br />exit<br /><br /><br /><br />:Main<br /><br />(<br />&nbsp; &nbsp;for /F &quot;delims==&quot; %%v in ('set') do set &quot;%%v=&quot;<br />&nbsp; &nbsp;set /A cols=%cols%, lines=%lines%<br />)<br /><br />rem Initialize the Field<br />for /L %%i in (1,1,%cols%) do set &quot;spc=!spc! &quot;<br />for /L %%i in (1,1,%lines%) do set &quot;F%%i=&nbsp; ³%spc%³&quot;<br />set /A top=lines+1<br />set &quot;F%top%=&nbsp; Ú&quot; &amp; set &quot;F0=&nbsp; À&quot;<br />for /L %%i in (1,1,%cols%) do set &quot;F%top%=!F%top%!Ä&quot; &amp; set &quot;F0=!F0!Ä&quot;<br />set &quot;F%top%=!F%top%!¿&quot; &amp; set &quot;F0=%F0%Ù&quot;<br />set &quot;F-1=&nbsp; Level: 1&quot; &amp; set &quot;Level=1&quot;<br />set &quot;F-2=&nbsp; &nbsp;Rows: 0&quot; &amp; set &quot;Rows=0&quot;<br />set &quot;F-3=&nbsp; Score: 0&quot; &amp; set &quot;Score=0&quot;<br />for /L %%i in (1,1,%cols%) do set &quot;blk=!blk!Û&quot;<br />set /A top=lines+3, delay=50,&nbsp; &nbsp;linesP2=lines+2, linesP1=lines+1<br /><br />rem Define all &quot;:orientations:&quot; of the O I S Z L J T pieces via &quot;triplets&quot;:<br />rem (offset Y . offset X . length X); one &quot;triplet&quot; for each horizontal line<br />for %%t in ( &quot;O:0.-1.2 -1.-1.2&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;I:0.-2.4:1.0.1 0.0.1 -1.0.1 -2.0.1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;S:0.0.2 -1.-1.2:1.0.1 0.0.2 -1.1.1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;Z:0.-1.2 -1.0.2:1.1.1 0.0.2 -1.0.1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;L:0.-1.3 -1.-1.1:1.0.1 0.0.1 -1.0.2:1.1.1 0.-1.3:1.-1.2 0.0.1 -1.0.1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;J:0.-1.3 -1.1.1:1.0.2 0.0.1 -1.0.1:1.-1.1 0.-1.3:1.0.1 0.0.1 -1.-1.2&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;T:0.-1.3 -1.0.1:1.0.1 0.0.2 -1.0.1:1.0.1 0.-1.3:1.0.1 0.-1.2 -1.0.1&quot; ) do (<br />&nbsp; &nbsp;set &quot;pc=%%~t&quot;<br />&nbsp; &nbsp;set &quot;i=-1&quot;<br />&nbsp; &nbsp;for /F &quot;delims=&quot; %%p in (^&quot;!pc::^=^<br />% New line %<br />!^&quot;) do (<br />&nbsp; &nbsp; &nbsp; if !i! lss 0 (set &quot;pc=%%p&quot;) else set &quot;!pc!!i!=%%p&quot;<br />&nbsp; &nbsp; &nbsp; set /A i+=1<br />&nbsp; &nbsp;)<br />&nbsp; &nbsp;set &quot;!pc!N=!i!&quot;<br />)<br />set &quot;pcs=OISZLJT&quot;<br /><br /><br />:WaitPS for PowerShell start signal<br />&nbsp; &nbsp;set /P &quot;com=&quot;<br />if not defined com goto WaitPS<br />set &quot;com=&quot;<br /><br /><br />set &quot;init=1&quot;<br />for /L %%# in () do (<br /><br />&nbsp; &nbsp;if defined init (<br />&nbsp; &nbsp; &nbsp; setlocal EnableDelayedExpansion<br />&nbsp; &nbsp; &nbsp; set &quot;init=&quot;<br /><br />&nbsp; &nbsp; &nbsp; rem Create the first &quot;previous&quot; piece<br />&nbsp; &nbsp; &nbsp; for /L %%i in (0,1,!time:~-1!) do set /A p=!random!%%7<br />&nbsp; &nbsp; &nbsp; for %%p in (!p!) do set &quot;p2=!pcs:~%%p,1!&quot;<br />&nbsp; &nbsp; &nbsp; for %%p in (!p2!) do set &quot;p3=!%%p0!&quot; &amp; set &quot;p4=!%%pN!&quot;<br /><br />&nbsp; &nbsp; &nbsp; set &quot;new=1&quot;<br />&nbsp; &nbsp;)<br /><br />&nbsp; &nbsp;if defined new (<br />&nbsp; &nbsp; &nbsp; set &quot;new=&quot;<br /><br />&nbsp; &nbsp; &nbsp; rem Take the &quot;previous&quot; piece as current one<br />&nbsp; &nbsp; &nbsp; set &quot;pc=!p2!&quot; &amp; set &quot;p0=!p3!&quot; &amp; set &quot;pN=!p4!&quot;<br /><br />&nbsp; &nbsp; &nbsp; rem Create a new &quot;previous&quot; piece<br />&nbsp; &nbsp; &nbsp; for /L %%i in (1,1,2) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A p=!random!*7/32768<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for %%p in (!p!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;p=!pcs:~%%p,1!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !p! neq !pc! set &quot;p2=!p!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; for %%p in (!p2!) do set &quot;p3=!%%p0!&quot; &amp; set &quot;p4=!%%pN!&quot;<br /><br />&nbsp; &nbsp; &nbsp; rem Insert the new &quot;previous&quot; piece in its place, above Field<br />&nbsp; &nbsp; &nbsp; set /A x=3+cols/2, y=top, yp=top-1<br />&nbsp; &nbsp; &nbsp; set &quot;F!yp!=&nbsp; &nbsp;%spc%&quot;<br />&nbsp; &nbsp; &nbsp; for %%p in (!p3!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /F &quot;tokens=1-3 delims=.&quot; %%i in (&quot;%%p&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A yp=y+%%i, xp=x+%%j, xL=xp+%%k<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-3&quot; %%a in (&quot;!yp! !xp! !xL!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;F%%a=!spc:~0,%%b!!blk:~0,%%k!!spc:~%%c!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; &nbsp; rem Try to insert the new current piece in the Field...<br />&nbsp; &nbsp; &nbsp; set /A x=3+cols/2, y=lines,&nbsp; &nbsp;b=1<br />&nbsp; &nbsp; &nbsp; for %%p in (!p0!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /F &quot;tokens=1-3 delims=.&quot; %%i in (&quot;%%p&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A yp=y+%%i, xp=x+%%j, xL=xp+%%k<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-3&quot; %%a in (&quot;!yp! !xp! !xL!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &quot;!F%%a:~%%b,%%k!&quot; neq &quot;!spc:~0,%%k!&quot; set&nbsp; &nbsp; &nbsp;&quot;b=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;F%%a=!F%%a:~0,%%b!!blk:~0,%%k!!F%%a:~%%c!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; cls<br />&nbsp; &nbsp; &nbsp; for /L %%i in (%top%,-1,%linesP2%) do echo(!F%%i!&amp; echo(!F%%i!<br />&nbsp; &nbsp; &nbsp; echo(!F%linesP1%!<br />&nbsp; &nbsp; &nbsp; for /L %%i in (%lines%,-1,1) do echo(!F%%i!&amp; echo(!F%%i!<br />&nbsp; &nbsp; &nbsp; for /L %%i in (0,-1,-3) do echo(!F%%i!<br /><br />&nbsp; &nbsp; &nbsp; rem ... if that was not possible:<br />&nbsp; &nbsp; &nbsp; if not defined b call :endGame &amp; endlocal<br /><br />&nbsp; &nbsp; &nbsp; set &quot;p1=!p0!&quot;<br />&nbsp; &nbsp; &nbsp; set /A &quot;pI=0, del=delay, b=1!time:~-2!&quot;<br /><br />&nbsp; &nbsp;)<br /><br />&nbsp; &nbsp;rem Control module: move the piece as requested via a key, or down one row each %del% centiseconds<br />&nbsp; &nbsp;set &quot;move=&quot;<br />&nbsp; &nbsp;set /A &quot;Dy=Dx=0&quot;<br />&nbsp; &nbsp;set /P &quot;com=&quot;<br />&nbsp; &nbsp;if defined com (<br />&nbsp; &nbsp; &nbsp; set /A &quot;!com!, move=1&quot;<br />&nbsp; &nbsp; &nbsp; set &quot;com=&quot;<br />&nbsp; &nbsp; &nbsp; if defined N exit<br />&nbsp; &nbsp; &nbsp; if defined pause call :Pause &amp; set &quot;move=&quot;<br />&nbsp; &nbsp; &nbsp; set &quot;b=1!time:~-2!&quot;<br />&nbsp; &nbsp;) else (<br />&nbsp; &nbsp; &nbsp; set /A &quot;e=1!time:~-2!, elap=e-b, elap-=(elap&gt;&gt;31)*100&quot;<br />&nbsp; &nbsp; &nbsp; if !elap! geq !del! set /A b=e, Dy=move=-1<br />&nbsp; &nbsp;)<br /><br />&nbsp; &nbsp;if defined move (<br /><br />&nbsp; &nbsp; &nbsp; rem Delete the piece from its current position, and store current coordinates<br />&nbsp; &nbsp; &nbsp; set i=0<br />&nbsp; &nbsp; &nbsp; for %%p in (!p0!) do for /F &quot;tokens=1-3 delims=.&quot; %%i in (&quot;%%p&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A yp=y+%%i, xp=x+%%j, xL=xp+%%k<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /F &quot;tokens=1-3&quot; %%a in (&quot;!yp! !xp! !xL!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;F%%a=!F%%a:~0,%%b!!spc:~0,%%k!!F%%a:~%%c!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A i+=1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;c!i!=%%a %%b %%c %%k&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; &nbsp; rem If move is Rotate: get rotated piece<br />&nbsp; &nbsp; &nbsp; if defined R (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A &quot;p=(pI+R+pN)%%pN&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /F &quot;tokens=1,2&quot; %%i in (&quot;!pc! !p!&quot;) do set &quot;p1=!%%i%%j!&quot;<br />&nbsp; &nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; &nbsp; rem Test if the piece can be placed at the new position, and store new coordinates<br />&nbsp; &nbsp; &nbsp; set j=0<br />&nbsp; &nbsp; &nbsp; for %%p in (!p1!) do if defined move (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /F &quot;tokens=1-3 delims=.&quot; %%i in (&quot;%%p&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A yp=y+%%i+Dy, xp=x+%%j+Dx, xL=xp+%%k<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-3&quot; %%a in (&quot;!yp! !xp! !xL!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &quot;!F%%a:~%%b,%%k!&quot; equ &quot;!spc:~0,%%k!&quot; (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A j+=1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;n!j!=%%a %%b %%c %%k&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;move=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; &nbsp; if defined move (<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Place the piece at the new position<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%j in (1,1,!j!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-4&quot; %%a in (&quot;!n%%j!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;F%%a=!F%%a:~0,%%b!!blk:~0,%%d!!F%%a:~%%c!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Update the Field in screen<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cls<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (%top%,-1,%linesP2%) do echo(!F%%i!&amp; echo(!F%%i!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo(!F%linesP1%!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (%lines%,-1,1) do echo(!F%%i!&amp; echo(!F%%i!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (0,-1,-3) do echo(!F%%i!<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Update any changes in the piece<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A y+=Dy, x+=Dx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if defined R set &quot;p0=!p1!&quot; &amp; set &quot;pI=!p!&quot; &amp; set &quot;R=&quot;<br /><br />&nbsp; &nbsp; &nbsp; ) else (&nbsp; &nbsp;rem The piece can not be moved<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Recover the piece at its current position<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (1,1,!i!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-4&quot; %%a in (&quot;!c%%i!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;F%%a=!F%%a:~0,%%b!!blk:~0,%%d!!F%%a:~%%c!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if defined R set &quot;p1=!p0!&quot; &amp; set &quot;R=&quot;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if !Dy! neq 0 (&nbsp; &nbsp;rem The piece &quot;lands&quot;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rem Count completed lines<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;j=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /L %%i in (1,1,!i!) do for /F %%a in (&quot;!c%%i!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &quot;!F%%a:~3,%cols%!&quot; equ &quot;%blk%&quot; (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;F%%a=&nbsp; ³%spc: ==%³&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A j+=1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !j! neq 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Update scores (See N-Blox at http://www.tetrisfriends.com/help/tips_appendix.php#rankingsystem)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A &quot;xp=Level*(40+((j-2&gt;&gt;31)+1)*60+((j-3&gt;&gt;31)+1)*200+((j-4&gt;&gt;31)+1)*900), Score+=xp, Rows+=j, xL=Level, Level=(Rows-1)/10+1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;F-2=!F-2:~0,8!+!j!&nbsp; &nbsp; &nbsp;&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;xp=!xp!&nbsp; &nbsp; &nbsp;&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;F-3=!F-3:~0,8!+!xp:~0,6!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo  BEL Ctrl-G Ascii-7<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cls<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (%top%,-1,%linesP2%) do echo(!F%%i!&amp; echo(!F%%i!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo(!F%linesP1%!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (%lines%,-1,1) do echo(!F%%i!&amp; echo(!F%%i!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (0,-1,-3) do echo(!F%%i!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;F-1=!F-1:~0,8! !Level!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;F-2=!F-2:~0,8! !Rows!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;F-3=!F-3:~0,8! !Score!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if !Level! neq !xL! if !delay! gtr 5 set /A delay-=5<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Remove completed lines<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;i=1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (1,1,%lines%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;F!i!=!F%%i!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &quot;!F%%i:~3,1!&quot; neq &quot;=&quot; set /A i+=1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (!i!,1,%lines%) do set &quot;F%%i=&nbsp; ³%spc%³&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call :Delay 95<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cls<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (%top%,-1,%linesP2%) do echo(!F%%i!&amp; echo(!F%%i!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo(!F%linesP1%!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (%lines%,-1,1) do echo(!F%%i!&amp; echo(!F%%i!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (0,-1,-3) do echo(!F%%i!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rem Request to show a new piece<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;new=1&quot;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br /><br />&nbsp; &nbsp; &nbsp; )<br /><br />&nbsp; &nbsp;)<br /><br />)<br /><br />:endGame<br />set /P &quot;=Play again? &quot; &lt; NUL<br />:choice<br />&nbsp; &nbsp;set /P &quot;com=&quot;<br />if not defined com goto choice<br />if /I &quot;%com%&quot; equ &quot;Y&quot; exit /B<br />if /I &quot;%com:~0,1%&quot; neq &quot;N&quot; set &quot;com=&quot; &amp; goto choice<br />echo N<br />exit<br /><br /><br />:Pause<br />set &quot;pause=!F%lines%!&quot;<br />set &quot;F%lines%=&nbsp; ³%spc:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; =&nbsp; PAUSED&nbsp; %³&quot;<br />cls &amp; for /L %%i in (%top%,-1,%linesP2%) do echo(!F%%i!&amp; echo(!F%%i!<br />echo(!F%linesP1%!<br />for /L %%i in (%lines%,-1,1) do echo(!F%%i!&amp; echo(!F%%i!<br />for /L %%i in (0,-1,-3) do echo(!F%%i!<br />:wait<br />&nbsp; &nbsp;set /P &quot;com=&quot;<br />if not defined com goto wait<br />set &quot;com=&quot;<br />set &quot;F%lines%=%pause%&quot;<br />cls &amp; for /L %%i in (%top%,-1,%linesP2%) do echo(!F%%i!&amp; echo(!F%%i!<br />echo(!F%linesP1%!<br />for /L %%i in (%lines%,-1,1) do echo(!F%%i!&amp; echo(!F%%i!<br />for /L %%i in (0,-1,-3) do echo(!F%%i!<br />set &quot;pause=&quot;<br />exit /B<br /><br /><br />:Delay centisecs<br />set &quot;b=1%time:~-2%&quot;<br />:wait2<br />&nbsp; &nbsp;set /A &quot;e=1%time:~-2%, elap=e-b, elap-=(elap&gt;&gt;31)*100&quot;<br />if %elap% lss %1 goto wait2<br />set &quot;b=1%time:~-2%&quot;<br />exit /B<br /></code></pre></div><br />The next step is the already described in the first post of this thread: establish a backwards communication from the Batch code to the &quot;resident&quot; (active) PowerShell one via a file, so the Batch code may request PowerShell to execute several commands, like move the cursor, show text in color, etc. See the first post in this thread for further details.<br /><br />Antonio</div>

			
													<div class="notice">
					Last edited by <a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a> on 15 Aug 2016 10:47, edited 1 time in total.
									</div>
			
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p45984" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile45984">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search661c.html?author_id=1265&amp;sr=posts">3386</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 22 Jan 2010 18:01</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Germany</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content45984">

						<h3 ><a href="#p45984">Re: Process arrow keys in Batch in an efficient way</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting21ba.html?mode=quote&amp;f=3&amp;p=45984" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicd7e3.html?p=45984#p45984" onclick="prompt('Message #3',this.href); return false;">#3</a></span> 
									<a class="unread" href="viewtopicd7e3.html?p=45984#p45984" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a></strong> &raquo; </span>31 Mar 2016 16:43
			</p>
			
			
			
			<div class="content">That's neat  <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> Thanks Antonio!<br /><br />I had to change the code at one point.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; &nbsp; if ($validKeys.contains($key)) {Write-Host $key}&nbsp; ^</code></pre></div><br />PowerShell complained that the object doesn't have a &quot;contains&quot; method.<br />After some tests this worked for me:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; &nbsp; if ($validKeys -contains $key) {Write-Host $key}&nbsp; ^</code></pre></div><br /><br />Regards<br />aGerman</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p45985" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile45985">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha86d.html?author_id=2258&amp;sr=posts">2152</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 Feb 2011 21:02</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> United States (east coast)</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content45985">

						<h3 ><a href="#p45985">Re: Process arrow keys in Batch in an efficient way</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting3141.html?mode=quote&amp;f=3&amp;p=45985" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicf7b0.html?p=45985#p45985" onclick="prompt('Message #4',this.href); return false;">#4</a></span> 
									<a class="unread" href="viewtopicf7b0.html?p=45985#p45985" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a></strong> &raquo; </span>31 Mar 2016 19:09
			</p>
			
			
			
			<div class="content">Very nice <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /><br /><br /><blockquote><div><cite>Aacini wrote:</cite>The next step is the already described in the first post of this thread: establish a backwards communication from the Batch code to the &quot;resident&quot; (active) PowerShell one via a file, so the Batch code may request PowerShell to execute several commands, like move the cursor, show text in color, etc. See the first post in this thread for further details.<br /></div></blockquote> That is exactly what I was thinking when I finished <a href="viewtopicc8da.html?f=3&amp;t=7047" class="postlink">CONSOLE.BAT</a>. Currently CONSOLE.BAT is too slow for many applications. Having the utility running in the background, ready to set color, cursor position, get keys, etc. on demand could make the utility extremely useful.<br /><br />I haven't studied your first post carefully, but I don't see where you talk about or implement two way communication. I'm assuming you have yet to do this.<br /><br />One additional aspect of the PowerShell rawUI object that intrigues me are all of the buffer methods. It looks to me like you can address the buffer space directly and &quot;plot&quot; characters, along with color, without having to move a cursor and write the data. You can also fill entire areas with a character with a single command. It also looks like you can scroll up and down, left and right. And also I think you can have multiple buffers. While one is displayed, you could prepare the next frame, and then once complete, swap it with the displayed buffer for &quot;instantaneous&quot; full screen updates. I see some interesting scrolling game possibilities. But I wonder if it would be better to simply develop the whole thing in PowerShell.<br /><br />The one thing I don't like about PowerShell scripts is the need to enable scripts while having admin rights. In contrast, the mini command line &quot;script&quot; can be run right out of the box, without configuration. But there is a limit to the size of such a command line &quot;script&quot;, which is one small argument for the hybrid approach.<br /><br /><br />Dave Benham</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p46206" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile46206">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content46206">

						<h3 ><a href="#p46206">Re: Read arrow keys and show color text in an efficient way</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting9524.html?mode=quote&amp;f=3&amp;p=46206" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic6d5c.html?p=46206#p46206" onclick="prompt('Message #5',this.href); return false;">#5</a></span> 
									<a class="unread" href="viewtopic6d5c.html?p=46206#p46206" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>11 Apr 2016 23:10
			</p>
			
			
			
			<div class="content"><img class="smilies" src="images/smilies/icon_arrow.gif" alt=":arrow:" title="Arrow" /> The second part of this application is ready <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" />  <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />  <img class="smilies" src="images/smilies/icon_cool.gif" alt="8)" title="Cool" /> <br /><br /><img src="../../i.imgur.com/IdfVgTV.png" class="postimage" alt="Image" /><br /><br /><strong class="text-strong">2016-04-12:</strong> Code modified to fix a synchronization problem and a bug when the window/buffer sizes are changed.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion<br /><br />if &quot;%~1&quot; neq &quot;&quot; goto %1<br /><br />rem Written by Antonio Perez Ayala<br />rem http://www.dostips.com/forum/viewtopic.php?f=3&amp;t=6812<br />rem Reference: http://colinfahey.com/tetris/tetris.html<br />rem 2015/11/27 - version 1.0<br />rem 2016/03/31 - version 2.0: Use PowerShell to read arrow keys and mouse movements<br />rem 2016/04/11 - version 3.0: Use PowerShell to show text in color<br />rem 2016/04/12 - version 3.1: Synchronization problem fixed, change window/buffer size bug fixed<br />rem http://www.dostips.com/forum/viewtopic.php?f=3&amp;t=6936&amp;p=46206#p46206<br /><br />rem The best appearance is obtained with a square font, like Raster Font 8x8<br /><br />color 0F<br />chcp 850 &gt; NUL<br />cls<br />echo/<br />echo ===&nbsp; Pure .BATch-file Tetris game by Aacini&nbsp; ===<br />echo/<br />echo/<br />echo Tetris pieces are controlled with these keys:<br />echo/<br />echo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rot.right<br />echo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;^^<br />echo rot.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rot.&nbsp; &nbsp; &nbsp;move&nbsp; &nbsp; ^|&nbsp; &nbsp; &nbsp;move<br />echo left ^&lt;ÄÄ A S D ÄÄ^&gt; right&nbsp; &nbsp; left ^&lt;ÄÄúÄÄ^&gt; right<br />echo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^|&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ^|<br />echo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; v<br />echo&nbsp; &nbsp; &nbsp; &nbsp; soft drop&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; hard drop<br />echo/<br />echo Mouse movements emulate arrow key presses,<br />echo left button pause/continue the game.<br />echo/<br />echo/<br />echo Press P to pause/continue; press N to end game.<br />echo/<br />echo/<br />pause<br />cls<br /><br />rem Field dimensions<br />set /A cols=10, lines=20<br /><br />set /P &quot;=Loading PS engine...&quot; &lt; NUL<br />cd . &gt; pipeFile.txt<br />&quot;%~F0&quot; Input &gt;&gt; pipeFile.txt&nbsp; |&nbsp; &quot;%~F0&quot; Main &lt; pipeFile.txt&nbsp; |&nbsp; &quot;%~F0&quot; Output<br />ping localhost -n 2 &gt; NUL<br />del pipeFile.txt<br />goto :EOF<br /><br /><br /><br />:Input<br />set &quot;letter=ABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;<br />for /L %%i in (0,1,25) do (<br />&nbsp; &nbsp;set /A &quot;Letter!letter:~%%i,1!=%%i+65&quot;<br />)<br />set /A &quot;LeftArrow=37, UpArrow=38, RightArrow=39, DownArrow=40&quot;<br />PowerShell&nbsp; ^<br />&nbsp; &nbsp;$mouseSens = 10;&nbsp; ^<br />&nbsp; &nbsp;$command = @{&nbsp; &nbsp; &nbsp;^<br />&nbsp; &nbsp; &nbsp; %LeftArrow%&nbsp; = 'Dx=-1';&nbsp; ^<br />&nbsp; &nbsp; &nbsp; %RightArrow% = 'Dx=1';&nbsp; &nbsp;^<br />&nbsp; &nbsp; &nbsp; %DownArrow%&nbsp; = 'del=3';&nbsp; ^<br />&nbsp; &nbsp; &nbsp; %UpArrow%&nbsp; &nbsp; = 'R=-1';&nbsp; &nbsp;^<br />&nbsp; &nbsp; &nbsp; %LetterA%&nbsp; &nbsp; = 'R=1';&nbsp; &nbsp; ^<br />&nbsp; &nbsp; &nbsp; %LetterD%&nbsp; &nbsp; = 'R=-1';&nbsp; &nbsp;^<br />&nbsp; &nbsp; &nbsp; %LetterS%&nbsp; &nbsp; = 'Dy=-1';&nbsp; ^<br />&nbsp; &nbsp; &nbsp; %LetterY%&nbsp; &nbsp; = 'Y';&nbsp; &nbsp; &nbsp; ^<br />&nbsp; &nbsp; &nbsp; %LetterN%&nbsp; &nbsp; = 'N=1';&nbsp; &nbsp; ^<br />&nbsp; &nbsp; &nbsp; %LetterP%&nbsp; &nbsp; = 'pause=1';&nbsp; ^<br />&nbsp; &nbsp;};&nbsp; ^<br />&nbsp; &nbsp;&#91;Reflection.Assembly&#93;::LoadWithPartialName('System.Windows.Forms') ^| Out-Null; ^<br />&nbsp; &nbsp;$lX = &#91;System.Windows.Forms.Control&#93;::MousePosition.X; ^<br />&nbsp; &nbsp;$lY = &#91;System.Windows.Forms.Control&#93;::MousePosition.Y; ^<br />&nbsp; &nbsp;Start-Sleep -m 1500;&nbsp; ^<br />&nbsp; &nbsp;Write-Output 0;&nbsp; ^<br />&nbsp; &nbsp;while ( $key -ne %LetterN% ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; if ( $Host.UI.RawUI.KeyAvailable ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$key = $Host.UI.RawUI.ReadKey('NoEcho,IncludeKeyUp').VirtualKeyCode;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Write-Output $command&#91;$key&#93;;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; } else {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$mX = &#91;System.Windows.Forms.Control&#93;::MousePosition.X;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$mY = &#91;System.Windows.Forms.Control&#93;::MousePosition.Y;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$mB = &#91;System.Windows.Forms.Control&#93;::MouseButtons;&nbsp; &nbsp; &nbsp;^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$dX = $mX - $lX;&nbsp; $dY = $mY - $lY;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( &#91;math&#93;::abs($dX) -gt $mouseSens ) {&nbsp; &nbsp;^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $if = if ($dX -lt 0) {%LeftArrow%} else {%RightArrow%};&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write-Output $command&#91;$if&#93;;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $lX = $mX;&nbsp; $lY = $mY;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else { if ( &#91;math&#93;::abs($dY) -gt $mouseSens ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $if = if ($dY -lt 0) {%UpArrow%} else {%DownArrow%};&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write-Output $command&#91;$if&#93;;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $lX = $mX;&nbsp; $lY = $mY;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else { if ( $mB -eq 'Left' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write-Output $command&#91;%LetterP%&#93;;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}}}&nbsp; ^<br />&nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; Start-Sleep -m 100;&nbsp; ^<br />&nbsp; &nbsp;}<br />%End PowerShell%<br />echo Ending game... &gt; CON<br />exit<br /><br /><br /><br />:Output<br />rem Parameters received via lines read have one of these four forms:<br />rem - 'cls' = Clear screen and initialize the field<br />rem - X,Y&nbsp; =&nbsp; Move cursor to X,Y position<br />rem - X,Y,'ColorString' = Move cursor to such position and show the &quot;Color Codes String&quot;<br />rem - X,Y,Color,Wide = Move cursor to such position and show Wide chars in given Color;<br />rem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if Color is '=', show an equal-sign character Wide times<br />rem - 'del',Filename = Delete the given file (for synchro purposes)<br />PowerShell&nbsp; ^<br />&nbsp; &nbsp;function ClearScreen () {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; cls; for ( $i=0; $i -lt $lnN; ++$i ) { Write-Host; Write-Host }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; Write-Host -NoNewLine (' '*2); Write-Host &quot;Ú$frame¿&quot;;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; for ( $i=1; $i -le %lines%*$lnN; ++$i ) { Write-Host -NoNewLine (' '*2); Write-Host &quot;³$spc³&quot; }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; Write-Host -NoNewLine (' '*2); Write-Host &quot;À$frameÙ&quot;;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; Write-Host -NoNewLine (' '*2); Write-Host ' Level: 1';&nbsp; ^<br />&nbsp; &nbsp; &nbsp; Write-Host -NoNewLine (' '*3); Write-Host ' Rows: 0';&nbsp; ^<br />&nbsp; &nbsp; &nbsp; Write-Host -NoNewLine (' '*2); Write-Host ' Score: 0';&nbsp; ^<br />&nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp;$console = $Host.UI.RawUI;&nbsp; ^<br />&nbsp; &nbsp;$console.WindowTitle = 'Tetris.BAT by Aacini';&nbsp; ^<br />&nbsp; &nbsp;$curSize = $console.CursorSize;&nbsp; ^<br />&nbsp; &nbsp;$console.CursorSize = 0;&nbsp; ^<br />&nbsp; &nbsp;for ( $i=1; $i -le 3; ++$i ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; if ( $i*(%lines%+2)+6 -le $console.MaxPhysicalWindowSize.Height ) { $lnN = $i } ^<br />&nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp;$col = $lnN*%cols%+6;&nbsp; $lin = $lnN*(%lines%+2)+6;&nbsp; ^<br />&nbsp; &nbsp;$winSize = $console.WindowSize; $bufSize = $console.BufferSize;&nbsp; ^<br />&nbsp; &nbsp;$winSize.Width = $col;&nbsp; $bufSize.Width = $col;&nbsp; ^<br />&nbsp; &nbsp;if ( $col -lt $console.WindowSize.Width ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; $console.WindowSize = $winSize; $console.BufferSize = $bufSize;&nbsp; ^<br />&nbsp; &nbsp;} else {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; $console.BufferSize = $bufSize; $console.WindowSize = $winSize;&nbsp; ^<br />&nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp;$winSize.Height = $lin; $bufSize.Height = $lin;&nbsp; ^<br />&nbsp; &nbsp;if ( $lin -lt $console.WindowSize.Height ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; $console.WindowSize = $winSize; $console.BufferSize = $bufSize;&nbsp; ^<br />&nbsp; &nbsp;} else {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; $console.BufferSize = $bufSize; $console.WindowSize = $winSize;&nbsp; ^<br />&nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp;$ln = ( ('X'), ('Úª','ÀÙ'), ('ÚÄ¿','³ ³','ÀÄÙ') )&#91;$lnN-1&#93;;&nbsp; ^<br />&nbsp; &nbsp;$frame = ''; $spc = ''; for ( $i=1; $i -le $col-6; ++$i ) { $frame+='Ä'; $spc+=' '; }&nbsp; ^<br />&nbsp; &nbsp;$coords = $console.CursorPosition;&nbsp; ^<br />&nbsp; &nbsp;foreach ( $line in $input ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; $X,$Y,$Color,$Wide = $line.Split(',');&nbsp; ^<br />&nbsp; &nbsp; &nbsp; if ( $X -eq 'cls' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ClearScreen&nbsp; ^<br />&nbsp; &nbsp; &nbsp; } else { if ($X -eq 'del') {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;del $Y&nbsp; ^<br />&nbsp; &nbsp; &nbsp; } else {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$coords.X = 3 + (&#91;int&#93;$X-1) * $lnN;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$Y = &#91;int&#93;$Y; $coords.Y = (%lines%+3-$Y) * $lnN ;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( $Y -le %lines% ) { $coords.Y -= $lnN-1 }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( $Y -lt 0 ) { $coords.Y += $Y*($lnN-1) }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$console.CursorPosition = $coords;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( $Wide ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $Wide = &#91;int&#93;$Wide;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( $Color -ne '=' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$Color = &#91;int&#93;('0x'+$Color);&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for ( $i=0; $i -lt $lnN; ++$i ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for ( $j=0; $j -lt $Wide; ++$j ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Write-Host&nbsp; -BackgroundColor $Color&nbsp; -ForegroundColor 'Black'&nbsp; -NoNewLine&nbsp; $ln&#91;$i&#93;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++$coords.Y; $console.CursorPosition = $coords;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for ( $i=0; $i -lt $lnN; ++$i ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write-Host&nbsp; ('='*($Wide*$lnN));&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ++$coords.Y; $console.CursorPosition = $coords;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else { if ( $Color ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for ( $i=0; $i -lt $lnN; ++$i ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for ( $j=0; $j -lt $Color.Length; ++$j ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $colr = &#91;int&#93;('0x'+$Color&#91;$j&#93;);&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write-Host&nbsp; -BackgroundColor $colr&nbsp; -ForegroundColor 'Black'&nbsp; -NoNewLine&nbsp; $ln&#91;$i&#93;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;++$coords.Y; $console.CursorPosition = $coords;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}}&nbsp; ^<br />&nbsp; &nbsp; &nbsp; }}&nbsp; ^<br />&nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp;$console.CursorSize = $curSize;<br />%End PowerShell%<br />exit /B<br /><br /><br /><br />:Main<br /><br />(<br />&nbsp; &nbsp;for /F &quot;delims==&quot; %%v in ('set') do set &quot;%%v=&quot;<br />&nbsp; &nbsp;set /A cols=%cols%, lines=%lines%<br />)<br /><br />rem Initialize the Field<br />for /L %%i in (1,1,%cols%) do set &quot;spc=!spc!0&quot;<br />for /L %%i in (1,1,%lines%) do set &quot;F%%i=³%spc%³&quot;<br />set /A &quot;Level=1, Rows=0, Score=0,&nbsp; top=lines+3, delay=50&quot;<br /><br />rem The pieces are defined via 3 groups of values:&nbsp; Piece : Color : Orientations<br />rem The &quot;:orientations:&quot; (piece positions) are defined via &quot;triplets&quot;:<br />rem (offset Y . offset X . length X); one &quot;triplet&quot; for each horizontal line<br />rem See: http://colinfahey.com/tetris/tetris.html<br />set &quot;pcs=&quot;<br />for %%t in ( &quot;O:9:0.-1.2 -1.-1.2&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;I:C:0.-2.4:1.0.1 0.0.1 -1.0.1 -2.0.1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;S:A:0.0.2 -1.-1.2:1.0.1 0.0.2 -1.1.1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;Z:B:0.-1.2 -1.0.2:1.1.1 0.0.2 -1.0.1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;L:D:0.-1.3 -1.-1.1:1.0.1 0.0.1 -1.0.2:1.1.1 0.-1.3:1.-1.2 0.0.1 -1.0.1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;J:7:0.-1.3 -1.1.1:1.0.2 0.0.1 -1.0.1:1.-1.1 0.-1.3:1.0.1 0.0.1 -1.-1.2&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;T:E:0.-1.3 -1.0.1:1.0.1 0.0.2 -1.0.1:1.0.1 0.-1.3:1.0.1 0.-1.2 -1.0.1&quot; ) do (<br />&nbsp; &nbsp;set &quot;pc=%%~t&quot; &amp; set &quot;i=-2&quot;<br />&nbsp; &nbsp;for /F &quot;delims=&quot; %%p in (^&quot;!pc::^=^<br />% New line %<br />!^&quot;) do (<br />&nbsp; &nbsp; &nbsp; if !i! equ -2 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;pc=%%p&quot; &amp; set &quot;pcs=!pcs!%%p&quot;<br />&nbsp; &nbsp; &nbsp; ) else if !i! equ -1 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;!pc!R=%%p&quot;<br />&nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;!pc!!i!=%%p&quot;<br />&nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; set /A i+=1<br />&nbsp; &nbsp;)<br />&nbsp; &nbsp;set &quot;!pc!N=!i!&quot;<br />)<br /><br />:WaitPS for PowerShell Input part start signal<br />&nbsp; &nbsp;set /P &quot;com=&quot;<br />if not defined com goto WaitPS<br />set &quot;com=&quot;<br /><br />set &quot;init=1&quot;<br />for /L %%# in () do (<br /><br />&nbsp; &nbsp;if defined init (<br />&nbsp; &nbsp; &nbsp; setlocal EnableDelayedExpansion<br />&nbsp; &nbsp; &nbsp; set &quot;init=&quot;<br />&nbsp; &nbsp; &nbsp; echo cls<br /><br />&nbsp; &nbsp; &nbsp; rem Create the first &quot;previous&quot; -hidden- piece<br />&nbsp; &nbsp; &nbsp; for /L %%i in (0,1,!time:~-1!) do set /A p=!random!%%7<br />&nbsp; &nbsp; &nbsp; for %%p in (!p!) do set &quot;p2=!pcs:~%%p,1!&quot;<br />&nbsp; &nbsp; &nbsp; for %%p in (!p2!) do set &quot;p3=!%%p0!&quot; &amp; set &quot;p4=!%%pN!&quot; &amp; set &quot;p5=!%%pR!!%%pR!!%%pR!!%%pR!&quot;<br /><br />&nbsp; &nbsp; &nbsp; set &quot;new=1&quot;<br />&nbsp; &nbsp;)<br /><br />&nbsp; &nbsp;if defined new (<br />&nbsp; &nbsp; &nbsp; set &quot;new=&quot;<br /><br />&nbsp; &nbsp; &nbsp; rem Take the &quot;previous&quot; piece as current one<br />&nbsp; &nbsp; &nbsp; set &quot;pc=!p2!&quot; &amp; set &quot;p0=!p3!&quot; &amp; set &quot;pN=!p4!&quot; &amp; set &quot;pR=!p5!&quot;<br /><br />&nbsp; &nbsp; &nbsp; rem Create a new &quot;previous&quot; piece<br />&nbsp; &nbsp; &nbsp; for /L %%i in (1,1,2) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A p=!random!*7/32768<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for %%p in (!p!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;p=!pcs:~%%p,1!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !p! neq !pc! set &quot;p2=!p!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; for %%p in (!p2!) do set &quot;p3=!%%p0!&quot; &amp; set &quot;p4=!%%pN!&quot; &amp; set &quot;p5=!%%pR!!%%pR!!%%pR!!%%pR!&quot;<br /><br />&nbsp; &nbsp; &nbsp; rem Show the new &quot;previous&quot; piece in its place, above Field<br />&nbsp; &nbsp; &nbsp; set /A x=cols/2-1<br />&nbsp; &nbsp; &nbsp; for %%p in (!p3!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /F &quot;tokens=1-3 delims=.&quot; %%i in (&quot;%%p&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A yp=top+%%i, xp=2+%%j, xL=xp+%%k<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1,2&quot; %%a in (&quot;!xp! !xL!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;pce=0000&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;pce=!pce:~0,%%a!!p5:~0,%%k!!pce:~%%b!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo !x!,!yp!,!pce!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; if !p2! equ I set /A yp=top-1 &amp; echo !x!,!yp!,0000<br /><br />&nbsp; &nbsp; &nbsp; rem Try to insert the new current piece in the Field...<br />&nbsp; &nbsp; &nbsp; set /A x=cols/2+1, y=lines,&nbsp; &nbsp;b=1<br />&nbsp; &nbsp; &nbsp; for %%p in (!p0!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /F &quot;tokens=1-3 delims=.&quot; %%i in (&quot;%%p&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A yp=y+%%i, xp=x+%%j, xL=xp+%%k<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-3&quot; %%a in (&quot;!yp! !xp! !xL!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &quot;!F%%a:~%%b,%%k!&quot; neq &quot;!spc:~0,%%k!&quot; set&nbsp; &nbsp; &nbsp;&quot;b=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;F%%a=!F%%a:~0,%%b!!pR:~0,%%k!!F%%a:~%%c!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo %%b,%%a,!F%%a:~%%b,1!,%%k<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; &nbsp; rem ... if that was not possible:<br />&nbsp; &nbsp; &nbsp; if not defined b call :endGame &amp; endlocal<br /><br />&nbsp; &nbsp; &nbsp; set &quot;p1=!p0!&quot;<br />&nbsp; &nbsp; &nbsp; set /A &quot;pI=0, del=delay, b=1!time:~-2!&quot;<br /><br />&nbsp; &nbsp;)<br /><br />&nbsp; &nbsp;rem Control module: move the piece as requested via a key, or down one row each %del% centiseconds<br />&nbsp; &nbsp;set &quot;move=&quot;<br />&nbsp; &nbsp;set /A &quot;Dy=Dx=0&quot;<br />&nbsp; &nbsp;set /P &quot;com=&quot;<br />&nbsp; &nbsp;if defined com (<br />&nbsp; &nbsp; &nbsp; set /A &quot;!com!, move=1&quot;<br />&nbsp; &nbsp; &nbsp; set &quot;com=&quot;<br />&nbsp; &nbsp; &nbsp; if defined N exit<br />&nbsp; &nbsp; &nbsp; if &quot;!pause!&quot; equ &quot;1&quot; call :Pause &amp; set &quot;move=&quot;<br />&nbsp; &nbsp; &nbsp; set &quot;b=1!time:~-2!&quot;<br />&nbsp; &nbsp;) else (<br />&nbsp; &nbsp; &nbsp; set /A &quot;e=1!time:~-2!, elap=e-b, elap-=(elap&gt;&gt;31)*100&quot;<br />&nbsp; &nbsp; &nbsp; if !elap! geq !del! set /A b=e, Dy=move=-1<br />&nbsp; &nbsp;)<br /><br />&nbsp; &nbsp;if defined move (<br /><br />&nbsp; &nbsp; &nbsp; rem Delete the piece from its current position in the field, and store current coordinates<br />&nbsp; &nbsp; &nbsp; set i=0<br />&nbsp; &nbsp; &nbsp; for %%p in (!p0!) do for /F &quot;tokens=1-3 delims=.&quot; %%i in (&quot;%%p&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A yp=y+%%i, xp=x+%%j, xL=xp+%%k<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /F &quot;tokens=1-3&quot; %%a in (&quot;!yp! !xp! !xL!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;F%%a=!F%%a:~0,%%b!!spc:~0,%%k!!F%%a:~%%c!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A i+=1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;c!i!=%%a %%b %%c %%k&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; &nbsp; rem If move is Rotate: get rotated piece<br />&nbsp; &nbsp; &nbsp; if defined R (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A &quot;p=(pI+R+pN)%%pN&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /F &quot;tokens=1,2&quot; %%i in (&quot;!pc! !p!&quot;) do set &quot;p1=!%%i%%j!&quot;<br />&nbsp; &nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; &nbsp; rem Test if the piece can be placed at the new position, and store new coordinates<br />&nbsp; &nbsp; &nbsp; set j=0<br />&nbsp; &nbsp; &nbsp; for %%p in (!p1!) do if defined move (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /F &quot;tokens=1-3 delims=.&quot; %%i in (&quot;%%p&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A yp=y+%%i+Dy, xp=x+%%j+Dx, xL=xp+%%k<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-3&quot; %%a in (&quot;!yp! !xp! !xL!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &quot;!F%%a:~%%b,%%k!&quot; equ &quot;!spc:~0,%%k!&quot; (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A j+=1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;n!j!=%%a %%b %%c %%k&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;move=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; &nbsp; if defined move (<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Clear the piece from its current position, on the screen<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (1,1,!i!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-4&quot; %%a in (&quot;!c%%i!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo %%b,%%a,!F%%a:~%%b,1!,%%d<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Place the piece at the new position, both in field and screen<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%j in (1,1,!j!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-4&quot; %%a in (&quot;!n%%j!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;F%%a=!F%%a:~0,%%b!!pR:~0,%%d!!F%%a:~%%c!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo %%b,%%a,!F%%a:~%%b,1!,%%d<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Update any changes in the piece<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A y+=Dy, x+=Dx<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if defined R set &quot;p0=!p1!&quot; &amp; set &quot;pI=!p!&quot; &amp; set &quot;R=&quot;<br /><br />&nbsp; &nbsp; &nbsp; ) else (&nbsp; &nbsp;rem The piece can not be moved<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Recover the piece at its current position, in the field<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (1,1,!i!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-4&quot; %%a in (&quot;!c%%i!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;F%%a=!F%%a:~0,%%b!!pR:~0,%%d!!F%%a:~%%c!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if defined R set &quot;p1=!p0!&quot; &amp; set &quot;R=&quot;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if !Dy! neq 0 (&nbsp; &nbsp;rem The piece &quot;lands&quot;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rem Check completed lines<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;j=&quot; &amp; set &quot;m=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /L %%i in (1,1,!i!) do for /F %%a in (&quot;!c%%i!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &quot;!F%%a:0=!&quot; equ &quot;!F%%a!&quot; (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;F%%a=X&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;j=!j! %%a&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A m+=1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !m! gtr 0 (<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Blink completed lines on screen<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for %%i in (!j!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo 1,%%i,=,%cols%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Update level and scores<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem See: N-Blox at http://www.tetrisfriends.com/help/tips_appendix.php#rankingsystem<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A &quot;xp=Level*(40+((j-2&gt;&gt;31)+1)*60+((j-3&gt;&gt;31)+1)*200+((j-4&gt;&gt;31)+1)*900)&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A &quot;Score+=xp, Rows+=j, xL=Level, Level=(Rows-1)/10+1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if !Level! neq !xL! if !delay! gtr 5 set /A delay-=5<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem BEL Ctrl-G Ascii-7:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /P &quot;=&quot; &lt; NUL &gt; CON<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Remove completed lines from field<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;i=1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (1,1,%lines%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;F!i!=!F%%i!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &quot;!F%%i!&quot; neq &quot;X&quot; set /A i+=1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (!i!,1,%lines%) do set &quot;F%%i=³%spc%³&quot;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Update scores and the whole field on screen<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo 1,-1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call :Delay 95<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo Level: !Level!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo&nbsp; &nbsp; &nbsp;Rows: !Rows!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo&nbsp; &nbsp; Score: !Score!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) &gt; CON<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo X &gt; PSbusy.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%i in (%lines%,-1,1) do echo 1,%%i,!F%%i:~1,-1!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;echo del,PSbusy.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;call :WaitPSbusy<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rem Request to show a new piece<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;new=1&quot;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br /><br />&nbsp; &nbsp; &nbsp; )<br /><br />&nbsp; &nbsp;)<br /><br />)<br /><br /><br />:endGame<br />echo 1,-4<br />echo X &gt; PSbusy.txt<br />echo del,PSbusy.txt<br />call :WaitPSbusy<br />set /P &quot;=Play again? &quot; &lt; NUL &gt; CON<br />:choice<br />&nbsp; &nbsp;set /P &quot;com=&quot;<br />if not defined com goto choice<br />if &quot;%com%&quot; equ &quot;Y&quot; exit /B<br />if &quot;%com:~0,1%&quot; neq &quot;N&quot; set &quot;com=&quot; &amp; goto choice<br />echo N &gt; CON<br />exit<br /><br /><br />:WaitPSbusy<br />&nbsp; &nbsp;if exist PSbusy.txt goto WaitPSbusy<br />exit /B<br /><br /><br />:Pause<br />title PAUSED<br />:wait<br />&nbsp; &nbsp;set /P &quot;com=&quot;<br />&nbsp; &nbsp;if not defined com goto wait<br />if &quot;%com%&quot; neq &quot;pause=1&quot; set &quot;com=&quot; &amp; goto wait<br />set &quot;com=&quot;<br />set &quot;pause=&quot;<br />title Tetris.BAT by Aacini<br />exit /B<br /><br /><br />:Delay centisecs<br />set &quot;b=1%time:~-2%&quot;<br />:wait2<br />&nbsp; &nbsp;set /A &quot;e=1%time:~-2%, elap=e-b, elap-=(elap&gt;&gt;31)*100&quot;<br />if %elap% lss %1 goto wait2<br />set &quot;b=1%time:~-2%&quot;<br />exit /B<br /></code></pre></div><br /><br />Antonio</div>

			
													<div class="notice">
					Last edited by <a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a> on 12 Apr 2016 20:16, edited 4 times in total.
									</div>
			
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p46209" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile46209">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist2675.html?mode=viewprofile&amp;u=2988" style="color: #00AA00;" class="username-coloured">Squashman</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search1322.html?author_id=2988&amp;sr=posts">3970</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 23 Dec 2011 13:59</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content46209">

						<h3 ><a href="#p46209">Re: Read arrow keys and show color text in an efficient way</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingc82f.html?mode=quote&amp;f=3&amp;p=46209" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic3de7.html?p=46209#p46209" onclick="prompt('Message #6',this.href); return false;">#6</a></span> 
									<a class="unread" href="viewtopic3de7.html?p=46209#p46209" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist2675.html?mode=viewprofile&amp;u=2988" style="color: #00AA00;" class="username-coloured">Squashman</a></strong> &raquo; </span>12 Apr 2016 06:18
			</p>
			
			
			
			<div class="content">Fantastic!</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p46218" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile46218">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content46218">

						<h3 ><a href="#p46218">Re: Read arrow keys and show color text in an efficient way</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting5079.html?mode=quote&amp;f=3&amp;p=46218" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic3b4e.html?p=46218#p46218" onclick="prompt('Message #7',this.href); return false;">#7</a></span> 
									<a class="unread" href="viewtopic3b4e.html?p=46218#p46218" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>12 Apr 2016 20:06
			</p>
			
			
			
			<div class="content">After several tests I found a synchronization problem that may cause an undesirable behavior when the selected font is small and the computer is slow. Also, there was a subtle bug that cause an error when the window/buffer sizes are changed in certain cases. I fixed two previous points and posted the new code in the same place of <a href="viewtopic5338.html?f=3&amp;t=6936&amp;p=46206#p46206" class="postlink">the original</a>, as usual.<br /><br />Antonio</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p46219" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile46219">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistcb12.html?mode=viewprofile&amp;u=1621" class="username">carlos</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchda66.html?author_id=1621&amp;sr=posts">472</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 20 Aug 2010 13:57</dd>		
		
																<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Chile</dd>
							
							<dd class="profile-contact">
				<strong>Contact:</strong>
				<div class="dropdown-container dropdown-left">
					<a href="#" class="dropdown-trigger" title="Contact carlos">
						<i class="icon fa-commenting-o fa-fw icon-lg" aria-hidden="true"></i><span class="sr-only">Contact carlos</span>
					</a>
					<div class="dropdown">
						<div class="pointer"><div class="pointer-inner"></div></div>
						<div class="dropdown-contents contact-icons">
																																								<div>
																	<a href="https://web.archive.org/web/20180902091521/http://consolesoft.com/" title="Website" class="last-cell">
										<span class="contact-icon phpbb_website-icon">Website</span>
									</a>
																	</div>
																					</div>
					</div>
				</div>
			</dd>
				
		</dl>

		<div class="postbody">
						<div id="post_content46219">

						<h3 ><a href="#p46219">Re: Read arrow keys and show color text in an efficient way</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting9382.html?mode=quote&amp;f=3&amp;p=46219" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic56b9-2.html?p=46219#p46219" onclick="prompt('Message #8',this.href); return false;">#8</a></span> 
									<a class="unread" href="viewtopic56b9-2.html?p=46219#p46219" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistcb12.html?mode=viewprofile&amp;u=1621" class="username">carlos</a></strong> &raquo; </span>12 Apr 2016 22:22
			</p>
			
			
			
			<div class="content">Very good game Aacini.<br />For play it I needed in windows 8 I add this before the cls:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>cls<br />path %path%;%SystemRoot%\syswow64\WindowsPowerShell\v1.0;</code></pre></div></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p46221" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile46221">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistfcd9.html?mode=viewprofile&amp;u=4919" class="username">npocmaka_</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha36f.php?author_id=4919&amp;sr=posts">473</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 24 Jun 2013 17:10</dd>		
		
																<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Bulgaria</dd>
							
							<dd class="profile-contact">
				<strong>Contact:</strong>
				<div class="dropdown-container dropdown-left">
					<a href="#" class="dropdown-trigger" title="Contact npocmaka_">
						<i class="icon fa-commenting-o fa-fw icon-lg" aria-hidden="true"></i><span class="sr-only">Contact npocmaka_</span>
					</a>
					<div class="dropdown">
						<div class="pointer"><div class="pointer-inner"></div></div>
						<div class="dropdown-contents contact-icons">
																																								<div>
																	<a href="http://stackoverflow.com/questions/28043589/how-can-i-compres-zip-and-uncopress-unzip-files-and-folders-with-batch-f" title="Website" class="last-cell">
										<span class="contact-icon phpbb_website-icon">Website</span>
									</a>
																	</div>
																					</div>
					</div>
				</div>
			</dd>
				
		</dl>

		<div class="postbody">
						<div id="post_content46221">

						<h3 ><a href="#p46221">Re: Read arrow keys and show color text in an efficient way</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingf249-2.html?mode=quote&amp;f=3&amp;p=46221" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic2c41.html?p=46221#p46221" onclick="prompt('Message #9',this.href); return false;">#9</a></span> 
									<a class="unread" href="viewtopic2c41.html?p=46221#p46221" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistfcd9.html?mode=viewprofile&amp;u=4919" class="username">npocmaka_</a></strong> &raquo; </span>13 Apr 2016 03:12
			</p>
			
			
			
			<div class="content">another way with c# and platform invoke (code was stolen shamelessly from here : <!-- m --><a class="postlink" href="https://blogs.msdn.microsoft.com/toub/2006/05/03/low-level-keyboard-hook-in-c/">https://blogs.msdn.microsoft.com/toub/2 ... hook-in-c/</a><!-- m --> )<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>// 2&gt;nul||@goto :batch<br />/*<br />:batch<br />@echo off<br />setlocal<br /><br />:: find csc.exe<br />set &quot;csc=&quot;<br />for /r &quot;%SystemRoot%\Microsoft.NET\Framework\&quot; %%# in (&quot;*csc.exe&quot;) do&nbsp; set &quot;csc=%%#&quot;<br /><br />if not exist &quot;%csc%&quot; (<br />&nbsp; &nbsp;echo no .net framework installed<br />&nbsp; &nbsp;exit /b 10<br />)<br /><br />if not exist &quot;%~n0.exe&quot; (<br />&nbsp; &nbsp;call %csc% /nologo /warn:0 /out:&quot;%~n0.exe&quot; &quot;%~dpsfnx0&quot; || (<br />&nbsp; &nbsp; &nbsp; exit /b %errorlevel% <br />&nbsp; &nbsp;)<br />)<br />%~n0.exe %*<br />endlocal &amp; exit /b %errorlevel%<br /><br />*/<br /><br />using System;<br />using System.Diagnostics;<br />using System.Windows.Forms;<br />using System.Runtime.InteropServices;<br />class InterceptKeys<br />{<br />&nbsp; &nbsp; private const int WH_KEYBOARD_LL = 13;<br />&nbsp; &nbsp; private const int WM_KEYDOWN = 0x0100;<br />&nbsp; &nbsp; private static LowLevelKeyboardProc _proc = HookCallback;<br />&nbsp; &nbsp; private static IntPtr _hookID = IntPtr.Zero;<br />&nbsp; &nbsp; public static void Main()<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; _hookID = SetHook(_proc);<br />&nbsp; &nbsp; &nbsp; &nbsp; Application.Run();<br />&nbsp; &nbsp; &nbsp; &nbsp; UnhookWindowsHookEx(_hookID);<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; private static IntPtr SetHook(LowLevelKeyboardProc proc)<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; using (Process curProcess = Process.GetCurrentProcess())<br />&nbsp; &nbsp; &nbsp; &nbsp; using (ProcessModule curModule = curProcess.MainModule)<br />&nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return SetWindowsHookEx(WH_KEYBOARD_LL, proc,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GetModuleHandle(curModule.ModuleName), 0);<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; private delegate IntPtr LowLevelKeyboardProc(<br />&nbsp; &nbsp; &nbsp; &nbsp; int nCode, IntPtr wParam, IntPtr lParam);<br />&nbsp; &nbsp; private static IntPtr HookCallback(<br />&nbsp; &nbsp; &nbsp; &nbsp; int nCode, IntPtr wParam, IntPtr lParam)<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; if (nCode &gt;= 0 &amp;&amp; wParam == (IntPtr)WM_KEYDOWN)<br />&nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; int vkCode = Marshal.ReadInt32(lParam);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Console.WriteLine((Keys)vkCode);<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; &nbsp; &nbsp; return CallNextHookEx(_hookID, nCode, wParam, lParam);<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; &#91;DllImport(&quot;user32.dll&quot;, CharSet = CharSet.Auto, SetLastError = true)&#93;<br />&nbsp; &nbsp; private static extern IntPtr SetWindowsHookEx(int idHook,<br />&nbsp; &nbsp; &nbsp; &nbsp; LowLevelKeyboardProc lpfn, IntPtr hMod, uint dwThreadId);<br />&nbsp; &nbsp; &#91;DllImport(&quot;user32.dll&quot;, CharSet = CharSet.Auto, SetLastError = true)&#93;<br />&nbsp; &nbsp; &#91;return: MarshalAs(UnmanagedType.Bool)&#93;<br />&nbsp; &nbsp; private static extern bool UnhookWindowsHookEx(IntPtr hhk);<br />&nbsp; &nbsp; &#91;DllImport(&quot;user32.dll&quot;, CharSet = CharSet.Auto, SetLastError = true)&#93;<br />&nbsp; &nbsp; private static extern IntPtr CallNextHookEx(IntPtr hhk, int nCode,<br />&nbsp; &nbsp; &nbsp; &nbsp; IntPtr wParam, IntPtr lParam);<br />&nbsp; &nbsp; &#91;DllImport(&quot;kernel32.dll&quot;, CharSet = CharSet.Auto, SetLastError = true)&#93;<br />&nbsp; &nbsp; private static extern IntPtr GetModuleHandle(string lpModuleName);<br />}<br /></code></pre></div></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p46288" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile46288">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content46288">

						<h3 ><a href="#p46288">Re: Read arrow keys and show color text in an efficient way</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingbaca.html?mode=quote&amp;f=3&amp;p=46288" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic5dcd-2.html?p=46288#p46288" onclick="prompt('Message #10',this.href); return false;">#10</a></span> 
									<a class="unread" href="viewtopic5dcd-2.html?p=46288#p46288" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>15 Apr 2016 11:06
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>carlos wrote:</cite>For play it I needed in windows 8 I add this before the cls:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>cls<br />path %path%;%SystemRoot%\syswow64\WindowsPowerShell\v1.0;<br /></code></pre></div><br /></div></blockquote><br /><br />In my computer (Windows 8.1 Spanish 64-Bits) the %path% had the value &quot;C:\Windows\System32\WindowsPowerShell\v1.0&quot; predefined on it, so I would needed to insert the new path &quot;C:\Windows\syswow64\WindowsPowerShell\v1.0&quot; <em class="text-italics">before</em> the standard path in order to start the 64-bits PS version instead. I did it as a test and saw no difference in the program behavior...<br /><br />I think that all computers with PowerShell preinstalled have also the right value in %path%, so no adjustment is necessary.<br /><br /><br /><blockquote><div><cite>npocmaka_ wrote:</cite>another way with c# and platform invoke...<br /></div></blockquote><br /><br />Well, in the first paragraph of this thread I said: <em class="text-italics">&quot;we want a Batch-file based solution with the minimal part of non native code&quot;</em>, and the original name of the posted game is &quot;Pure .BATch-file Tetris game&quot;. The purpose of this thread is develop a method to read arrow keys and show color text using just preinstalled Windows features that be efficient enough that can be used in an animated game.<br /><br />Anyway, if a third party application could be used in these programs, a much simpler solution would be to just use my <a href="viewtopic9635.html?f=3&amp;t=3428" class="postlink">auxiliary programs</a>, as I did already in the <a href="viewtopic713d.html?f=3&amp;t=5701&amp;p=35407#p35407" class="postlink">2048.bat game</a>.<br /><br />Antonio</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p46413" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile46413">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content46413">

						<h3 ><a href="#p46413">Re: Read arrow keys and show color text in an efficient way</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting7c64.html?mode=quote&amp;f=3&amp;p=46413" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic4009.html?p=46413#p46413" onclick="prompt('Message #11',this.href); return false;">#11</a></span> 
									<a class="unread" href="viewtopic4009.html?p=46413#p46413" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>24 Apr 2016 10:06
			</p>
			
			
			
			<div class="content">I modified my <a href="viewtopic713d.html?f=3&amp;t=5701&amp;p=35407#p35407" class="postlink">2048.bat game</a> program in order to read cursor keys and show color text in the way described in this thread. This modification is different than the Tetris game one because in this case the original program read cursor keys and show color text already using my GetInput.exe, CursorPos.exe, and ColorChar.exe auxiliary programs. I defined the format of the &quot;control lines&quot; received by the :Output PowerShell code section so they have <em class="text-italics">the same format</em> of the original lines used to execute the auxiliary .exe programs. For example, the original code use this line to move the cursor:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>CursorPos X Y<br /></code></pre></div><br />This way, the new :Output PowerShell section was designed to get a line with this format: &quot;CursorPos X Y&quot; and move the cursor to the position specified, and do the same thing with &quot;ColorChar ...&quot; line. This design makes possible that the modification of the original code, from using auxiliary .exe programs to use PowerShell output section, just consist in add &quot;echo&quot; commands:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>echo CursorPos X Y<br /></code></pre></div><br />The &quot;echo&quot; part may even be stored in a variable that select the method used (original .exe programs or the new PowerShell code) so the resulting program may work in anyone of these two ways by just defining a variable:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>rem The line below select original .exe programs or new PowerShell method:<br />set &quot;PS=echo&quot;<br /><br />%PS% CursorPos X Y<br /><br />if not defined PS (<br />&nbsp; &nbsp;.exe version specific lines<br />) else (<br />&nbsp; &nbsp;PowerShell version specific lines<br />)<br /></code></pre></div><br />A simple visual comparison of the two methods indicate that the .exe auxiliary programs are still faster than the PowerShell method, but the difference is not big.<br /><br />The :Input PowerShell code section can not be managed in the same way, because the original execution of GetInput.exe auxiliary program is changed by a simple SET /P command that read equivalent input from the piped PowerShell code section. However, the <em class="text-italics">definition</em> of the valid keys and mouse click zones is done via a line passed to the :Input PowerShell section that have the same format of GetInput command. This new :Input section features a standard management of mouse left button: it converts the screen-wide pixel coordinates of a mouse click into cmd.exe text window column/line coordinates and return the correct value when a mouse click was done in the specified zones (in the same way as GetInput.exe auxiliary program). The mouse management is the most complex part of this section, indeed; if this section would read just arrow keys, it would be <em class="text-italics">much</em> simpler.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion<br /><br />if &quot;%~1&quot; neq &quot;&quot; goto %1<br /><br />rem 2048 game: http://gabrielecirulli.github.io/2048/<br />rem Windows Batch file version by Antonio Perez Ayala<br />rem Version 3: http://www.dostips.com/forum/viewtopic.php?f=3&amp;t=6936&amp;p=46413#p46413<br /><br />rem This version 3 may use CursorPos.exe, ColorChar.exe and GetInput.exe auxiliary programs<br />rem (to get them, download and execute 2048-Support.bat file from:<br />rem&nbsp; http://www.dostips.com/forum/viewtopic.php?f=3&amp;t=5701&amp;p=35407#p35407)<br />rem OR it may use PowerShell modules to perform the same tasks; the line below select the metod used:<br />rem PS var defined = use PowerShell modules; PS var not defined = use the 3 auxiliary .exe programs<br />set &quot;PS=echo&quot;<br /><br />cls<br />echo/<br />echo 2048 game, original version by Gabriele Cirulli<br />echo http://gabrielecirulli.github.io/2048/<br />echo/<br />echo This Windows batch file version by Antonio Perez Ayala<br />echo/<br />echo HOW TO PLAY:<br />echo - Use your arrow keys to move the tiles<br />echo&nbsp; &nbsp;or click on the central tiles of the side to move<br />echo - When two tiles with same number touch, they merge into one<br />echo - Join the numbers and get to the 2048 TILE<br />echo/<br />echo Press Esc key to start a new game, press Del key to exit<br />echo or click on the corresponding NewGame/Exit buttons<br />echo/<br /><br />rem Load a previously saved game, if any<br />cd &quot;%~P0&quot;<br />set &quot;prevGame=&quot;<br />if exist 2048.dat (<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;for %%a in (2048.dat) do echo --^&gt; A previous game exists saved on %%~Ta<br />&nbsp; &nbsp;choice /M &quot;Do you want to load it &quot;<br />&nbsp; &nbsp;if !errorlevel! equ 1 (<br />&nbsp; &nbsp; &nbsp; for /F &quot;delims=&quot; %%a in (2048.dat) do set %%a<br />&nbsp; &nbsp; &nbsp; del 2048.dat<br />&nbsp; &nbsp; &nbsp; set prevGame=true<br />&nbsp; &nbsp; &nbsp; echo Game loaded<br />&nbsp; &nbsp;)<br />&nbsp; &nbsp;echo/<br />&nbsp; &nbsp;echo/<br />) else (<br />&nbsp; &nbsp;set score=0<br />)<br />call :getBestScore<br />set lastBestScore=%bestScore%<br />pause<br /><br />title 2048 game by Aacini<br />mode con cols=68 lines=36<br />color F0<br />cls<br /><br />if not defined PS goto Main<br />set /P &quot;=Loading PS engine...&quot; &lt; NUL<br />rem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Left Up&nbsp; Right Down Esc End&nbsp; &nbsp; &nbsp; Left&nbsp; &nbsp; &nbsp; &nbsp; Up&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Right&nbsp; &nbsp; &nbsp; &nbsp; Down&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NewGame&nbsp; &nbsp; Exit<br />echo GetInput 293&nbsp; 294 295&nbsp; &nbsp;296&nbsp; 27&nbsp; 302&nbsp; /M&nbsp; 0 16 17 26&nbsp; 20 7 47 14&nbsp; 50 16 67 26&nbsp; 20 28 47 35&nbsp; 36 4 45 6&nbsp; 52 4 59 6 &gt; input.def<br />&quot;%~F0&quot; Input&nbsp; |&nbsp; &quot;%~F0&quot; Main&nbsp; |&nbsp; &quot;%~F0&quot; Output<br />del input.def<br />goto :EOF<br /><br /><br /><br />:Input<br />PowerShell&nbsp; ^<br />&nbsp; &nbsp;$GetConsoleWindow = Add-Type 'A' -PassThru -MemberDefinition '&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &#91;DllImport(\&quot;Kernel32.dll\&quot;)&#93;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; public static extern int GetConsoleWindow();&nbsp; ^<br />&nbsp; &nbsp;';&nbsp; ^<br />&nbsp; &nbsp;$GetClientRect,$RECT = Add-Type 'B' -PassThru -MemberDefinition '&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &#91;DllImport(\&quot;user32.dll\&quot;)&#93;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; public static extern bool GetClientRect(IntPtr hWnd, ref RECT lpRect);&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &#91;StructLayout(LayoutKind.Sequential)&#93;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; public struct RECT { public int Left, Top, Right, Bottom; }&nbsp; ^<br />&nbsp; &nbsp;';&nbsp; ^<br />&nbsp; &nbsp;$ScreenToClient,$POINT = Add-Type 'C' -PassThru -MemberDefinition '&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &#91;DllImport(\&quot;user32.dll\&quot;)&#93;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; public static extern bool ScreenToClient(IntPtr hWnd, ref POINT lpPoint);&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &#91;StructLayout(LayoutKind.Sequential)&#93;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; public struct POINT { public int X, Y; }&nbsp; ^<br />&nbsp; &nbsp;';&nbsp; ^<br />&nbsp; &nbsp;$Prog,$Params = (Get-Content input.def).Split(' ',&#91;StringSplitOptions&#93;::RemoveEmptyEntries);&nbsp; ^<br />&nbsp; &nbsp;if ( $Prog -eq 'GetInput' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; $validKeys = '';&nbsp; $pos = 0; $mouseSwitch = $false;&nbsp; $mouseZone = @();&nbsp; ^<br />&nbsp; &nbsp; &nbsp; while ( $Params ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( -not $mouseSwitch ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( $Params&#91;0&#93; -eq '/M' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$mouseSwitch = $true;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$null,$Params = $Params;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#91;int&#93;$Param,$Params = $Params;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( $Param -ge 256 ) { $Param -= 256 }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$validKeys += &#91;char&#93;$Param;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $Rectangle = New-Object -TypeName $RECT.FullName;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $Rectangle.Left,$Rectangle.Top,$Rectangle.Right,$Rectangle.Bottom,$Params = $Params;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $mouseZone += $Rectangle;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp;$CmdWindowHandle = $GetConsoleWindow::GetConsoleWindow();&nbsp; ^<br />&nbsp; &nbsp;$ClientRect = New-Object -TypeName $RECT.FullName;&nbsp; ^<br />&nbsp; &nbsp;$null = $GetClientRect::GetClientRect($CmdWindowHandle,&#91;ref&#93;$ClientRect);&nbsp; ^<br />&nbsp; &nbsp;$console = $Host.UI.RawUI;&nbsp; ^<br />&nbsp; &nbsp;$fontWidth&nbsp; = $ClientRect.Right / $console.WindowSize.Width;&nbsp; ^<br />&nbsp; &nbsp;$fontHeight = $ClientRect.Bottom / $console.WindowSize.Height;&nbsp; ^<br />&nbsp; &nbsp;$null = &#91;Reflection.Assembly&#93;::LoadWithPartialName('System.Windows.Forms'); ^<br />&nbsp; &nbsp;$control = &#91;System.Windows.Forms.Control&#93;;&nbsp; ^<br />&nbsp; &nbsp;$MouseCoord = New-Object -TypeName $POINT.FullName;&nbsp; ^<br />&nbsp; &nbsp;Start-Sleep -m 1500;&nbsp; ^<br />&nbsp; &nbsp;Write-Output 0;&nbsp; ^<br />&nbsp; &nbsp;while ( $pos -lt $validKeys.length ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; if ( $console.KeyAvailable ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$key = $console.ReadKey('NoEcho,IncludeKeyUp').VirtualKeyCode;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( $pos = $validKeys.IndexOf($key)+1 ) { Write-Output $pos }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; } else {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$mouseButn = $control::MouseButtons;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( $mouseButn -ne $lastButn ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $lastButn = $mouseButn;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( $mouseButn -eq 'Left' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$MouseCoord.X = $control::MousePosition.X; $MouseCoord.Y = $control::MousePosition.Y;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$null = $ScreenToClient::ScreenToClient($CmdWindowHandle,&#91;ref&#93;$MouseCoord);&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$mouseCol = $MouseCoord.X/$fontWidth; $mouseRow = $MouseCoord.Y/$fontHeight;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for ( $pos=$i=0; $i -lt $mouseZone.length; ++$i ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( ($mouseCol -ge $mouseZone&#91;$i&#93;.Left)&nbsp; -and&nbsp; ($mouseCol -le $mouseZone&#91;$i&#93;.Right)&nbsp; -and&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;($mouseRow -ge $mouseZone&#91;$i&#93;.Top)&nbsp; &nbsp;-and&nbsp; ($mouseRow -le $mouseZone&#91;$i&#93;.Bottom) ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$pos = $i+1; break;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( $pos ) { Write-Output $pos }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; Start-Sleep -m 100;&nbsp; ^<br />&nbsp; &nbsp;}<br />%End PowerShell%<br />echo Ending game... &gt; CON<br />exit<br /><br /><br /><br />:Output<br />rem Parameters received via lines read have one of these three forms:<br />rem - cls<br />rem - CursorPos X Y<br />rem - ColorChar standard parameters of ColorChar.exe auxiliary program<br />PowerShell&nbsp; ^<br />&nbsp; &nbsp;$console = $Host.UI.RawUI;&nbsp; ^<br />&nbsp; &nbsp;$console.WindowTitle = '2048 game by Aacini';&nbsp; ^<br />&nbsp; &nbsp;$curSize = $console.CursorSize;&nbsp; ^<br />&nbsp; &nbsp;$console.CursorSize = 0;&nbsp; ^<br />&nbsp; &nbsp;$coords = $console.CursorPosition;&nbsp; ^<br />&nbsp; &nbsp;foreach ( $line in $input ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; $Prog,$Params = $line.Split(' ',&#91;StringSplitOptions&#93;::RemoveEmptyEntries);&nbsp; ^<br />&nbsp; &nbsp; &nbsp; if ( $Prog -eq 'cls' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cls&nbsp; ^<br />&nbsp; &nbsp; &nbsp; } elseif ( $Prog -eq 'CursorPos' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$coords.X = &#91;int&#93;$Params&#91;0&#93;;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$coords.Y = &#91;int&#93;$Params&#91;1&#93;;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$console.CursorPosition = $coords;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; } elseif ( $Prog -eq 'ColorChar' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;while ( $Params ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $Param,$Params = $Params;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( $Param&#91;0&#93; -eq '/' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$color = &#91;int&#93;('0x'+$Param.substring(1));&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$back = $color -shr 4; $fore = $color%%16;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif ( $Param&#91;0&#93; -eq '\^&quot;' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Write-Host -BackgroundColor $back -ForegroundColor $fore -NoNewLine $Param.substring(1,$Param.length-2);&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif ( $Param -eq '13' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Write-Host;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$Params = '';&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#91;int&#93;$code,&#91;int&#93;$times = $Param.Split('x');&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( -not $times ) { $times = 1 }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( $code -ne 219 ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $str = &#91;string&#93;&#91;char&#93;$code * $times;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write-Host -BackgroundColor $back -ForegroundColor $fore -NoNewLine $str;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $str = ' ' * $times;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write-Host -BackgroundColor $fore -ForegroundColor $back -NoNewLine $str;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp;$console.CursorSize = $curSize;<br />%End PowerShell%<br />exit /B<br /><br /><br /><br />:Main<br /><br />rem Define the numbers used in output (5 lines each)<br />for %%m in (<br />&quot;&nbsp; &nbsp; |70|32x13|32x13|32x13|32x13|32x13&quot;<br />&quot;&nbsp; &nbsp;2|F0|32x5&nbsp; &nbsp; 219x3&nbsp; &nbsp;32x5|32x7&nbsp; &nbsp; &nbsp; &nbsp; 219 32x5|32x5 219x3 32x5|32x5 219&nbsp; &nbsp; &nbsp; &nbsp; 32x7|32x5 219x3 32x5&quot;<br />&quot;&nbsp; &nbsp;4|70|32x5 219 32 219 32x5|32x5 219 32 219 32x5|32x5 219x3 32x5|32x7&nbsp; &nbsp; &nbsp; &nbsp; 219 32x5|32x7&nbsp; &nbsp;219 32x5&quot;<br />&quot;&nbsp; &nbsp;8|C7|32x5&nbsp; &nbsp; 219x3&nbsp; &nbsp;32x5|32x5 219 32 219 32x5|32x5 219x3 32x5|32x5 219 32 219 32x5|32x5 219x3 32x5&quot;<br />&quot;&nbsp; 16|CF|32x4&nbsp; &nbsp;219&nbsp; 32&nbsp; &nbsp; 219x3&nbsp; 32x4|32x4 219 32 219&nbsp; &nbsp; &nbsp;32x6&nbsp; &nbsp; &nbsp;|32x4&nbsp; 219 32 219x3&nbsp; 32x4|32x4 219 32 219 32 219&nbsp; 32x4 |32x4 219&nbsp; &nbsp;32 219x3 32x4&quot;<br />&quot;&nbsp; 32|47|32x3 219x3 32&nbsp; &nbsp; 219x3&nbsp; &nbsp;32x3|32x5&nbsp; &nbsp; &nbsp; &nbsp; 219 32x3 219 32x3|32x3 219x3 32 219x3 32x3|32x5&nbsp; &nbsp; &nbsp; &nbsp; 219 32 219&nbsp; &nbsp;32x5|32x3 219x3 32 219x3 32x3&quot;<br />&quot;&nbsp; 64|4F|32x3 219x3 32 219 32 219 32x3|32x3 219 32x3 219 32 219 32x3|32x3 219x3 32 219x3 32x3|32x3 219 32 219 32x3 219 32x3|32x3 219x3 32x3 219 32x3&quot;<br />&quot; 128|27|32x2 219 32 219x3 32 219x3 32x2|32x2 219 32x3 219 32 219 32 219 32x2|32x2 219 32 219x3 32 219x3 32x2|32x2 219 32&nbsp; &nbsp;219 32x3 219 32 219 32x2|32x2 219 32 219x3 32 219x3 32x2&quot;<br />&quot; 256|2F|32 219x3 32 219x3 32 219x3 32&nbsp; |32x3&nbsp; 219&nbsp; 32&nbsp; &nbsp; &nbsp; 219 32x3 219 32x3|32 219x3 32 219x3 32 219x3 32&nbsp; |32&nbsp; &nbsp;219 32x5 219 32&nbsp; &nbsp;219 32 219 32&nbsp; |32 219x3 32 219x3 32 219x3 32&nbsp; &quot;<br />&quot; 512|E6|32x2 219x3 32 219 32 219x3 32x2|32x2 219 32x3&nbsp; &nbsp; &nbsp; 219 32x3 219 32x2|32x2 219x3 32 219 32 219x3 32x2|32x4 219 32&nbsp; &nbsp;219 32&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 219 32x4|32x2 219x3 32 219 32 219x3 32x2&quot;<br />&quot;1024|E0|219 32 219x3 32 219x3 32 219 32 219|219 32 219 32 219 32x3 219 32 219 32 219|219 32 219 32 219 32 219x3 32 219x3|219 32 219 32 219 32 219 32x5 219|219 32 219x3 32 219x3 32x3 219&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) do (<br />&nbsp; &nbsp;for /F &quot;tokens=1-7 delims=|&quot; %%a in (%%m) do (<br />&nbsp; &nbsp; &nbsp; set &quot;num&#91;1,%%a&#93;=/%%b %%c&quot;<br />&nbsp; &nbsp; &nbsp; set &quot;num&#91;2,%%a&#93;=/%%b %%d&quot;<br />&nbsp; &nbsp; &nbsp; set &quot;num&#91;3,%%a&#93;=/%%b %%e&quot;<br />&nbsp; &nbsp; &nbsp; set &quot;num&#91;4,%%a&#93;=/%%b %%f&quot;<br />&nbsp; &nbsp; &nbsp; set &quot;num&#91;5,%%a&#93;=/%%b %%g&quot;<br />&nbsp; &nbsp;)<br />)<br /><br />rem Define the mapping indices tables<br />set j=0<br />rem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LEFT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;UP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RIGHT&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;DOWN<br />for %%m in (&quot;1,1|1,2|1,3|1,4&nbsp; &nbsp;1,1|2,1|3,1|4,1&nbsp; &nbsp;1,4|1,3|1,2|1,1&nbsp; &nbsp;4,1|3,1|2,1|1,1&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;2,1|2,2|2,3|2,4&nbsp; &nbsp;1,2|2,2|3,2|4,2&nbsp; &nbsp;2,4|2,3|2,2|2,1&nbsp; &nbsp;4,2|3,2|2,2|1,2&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;3,1|3,2|3,3|3,4&nbsp; &nbsp;1,3|2,3|3,3|4,3&nbsp; &nbsp;3,4|3,3|3,2|3,1&nbsp; &nbsp;4,3|3,3|2,3|1,3&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;4,1|4,2|4,3|4,4&nbsp; &nbsp;1,4|2,4|3,4|4,4&nbsp; &nbsp;4,4|4,3|4,2|4,1&nbsp; &nbsp;4,4|3,4|2,4|1,4&quot;) do (<br />&nbsp; &nbsp;set /A j+=1<br />&nbsp; &nbsp;for /F &quot;tokens=1-4&quot; %%a in (%%m) do (<br />&nbsp; &nbsp; &nbsp; set &quot;map&#91;1,!j!&#93;=%%a&quot;<br />&nbsp; &nbsp; &nbsp; set &quot;map&#91;2,!j!&#93;=%%b&quot;<br />&nbsp; &nbsp; &nbsp; set &quot;map&#91;3,!j!&#93;=%%c&quot;<br />&nbsp; &nbsp; &nbsp; set &quot;map&#91;4,!j!&#93;=%%d&quot;<br />&nbsp; &nbsp;)<br />)<br /><br />rem Wait for PowerShell Input part start signal<br />if defined PS set /P &quot;=&quot; &amp; set /P &quot;=&quot;<br /><br />:showHeader<br />%PS% cls<br />%PS% CursorPos 0 1<br />%PS% ColorChar /F0 32x38&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /8F 32 &quot;SCORE&quot; 32&nbsp; &nbsp; &nbsp;/F0 32x8 /8F 32 &quot;BEST&quot; 32&nbsp; &nbsp; &nbsp;13 10<br />%PS% ColorChar /F0 32x3 219x5 32x2 219x5 32x2 219 32x3 219 32x2 219x5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 32x9 /8F 32 &quot;12345&quot; 32&nbsp; &nbsp; &nbsp;/F0 32x8 /8F &quot;123456&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;13 10<br />%PS% ColorChar /F0 32x7 219 32x2 219 32x3 219 32x2 219 32x3 219 32x2 219 32x3 219&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;13 10<br />%PS% ColorChar /F0 32x3 219x5 32x2 219 32x3 219 32x2 219x5 32x2 219x5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 32x7 /8F 32x10&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/F0 32x6 /8F 32x8&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;13 10<br />%PS% ColorChar /F0 32x3 219 32x6 219 32x3 219 32x6 219 32x2 219 32x3 219&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32x7 /8F 32&nbsp; &quot;New&quot; 32 &quot;Game&quot; 32 /F0 32x6 /8F 32x2 &quot;Exit&quot; 32x2 13 10<br />%PS% ColorChar /F0 32x3 219x5 32x2 219x5 32x6 219 32x2 219x5&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;32x7 /8F 32x2 &quot;(Esc)&quot; 32x3 /F0 32x6 /8F 32x2 &quot;(Del)&quot; 32<br />if defined prevGame goto showMove<br />:newGame<br />for /L %%i in (1,1,4) do (<br />&nbsp; &nbsp;for /L %%j in (1,1,4) do (<br />&nbsp; &nbsp; &nbsp; set &quot;board&#91;%%i,%%j&#93;=&nbsp; &nbsp; &quot;<br />&nbsp; &nbsp;)<br />)<br />call :tileSpawn<br />call :tileSpawn<br />set /A score=0, points=0, maxTile=0<br />goto showMove<br /><br />:mainLoop<br />if not defined anyHole (<br />&nbsp; &nbsp;echo Not empty space left, end of this game.<br />&nbsp; &nbsp;set /P &quot;=Press Enter key to start a new game &quot; &lt; CON<br />&nbsp; &nbsp;set &quot;prevGame=&quot;<br />&nbsp; &nbsp;goto showHeader<br />) &gt; CON<br />call :tileSpawn<br /><br />:showMove<br />if %maxTile% equ 2048 (<br />&nbsp; &nbsp;echo Congratulations: YOU WON<br />&nbsp; &nbsp;pause<br />&nbsp; &nbsp;color<br />&nbsp; &nbsp;cls<br />&nbsp; &nbsp;goto :EOF<br />) &gt; CON<br />set /A score+=points<br />if %score% gtr %bestScore% set bestScore=%score%<br />if not defined PS (<br />&nbsp; &nbsp;set &quot;scoreOut=&nbsp; &nbsp; %score%&quot;<br />&nbsp; &nbsp;set &quot;bestOut=&nbsp; &nbsp; %bestScore%&quot;<br />) else (<br />&nbsp; &nbsp;set &quot;scoreOut=ÿÿÿÿ%score%&quot;<br />&nbsp; &nbsp;set &quot;bestOut=ÿÿÿÿ%bestScore%&quot;<br />)<br />%PS% CursorPos 39 2<br />%PS% ColorChar /8F &quot;%scoreOut:~-5%&quot; 32 /F0 32x8 /8F &quot;%bestOut:~-6%&quot; 13 10<br />%PS% CursorPos 0 9<br />%PS% ColorChar /F0 32x3 /08 219x62&nbsp; 13 10<br />for /L %%i in (1,1,4) do (<br />&nbsp; &nbsp;for /L %%n in (1,1,5) do (<br />&nbsp; &nbsp; &nbsp; set &quot;numLine=/08 219x2&quot;<br />&nbsp; &nbsp; &nbsp; for /L %%j in (1,1,4) do for /F &quot;delims=&quot; %%k in (&quot;!board&#91;%%i,%%j&#93;!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;numLine=!numline! !num&#91;%%n,%%k&#93;! /08 219x2&quot;<br />&nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; %PS% ColorChar /F0 32x3 !numLine!&nbsp; 13 10<br />&nbsp; &nbsp;)<br />&nbsp; &nbsp;%PS% ColorChar /F0 32x3 /08 219x62&nbsp; 13 10<br />)<br /><br />:getKey&nbsp; &nbsp; &nbsp;Left Up&nbsp; Right Down Esc End&nbsp; &nbsp; &nbsp; Left&nbsp; &nbsp; &nbsp; &nbsp; Up&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Right&nbsp; &nbsp; &nbsp; &nbsp; Down&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;NewGame&nbsp; &nbsp; Exit<br />if not defined PS (<br />&nbsp; &nbsp;GetInput 293&nbsp; 294 295&nbsp; &nbsp;296&nbsp; 27&nbsp; 302&nbsp; /M&nbsp; 0 16 17 26&nbsp; 20 7 47 14&nbsp; 50 16 67 26&nbsp; 20 28 47 35&nbsp; 36 4 45 6&nbsp; 52 4 59 6<br />&nbsp; &nbsp;set &quot;option=!errorlevel!&quot;<br />) else (<br />&nbsp; &nbsp;set /P &quot;option=&quot; &amp; set /P &quot;=&quot;<br />)<br />if %option% gtr 4 goto option-%option%<br /><br />rem Assemble equivalent horizontal rows for move to left<br />for /L %%i in (1,1,4) do (<br />&nbsp; &nbsp;for /F &quot;tokens=1-4 delims=|&quot; %%a in (&quot;!map&#91;%option%,%%i&#93;!&quot;) do (<br />&nbsp; &nbsp; &nbsp; set &quot;row&#91;%%i&#93;=|!board&#91;%%a&#93;!|!board&#91;%%b&#93;!|!board&#91;%%c&#93;!|!board&#91;%%d&#93;!|&quot;<br />&nbsp; &nbsp;)<br />)<br />rem Move and merge tiles to left<br />call :moveLeft<br />rem Return moved tiles to their original positions in board<br />for /L %%i in (1,1,4) do (<br />&nbsp; &nbsp;for /F &quot;tokens=1-8 delims=|&quot; %%a in (&quot;!map&#91;%option%,%%i&#93;!!row&#91;%%i&#93;!&quot;) do (<br />&nbsp; &nbsp; &nbsp; set &quot;board&#91;%%a&#93;=%%e&quot; &amp; set &quot;board&#91;%%b&#93;=%%f&quot; &amp; set &quot;board&#91;%%c&#93;=%%g&quot; &amp; set &quot;board&#91;%%d&#93;=%%h&quot;<br />&nbsp; &nbsp;)<br />)<br />goto mainLoop<br /><br />:option-5 New game<br />goto newGame<br /><br />:option-6 Exit<br />if %maxTile% gtr 4 (<br />&nbsp; &nbsp;set points=0<br />&nbsp; &nbsp;for %%a in (score points maxTile) do echo %%a=!%%a!<br />&nbsp; &nbsp;set board&#91;<br />) &gt; 2048.dat<br />color<br />cls<br />if %bestScore% leq %lastBestScore% goto :EOF<br /><br />rem Save the new best score<br />setlocal DisableDelayedExpansion<br />(for /F &quot;usebackq delims=&quot; %%a in (&quot;%~F0&quot;) do (<br />&nbsp; &nbsp;set &quot;line=%%a&quot;<br />&nbsp; &nbsp;setlocal EnableDelayedExpansion&nbsp; &nbsp;<br />&nbsp; &nbsp;echo !line!<br />&nbsp; &nbsp;if &quot;!line!&quot; equ &quot;:getBestScore&quot; goto continue<br />&nbsp; &nbsp;endlocal<br />)) &gt; &quot;%~PN0.tmp&quot;<br />:continue<br />echo set bestScore=%bestScore%&gt;&gt; &quot;%~PN0.tmp&quot;<br />del &quot;%~F0&quot; &amp; ren &quot;%~PN0.tmp&quot; &quot;%~NX0&quot; &amp; goto :EOF<br /><br /><br />:moveLeft<br />set points=0<br />set &quot;anyHole=&quot;<br />for /L %%i in (1,1,4) do (<br />&nbsp; &nbsp;set &quot;row=!row&#91;%%i&#93;!&quot;<br />&nbsp; &nbsp;set &quot;d=&quot;<br />&nbsp; &nbsp;rem Eliminate empty places and move tiles to left<br />&nbsp; &nbsp;for /F &quot;tokens=1-4 delims=|&quot; %%a in (&quot;!row:|&nbsp; &nbsp; =!&quot;) do (<br />&nbsp; &nbsp; &nbsp; set &quot;a=%%a&quot; &amp; set &quot;b=%%b&quot; &amp; set &quot;c=%%c&quot; &amp; set &quot;d=%%d&quot;<br />&nbsp; &nbsp; &nbsp; rem Merge tiles with same number<br />&nbsp; &nbsp; &nbsp; if defined a (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if !a! equ !b! (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;a+=b, points+=a&quot; &amp; set &quot;b=!c!&quot; &amp; set &quot;c=!d!&quot; &amp; set &quot;d=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !a! gtr !maxTile! set maxTile=!a!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;a=&nbsp; &nbsp;!a!&quot; &amp; set &quot;row=|!a:~-4!|&quot;<br />&nbsp; &nbsp; &nbsp; ) else set &quot;row=|&nbsp; &nbsp; |&quot;<br />&nbsp; &nbsp; &nbsp; if defined b (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if !b! equ !c! (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;b+=c, points+=b&quot; &amp; set &quot;c=!d!&quot; &amp; set &quot;d=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !b! gtr !maxTile! set maxTile=!b!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;b=&nbsp; &nbsp;!b!&quot; &amp; set &quot;row=!row!!b:~-4!|&quot;<br />&nbsp; &nbsp; &nbsp; ) else set &quot;row=!row!&nbsp; &nbsp; |&quot;<br />&nbsp; &nbsp; &nbsp; if defined c (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if !c! equ !d! (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;c+=d, points+=c&quot; &amp; set &quot;d=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !c! gtr !maxTile! set maxTile=!c!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;c=&nbsp; &nbsp;!c!&quot; &amp; set &quot;row=!row!!c:~-4!|&quot;<br />&nbsp; &nbsp; &nbsp; ) else set &quot;row=!row!&nbsp; &nbsp; |&quot;<br />&nbsp; &nbsp; &nbsp; if defined d (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;row=!row!!d!|&quot; <br />&nbsp; &nbsp; &nbsp; ) else set &quot;row=!row!&nbsp; &nbsp; |&quot;<br />&nbsp; &nbsp;)<br />&nbsp; &nbsp;if not defined d set anyHole=true<br />&nbsp; &nbsp;set &quot;row&#91;%%i&#93;=!row!&quot;<br />)<br />exit /B<br /><br />:tileSpawn<br />set /A newI=%random% %% 4 + 1, newJ=!random! %% 4 + 1<br />if &quot;!board&#91;%newI%,%newJ%&#93;!&quot; neq &quot;&nbsp; &nbsp; &quot; goto tileSpawn<br />set /A newVal=%random% %% 10/9*2 + 2<br />set &quot;board&#91;%newI%,%newJ%&#93;=&nbsp; &nbsp;%newVal%&quot;<br />exit /B<br /><br />rem To reset the best score, modify the value below<br />:getBestScore<br />set bestScore=0<br /></code></pre></div><br /><br />PS - I did it!  <img class="smilies" src="images/smilies/icon_mrgreen.gif" alt=":mrgreen:" title="Mr. Green" /> The first image is the one 9 moves before the game end.<br /><br /><img src="../../i.imgur.com/0idUaQ9.png" class="postimage" alt="Image" />  <img src="../../i.imgur.com/dTiZ9v9.png" class="postimage" alt="Image" /><br /><br />Antonio</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p49517" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile49517">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist8aa8.html?mode=viewprofile&amp;u=3644" class="username">neorobin</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search971b.html?author_id=3644&amp;sr=posts">44</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 01 May 2012 12:18</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content49517">

						<h3 ><a href="#p49517">Re: Read arrow keys and show color text in an efficient way</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting1833.html?mode=quote&amp;f=3&amp;p=49517" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicbece.html?p=49517#p49517" onclick="prompt('Message #12',this.href); return false;">#12</a></span> 
									<a class="unread" href="viewtopicbece.html?p=49517#p49517" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist8aa8.html?mode=viewprofile&amp;u=3644" class="username">neorobin</a></strong> &raquo; </span>07 Oct 2016 04:23
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>Aacini wrote:</cite>:arrow: The second part of this application is ready <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" />  <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />  <img class="smilies" src="images/smilies/icon_cool.gif" alt="8)" title="Cool" /> <br /><strong class="text-strong">2016-04-12:</strong> Code modified to fix a synchronization problem and a bug when the window/buffer sizes are changed.<br /></div></blockquote><br /><br /><br />Aacini<br /><br />Nice effect! I like it!<br /><br />Your Tetris game code a bit long (  <!-- l --><a class="postlink-local" href="viewtopic5338.html?f=3&amp;t=6936&amp;p=46206#p46206">viewtopic.php?f=3&amp;t=6936&amp;p=46206#p46206</a><!-- l -->  ),<br /><br />so I can not easily find those special characters that used to display blocks and borders.<br /><br />My system is running the 936 code page,<br /><br />The copy code of the forum is UNICODE, there are some coding problems.<br /><br />please tell me, in the code, which lines have special display characters.<br /><br />In this way, I can do some modification,  so that it is good to run on 936 code page<br /><br />Thanks!</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p49528" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile49528">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content49528">

						<h3 ><a href="#p49528">Re: Read arrow keys and show color text in an efficient way</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting702e.html?mode=quote&amp;f=3&amp;p=49528" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic3094.html?p=49528#p49528" onclick="prompt('Message #13',this.href); return false;">#13</a></span> 
									<a class="unread" href="viewtopic3094.html?p=49528#p49528" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>07 Oct 2016 10:18
			</p>
			
			
			
			<div class="content">@neorobin:<br /><br />The characters used in the field frame are given in these lines (in PowerShell code):<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>121:&nbsp; &nbsp; &nbsp; Write-Host -NoNewLine (' '*2); Write-Host &quot;Ú$frame¿&quot;;&nbsp; ^<br />122:&nbsp; &nbsp; &nbsp; for ( $i=1; $i -le %lines%*$lnN; ++$i ) { Write-Host -NoNewLine (' '*2); Write-Host &quot;³$spc³&quot; }&nbsp; ^<br />123:&nbsp; &nbsp; &nbsp; Write-Host -NoNewLine (' '*2); Write-Host &quot;À$frameÙ&quot;;&nbsp; ^<br /><br />150:&nbsp; &nbsp;$frame = ''; $spc = ''; for ( $i=1; $i -le $col-6; ++$i ) { $frame+='Ä'; $spc+=' '; }&nbsp; ^<br /></code></pre></div><br />The characters used to draw the pieces are these ones:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>149:&nbsp; &nbsp;$ln = ( ('X'), ('Úª','ÀÙ'), ('ÚÄ¿','³ ³','ÀÄÙ') )&#91;$lnN-1&#93;;&nbsp; ^<br /></code></pre></div><br />Antonio</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p50965" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile50965">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist11f0.html?mode=viewprofile&amp;u=8073" class="username">IcarusLives</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search393f.php?author_id=8073&amp;sr=posts">92</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 17 Jan 2016 23:55</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content50965">

						<h3 ><a href="#p50965">Re: Read arrow keys and show color text in an efficient way</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingc1c9.html?mode=quote&amp;f=3&amp;p=50965" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic12eb.html?p=50965#p50965" onclick="prompt('Message #14',this.href); return false;">#14</a></span> 
									<a class="unread" href="viewtopic12eb.html?p=50965#p50965" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist11f0.html?mode=viewprofile&amp;u=8073" class="username">IcarusLives</a></strong> &raquo; </span>29 Jan 2017 11:51
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>Aacini wrote:</cite><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />:Output<br />rem Parameters received via lines read have one of these three forms:<br />rem - cls<br />rem - CursorPos X Y<br />rem - ColorChar standard parameters of ColorChar.exe auxiliary program<br />PowerShell&nbsp; ^<br />&nbsp; &nbsp;$console = $Host.UI.RawUI;&nbsp; ^<br />&nbsp; &nbsp;$console.WindowTitle = '2048 game by Aacini';&nbsp; ^<br />&nbsp; &nbsp;$curSize = $console.CursorSize;&nbsp; ^<br />&nbsp; &nbsp;$console.CursorSize = 0;&nbsp; ^<br />&nbsp; &nbsp;$coords = $console.CursorPosition;&nbsp; ^<br />&nbsp; &nbsp;foreach ( $line in $input ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; $Prog,$Params = $line.Split(' ',&#91;StringSplitOptions&#93;::RemoveEmptyEntries);&nbsp; ^<br />&nbsp; &nbsp; &nbsp; if ( $Prog -eq 'cls' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cls&nbsp; ^<br />&nbsp; &nbsp; &nbsp; } elseif ( $Prog -eq 'CursorPos' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$coords.X = &#91;int&#93;$Params&#91;0&#93;;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$coords.Y = &#91;int&#93;$Params&#91;1&#93;;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$console.CursorPosition = $coords;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; } elseif ( $Prog -eq 'ColorChar' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;while ( $Params ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $Param,$Params = $Params;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if ( $Param&#91;0&#93; -eq '/' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$color = &#91;int&#93;('0x'+$Param.substring(1));&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$back = $color -shr 4; $fore = $color%%16;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif ( $Param&#91;0&#93; -eq '\^&quot;' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Write-Host -BackgroundColor $back -ForegroundColor $fore -NoNewLine $Param.substring(1,$Param.length-2);&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } elseif ( $Param -eq '13' ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Write-Host;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;$Params = '';&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; } else {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&#91;int&#93;$code,&#91;int&#93;$times = $Param.Split('x');&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( -not $times ) { $times = 1 }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if ( $code -ne 219 ) {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $str = &#91;string&#93;&#91;char&#93;$code * $times;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write-Host -BackgroundColor $back -ForegroundColor $fore -NoNewLine $str;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;} else {&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $str = ' ' * $times;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Write-Host -BackgroundColor $fore -ForegroundColor $back -NoNewLine $str;&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp; &nbsp; }&nbsp; ^<br />&nbsp; &nbsp;}&nbsp; ^<br />&nbsp; &nbsp;$console.CursorSize = $curSize;<br />%End PowerShell%<br />exit /B<br /></code></pre></div><br />Antonio</div></blockquote><br /><br />Hello Aacini,<br /><br />I'm really interested how this code here works. This is your :Output from the 2048 game you posted where you could use PS or aux interchangeably. I'm unfamiliar with powershell, but I love how it is much more efficient at displaying colors than batch. I'm rather curious how I could utilize this for my own projects. I just had some questions <img class="smilies" src="images/smilies/icon_razz.gif" alt=":P" title="Razz" /><br /><br />How does this work? Does it accept arguments? I saw you were multi-threading it, so perhaps it collects data from :Main elsewhere? How would you go about this for more casual use? I'm unsure if I'm asking the right questions, but this would be extremely useful for me to learn. Thank you <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p50983" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile50983">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content50983">

						<h3 ><a href="#p50983">Re: Read arrow keys and show color text in an efficient way</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting55a5.html?mode=quote&amp;f=3&amp;p=50983" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic688d.html?p=50983#p50983" onclick="prompt('Message #15',this.href); return false;">#15</a></span> 
									<a class="unread" href="viewtopic688d.html?p=50983#p50983" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>30 Jan 2017 15:21
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>IcarusLives wrote:</cite>Hello Aacini,<br /><br />I'm really interested how this code here works. This is your :Output from the 2048 game you posted where you could use PS or aux interchangeably. I'm unfamiliar with powershell, but I love how it is much more efficient at displaying colors than batch. I'm rather curious how I could utilize this for my own projects. I just had some questions <img class="smilies" src="images/smilies/icon_razz.gif" alt=":P" title="Razz" /><br /><br />How does this work? Does it accept arguments? I saw you were multi-threading it, so perhaps it collects data from :Main elsewhere? How would you go about this for more casual use? I'm unsure if I'm asking the right questions, but this would be extremely useful for me to learn. Thank you <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div></blockquote><br /><br />I am afraid I don't fathom out what exactly is your question. All my programs have plenty of remarks that describe all aspects related to the code.<br /><br />The 2048.bat game is the 6th program posted in this thread. The first three programs are examples of how use the communication with a small PowerShell code segment, that was started at left side of a pipe, to read input keys from it. The 4th example is my Tetris.bat program that was modified in the same way (to read input keys from PowerShell code), although in this case the PS segment is much larger. The line that starts the communication in this Tetris.bat version 2.0 is this:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&quot;%~F0&quot; Input &gt;&gt; pipeFile.txt&nbsp; |&nbsp; &quot;%~F0&quot; Main &lt; pipeFile.txt<br /></code></pre></div><br />The next example is Tetris.bat game again, but this time it uses <em class="text-italics">two</em> simultaneous PowerShell code segments: one to read input keys as before, and another one to show text in color. The communication between Batch code and the PowerShell segments is done via pipes like before, that is, the Input PS code is placed at left side of a pipe and the Output PS code is placed at right side of a pipe. This is the line that starts the whole process:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&quot;%~F0&quot; Input &gt;&gt; pipeFile.txt&nbsp; |&nbsp; &quot;%~F0&quot; Main &lt; pipeFile.txt&nbsp; |&nbsp; &quot;%~F0&quot; Output<br /></code></pre></div><br />This means that the Output PowerShell code segment read lines via its Stdin and takes the parameters needed to show text from they; these parameters are described in the code, for example: &quot;cls&quot;, &quot;del&quot;, etc. In this way, when the Batch code needs to request an action from the Output PS segment, it just needs to output the desired command via its Stdout like in these parts:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp;if defined init (<br />&nbsp; &nbsp; &nbsp; setlocal EnableDelayedExpansion<br />&nbsp; &nbsp; &nbsp; set &quot;init=&quot;<br />&nbsp; &nbsp; &nbsp; echo cls<br /><br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem Blink completed lines on screen<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for %%i in (!j!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo 1,%%i,=,%cols%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)<br /></code></pre></div><br />The next example is the 2048.bat program. This game is entirely similar to the last version of Tetris.bat with two differences: 2048.bat is not an <em class="text-italics">animated game</em>, but a static one that waits until the user press a key to react, so the Input part don't needs to be a non-blocking one. In this case the game is started this way:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&quot;%~F0&quot; Input&nbsp; |&nbsp; &quot;%~F0&quot; Main&nbsp; |&nbsp; &quot;%~F0&quot; Output<br /></code></pre></div><br />The second difference is that the commands given to the Output part have the same format of the auxiliaty .exe programs that was originally used for the same task; this point is described with detail in the text.<br /><br />So?<br /><br />Antonio</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
	

	<div class="action-bar bar-bottom">
	
			<a href="posting7657-2.html?mode=reply&amp;f=3&amp;t=6936" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
		
		<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic8cff.html?f=3&amp;t=6936&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>

			<form method="post" action="https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=6936">
		<div class="dropdown-container dropdown-container-left dropdown-button-control sort-tools">
	<span title="Display and sorting options" class="button button-secondary dropdown-trigger dropdown-select">
		<i class="icon fa-sort-amount-asc fa-fw" aria-hidden="true"></i>
		<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
	</span>
	<div class="dropdown hidden">
		<div class="pointer"><div class="pointer-inner"></div></div>
		<div class="dropdown-contents">
			<fieldset class="display-options">
							<label>Display: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
								<label>Sort by: <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label>
				<label>Direction: <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select></label>
								<hr class="dashed" />
				<input type="submit" class="button2" name="sort" value="Go" />
						</fieldset>
		</div>
	</div>
</div>
		</form>
	
	
	
			<div class="pagination">
			16 posts
							<ul>
		<li class="active"><span>1</span></li>
				<li><a class="button" href="viewtopic7a33.html?f=3&amp;t=6936&amp;start=15" role="button">2</a></li>
				<li class="arrow next"><a class="button button-icon-only" href="viewtopic7a33.html?f=3&amp;t=6936&amp;start=15" rel="next" role="button"><i class="icon fa-chevron-right fa-fw" aria-hidden="true"></i><span class="sr-only">Next</span></a></li>
	</ul>
					</div>
	</div>


<div class="action-bar actions-jump">
		<p class="jumpbox-return">
		<a href="viewforum4d6b.html?f=3" class="left-box arrow-left" accesskey="r">
			<i class="icon fa-angle-left fa-fw icon-black" aria-hidden="true"></i><span>Return to “DOS Batch Forum”</span>
		</a>
	</p>
	
		<div class="jumpbox dropdown-container dropdown-container-right dropdown-up dropdown-left dropdown-button-control" id="jumpbox">
			<span title="Jump to" class="button button-secondary dropdown-trigger dropdown-select">
				<span>Jump to</span>
				<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
			</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																				<li><a href="viewforum31e6.html?f=4" class="jumpbox-cat-link"> <span> DosTips - Dos Batch</span></a></li>
																<li><a href="viewforum4d6b.html?f=3" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; DOS Batch Forum</span></a></li>
											</ul>
		</div>
	</div>

	</div>


			</div>


<div id="page-footer" class="page-footer" role="contentinfo">
	<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-footer" class="nav-footer linklist" role="menubar">
		<li class="breadcrumbs">
							<span class="crumb"><a href="../index.html" data-navbar-reference="home"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span>DosTips.com</span></a></span>									<span class="crumb"><a href="index.html" data-navbar-reference="index"><span>Board index</span></a></span>					</li>
		
				<li class="rightside">All times are <span title="UTC-6">UTC-06:00</span></li>
							<li class="rightside">
				<a href="ucp033a.html?mode=delete_cookies" data-ajax="true" data-refresh="true" role="menuitem">
					<i class="icon fa-trash fa-fw" aria-hidden="true"></i><span>Delete all board cookies</span>
				</a>
			</li>
												<li class="rightside" data-last-responsive="true">
				<a href="memberlist4bfd.html?mode=team" role="menuitem">
					<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
				</a>
			</li>
									<li class="rightside" data-last-responsive="true">
				<a href="memberlist8733.html?mode=contactadmin" role="menuitem">
					<i class="icon fa-envelope fa-fw" aria-hidden="true"></i><span>Contact us</span>
				</a>
			</li>
			</ul>

	</div>
</div>

	<div class="copyright">
				<!-- WARNING NO DELETE -->Style developer by <a href="http://tricolor.x-tk.ru/">support forum tricolor</a>, <!-- END WARNING NO DELETE -->Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
									</div>

	<div id="darkenwrapper" class="darkenwrapper" data-ajax-error-title="AJAX error" data-ajax-error-text="Something went wrong when processing your request." data-ajax-error-text-abort="User aborted request." data-ajax-error-text-timeout="Your request timed out; please try again." data-ajax-error-text-parsererror="Something went wrong with the request and the server returned an invalid reply.">
		<div id="darken" class="darken">&nbsp;</div>
	</div>

	<div id="phpbb_alert" class="phpbb_alert" data-l-err="Error" data-l-timeout-processing-req="Request timed out.">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<h3 class="alert_title">&nbsp;</h3><p class="alert_text"></p>
	</div>
	<div id="phpbb_confirm" class="phpbb_alert">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<div class="alert_text"></div>
	</div>
</div>

</div>

<div>
	<a id="bottom" class="anchor" accesskey="z"></a>
	<img src="cronc6bf.gif?cron_type=cron.task.text_reparser.user_signature" width="1" height="1" alt="cron" /></div>

<script type="text/javascript" src="assets/javascript/jquery.mind772.js?assets_version=34"></script>
<script type="text/javascript" src="assets/javascript/cored772.js?assets_version=34"></script>



<script type="text/javascript" src="styles/prosilver/template/forum_fnd772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/prosilver/template/ajaxd772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/AllanStyle-SUBSILVER/template/jquery-uid772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/AllanStyle-SUBSILVER/template/collapsed772.js?assets_version=34"></script>



</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=6936 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:23:15 GMT -->
</html>
