<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=8594&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 07:06:02 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>DosTips.com &bull; Need help in amending a script.</title>

<link href="styles/AllanStyle-SUBSILVER/theme/print.css" rel="stylesheet">
</head>
<body id="phpbb">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>DosTips.com</h1>
		<p>A Forum all about DOS Batch<br /><a href="index-2.html">https://www.dostips.com/forum/</a></p>

		<h2>Need help in amending a script.</h2>
		<p><a href="viewtopic98e8.html?f=3&amp;t=8594">https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=8594</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>2</strong></div>
					<div class="post">
				<h3>Need help in amending a script.</h3>
				<div class="date">Posted: <strong>28 May 2018 10:00</strong></div>
				<div class="author">by <strong>tweacle</strong></div>
				<div class="content">Hi<br>
<br>
I have the following script that moves stuff from C:\Downloads\BTP to S:\BTP DOWNLOADS  and also from C:\Downloads to S:\DOWNLOADS<br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off &amp;setlocal DisableDelayedExpansion
for /f "delims=" %%i in ('dir /ad /b "C:\Downloads\BTP*"') do robocopy "C:\Downloads\%%i" "S:\BTP DOWNLOADS\%%i" /s /e /move /r:1 /w:1
for /f "delims=" %%i in ('dir /ad /b "C:\Downloads\*"') do robocopy "C:\Downloads\%%i" "S:\DOWNLOADS\%%i" /s /e /move /r:1 /w:1</code></pre></div>

Im trying to amend it to look in C:\Downloads and if subfolder name starts with the letters BTP then I need it moving to S:\BTP DOWNLOADS and if not then I need the folder moving to S:\DOWNLOADS<br>
<br>
Any ideas.<br>
<br>
Thanks</div>
			</div>
			<hr />
					<div class="post">
				<h3>A Simple move file command help</h3>
				<div class="date">Posted: <strong>29 May 2018 06:41</strong></div>
				<div class="author">by <strong>tweacle</strong></div>
				<div class="content">Hi <br>
<br>
Im totally baffled after looking on the net at all the options avail.<br>
<br>
What im trying to do is set up a .VBS command to move files that start with the name BTP in C:\Documents into S:\Documents .<br>
<br>
Trouble is that the file will always start with the letters BTP but will then have different numbers after it.<br>
<br>
Any Ideas.<br>
<br>
Thanks</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Need help in amending a script.</h3>
				<div class="date">Posted: <strong>29 May 2018 09:27</strong></div>
				<div class="author">by <strong>MarioZac</strong></div>
				<div class="content">Pls add <em class="text-italics">exit /b</em> to the end of your batch, and then post errors printed in open Cmd Window, when running your current batch from that window?<br>
<br>
Pls post examples of <strong class="text-strong">full file names</strong> moved with your current script, and compare them to examples of full file names that were NOT moved, but you expect the script to move.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Need help in amending a script.</h3>
				<div class="date">Posted: <strong>30 May 2018 11:27</strong></div>
				<div class="author">by <strong>tweacle</strong></div>
				<div class="content">Apologies but I got myself confused. <br>
<br>
I have now created this command of which 90% of what I need it to do.<br>
<br>
@echo off<br>
setlocal<br>
set source=C:\Users\g\Documents<br>
set dest=C:\Users\g\Documents\btp<br>
set prefix=B<br>
<br>
for /f "tokens=*" %%a in ('dir /b "%source%\%prefix%*"') do (echo Moving "%%a"<br>
   xcopy "%source%\%%a\*.*" "%dest%\%%a\" /s /h /k /c /y<br>
   rd "%source%\%%a" /q /s)<br>
<br>
echo Done. <br>
<br>
It moves all the folders that start with the prefix "B"  but  im having to 7zip and password protect the folder BEFORE moving.   It then dont recognise the folder although the name still starts with the prefix "B"   .  I think its because 7zip is a .EXE file . Is there anyway the script can be amended??<br>
<br>
Thanks</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Need help in amending a script.</h3>
				<div class="date">Posted: <strong>30 May 2018 11:52</strong></div>
				<div class="author">by <strong>MarioZac</strong></div>
				<div class="content">Your task is now changed beyond recognition.  <img class="smilies" src="images/smilies/icon_biggrin.gif" width="15" height="15" alt=":D" title="Very Happy">  Where is your archiving code snippet?<br>
<br>
If %%a looks like x.7zip , and you try to copy %%a\*.* , which means x.7zip\*.* , would you expect XCOPY to look inside each 7zip archive? Try <em class="text-italics">xcopy "%source%\%%a" "%dest%\%%a"</em>  - any issues?</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Need help in amending a script.</h3>
				<div class="date">Posted: <strong>30 May 2018 11:57</strong></div>
				<div class="author">by <strong>tweacle</strong></div>
				<div class="content">will give that a try  thanks</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Need help in amending a script.</h3>
				<div class="date">Posted: <strong>30 May 2018 13:59</strong></div>
				<div class="author">by <strong>tweacle</strong></div>
				<div class="content">Sorry I think im confusing you after trying that. Let me try and explain simpler.<br>
<br>
I have a file that I have 7 zipped and password protected separately and thats fine.<br>
<br>
The code shown below is to move documents to C:\Users\g\Documents\btp  BEFORE the file is zipped and password protected but what im trying to do is move it AFTER it zipped and password protected.<br>
<br>
I believe that the reason it is not moving after it zipped etc is due to it being an application .exe file rather than a folder. Im trying to find out if I can amend below so that it looks for .exe files that start with the prefix B  and move them.<br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off
setlocal
set source=C:\Users\g\Documents
set dest=C:\Users\g\Documents\btp
set prefix=B

for /f "tokens=*" %%a in ('dir /b "%source%\%prefix%*"') do (echo Moving "%%a"
xcopy "%source%\%%a\*.*" "%dest%\%%a\" /s /h /k /c /y
rd "%source%\%%a" /q /s)

echo Done. </code></pre></div>

Thanks</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Need help in amending a script.</h3>
				<div class="date">Posted: <strong>30 May 2018 20:29</strong></div>
				<div class="author">by <strong>MarioZac</strong></div>
				<div class="content">Pls READ above <a href="viewtopic102a.html?p=57000#p57000" class="postlink">post</a> #5. Try modifying your script as suggested, then report any errors printed in open Cmd window or discovered.  <img class="smilies" src="images/smilies/icon_biggrin.gif" width="15" height="15" alt=":D" title="Very Happy"> <br>
<br>
<br>
<span style="text-decoration: underline">UPDATE</span>: The error the modified code prints: <em class="text-italics">Cannot perform a cyclic copy</em>. If the code doesn't work as expected, add Exit /b at the end and debug it in an open Cmd Prompt window to see variable values and errors it prints. Did you ever try that? What Google suggests for that error if you do the search: "<em class="text-italics">for Xcopy place the destination folder outside of the source folder. Or use Robocopy with /xd switch to exclude the destination folder from being recursively copied</em>".</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Need help in amending a script.</h3>
				<div class="date">Posted: <strong>31 May 2018 10:49</strong></div>
				<div class="author">by <strong>MarioZac</strong></div>
				<div class="content">Try this script.<br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off
setlocal
set "source=O:\Temp\Other" &amp; set "dest=O:\Temp\Other\btp" &amp; set "prefix=B"
for /d %%B in ("%dest%") do set "fold=%%~nxB"
for /f "tokens=*" %%a in ('dir /b "%source%\%prefix%*"') do ( echo Moving "%%a"
	if exist "%source%\%%a\" ( xcopy "%source%\%%a" "%dest%\%%a" /s /h /k /c /y /i &amp; if not %%a==%fold% rd "%source%\%%a" /q /s 
	) else ( xcopy "%source%\%%a" "%dest%\Files\%%a*" /c /y /i &amp; del %source%\%%a ) 
)
endlocal
exit /b
</code></pre></div></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Need help in amending a script.</h3>
				<div class="date">Posted: <strong>02 Jun 2018 05:13</strong></div>
				<div class="author">by <strong>tweacle</strong></div>
				<div class="content">Tried your last suggestion  MarioZac and get error message  enviorment variable C:\CCTV DOWNLOADS\BTP DOWNLOADS not defined and then it tries to moved file and finishes but dont actually move anything.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Need help in amending a script.</h3>
				<div class="date">Posted: <strong>02 Jun 2018 06:19</strong></div>
				<div class="author">by <strong>tweacle</strong></div>
				<div class="content">Ignore my comments about not defined as sorted that but is there anyway I can add to this script so if file dont start with prefix "B" I need it moved to "O:\Temp\Other\Other"<br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off
setlocal
set "source=O:\Temp\Other" &amp; set "dest=O:\Temp\Other\btp" &amp; set "prefix=B"
for /d %%B in ("%dest%") do set "fold=%%~nxB"
for /f "tokens=*" %%a in ('dir /b "%source%\%prefix%*"') do ( echo Moving "%%a"
	if exist "%source%\%%a\" ( xcopy "%source%\%%a" "%dest%\%%a" /s /h /k /c /y /i &amp; if not %%a==%fold% rd "%source%\%%a" /q /s 
	) else ( xcopy "%source%\%%a" "%dest%\Files\%%a*" /c /y /i &amp; del %source%\%%a ) 
)
endlocal
exit /b</code></pre></div></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Need help in amending a script.</h3>
				<div class="date">Posted: <strong>02 Jun 2018 09:09</strong></div>
				<div class="author">by <strong>MarioZac</strong></div>
				<div class="content">There are always ways to do simple file operations in a batch. This forum is learning environment. You seems to be learning now how to check a batch code for execution errors. What is your extra code version? What errors does it give?<br>
<br>
Hint: consider setting Dest1 and Dest2 variables, and extra FOR and/or IF enclosed commands. Also, if you copy from C:\ to O:\, the script can be simplified as source folder is different from the destination folder. But my code version is more universal to cover your evolving and well hidden moving goals.  <img class="smilies" src="images/smilies/icon_biggrin.gif" width="15" height="15" alt=":D" title="Very Happy"><br>
<br>
Also, consider renaming this forum thread to "Conditionally move disk content" or such to help others with similar task to find it.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Conditionally move disk content</h3>
				<div class="date">Posted: <strong>02 Jun 2018 12:08</strong></div>
				<div class="author">by <strong>tweacle</strong></div>
				<div class="content">Thanks for boost but I think that im not totally compitent yet by a long way.<br>
<br>
What I need is after all the files that have moved that have a prefix "B" I need the rest of the files regardless of name to be moved to Other1.  It just  downloading into O:\Temp\Other and then need to save into O:\Temp\Other\btp if letter starts with "B" and O:\Temp\Other\Other1 for everything else. <br>
<br>
Im thinking like this as second one??  I think I would be OK running as 2 seperate items but trying to get to run as one.<br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off
setlocal
set "source=O:\Temp\Other" &amp; set "dest=O:\Temp\Other\Other1"  
for /d %%B in ("%dest%") do set "fold=%%~nxB"
for /f "tokens=*" %%a in ('dir /b "%source%\%prefix%*"') do ( echo Moving "%%a"
	if exist "%source%\%%a\" ( xcopy "%source%\%%a" "%dest%\%%a" /s /h /k /c /y /i &amp; if not %%a==%fold% rd "%source%\%%a" /q /s 
	) else ( xcopy "%source%\%%a" "%dest%\Files\%%a*" /c /y /i &amp; del %source%\%%a ) 
)
endlocal</code></pre></div></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Need help in amending a script.</h3>
				<div class="date">Posted: <strong>02 Jun 2018 21:59</strong></div>
				<div class="author">by <strong>MarioZac</strong></div>
				<div class="content"><blockquote><div><cite><a href="memberlist8291.html?mode=viewprofile&amp;u=9155">tweacle</a> wrote: <a href="viewtopicf04f.html?p=57045#p57045" data-post-id="57045" onclick="if(document.getElementById(hash.substr(1)))href=hash">â†‘</a><div class="responsive-hide">02 Jun 2018 12:08</div></cite>
im not totally compitent yet by a long way.
</div></blockquote>
Never will be if not trying to do things yourself. Do you need to move only remaining files to Other1, or also remaining folders somewhere else? Your appetite for moving things grows by an hour.  <img class="smilies" src="images/smilies/icon_biggrin.gif" width="15" height="15" alt=":D" title="Very Happy"><br>
<br>
To change the topic title, you need to edit the 1st post title.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Need help in amending a script.</h3>
				<div class="date">Posted: <strong>03 Jun 2018 02:10</strong></div>
				<div class="author">by <strong>tweacle</strong></div>
				<div class="content">Aaaahhhh right.   I need to move remaining folders</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="UTC-6">UTC-06:00</span><br />Page <strong>1</strong> of <strong>2</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Limited<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=8594&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 07:06:02 GMT -->
</html>
