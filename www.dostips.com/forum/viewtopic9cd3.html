<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=7617&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 07:58:44 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>DosTips.com &bull; Renaming recursively files with alphabetical order</title>

<link href="styles/AllanStyle-SUBSILVER/theme/print.css" rel="stylesheet">
</head>
<body id="phpbb">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>DosTips.com</h1>
		<p>A Forum all about DOS Batch<br /><a href="index-2.html">https://www.dostips.com/forum/</a></p>

		<h2>Renaming recursively files with alphabetical order</h2>
		<p><a href="viewtopic86ef.html?f=3&amp;t=7617">https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=7617</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>2</strong></div>
					<div class="post">
				<h3>Renaming recursively files with alphabetical order</h3>
				<div class="date">Posted: <strong>15 Dec 2016 18:42</strong></div>
				<div class="author">by <strong>crazyroot</strong></div>
				<div class="content">Hello again,<br /><br />Like I said in JREN topic, I'm trying to rename recursively files with alphabetical order to give a right order to a car radio. I need to have incrementing continued beacause tha car radio mix all songs. My code is like this :<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set zero=000<br />REM for /f &quot;delims=&quot; %%a in ('dir &quot;E:\&quot; /b /o:n') do (<br />for /r &quot;E:\&quot;&nbsp; %%a in (.) do (<br />&nbsp;pushd &quot;%%a&quot;<br />&nbsp; &nbsp; for /f &quot;delims=&quot; %%j in ('dir /b/a-d/on ^| findstr /ile &quot;.flac .mp3&quot;') do set VrOldName=%%j&amp; set VrFile=%%~nxj&amp; set /a Nincr+=1&amp; call :renaming<br />&nbsp; popd)<br />:renaming<br />if /i %Nincr% GTR 9 set zero=00<br />if /i %Nincr% GTR 99 set zero=0<br />if /i %Nincr% GTR 999 set zero=<br />ren &quot;%VrOldName%&quot; &quot;%zero%%Nincr%_%VrFile%&quot;</code></pre></div><br /><br />I still didn't find how to get the right order for directories as for /r doesn't sort like 'dir &quot;E:\&quot; /b /o:n'.<br /><br />Also, jren.bat would almost work except the incrementing and ordering problems. I tried of course :<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp;jren &quot;(.*)(\.mp3|\.flac)$&quot; &quot;$n+'_'+$1+$2&quot; /nbeg 1 /npad 4 /j /i /s /pm &quot;/p:**&quot;</code></pre></div><br /><br />So, if you can give me some alternatives, I would be very happy <img class="smilies" src="images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br />Cheers<br /><br />EDIT : jren v2.7 and its /nkeep option solved incrementing problem, BIG THANKS to Dave !!</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Renaming recursively files with alphabetical order</h3>
				<div class="date">Posted: <strong>21 Dec 2016 13:45</strong></div>
				<div class="author">by <strong>crazyroot</strong></div>
				<div class="content">Hello,<br /><br />I'm still stucked with the sorting problem (folders and files in alphabetical order).<br />Reading other topics here I saw some of you proposing powershell which I have never used but by searching a little maybe it's the best tool for my problem ?<br />Something like : <br /><br />Get-Childitem E:\ |<br />    Foreach-object {<br />    $a=$_.FullName<br />    $a2=$_.BaseName<br />    $b=<span style="color: #FF0000">something_that_increments_with_pad_4()</span>+$a2<br />    Rename-Item -path $a -NewName $b<br />        }<br /><br />With option -whatif which is really cool for testing. But I have many holes here : recurse subfolders, filters .mp3 and .flac, sorting folders, sorting files <br />As I had no luck with dos, maybe a big powershell loving heart here can help me <img class="smilies" src="images/smilies/icon_wink.gif" alt=";)" title="Wink" /> ?<br /><br />Thanks and cheers<br /><br />PS : maybe this could be closer?<br />Dir E:\*.mp3 *.flac -recurse | rename-item -newname { [io.path]::<span style="color: #FF0000">something_that_increments_with_pad_4()</span>+GetFileName() }</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Renaming recursively files with alphabetical order</h3>
				<div class="date">Posted: <strong>21 Dec 2016 16:49</strong></div>
				<div class="author">by <strong>ShadowThief</strong></div>
				<div class="content"><blockquote><div><cite>crazyroot wrote:</cite>I'm trying to rename recursively files</div></blockquote><br />You're trying to do what now?</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Renaming recursively files with alphabetical order</h3>
				<div class="date">Posted: <strong>21 Dec 2016 17:42</strong></div>
				<div class="author">by <strong>crazyroot</strong></div>
				<div class="content">Hi ShadowThief,<br /><br />Well still the same, I have a car radio that needs songs to be renamed but I want to keep the original order of songs (usually named 01. title1.mp3, 02 title2.mp3 etc) and it's the same with folders to keep the orders of artists and albums :<br />01. 1st artist<br />---------------01. 1st album of the 1st artist<br />---------------02. 2nd album of the 1st artist<br />--------------- ....<br />02. 2nd artist<br />---------------01. 1st album of the 2nd artist<br />---------------02. 2nd album of the 2nd artist<br />--------------- ....<br /><br />The dos solution is almost OK on my post above, only folders are not sorted.<br />The jren 2.7 solution is OK with incrementing but folders are not sorted and even it's same with the files (regular expression cannot be sorted)<br />As noone has answered, I turned my attention to powershell but not knowing enough to conclude <img class="smilies" src="images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />Hope I was clear enough, sorry for my bad english.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Renaming recursively files with alphabetical order</h3>
				<div class="date">Posted: <strong>25 Dec 2016 14:23</strong></div>
				<div class="author">by <strong>crazyroot</strong></div>
				<div class="content">Merry Christmas to all members of dos-community <img class="smilies" src="images/smilies/icon_wink.gif" alt=";)" title="Wink" /></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Renaming recursively files with alphabetical order</h3>
				<div class="date">Posted: <strong>26 Dec 2016 11:04</strong></div>
				<div class="author">by <strong>pieh-ejdsch</strong></div>
				<div class="content">Hello crazyroot,<br /><br />Rekursive renaming of files and folders can occur only from the deepest folder.<br />Otherwise renamed folders do not exist any more -<br />- files are not found any more or in easy forLoop several flows are made.<br /><br />A list must be provided and according to sorted.<br />with the help of this list the files and folders must be renamed.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>setlocal<br />set process=@echo ren<br />::set process=ren<br />set prompt=$g$s<br />set &quot;Folder=e:\Music&quot; <br />for /f &quot;delims= &quot; %%T in ('robocopy /L . . /njh /njs')do set &quot;TAB=%%T&quot;<br />for /f &quot;tokens=*delims=1&quot; %%x in ('<br />&nbsp;((for /l %%n in (1 1 9998^) do @echo :^) ^&amp;robocopy /L /s /njh &quot;%Folder%\.&quot; &quot;.. ListOnly ..\.&quot; *.mp3 *.flac /fp /ns /nc /njs ^) ^<br />&nbsp;^|find &quot;:&quot; ^|findstr /n :\\ ^|findstr /b .....: ^|sort /r<br />&nbsp;')do @for /f &quot;tokens=1*delims=:%tab% &quot; %%o in (&quot;%%x.&quot; )do %process% &quot;%%p&quot; &quot;%%o_%%~nxp&quot;<br /><br />pause</code></pre></div><br /><br />[edit]<br />I have inserted afterwards the tabulator in the Script, he was eaten by the browser.<br />[/edit]<br /><br />[edit2]<br />To create the prezeros automatically the smallest possible number of the preliminary lines is calculated.<br />Now for it a temporary file is used.<br />The echo is switched on before the last ForLoop, so that the command of renaming is also visible. <br />The count of the files and folders now occurs through the redirected output of Robocopy.<br />At the same time the temporary file with the same information is created.<br />If Robocopy error generates, these are indicated.<br />[/edit2]<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal<br />set &quot;process=@echo ren&quot;<br />rem set process=ren<br />set &quot;Folder=d:\Music&quot;<br />set &quot;Files=*.mp3 *.flac&quot;<br /><br />&nbsp;rem END Settings<br />set prompt=$g$s<br />for /f &quot;delims= &quot; %%T in ('robocopy /L . . /njh /njs')do set &quot;TAB=%%T&quot;<br />set &quot;tempf=%temp%\RC_%time::=%&quot;<br />for /f %%c in ('<br />&nbsp;robocopy /L /s /njh &quot;%Folder%\.&quot; &quot;.. ListOnly ..\.&quot; %files% /fp /ns /nc /njs /log:&quot;%tempf%&quot; /tee ^|find /c &quot;%tab%&quot;<br />&nbsp;')do set /a C=%%c<br />set/as=1<br />&lt;&quot;%tempf%&quot; (for /f &quot;Delims=:&quot; %%c in ('find &quot;%tab%&quot;^|findstr /n .^|findstr &quot;^10*\&gt;&quot;')do set /a S=%%c,N=%%c+c,B=N/S)<br />for /l %%n in (0 %S% %N%)do set/a E=10*%%n-2<br />@echo on<br />@ &lt;&quot;%tempf%&quot; (<br />for /f &quot;tokens=*delims=%B%&quot; %%x in (<br />&nbsp;' ((for /l %%n in (1 1 %E%^)do @echo -^) ^&amp;find &quot;%tab%&quot; ^)^|findstr /n : ^|findstr /b %B% ^|sort /r<br />&nbsp;')do @for /f &quot;tokens=1*delims=:%tab% &quot; %%o in (&quot;%%x.&quot; )do %process% &quot;%%p&quot; &quot;%%o_%%~nxp&quot;<br />) ||&gt;&amp;2 type &quot;%tempf%&quot;<br />@echo off<br />pause<br />exit /b</code></pre></div><br /><br />Phil</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Renaming recursively files with alphabetical order</h3>
				<div class="date">Posted: <strong>27 Dec 2016 12:17</strong></div>
				<div class="author">by <strong>crazyroot</strong></div>
				<div class="content">Wow Phil, thank you very much, your code is beautiful !<br />I didn't know robocopy was so powerfull, I'm very impressed. <br />Also, your loops and pipelines are great, you even renamed the folders by keeping alphabetical order, really fabulous !<br />I haven't still understand how everything works, but I will look it closer.<br />Thank you again I'm very happy with this !<br />Big hugs !!</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Renaming recursively files with alphabetical order</h3>
				<div class="date">Posted: <strong>29 Dec 2016 05:19</strong></div>
				<div class="author">by <strong>crazyroot</strong></div>
				<div class="content">I have just discovered the 2nd version, thank you so much Phil !<br /><br />Is it possible to make some changes in 2nd version in order to : <br /><br />1. increment folders independentely from files with pad=2, starting by 01 for folders and pad=4, starting by 0001 for MusicFiles<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>ex : 01_Folder1, 02_Folder2,... /// 0001_MusicFile1, 0002_MusicFile2...</code></pre></div><br /><br />2. do not increment subfolders (stay with the same number) while there are zero MusicFile inside :<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>ex :<br />&nbsp; &nbsp;04_FolderTitleArtist<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|_&nbsp; &nbsp; 04_SubFolderTitleAlbum<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|_&nbsp; &nbsp;05_AlbumCD1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000n_MusicFilex1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000n+1_MusicFilex2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ....<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|_&nbsp; &nbsp;06_AlbumCD2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000m_MusicFiley1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 000m+1_MusicFiley2<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ....<br /></code></pre></div><br /><br />Thank you again for your awesome work !</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Renaming recursively files with alphabetical order</h3>
				<div class="date">Posted: <strong>29 Dec 2016 19:09</strong></div>
				<div class="author">by <strong>pieh-ejdsch</strong></div>
				<div class="content">you want so<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo OFF<br />setlocal<br />set &quot;process=@echo ren&quot;<br />rem set process=ren<br />set &quot;Folder=d:\music&quot;<br />set &quot;Files=*.mp3 *.flac&quot;<br />&nbsp;rem Setting Directory and File prezero<br />set /a DN=100 ,FN=10000<br /><br />&nbsp;rem END Settings<br />set prompt=$g$s<br />for /f &quot;delims= &quot; %%T in ('robocopy /L . . /njh /njs') do set &quot;TAB=%%T&quot;<br />set &quot;tempf=%temp%\RC_%time::=%&quot;<br />set /a DN*=10 ,DN+=1 ,FN*=10 <br />&nbsp;rem If Error stop<br />&gt;&quot;%tempf%L&quot; robocopy /L /s /njh &quot;%folder%\\&quot; &quot;.. ListOnly ..\\&quot; %files% /fp /nc /bytes /njs <br />if errorlevel 16 type &quot;%tempf%L&quot; &amp;del &quot;%tempf%L&quot; &amp;pause &amp;exit /b <br />@ &lt;&quot;%tempf%L&quot; &gt;&quot;%tempf%&quot; (<br />&nbsp; for /f &quot;skip=1tokens=1-3delims=%tab%&quot; %%D in ('find &quot;%tab%&quot;')do @(<br />&nbsp; &nbsp; if :%%F==: (set &quot;Fname=%%E&quot;<br />&nbsp; &nbsp; &nbsp; set /a P=DN<br />&nbsp; &nbsp; &nbsp; set &quot;B= &quot;<br />&nbsp; &nbsp; &nbsp; for /f &quot;delims=0 &quot; %%n in (&quot;%%D&quot;)do @set /a DN+=1<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; if NOT :%%F==: (set &quot;Fname=%%F&quot;<br />&nbsp; &nbsp; &nbsp; set /a FN+=1 ,P=FN<br />&nbsp; &nbsp; &nbsp; set &quot;B=&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; setlocal enabledelayedexpansion<br />&nbsp; &nbsp; for /f &quot;delims=&quot; %%L in (&quot;!B!!P:~2! !Fname!.&quot;)do @endlocal&amp;echo %%L<br />&nbsp; )<br />)<br />del &quot;%tempf%L&quot; <br />@echo on<br />@for /f &quot;tokens=1*&quot; %%i in ('sort /r &quot;%tempf%&quot;')do %process% &quot;%%~j&quot; &quot;%%i_%%~nxj&quot; <br />@echo OFF<br />del &quot;%tempf%&quot;<br />pause<br />exit /b</code></pre></div><br /><br />Phil</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Renaming recursively files with alphabetical order</h3>
				<div class="date">Posted: <strong>30 Dec 2016 12:05</strong></div>
				<div class="author">by <strong>crazyroot</strong></div>
				<div class="content">Hi Phil and thank you for your very quick answer <img class="smilies" src="images/smilies/icon_wink.gif" alt=";)" title="Wink" /><br /><br />Well, this code seems to be very close to be perfect but I encountered an issue : files cannot be renamed as their path contains folders' names before renaming.<br />Maybe renaming files should be done juste before folders ?<br /><br />Also, when testing with many folders, I've noticed that for artists and songs (folders and files) that are in foreign language (chcp different from the default), renaming fails. Don't know if this could be trapped and dynamically corrected ?</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Renaming recursively files with alphabetical order</h3>
				<div class="date">Posted: <strong>30 Dec 2016 13:59</strong></div>
				<div class="author">by <strong>Aacini</strong></div>
				<div class="content">Excuse me. The first time I read this request I just didn't understood the purpose. How a renaming could be done in <em class="text-italics">alphabetic order</em> if you add <em class="text-italics">a number</em> to the original names? The description &quot;Like I said in JREN topic&quot; serve for nothing, and show code that does <em class="text-italics">not</em> get the required result is not useful either... You should describe your problem in a clear and concise way and show a small example of the input and the desired output. Did you read <a href="viewtopicf756.html?f=3&amp;t=6108" class="postlink">the post</a> placed at first place in the list of topics?<br /><br />When I read your reply with <em class="text-italics">an example</em> of the desired final names, I assumed that what you want is &quot;add a numeric prefix to the names in the order displayed by DIR command&quot;. If so, then this Batch file may solve your problem:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion<br /><br />rem Folders will have a two-digits numeric prefix<br />rem Folders prefix will increment for *ALL FOLDERS* in the tree<br />set &quot;folder=100&quot;<br />call :ProcessThisFolder<br />goto :EOF<br /><br /><br />:ProcessThisFolder<br /><br />echo/<br />echo Folder: %cd%<br /><br />rem Rename the files in this folder<br />rem Files will have a four-digits numeric prefix<br />rem Files prefix will *RESET TO ZERO* in each folder<br />set &quot;file=10000&quot;<br />for /F &quot;delims=&quot; %%f in ('dir /A:-D /B 2^&gt;NUL') do (<br />&nbsp; &nbsp;set /a file+=1<br />&nbsp; &nbsp;ECHO ren &quot;%%f&quot; &quot;!file:~1!_%%f&quot;<br />)<br /><br />rem For each subfolder in this folder:<br />for /F &quot;delims=&quot; %%d in ('dir /A:D /B 2^&gt;NUL') do (<br />&nbsp; &nbsp;rem Process it recursively<br />&nbsp; &nbsp;cd &quot;%%d&quot;<br />&nbsp; &nbsp;call :ProcessThisFolder<br />&nbsp; &nbsp;cd ..<br />&nbsp; &nbsp;rem Rename it<br />&nbsp; &nbsp;set /A folder+=1<br />&nbsp; &nbsp;ECHO ren &quot;%%d &quot;!folder:~1!_%%d&quot;<br />)<br />exit /B<br /></code></pre></div><br />This basic program may be modified in several ways, like use the same increasingly numeric prefix in all files (instead of reset it to zero in each folder), reset the folder prefix to zero in each subfolder, check if a folder have no files in order to supress its renaming, etc.<br /><br />Note that the REN commands have an ECHO command before, so the commands are just displayed in the screen. Note also that this program eliminate exclamation marks from file/folder names; this point may be fixed, if needed.<br /><br />Antonio</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Renaming recursively files with alphabetical order</h3>
				<div class="date">Posted: <strong>30 Dec 2016 16:03</strong></div>
				<div class="author">by <strong>crazyroot</strong></div>
				<div class="content">Hi Antonio,<br /><br />Thank you for your posting and your very interesting recursif code.<br /><br />And so sorry for confusion, I should insist more in the description. My car radio is windows ce based and for some strange reasons, unlike classic mp3/flac readers, the car radio mix all the songs (*.mp3 *.flac) without consideration for folders but only alphabetical order of music files.<br /><br />That's why, in order to let the car radio read in the right and controlled order for songs, I wanted to combine these features :<br />- filtering (*.mp3 *.flac)<br />- sorting folders and subfolders (to get an album in order)<br />- renaming music files with absolute incrementing (not interrupting), following the order of an album but also of the folders/subfolders, between albums<br /><br />Phil gave me a working solution, but I have asked him some bonus features (renaming folders and subfolders with songs only), so the last solution he gave had an issue.<br /><br />I like very much your recursif way Antonio, it solves sorting problem beautifully.<br />In this version however,  there is no filter (mp3/flac, it would rename everything) and the modifications you enumerated (absolute increasing for numeric prefix and conditions on folder/subfolder prefix).<br />Thank you Antonio and again sorry for the misunderstanding before.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Renaming recursively files with alphabetical order</h3>
				<div class="date">Posted: <strong>30 Dec 2016 18:56</strong></div>
				<div class="author">by <strong>Aacini</strong></div>
				<div class="content">@crazyroot,<br /><br />Mi <em class="text-italics">example</em> code list all files. If you want to list .mp3 and .flac files only, just add the appropriate wild-cards to the DIR command: <strong class="text-strong">dir /A:-D /B *.flac *.mp3</strong><br /><br />If you want to rename all music files with just one continuous number sequence, move the initialization of file numbers from its current place, below <em class="text-italics">&quot;rem Files prefix will *RESET TO ZERO* in each folder&quot;</em>, to the beginning, below <em class="text-italics">&quot;rem Folders prefix will increment for *ALL FOLDERS* in the tree&quot;</em>. BTW the purpose of the REMarks is that you know what the commands does so you may complete your own modifications in the code, like this one.<br /><br />If you want to rename folders with songs only, a small modification is required. However, in order to make this mod simpler, I <em class="text-italics">assumed</em> that the topmost folder, the one where the Batch file start run, does <em class="text-italics">not</em> contain song files. Note that this point is not contrary to the specifications, because you did <em class="text-italics">not</em> stated any specification! <img class="smilies" src="images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /> <br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion<br /><br />rem Folders will have a two-digits numeric prefix<br />rem Folders prefix will increment for *ALL FOLDERS* in the tree<br />set &quot;folder=100&quot;<br /><br />rem Files will have a four-digits numeric prefix<br />rem Files prefix will increment for *ALL FILES* in the tree<br />set &quot;file=10000&quot;<br /><br />call :ProcessThisFolder<br />goto :EOF<br /><br /><br />:ProcessThisFolder<br /><br />rem For each subfolder in this folder:<br />for /F &quot;delims=&quot; %%d in ('dir /A:D /B 2^&gt;NUL') do (<br />&nbsp; &nbsp;rem Enter to it <br />&nbsp; &nbsp;cd &quot;%%d&quot;<br /><br />&nbsp; &nbsp;rem Rename the music files in this folder<br />&nbsp; &nbsp;set &quot;anyFileHere=&quot;<br />&nbsp; &nbsp;for /F &quot;delims=&quot; %%f in ('dir /A:-D /B *.flac *.mp3 2^&gt;NUL') do (<br />&nbsp; &nbsp; &nbsp; set /a file+=1<br />&nbsp; &nbsp; &nbsp; ren &quot;%%f&quot; &quot;!file:~1!_%%f&quot;<br />&nbsp; &nbsp; &nbsp; set &quot;anyFileHere=1&quot;<br />&nbsp; &nbsp;)<br /><br />&nbsp; &nbsp;rem If this folder contain any music file<br />&nbsp; &nbsp;if defined anyFileHere (<br />&nbsp; &nbsp; &nbsp; rem Rename the folder<br />&nbsp; &nbsp; &nbsp; set /A folder+=1<br />&nbsp; &nbsp; &nbsp; cd ..<br />&nbsp; &nbsp; &nbsp; ren &quot;%%d&quot; &quot;!folder:~1!_%%d&quot;<br />&nbsp; &nbsp; &nbsp; cd &quot;!folder:~1!_%%d&quot;<br />&nbsp; &nbsp;)<br /><br />&nbsp; &nbsp;rem Recursively process this folder<br />&nbsp; &nbsp;call :ProcessThisFolder<br /><br />&nbsp; &nbsp;rem And go back to parent<br />&nbsp; &nbsp;cd ..<br />)<br />exit /B<br /></code></pre></div><br />Antonio</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Renaming recursively files with alphabetical order</h3>
				<div class="date">Posted: <strong>31 Dec 2016 03:57</strong></div>
				<div class="author">by <strong>crazyroot</strong></div>
				<div class="content">Hi Antonio,<br /><br />This version is almost perfect, thank you !<br /><br />And you're right, I didn't specified completely the thing about folders/subfolders.<br />About the root folder, OK to asume there are no MusicFiles directly there, only via folders and/or subfolders.<br /><br />Also, your last example code escapes renaming any folder/subfolder when no MusicFile there directly : there is a condition to add here, because a folder that has at least one subfolder which has MusicFile should be renamed also, and without increasing the FolderPrefix except if it's the first folder of the branche, see my &quot;specification&quot; post <img class="smilies" src="images/smilies/icon_wink.gif" alt=";)" title="Wink" />, 2nd point : <a href="viewtopic537b-2.html?p=50684#p50684" class="postlink">http://www.dostips.com/forum/viewtopic.php?p=50684#p50684</a><br /><br />About the cases when rename fails :<br />- I confirm that an exclamation mark is needed (there are some songs that had it in the name)<br />- I've already asked but I re-tape it here --&gt; Also, when testing with many folders, I've noticed that for artists and songs (folders and files) that are in foreign language (chcp different from the default), renaming fails. Don't know if this could be trapped and dynamically corrected ?<br /><br />Many thanx for your work and wish you and all dostips' community an excellent New Year's Eve <img class="smilies" src="images/smilies/icon_wink.gif" alt=";)" title="Wink" /></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Renaming recursively files with alphabetical order</h3>
				<div class="date">Posted: <strong>01 Jan 2017 15:48</strong></div>
				<div class="author">by <strong>pieh-ejdsch</strong></div>
				<div class="content">If the file list is given in a simple ForLoop, the file name is always right.<br /><br />The file name is falsified only by a For/f loop at name.<br />This can be simply tested<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp;for /r D:\music %i in (*) do @for /f &quot;delims=&quot; %A in ('dir /s /b &quot;%i&quot;' ) do @if not exist %A echo %A not found!<br /></code></pre></div><br /><br />Because the list with a diversion is made this list can spend just one wrong result.<br />The files are provided in a temporary folder help of Robocopy as zero byte files.<br />The files are provided alphabetically.<br />Now the file list is given by a simple ForLoop and in the orginal folder the files are renamed.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo OFF<br />setlocal<br />set &quot;process=echo ren&quot;<br />&nbsp;rem set process=ren<br />set &quot;Folder=d:\mmtest&quot;<br />set &quot;Files=*.mp3 *.flac&quot;<br />&nbsp;rem Setting Directory and File prezero<br />set /a DN=100 ,FN=10000<br /><br />&nbsp;rem this is a temporary Folder for Sorting and renaming only<br />set &quot;tempFolder=%temp%\nonExistingFolder&quot;<br /><br />&nbsp;rem use call with copies for testing <br />&nbsp;rem call :seperate <br />if :SUB==only * You want test with seperate Files * &amp; @(<br />:seperate<br />rd /s /q &quot;%folder%&quot; 2&gt;nul &gt;nul<br />md &quot;%folder%&quot;<br />robocopy /create /mir D:\music &quot;%folder%&quot; /njh /fp /ndl /nfl /njs<br />exit /b<br />)<br /><br />&nbsp;rem END Settings<br />rd /s /q &quot;%tempfolder%&quot; 2&gt;nul &gt;nul<br />md &quot;%tempfolder%&quot;<br />call :subST_LW Q &quot;%%folder%%&quot;<br />call :subST_LW R &quot;%%tempfolder%%&quot;<br />if errorlevel 3 pause &amp;exit /b 1<br />set Substlist= %Q% %R%<br />echo temporary Folder is filled ...<br />robocopy /create /mir %Q% %R% /njh /njs /ndl /nfl<br />pushD %R%<br />echo Rename ... <br />call :process<br />popD<br />for %%S in (%SubstList% )do subst /D %%S<br />rd /S /Q &quot;%tempfolder%&quot;<br />echo END script<br />pause<br />exit /b<br /><br />:process <br />@set &quot;D=&quot;<br />@for %%F in (%files%)do @( set/aFN+=1,D=1<br />&nbsp; setlocal enabledelayedexpansion<br />&nbsp; &nbsp; for %%N in (!FN:~1!)do @( endlocal<br />&nbsp; &nbsp; &nbsp; if NOT exist %Q%%%~pnxF &gt;&amp;2 echo file %Q%%%~pnxF not found!<br />&nbsp; &nbsp; &nbsp; if exist %Q%%%~pnxF %process% &quot;%Q%%%~pnxF&quot; &quot;%%N_%%~nxF&quot;<br />&nbsp; &nbsp; )<br />&nbsp; )<br />)<br />@if defined D set/aDN+=1<br />@for /D %%D in (*)do @( pushd %%D<br />&nbsp; if not errorlevel 1 (<br />&nbsp; &nbsp; &nbsp; call :process<br />&nbsp; &nbsp; &nbsp; popD<br />&nbsp; &nbsp; &nbsp; setlocal enabledelayedexpansion<br />&nbsp; &nbsp; &nbsp; for %%N in (!DN:~1!)do @( endlocal<br />&nbsp; &nbsp; &nbsp; &nbsp; if NOT exist %Q%%%~pnxD &gt;&amp;2 echo DIR %Q%%%~pnxD not found!<br />&nbsp; &nbsp; &nbsp; &nbsp; if exist %Q%%%~pnxD %process% &quot;%Q%%%~pnxD&quot; &quot;%%N_%%~nxD&quot;<br />&nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; )<br />&nbsp; )<br />)<br />@exit /b<br /><br />:subST_LW outVar_LW VarPathToSubst<br />set &quot;%1=&quot;<br />set &quot;FreeDrive=Z Y X W V U T S R Q P O N M L K J I H G F E D C B A&quot;<br />for %%i in (%FreeDrive%) do @if not defined %1 &gt;nul subst %%i: %2 &amp;&amp;set %1=%%i:<br />if not defined %1 1&gt;&amp;2 echo Kein Freies Laufwerk gefunden!&amp; exit /b 3<br />exit /b</code></pre></div><br /><br />Phil</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="UTC-6">UTC-06:00</span><br />Page <strong>1</strong> of <strong>2</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Limited<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=7617&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 07:58:44 GMT -->
</html>
