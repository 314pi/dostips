<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=8513&start=15&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:23:57 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>DosTips.com &bull; Alternate method to get TAB, Carriage return and possibly all others - Page 2</title>

<link href="styles/AllanStyle-SUBSILVER/theme/print.css" rel="stylesheet">
</head>
<body id="phpbb">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>DosTips.com</h1>
		<p>A Forum all about DOS Batch<br /><a href="index-2.html">https://www.dostips.com/forum/</a></p>

		<h2>Alternate method to get TAB, Carriage return and possibly all others</h2>
		<p><a href="viewtopic5bd3.html?f=3&amp;t=8513">https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=8513</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>2</strong> of <strong>3</strong></div>
					<div class="post">
				<h3>Re: Alternate method to get TAB, Carriage return and possibly all others</h3>
				<div class="date">Posted: <strong>30 Apr 2018 16:20</strong></div>
				<div class="author">by <strong>carlos</strong></div>
				<div class="content"><blockquote><div><cite><a href="memberlist0354.html?mode=viewprofile&amp;u=9161">sst</a> wrote: <a href="viewtopic69db.html?p=56621#p56621" data-post-id="56621" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">30 Apr 2018 14:09</div></cite>
<blockquote><div><cite><a href="memberlistcb12.html?mode=viewprofile&amp;u=1621">carlos</a> wrote: <a href="viewtopicbda2.html?p=56594#p56594" data-post-id="56594" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">27 Apr 2018 17:29</div></cite>
It will very useful found a solution.
</div></blockquote>
@carlos<br>
I've found that, after issuing chcp command, initiating a new cmd instance on the same console would resolve the code page issue for that new cmd instance.<br>
So for that particular version of genchr that I've used as test case in the previous post, putting chcp 437 in the start of the script would create correct chr files, because it offloads all of it's work to new instances of cmd on the same console. Otherwise the script needs to relaunch itself in a new instance of cmd after changing of the active code page.
</div></blockquote>

Many thanks @sst. You found a solution.<br>
I think the cmd relaunch is only needed for the copy command in text mode.<br>
<br>
I check this code using the 950 codepage from the registry and now works ok with all the .chr files generated. Checked with this c code from 2014:<br>
<a href="http://pastebin.com/raw/6K5SMYrg" class="postlink">http://pastebin.com/raw/6K5SMYrg</a><br>
<br>
I write your nick on the credits.<br>
<br>
Edit: the codes is here: <a href="viewtopic8c1f.html?f=3&amp;t=5326&amp;p=56708#p56709" class="postlink">viewtopic.php?f=3&amp;t=5326&amp;p=56708#p56709</a><br>
<br>
Is only a proposal of the new code. If you find a better way of fix that, please share the comments.<br>
<br>
But I only test it on windows 10. Please if you have access to some of that windows versions, please you can do test? I want update the routine code for fix this bug (found 4 years after the creation). Genchr also have a page on ss64: <a href="https://ss64.com/nt/syntax-genchr.html" class="postlink">https://ss64.com/nt/syntax-genchr.html</a> Because that is needed update that with the fix <img class="smilies" src="images/smilies/icon_smile.gif" width="15" height="15" alt=":)" title="Smile"></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Alternate method to get TAB, Carriage return and possibly all others</h3>
				<div class="date">Posted: <strong>30 Apr 2018 18:02</strong></div>
				<div class="author">by <strong>sst</strong></div>
				<div class="content"><blockquote><div><cite><a href="memberlistcb12.html?mode=viewprofile&amp;u=1621">carlos</a> wrote: <a href="viewtopic54f2.html?p=56622#p56622" data-post-id="56622" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">30 Apr 2018 16:20</div></cite>
I write your nick on the credits.
</div></blockquote>
It's an honor for me and It's very kind of you carlos, but I prefer you not to. That was a great collaborative work that I had no role in creating of it. Recommendation to put a single chcp on the script does not make me eligible for the credit. But I appreciate your kindness, Really.<br>
What is important here is the reason why this works for this version and not the others. That may comes in handy in future similar projects.<br>

<blockquote><div><cite><a href="memberlistcb12.html?mode=viewprofile&amp;u=1621">carlos</a> wrote: <a href="viewtopic54f2.html?p=56622#p56622" data-post-id="56622" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">30 Apr 2018 16:20</div></cite>
I think the cmd relaunch is only needed for the copy command in text mode.
</div></blockquote>
My NLSAscii in it's core doesn't relay on copy but still needs relaunch until alternate solution can be found.<br>

<blockquote><div><cite><a href="memberlistcb12.html?mode=viewprofile&amp;u=1621">carlos</a> wrote: <a href="viewtopic54f2.html?p=56622#p56622" data-post-id="56622" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">30 Apr 2018 16:20</div></cite>
Is only a proposal of the new code. If you find a better way of fix that, please share the comments.
</div></blockquote>
As for recommendations and comments, I think It should be continued on the main thread, so other readers who study the project can follow the progress. I will participate if any thing comes to my mind.<br>
<br>
Cheers.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Alternate method to get TAB, Carriage return and possibly all others</h3>
				<div class="date">Posted: <strong>30 Apr 2018 21:13</strong></div>
				<div class="author">by <strong>carlos</strong></div>
				<div class="content">@sst seems that is needed relaunch the cmd instance as you says because cmd.exe use a internal variable CurrentCP that is only initialized when it start the first time, this variable is used on some internal methods, regarding of the call to chcp.exe, that calls to winapi functions SetConsoleOutputCP and SetConsoleCP that touch other variable.<br>
<br>
The init of CurrentCP variables seems be like this:<br>
<br>
If cmd not have a parent instance:<br>
CurrentCP = get codepage from operating system locale or windows registry CodePage key.<br>
<br>
If cmd have a parent instance:<br>
CurrentCP = GetConsoleOutputCP()<br>
<br>
The solution that you says is:<br>
1) Change the current codepage with chcp<br>
2) Run your batch code with cmd /c this will touch correctly the CurrentCP variable.<br>
<br>
A possible workaround template:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off
::Workaround for environments with native dbcs codepages
if "%_cp_%"=="" (
  setlocal enableextensions
  for /f "tokens=*" %%a in ('chcp') do for %%b in (%%a) do set "_cp_=%%~nb"
  chcp 437 &gt;nul
  cmd /d /c "%~f0"
  call chcp %%_cp_%% &gt;nul
  exit /b
)

::your code here

</code></pre></div></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Alternate method to get TAB, Carriage return and possibly all others</h3>
				<div class="date">Posted: <strong>01 May 2018 12:19</strong></div>
				<div class="author">by <strong>Aacini</strong></div>
				<div class="content">You don't need to rely on the internal format of any binary file. You may easily create your own binary file via CERTUTIL:<br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off
setlocal EnableDelayedExpansion

call :DefineCtrlChar BEL=07, TAB=09, LF=0A, CR=0D
echo BEL[%BEL%]BEL, LF[!LF!]LF, TAB[%TAB%]TAB, CR[!CR!]CR
goto :EOF


:DefineCtrlChar var=hex ...

&gt; "CtrlChar.hex.txt" echo %2 20
certutil.exe -decodehex -f "CtrlChar.hex.txt" "CtrlChar.txt" &gt; NUL
set /P "%1=" &lt; CtrlChar.txt
set "%1=!%1:~0,1!"
shift &amp; shift
if "%~2" neq "" goto DefineCtrlChar 
del "CtrlChar.*"
exit /B
</code></pre></div>

Output:<br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>BEL[]BEL, LF[
]CR, TAB[       ]TAB, CR[
</code></pre></div>

Antonio</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Alternate method to get TAB, Carriage return and possibly all others</h3>
				<div class="date">Posted: <strong>01 May 2018 12:54</strong></div>
				<div class="author">by <strong>penpen</strong></div>
				<div class="content">i reread this topic, and thought about which codepages where part of windows over all versions:<br>
I only found codepage 65000 (utf-7) and 65001 (utf-8).<br>
<br>
Surprisingly using codepage transformation only suffices to solve this task (if i don't error);<br>
Under windows xp this only works on patched cmd.exe  (using <a href="viewtopicc191.html?t=5588#p34371" class="postlink">carlos and Jason Hoods cmd.exe patch</a>).<br>
I actually have only access to win xp, 32 bit, german localization and windows 10, 64 bit, german localization, so i cannot test this anywhere else:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off
setlocal enableExtensions disableDelayedExpansion
:: set active, utf-7 and utf8 codepages
set /A "utf7Cp=65000, utf8Cp=65001"
set "cp="
:: thanks to carlos, for the chcp messages in other languages, see:
:: https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=8533#p56632
:: bugfixed: for /f "tokens=2 delims=:." %%a in ('2^&gt;nul chcp') do set "cp=%%~a"
for /f "delims=." %%a in ('2^&gt;nul chcp') do for %%b in (%%a) do set "cp=%%b"
if not defined cp for /f "tokens=2" %%a in ('2^&gt;nul chcp') do set "cp=%%~a"
&gt;nul chcp %utf8Cp%

:: define filenames
set "utf7DataFile=table.utf-7.txt"
set "dataFile=table.dat"

:: create chinese chcp seperator char
set "data="
&lt;nul (&gt;"%utf7DataFile%" set /p "=+/xo-")

for /f "tokens=2 delims=:." %%a in ("%cp%") do set "cp=%%~a"


:: create unicode data [U+1A00 : U+1AFF] using only characters in { '+', '-', '/', '0'-'9', 'A'-'Z', 'a'-'z' }
:: set "data="
:: set "data=%data%+GgAaARoCGgMaBBoFGgYaBxoIGgkaChoLGgwaDRoOGg8aEBoRGhIaExoUGhUaFhoXGhgaGRoaGhsaHBodGh4aHxogGiEaIhojGiQ"
:: set "data=%data%aJRomGicaKBopGioaKxosGi0aLhovGjAaMRoyGjMaNBo1GjYaNxo4GjkaOho7GjwaPRo+Gj8aQBpBGkIaQxpEGkUaRhpHGkgaSRp"
:: set "data=%data%KGksaTBpNGk4aTw-+GlAaURpSGlMaVBpVGlYaVxpYGlkaWhpbGlwaXRpeGl8aYBphGmIaYxpkGmUaZhpnGmgaaRpqGmsabBptGm4"
:: set "data=%data%abxpwGnEachpzGnQadRp2GncaeBp5Gnoaexp8Gn0afhp/GoAagRqCGoMahBqFGoYahxqIGokaihqLGowajRqOGo8akBqRGpIakxq"
:: set "data=%data%UGpUalhqXGpgamRqaGpsanBqdGp4anw-+GqAaoRqiGqMapBqlGqYapxqoGqkaqhqrGqwarRquGq8asBqxGrIasxq0GrUathq3Grg"
:: set "data=%data%auRq6GrsavBq9Gr4avxrAGsEawhrDGsQaxRrGGscayBrJGsoayxrMGs0azhrPGtAa0RrSGtMa1BrVGtYa1xrYGtka2hrbGtwa3Rr"
:: set "data=%data%eGt8a4BrhGuIa4xrkGuUa5hrnGuga6RrqGusa7BrtGu4a7w-+GvAa8RryGvMa9Br1GvYa9xr4Gvka+hr7Gvwa/Rr+-+Gv8-"
:: thanks to carlos, for finding a shorter data encoding, see:
:: https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=8513&amp;p=56666#p56637
set "data="
set "data=%data%+GgAaARoCGgMaBBoFGgYaBxoIGgkaChoLGgwaDRoOGg8aEBoRGhIaExoUGhUaFhoXGhgaGRoaGhsaHBodGh4aHxogGiEaIhojGiQ"
set "data=%data%aJRomGicaKBopGioaKxosGi0aLhovGjAaMRoyGjMaNBo1GjYaNxo4GjkaOho7GjwaPRo+Gj8aQBpBGkIaQxpEGkUaRhpHGkgaSRp"
set "data=%data%KGksaTBpNGk4aTxpQGlEaUhpTGlQaVRpWGlcaWBpZGloaWxpcGl0aXhpfGmAaYRpiGmMaZBplGmYaZxpoGmkaahprGmwabRpuGm8"
set "data=%data%acBpxGnIacxp0GnUadhp3GngaeRp6GnsafBp9Gn4afxqAGoEaghqDGoQahRqGGocaiBqJGooaixqMGo0ajhqPGpAakRqSGpMalBq"
set "data=%data%VGpYalxqYGpkamhqbGpwanRqeGp8aoBqhGqIaoxqkGqUaphqnGqgaqRqqGqsarBqtGq4arxqwGrEashqzGrQatRq2GrcauBq5Gro"
set "data=%data%auxq8Gr0avhq/GsAawRrCGsMaxBrFGsYaxxrIGskayhrLGswazRrOGs8a0BrRGtIa0xrUGtUa1hrXGtga2RraGtsa3BrdGt4a3xr"
set "data=%data%gGuEa4hrjGuQa5RrmGuca6BrpGuoa6xrsGu0a7hrvGvAa8RryGvMa9Br1GvYa9xr4Gvka+hr7Gvwa/Rr+Gv8-"
::  index       0123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890123456789
::              0         1         2         3         4         5         6         7         8         9         
&lt;nul (&gt;"%utf7DataFile%" set /p "=%data%")
:: ensure cmd.exe is in ANSI mode (file size should be 695 bytes; if it is 1390 then cmd.exe is in UCS-2 mode)
:: for %%a in ("%utf7DataFile%") do (if %%~za == 1390 (cmd /d /a /e:on /v:off /c"%~f0" &amp; goto :eof))
:: size of data changed  to 685 bytes, so have to check for 1370
for %%a in ("%utf7DataFile%") do (if %%~za == 1370 (cmd /d /a /e:on /v:off /c"%~f0" &amp; goto :eof))
&gt;nul chcp %utf7Cp%
set "data=" &amp; &lt;"%utf7DataFile%" set /p "data="
&gt;nul chcp %cp%
rem del "%utf7DataFile%"

:: create *.chr files
if not exist chars md chars
set "hex=0 1 2 3 4 5 6 7 8 9 A B C D E F"
set "index=0"
&gt;nul chcp %utf8Cp%
cmd /d /u /e:on /v:on /c"@for %%h in (%hex%) do @for %%l in (%hex%) do @((for %%a in ("!index!") do @(&gt;"%dataFile%" echo(!data:~0x%%~h%%~l,2!))&amp;(&gt;nul copy /a "%dataFile%" "chars\%%~h%%~l.chr" /b))"
&gt;nul chcp %cp%
REM create "chars\1A.chr" because it's the eof character
&gt;nul copy /a nul "chars\1A.chr"

:: build test file [0x00 : 0xFF]
for %%h in (%hex%) do @for %%l in (%hex%) do for %%a in ("chars\%%~h%%~l.chr") do if not "%%~za" == "1" echo(Error in file "%%~a".
if exist "%dataFile%" del "%dataFile%"
&gt;nul (
	copy /b nul "%dataFile%"
	for %%h in (%hex%) do @for %%l in (%hex%) do copy /b "%dataFile%" +"chars\%%~h%%~l.chr" "%dataFile%"
)
goto :eof</code></pre></div>

penpen<br>
<br>
Edit: Fixed a bug (set cp for different languages see <a href="viewtopic18d8.html?f=3&amp;t=8533#p56632" class="postlink">viewtopic.php?f=3&amp;t=8533#p56632</a>).<br>
Edit2: Applied the shorter data encoding, proposed by carlos <a href="viewtopic61d9.html?f=3&amp;t=8513&amp;start=15#p56637" class="postlink">here</a>.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Alternate method to get TAB, Carriage return and possibly all others</h3>
				<div class="date">Posted: <strong>01 May 2018 15:39</strong></div>
				<div class="author">by <strong>carlos</strong></div>
				<div class="content">@penpen: nice technique, is new for me. Please you can explain it a little bit.?<br>
Also, If I remember well, the utf-8 bug on windows xp only affects when you run code in a batch file, because cmd tries convert the source code of the batch file to that codepage calling to a winapi function with a incorrect parameter. But you can work on interactive mode using utf-8 If I remember well, thus if you convert your code snippet to macro, maybe you can run that code if you run it on interactive mode. Maybe: echo %macro% | cmd<br>
Is a theory.<br>
<br>
@aacini: yes, with certutil you can easily handle binary data, but the idea i think is develop a new technique, as alternative in case certutil change or is removed in the future in the default installation, as it happened to the old telnet.exe</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Alternate method to get TAB, Carriage return and possibly all others</h3>
				<div class="date">Posted: <strong>01 May 2018 16:34</strong></div>
				<div class="author">by <strong>penpen</strong></div>
				<div class="content">Well the basic idea is the same as used in the "genchr.cmd":<br>
Create files with the searched byte (0xst; s,t in {0..F}) and an eof character (0x1A) at position2 and then use copy to cut of eof character and following data.<br>
<br>
I only used a way to do that using utf-7 and utf-8 codepages.<br>
So instead of using "makecab.exe" to create those bytes, i interpreted those two bytes as an ucs-2 encoded character.<br>
Because the utf-16le characters in this range are identical, i needed an utf-16le file that contains all unicode characters from U+1A00 to U+1AFF (0xst1A == U+1Ast).<br>
<br>
I used type to convert that file to utf-7 encoding:
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Z:\&gt;chcp 65000
Aktive Codepage: 65000.

Z:\&gt;&gt;"utf7.txt" type "utf16le.txt"

Z:\&gt;</code></pre></div>The code simply reverses this step, by creating the utf-7 file, changing the codepage to utf-7 and use set/p to read the file.<br>
Then i used "cmd/u" to create the single character files containing the needed utf-16le character.<br>
<br>
I then tested if the utf-8 codepage is sufficient for cutting off the eof/sub character, and it seems it works (but i cannot be sure for other versions/localizations of windows):<br>
That was a bit lucky, because some bytes are also leading bytes in multibyte encoding of characters (for example 0xC2);<br>
i assume that 0x1A never is a trailing byte saved this solution.<br>
<br>
<br>
penpen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Alternate method to get TAB, Carriage return and possibly all others</h3>
				<div class="date">Posted: <strong>01 May 2018 20:34</strong></div>
				<div class="author">by <strong>sst</strong></div>
				<div class="content">@Aacini<br>
The aim was to cover pre vista as well. cerutil was available by default starting from vista if I'm not wrong. On XP  we need to install Server 2003 Admin Pack and I think its not available for Win2K at all.<br>
<br>
@penpen<br>
Very nice and clever approach. It is very unfortunate that it cannot be used strait on XP.<br>
I didn't get purpose for the index variable and extra FOR loop around it, may its a leftover or something. I'm not sure.<br>
Anyway I got the concept, Thanks for that.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Alternate method to get TAB, Carriage return and possibly all others</h3>
				<div class="date">Posted: <strong>01 May 2018 20:38</strong></div>
				<div class="author">by <strong>carlos</strong></div>
				<div class="content">@penpen, now I see that the core of the function is rely on a internal conversion from utf-7 to utf-16le using set /p.<br>
I test on windows 10 ok, with some changes, I use codepage 437 instead utf-8 and works ok, also I encode  the utf16 file to utf-7 with convertcp and the result encoded is a little more small. It also works.<br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set "data="
set "data=%data%+GgAaARoCGgMaBBoFGgYaBxoIGgkaChoLGgwaDRoOGg8aEBoRGhIaExoUGhUaFhoXGhgaGRoaGhsaHBodGh4aHxogGiEaIhojGiQ"
set "data=%data%aJRomGicaKBopGioaKxosGi0aLhovGjAaMRoyGjMaNBo1GjYaNxo4GjkaOho7GjwaPRo+Gj8aQBpBGkIaQxpEGkUaRhpHGkgaSRp"
set "data=%data%KGksaTBpNGk4aTxpQGlEaUhpTGlQaVRpWGlcaWBpZGloaWxpcGl0aXhpfGmAaYRpiGmMaZBplGmYaZxpoGmkaahprGmwabRpuGm8"
set "data=%data%acBpxGnIacxp0GnUadhp3GngaeRp6GnsafBp9Gn4afxqAGoEaghqDGoQahRqGGocaiBqJGooaixqMGo0ajhqPGpAakRqSGpMalBq"
set "data=%data%VGpYalxqYGpkamhqbGpwanRqeGp8aoBqhGqIaoxqkGqUaphqnGqgaqRqqGqsarBqtGq4arxqwGrEashqzGrQatRq2GrcauBq5Gro"
set "data=%data%auxq8Gr0avhq/GsAawRrCGsMaxBrFGsYaxxrIGskayhrLGswazRrOGs8a0BrRGtIa0xrUGtUa1hrXGtga2RraGtsa3BrdGt4a3xr"
set "data=%data%gGuEa4hrjGuQa5RrmGuca6BrpGuoa6xrsGu0a7hrvGvAa8RryGvMa9Br1GvYa9xr4Gvka+hr7Gvwa/Rr+Gv8-"
</code></pre></div>

Unfortunately, this nice new technique will not works on cmd for windows xp, unless apply the unofficial mentioned patch, because that bug also affects utf-7, thus without that patch, set /p cannot convert the utf-7 to utf-16 properly on windows xp.<br>
But, I think that support for xp is not really needed. This new technique is a nice alternative.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Alternate method to get TAB, Carriage return and possibly all others</h3>
				<div class="date">Posted: <strong>03 May 2018 03:09</strong></div>
				<div class="author">by <strong>penpen</strong></div>
				<div class="content"><blockquote><div><cite><a href="memberlistcb12.html?mode=viewprofile&amp;u=1621">carlos</a> wrote: <a href="viewtopic5f69.html?p=56637#p56637" data-post-id="56637" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">01 May 2018 20:38</div></cite>I use codepage 437 instead utf-8 and works ok</div></blockquote>Does that mean the batch  produces errors when using utf-8, or what is the reason to not use it?<br>
If the answer is yes, in what error occurs in which circumstances (which initial codepage; is cmd.exe in ANSI mode (&lt;-cmd/a) or in UCS-2 mode (&lt;-cmd/u))?<br>
<br>
What i fear most is, that copy might use a fallback codepage, if reading an invalid character in utf-8:<br>
I hope that didn't happen.<br>

<blockquote><div><cite><a href="memberlistcb12.html?mode=viewprofile&amp;u=1621">carlos</a> wrote: <a href="viewtopic5f69.html?p=56637#p56637" data-post-id="56637" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">01 May 2018 20:38</div></cite>This new technique is a nice alternative.</div></blockquote>Many thanks.  <img class="smilies" src="images/smilies/icon_biggrin.gif" width="15" height="15" alt=":D" title="Very Happy"> <br>
<br>
Also thanks for the <a href="viewtopic18d8.html?f=3&amp;t=8533#p56632" class="postlink">chcp messages in other languages</a>;<br>
i've bugfixed the above code with an own (only slightly different) version, that could be extended easily to handle additional ending characters in other languages (although i don't know if there are any).<br>
<br>
<br>
penpen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Alternate method to get TAB, Carriage return and possibly all others</h3>
				<div class="date">Posted: <strong>03 May 2018 10:12</strong></div>
				<div class="author">by <strong>carlos</strong></div>
				<div class="content">I replace utf-8 by 437 trying avoid the utf-8 bug on xp, but finally the bug also extend to utf-7. If you look the unofficial patch source it covers utf-8 and utf-7. I got is a nice technique and a real replacement for certutil. For xp and windows 2000 we always can use debug.exe for generate binary data (i have a old program that generates scripts).  We can also create the patched cmd.exe using a debug.exe script. I not know why I not create the unofficial patch for cmd.exe using a debug script. I will have fun writing that. In that case if you want support xp you call the debug script for patch the cmd. That would be nice. <img class="smilies" src="images/smilies/icon_smile.gif" width="15" height="15" alt=":)" title="Smile"></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Alternate method to get TAB, Carriage return and possibly all others</h3>
				<div class="date">Posted: <strong>09 May 2018 23:39</strong></div>
				<div class="author">by <strong>sst</strong></div>
				<div class="content">This is the improved version of NLSAscii.cmd<br>
Additions/Changes:<br>
- It now relaunches itself to properly run under the correct code page.<br>
- Integrity verification code added to ASCII generator function so it can now reliably determine if the correct table has been produced.<br>
- Greatly improved the performance of generator by some small changes. On my system the execution time reduced from around 0.35 seconds without integrity verification to around 0.12 seconds with integrity verification and 0.06 seconds without integrity check.<br>
<br>
Please note this not a full batch application,it is only a demo to show how to handle the NLS files and extract a complete ASCII table from them. However incorporating the code for your own use is straightforward.<br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>
:: NLSAscii.cmd

:: NLS ASCII TABLE Generator. By sst
:: Special thanks to carlos for his valuable feedback and guidances

:: Sample batch script to demonstrate creation of in-memory ASCII table using NLS files.
:: Dependency:
:: C_950.NLS  SHA1: 1cd3f1ccf03d2b2d00dd3a133a6bebaa0e1bdb89
:: C_1252.NLS SHA1: 355e2ada0b9ea4f2a844c2d236d1b48336881b22

:: This script should produce the correct table on Win2K, WinXP, WinVista, Win7, Win8.x, Win10

:: Tested on Win2K SP4, WinXP SP3 32bit, Win7 SP1 64bit, Win10 1709 64bit




@echo off
setlocal EnableExtensions DisableDelayedExpansion

:: Using a unique enough name for init variable to effectively reduce the chance of unintentional collisions to zero.
set "Init=NLSAscii.Init.{10355d30-4e90-11e8-9330-aa819362ab44}"
if not defined %Init% (
    %= Relaunching in new cmd instance to fully apply new code page. =%
    setlocal EnableDelayedExpansion
    set "errorlevel="
    set "chcp=chcp"
    &gt;nul 2&gt;&amp;1 !chcp!
    if errorlevel 1 (
        set "errorlevel=!errorlevel!
        echo,
        &lt;nul set /p "=WARNING: "
        if "!errorlevel!"=="9009" (echo CHCP not found.) else (echo CHCP Error.)
        echo Correct operation of program depends on the current console code page.
        set "chcp=REM,"
        set "errorlevel="
    )
    for /f "tokens=*" %%a in ('!chcp!') do for %%b in (%%a) do set "PreviousCodePage=%%~nb"
    &gt;nul !chcp! 437
    set "%Init%=1"
    "%COMSPEC%" /a /d /c "%~f0"
    set "errorlevel=!errorlevel!
    &gt;nul 2&gt;&amp;1 !chcp! !PreviousCodePage! || echo WARNING: Could not revert back to the initial code page !PreviousCodePage!
    exit /b !errorlevel!
)
set "%Init%="
set "Init="
set "TIME="

:: Relaunched in new cmd instance, actual code begins here

:: Set this to none zero to enable creation of one-byte .chr files.
set /a "EnableChrExport=1"
set "ChrSubDir=.\CHR_NLS"

echo,
&lt;nul set /p "=Generating and verfying ASCII table ... "
set "Start=%TIME%"
call :CreateAsciiTableFromNLS ASCII_TABLE ErrMsg
if errorlevel 1 (
    echo Failed.
    (echo,%ErrMsg%)&gt;&amp;2
    echo,
    if /i %errorlevel% EQU 0x7FFFFFFF (
        echo Integrity verfication failed.
        echo This can happen for the following reasons:
        echo     - The batch file is running with an inappropriate code page,
        echo       The default working code page should be 437
        echo     - The NLS files [C_1252.NLS/C_950.NLS] may either be corrupt,
        echo       or have different binary structure than what is expected.
        echo,
    )
    pause
    exit /b %errorlevel%
)
set "End=%TIME%"
call :timediff Elapsed Start End
echo OK.   Time taken: %Elapsed%

setlocal EnableDelayedExpansion
&lt;nul&gt;"ASCII_TABLE.dat" set /p "=!ASCII_TABLE!"

echo,
echo Ascii table has been created in ASCII_TABLE environment variable.
echo,
echo For manual verification of the generated table, The contents of ASCII_TABLE variable
echo have been written to the file "ASCII_TABLE.dat" in the current directory.
echo SHA1 hash sum of the file should be: 8760d3807fb0c8ce8fd426f4cf72632edf8789f6
echo,

set "ASCII_TABLE=#!ASCII_TABLE!"
set "LF=!ASCII_TABLE:~10,1!"
set "CR=!ASCII_TABLE:~13,1!"
set "SUB=!ASCII_TABLE:~26,1!"
if /i %EnableChrExport% NEQ 0 (
    &lt;nul set /p "=Do you want to additionally create one-byte .chr files?[YN] "
    set "Key="
    for /F "delims=" %%K in ('"xcopy ?^| /w 2&gt;nul"') do if not defined Key set "Key=%%K"
    if /i "!Key:~-1!"=="Y" (set "Key=Y") else (set "Key=N")
    echo !Key!
    if "!Key!"=="Y" (
        &lt;nul set /p "=Please Wait...!CR!"
        if not exist "%ChrSubDir%\" MD "%ChrSubDir%"
        set "DEC=%ChrSubDir%\DEC"
        if not exist "!DEC!\" MD "!DEC!"
        for /L %%i in (1,1,255) do (
           (echo !ASCII_TABLE:~%%i,1!%SUB%)&gt;"!DEC!\%%i.tmp"
           copy /y "!DEC!\%%i.tmp" /a "!DEC!\%%i.chr" /b &gt;nul
        )
        set "prompt=%SUB%"
        "%COMSPEC%" /a /d /k&lt;nul&gt;"!DEC!\26.chr"
        "%COMSPEC%" /u /d /k&lt;nul&gt;"!DEC!\0.tmp"
        "%COMSPEC%" /a /d /k&lt;nul&gt;&gt;"!DEC!\0.tmp"
        type "!DEC!\0.tmp"|(pause&gt;nul&amp;findstr "^")&gt;"!DEC!\0.tmp"
        copy /y "!DEC!\0.tmp" /a "!DEC!\0.chr" /b &gt;nul
        del /f /q "!DEC!\*.tmp" &gt;nul 2&gt;&amp;1

        set "HEX=%ChrSubDir%\HEX"
        if not exist "!HEX!\" MD "!HEX!"
        set "HD=0 1 2 3 4 5 6 7 8 9 A B C D E F"
        set "i=0"
        for %%H in (!HD!) do for %%L in (!HD!) do (
            copy /y "!DEC!\!i!.chr" "!HEX!\%%H%%L.chr" &gt;nul
            set /a "i+=1"
        )

        echo Done.          !LF!
    )
)
endlocal



pause
exit /b 0



:CreateAsciiTableFromNLS &lt;outResult&gt; [outErrorMessage]
setlocal EnableDelayedExpansion

set "NLS950=%SystemRoot%\system32\C_950.NLS"
set "NLS1252=%SystemRoot%\system32\C_1252.NLS"

if "%~1"=="" exit /b 2
if not exist "%NLS950%"  (endlocal &amp; 2&gt;nul set "%~2=%0 : "%NLS950%" does not exist." &amp; exit /b 1)
if not exist "%NLS1252%" (endlocal &amp; 2&gt;nul set "%~2=%0 : "%NLS1252%" does not exist." &amp; exit /b 1)

:: Detection for Win2K is just for speed of reading file content
:: On Win2K, "SET /P" will read 1024 bytes of input buffer
:: On WinXP and later "SET /P" will read 1023 bytes of input buffer.
:: We need to know this to be able to seek to the correct offset.
:: Otherwise we have to use exsclusively "pause&gt;nul" to seek the input file
:: which is much slower for larger offsets
:: PS Note:
::   There is a difference between using SET /P inside a pipe eg: TYPE "BinaryFile" | SET /P "CAPTURE="
::   and using SET /P to directly read file contents eg: (SET /P "CAPTURE=")&lt;"BinaryFile"
::   In pipe mode "SET /P" will always eat the first 1023 bytes of input (1024 bytes on Win2K), no matter what the content is
::   and the result will be truncated at &lt;NULL&gt;, &lt;CRLF&gt; and &lt;LFCR&gt;
::   In direct read mode, SET /P will eat the whole 1023 or 1024 bytes ONLY if doesn't encounter one of the &lt;CRLF&gt; or &lt;LFCR&gt; pairs in the way,
::   in that case, SET /P will immediately stop reading from input upon reaching &lt;CRLF&gt; or &lt;LFCR&gt;
::   In both modes, all of the control characters(range 00-1F) which came immediately before &lt;CRLF&gt; or &lt;LFCR&gt; will be removed from the target variable.
::   Here, using the direct read mode to fast seek the NLS files is OK becuase there is no &lt;CRLF&gt; or &lt;LFCR&gt; in them.
::   But for the perpose of FastSeeking arbitrary files, only pipe mode can be used.

for /F "tokens=3" %%V in ('ver') do (
    if "%%V"=="2000" (set "FastSeekBytes=1024") else (set "FastSeekBytes=1023")
)
set "@{FastSeek}=SET /P "=""

:: Win2K's cmd has a bug in which it expands variable values to zero in SET /A expressions,
:: if they are placed in the right side of the operands. Thus we have to expand them ourselves.
set /a "NLS950_SingleSeekBytes1=1782-%FastSeekBytes%"
set /a "NLS950_SingleSeekBytes2=1890-%FastSeekBytes%"
set /a "NLS1252_SingleSeekBytes=547"

:: Capture phase
(
    for /L %%P in (1,1,%NLS1252_SingleSeekBytes%) do pause
    set /p "CAPTURE="
    set "CHAR_01-7F=!CAPTURE:~0,127!"
    set "CHAR_A0-FF=!CAPTURE:~159,96!"
    set "CHAR_EF=!CHAR_A0-FF:~79,1!"
)&lt;"%NLS1252%"&gt;nul
(
    %@{FastSeek}%
    for /L %%P in (1,1,%NLS950_SingleSeekBytes1%) do pause
    REM Equivalent to: for /L %%P in (1,1,1782) do pause&gt;nul

    set /p "CAPTURE="
    set "CHAR_80-93=!CAPTURE:%CHAR_EF%=!
    set "CHAR_80-93=!CHAR_80-93:~0,20!
)&lt;"%NLS950%"&gt;nul
(
    %@{FastSeek}%
    for /L %%P in (1,1,%NLS950_SingleSeekBytes2%) do pause
    REM Equivalent to: for /L %%P in (1,1,1890) do pause&gt;nul

    set /p "CAPTURE="
    set "CHAR_94-9F=!CAPTURE:%CHAR_EF%=!
    set "CHAR_94-9F=!CHAR_94-9F:~0,12!
)&lt;"%NLS950%"&gt;nul

:: Verification phase
set "CAPTURE="
set "TIME="
set "RANDOM="
set /a "_ErrLevel=0x7FFFFFFF"
set "CBool=^!^!"
set "BasePath=."
if defined Temp if exist "%Temp%\" set "BasePath=%Temp%"
for /F "tokens=1,3 delims=0123456789" %%A in ("%TIME: =0%") do set "time.delims=%%A%%B"
for /F "tokens=1-4 delims=%time.delims%" %%A in ("%TIME: =0%") do set "unq=%%A%%B%%C%%D"
set "unq=TMPNLSASCVRFY-%unq:~0,8%-%RANDOM%
set "Verify.File=%BasePath%\_asciitable_%unq%.tmp"
set "Dumper.File=%BasePath%\_dumper_%unq%.tmp"
&lt;nul&gt;"%Verify.File%" set /p "=!CHAR_01-7F!!CHAR_80-93!!CHAR_94-9F!!CHAR_A0-FF!"
set "CHAR_01-7F="&amp;set "CHAR_80-93="&amp;set "CHAR_94-9F="&amp;set "CHAR_A0-FF="&amp;set "unq="
set "a32=aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"
set "Dumper.Data=%a32%%a32%%a32%#%a32%%a32%%a32%%a32%%a32:~2%" =96xa + 1x# + 158xa=255
for %%F in ("%Verify.File%") do if "%%~zF"=="255" (
    &lt;nul&gt;"%Dumper.File%" set /p "=%Dumper.Data%"
    set "a32="&amp;set "Dumper.Data="
    set /a "index=cmp=0"
    for /F "skip=1 tokens=2" %%i in ('"fc /b "%Verify.File%" "%Dumper.File%""') do (
        if "!cmp!"=="0" (
            set /a "index+=1, cmp=index-0x%%i" 2&gt;nul || set "cmp=1"
        )
    )
    set /a "_ErrLevel*=!CBool!(cmp|(255-index))"
)
(
    endlocal
    if /i %_ErrLevel% EQU 0 (
        &lt;"%Verify.File%"&gt;nul set /p "%~1="
    ) else (
        2&gt;nul set "%~2=%0 : ASCII table error, Integrity verfication failed."
    )
    del /f "%Verify.File%", "%Dumper.File%" &gt;nul 2&gt;&amp;1
    exit /b %_ErrLevel%
)



:: timediff
:: -&gt; Input and output format is compatible with %TIME%
:: -&gt; The time and decimal seperators can be different between StartTime and EndTime
:: -&gt; Output will have the same time and decimal seperators as returned by %TIME% at runtime.
:: -&gt; If EndTime is less than StartTime then:
::     EndTime will be treated as a time in the next day
::     in that case, function measures time difference between a maximum distance of 24 hours minus 1 centisecond
::     time elements can have values greater than their standard maximum value ex: 12:247:853.5214
::     provided than the total represented time does not exceed 24*360000 centiseconds (24:00:00.00)
::     otherwise the result will not be meaningful.
:: -&gt; If EndTime is greater than or equals to StartTime then:
::     No formal limitation applies to the value of elements,
::     except that total represented time can not exceed 2147483647 centiseconds.
:: -&gt; To normalize (convert) none-standard time values pass 0:0:0.0 as StartTime
:timediff &lt;outDiff&gt; &lt;inStartTime&gt; &lt;inEndTime&gt;
(
    setlocal EnableDelayedExpansion
    set "TIME=" &amp; set "Input=!%~2!#!%~3!"
    for /F "tokens=1,3,4,5,7,9,11 delims=0123456789 " %%A in ("!Input!#!TIME!") do (
        set "user.time.delims=%%A%%B%%C%%D%%E " &amp; set "sys.time.delims=%%F%%G"
    )
)
for /F "tokens=1-8 delims=%user.time.delims%" %%a in ("%Input%") do (
    for %%A in ("@h1=%%a" "@m1=%%b" "@s1=%%c" "@c1=%%d" "@h2=%%e" "@m2=%%f" "@s2=%%g" "@c2=%%h") do (
        for /F "tokens=1,2 delims==" %%A in ("%%~A") do (
            for /F "tokens=* delims=0" %%B in ("%%B") do set "%%A=%%B"
        )
    )
    set /a "@d=(@h2-@h1)*360000+(@m2-@m1)*6000+(@s2-@s1)*100+(@c2-@c1), @sign=((@d&amp;0x80000000)&gt;&gt;31)&amp;1, @d+=(@sign*24*360000), @h=(@d/360000), @d%%=360000, @m=@d/6000, @d%%=6000, @s=@d/100, @c=@d%%100"
)
(
    if /i %@h% LEQ 9 set "@h=0%@h%"
    if /i %@m% LEQ 9 set "@m=0%@m%"
    if /i %@s% LEQ 9 set "@s=0%@s%"
    if /i %@c% LEQ 9 set "@c=0%@c%"
)
(
    endlocal
    set "%~1=%@h%%sys.time.delims:~0,1%%@m%%sys.time.delims:~0,1%%@s%%sys.time.delims:~1,1%%@c%"
    exit /b
)

</code></pre></div></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Alternate method to get TAB, Carriage return and possibly all others</h3>
				<div class="date">Posted: <strong>16 May 2018 04:36</strong></div>
				<div class="author">by <strong>penpen</strong></div>
				<div class="content"><blockquote><div><cite><a href="memberlistcb12.html?mode=viewprofile&amp;u=1621">carlos</a> wrote: <a href="viewtopicda0d.html?p=56680#p56680" data-post-id="56680" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">03 May 2018 10:12</div></cite>We can also create the patched cmd.exe using a debug.exe script. I not know why I not create the unofficial patch for cmd.exe using a debug script. I will have fun writing that. In that case if you want support xp you call the debug script for patch the cmd. That would be nice. <img class="smilies" src="images/smilies/icon_smile.gif" width="15" height="15" alt=":)" title="Smile"></div></blockquote>That should be no problem.<br>
<br>
Although in case of xp:<br>
I'm unsure why you don't create the character files using a debug script, or<br>
you don't use the code you gave <a href="viewtopicee84.html?f=3&amp;t=5324&amp;start=15#p32508" class="postlink">here</a>.<br>
<br>
Sorry for the delay, our public utility (don't know if that is the proper translation of "Stadtwerke") are checking and replacing all power cables in our street if necessary... (probably takes additional 1-2 weeks...).<br>
<br>
penpen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Alternate method to get TAB, Carriage return and possibly all others</h3>
				<div class="date">Posted: <strong>16 May 2018 06:32</strong></div>
				<div class="author">by <strong>penpen</strong></div>
				<div class="content"><blockquote><div><cite><a href="memberlistfcd5.html?mode=viewprofile&amp;u=4915">penpen</a> wrote: <a href="viewtopic697a.html?p=56766#p56766" data-post-id="56766" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">16 May 2018 04:36</div></cite>
<blockquote><div><cite><a href="memberlistcb12.html?mode=viewprofile&amp;u=1621">carlos</a> wrote: <a href="viewtopicda0d.html?p=56680#p56680" data-post-id="56680" onclick="if(document.getElementById(hash.substr(1)))href=hash">↑</a><div class="responsive-hide">03 May 2018 10:12</div></cite>We can also create the patched cmd.exe using a debug.exe script. I not know why I not create the unofficial patch for cmd.exe using a debug script. I will have fun writing that. In that case if you want support xp you call the debug script for patch the cmd. That would be nice. <img class="smilies" src="images/smilies/icon_smile.gif" width="15" height="15" alt=":)" title="Smile"></div></blockquote>That should be no problem.<br>
<br>
Although in case of xp:<br>
I'm unsure why you don't create the character files using a debug script, or<br>
why you don't use the code you gave <a href="viewtopicee84.html?f=3&amp;t=5324&amp;start=15#p32508" class="postlink">here</a>.<br>
<br>
Sorry for the delay, our public utility (don't know if that is the proper translation of "Stadtwerke") are checking and replacing all power cables in our street if necessary... (probably takes additional 1-2 weeks...).<br>
<br>
penpen
</div></blockquote></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Alternate method to get TAB, Carriage return and possibly all others</h3>
				<div class="date">Posted: <strong>18 Aug 2018 14:34</strong></div>
				<div class="author">by <strong>sst</strong></div>
				<div class="content">I was thinking about 8191 characters limit of cmd, and though what will happen if I echo a string that is exactly 8191 characters long, what will happen to the trailing CRLF that echo appends to end of the string? luckily with delayed expansion its possible to echo such a string and the length of the command will not limit the characters that can be passed to echo so I did this
<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>echo !String8191!
echo Hello
</code></pre></div>
And as I guessed, echo was unable to append CRLF at the end of String8191 so "Hello" appeared on the same line. Surely this is not new but I thought that if I eliminate one character from the string and reduce it to 8190 characters then there will be room only for the CR to be appended by echo and the obtrusive LF will go to hell. Now I can catch her alone  <img class="smilies" src="images/smilies/icon_twisted.gif" width="15" height="15" alt=":twisted:" title="Twisted Evil"><br>

<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off
setlocal DisableDelayedExpansion

for /F %%Z in ('
    @"CMD " /e:on /v:on /q /d /c
    set "line= "^^^&amp;
    (for /L %%Z in (1 1 12^) do set "line=!line!!line!"^)^^^&amp;
    echo(!line!!line:~0^,-2!^^^&amp;echo(
') do set "CR=%%Z"

setlocal EnableDelayedExpansion
echo(      World!CR!Hello&amp;
pause
</code></pre></div>

This is ugly and crazy and probably have no real use, but the hunting was interesting for me so I shared the story.</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="UTC-6">UTC-06:00</span><br />Page <strong>2</strong> of <strong>3</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Limited<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=8513&start=15&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:23:57 GMT -->
</html>
