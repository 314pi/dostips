<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?t=2704 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:43:58 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>SET/A: Macro to expand function results in SET /A expression - DosTips.com</title>


	<link rel="canonical" href="viewtopic537b.html?t=2704">

<!--
	phpBB style name: Allan Style - SUBSILVER
	Based on style:   prosilver (this is the default phpBB3 style)
	Based on style:   subsilver2 (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:  Allan ( http://x-tk.ru/ )
-->

<link href="assets/css/font-awesome.mind772.css?assets_version=34" rel="stylesheet">
<link href="styles/AllanStyle-SUBSILVER/theme/stylesheetd772.css?assets_version=34" rel="stylesheet">
<link href="styles/AllanStyle-SUBSILVER/theme/en/stylesheetd772.css?assets_version=34" rel="stylesheet">




<!--[if lte IE 9]>
	<link href="./styles/AllanStyle-SUBSILVER/theme/tweaks.css?assets_version=34" rel="stylesheet">
<![endif]-->




<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','../../www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-280191-1', 'auto');
	ga('send', 'pageview');
</script>

</head>
<body id="phpbb" class="nojs notouch section-viewtopic ltr ">

<div id="header-subsilver">
	<a id="top" class="top-anchor" accesskey="t"></a>
		<div class="headerbar" role="banner">
					<div class="inner">

			<div id="site-description" class="site-description">
				<a id="logo" class="logo" href="../index.html" title="DosTips.com"><span class="site_logo"></span></a>
				<h1>DosTips.com</h1>
				<p>A Forum all about DOS Batch</p>
				<p class="skiplink"><a href="#start_here">Skip to content</a></p>
			</div>

									<div id="search-box" class="search-box search-header" role="search">
				<form action="https://www.dostips.com/forum/search.php" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="search" maxlength="128" title="Search for keywords" class="inputbox search tiny" size="20" value="" placeholder="Search…" />
					<button class="button button-search" type="submit" title="Search">
						<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
					</button>
					<a href="search.html" class="button button-search-end" title="Advanced search">
						<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
					</a>
					
				</fieldset>
				</form>
			</div>
						
			</div>
					</div>
</div>


<div id="wrap" class="wrap">
	<div id="page-header">
				<div class="navbar-top" role="navigation">
	<div class="inner">

	<ul id="nav-main" class="nav-main linklist" role="menubar">

		<li id="quick-links" class="quick-links dropdown-container responsive-menu" data-skip-responsive="true">
			<a href="#" class="dropdown-trigger">
				<i class="icon fa-bars fa-fw" aria-hidden="true"></i><span>Quick links</span>
			</a>
			<div class="dropdown">
				<div class="pointer"><div class="pointer-inner"></div></div>
				<ul class="dropdown-contents" role="menu">
					
											<li class="separator"></li>
																									<li>
								<a href="search33a7.html?search_id=unanswered" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-gray" aria-hidden="true"></i><span>Unanswered topics</span>
								</a>
							</li>
							<li>
								<a href="search526f.html?search_id=active_topics" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-blue" aria-hidden="true"></i><span>Active topics</span>
								</a>
							</li>
							<li class="separator"></li>
							<li>
								<a href="search.html" role="menuitem">
									<i class="icon fa-search fa-fw" aria-hidden="true"></i><span>Search</span>
								</a>
							</li>
					
											<li class="separator"></li>
																			<li>
								<a href="memberlist4bfd.html?mode=team" role="menuitem">
									<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
								</a>
							</li>
																<li class="separator"></li>

									</ul>
			</div>
		</li>

				<li data-skip-responsive="true">
			<a href="app.php/help/faq.html" rel="help" title="Frequently Asked Questions" role="menuitem">
				<i class="icon fa-question-circle fa-fw" aria-hidden="true"></i><span>FAQ</span>
			</a>
		</li>
						
			<li class="rightside"  data-skip-responsive="true">
			<a href="ucp26c3.html?mode=login" title="Login" accesskey="x" role="menuitem">
				<i class="icon fa-power-off fa-fw" aria-hidden="true"></i><span>Login</span>
			</a>
		</li>
					<li class="rightside" data-skip-responsive="true">
				<a href="ucp8319.html?mode=register" role="menuitem">
					<i class="icon fa-pencil-square-o  fa-fw" aria-hidden="true"></i><span>Register</span>
				</a>
			</li>
						</ul>

	</div>
</div>

<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks" role="menubar">
						<li class="breadcrumbs">
							<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope=""><a href="../index.html" itemprop="url" data-navbar-reference="home"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span itemprop="title">DosTips.com</span></a></span>
										<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope=""><a href="index.html" itemprop="url" accesskey="h" data-navbar-reference="index"><span itemprop="title">Board index</span></a></span>

											<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="4"><a href="viewforum31e6.html?f=4" itemprop="url"><span itemprop="title">DosTips - Dos Batch</span></a></span>
															<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="3"><a href="viewforum4d6b.html?f=3" itemprop="url"><span itemprop="title">DOS Batch Forum</span></a></span>
												</li>
		
					<li class="rightside responsive-search">
				<a href="search.html" title="View the advanced search options" role="menuitem">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</a>
			</li>
			</ul>

	</div>
</div>

<div class="navbar-top-link">
	<div class="inner">
		<ul>
			<li class="navbar-top-link-left"><a href="search33a7.html?search_id=unanswered">Unanswered topics</a></li>
			<li class="navbar-top-link-left"><a href="search526f.html?search_id=active_topics">Active topics</a></li>

											</ul>
	</div>
</div>
	</div>

	
	<a id="start_here" class="anchor"></a>
	<div id="page-body" class="page-body" role="main">
		
		
<h2 class="topic-title"><a href="viewtopic5d59.html?f=3&amp;t=2704">SET/A: Macro to expand function results in SET /A expression</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Discussion forum for all Windows batch related topics.<br /></div>
<p>
	<strong>Moderator:</strong> <a href="memberlista6a8.html?mode=viewprofile&amp;u=5" class="username">DosItHelp</a>
</p>


<div class="action-bar bar-top">
	
			<a href="posting19dc.html?mode=reply&amp;f=3&amp;t=2704" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
	
			<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic03e1.html?f=3&amp;t=2704&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>
	
			<div class="search-box" role="search">
			<form method="get" id="topic-search" action="https://www.dostips.com/forum/search.php">
			<fieldset>
				<input class="inputbox search tiny"  type="search" name="keywords" id="search_keywords" size="20" placeholder="Search this topic…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="search.html" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				<input type="hidden" name="t" value="2704" />
<input type="hidden" name="sf" value="msgonly" />

			</fieldset>
			</form>
		</div>
	
			<div class="pagination">
			5 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
		</div>




<div id="subsilver-nav-topic">
	<div class="inner"><div class="post has-profile">
		<div class="leftsided postbody subsilver-topic-title">Message</div>
		<div class="leftsided postprofile subsilver-topic-author">Author</div>
	</div></div>
</div>

			<div id="p12304" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile12304">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content12304">

						<h3 class="first"><a href="#p12304">SET/A: Macro to expand function results in SET /A expression</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting38ef.html?mode=quote&amp;f=3&amp;p=12304" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic60b8.html?p=12304#p12304" onclick="prompt('Message #1',this.href); return false;">#1</a></span> 
									<a class="unread" href="viewtopic60b8.html?p=12304#p12304" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>26 Dec 2011 23:51
			</p>
			
			
			
			<div class="content">Batch <a href="viewtopic1ca9.html?f=3&amp;t=2518" class="postlink">macros with parameters</a> make possible to <em class="text-italics">redefine the syntax</em> of Batch language and give access to complex procedures in a simple way. Let's start with a smaller example before we immerse in SET/A macro description.<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>%SET/S% variable:~start,size=substring to insert</code></pre></div><br />Previous &quot;SET-Substring&quot; macro replace part of the current &quot;variable&quot; value with another substring; the part to replace is given in the same way as the standard Batch substring extraction with the sole difference that it does not end at the last character by default, so this point must be explicitly indicated by -0 in &quot;size&quot;. If a substring is inserted beyond the variable end, the original value is padded with spaces up to that place. To append a substring at variable end, put -0 in &quot;start&quot;.<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />::SET/S - Macro that replace a substring in a variable<br />::Antonio Perez Ayala - Dec/26/2011<br /><br />setlocal DisableDelayedExpansion<br />set LF=^<br /><br /><br />::Above 2 blank lines are required - do not remove<br />set ^&quot;\n=^^^%LF%%LF%^%LF%%LF%^^&quot;<br /><br />:SET/S variable:~start&#91;,size&#93;=substring<br />set set/s=for %%n in (1 2) do if %%n==2 (%\n%<br />&nbsp; &nbsp; &nbsp; for /F &quot;tokens=1* delims==&quot; %%1 in (&quot;!argv!&quot;) do (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set argv=%%1%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set substring=%%2%\n%<br />&nbsp; &nbsp; &nbsp; )%\n%<br />&nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-3 delims=:~, &quot; %%1 in (&quot;!argv!&quot;) do (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;value=!%%1!&quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if not defined value set &quot;value= &quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set size=%%3%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if not defined size (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &quot;%%2&quot; == &quot;-0&quot; (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;result=!value!!substring!&quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &quot;!value:~%%2,1!&quot; == &quot;&quot; (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /L %%A in (1,1,%%2) do set &quot;value=!value! &quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;result=!value:~0,%%2!!substring!&quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) else (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;result=!value:~0,%%2!!substring!!value:~%%2!&quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) else (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &quot;%%2&quot; == &quot;-0&quot; (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;result=!value!!substring!&quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else if &quot;!value:~%%2,1!&quot; == &quot;&quot; (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /L %%A in (1,1,%%2) do set &quot;value=!value! &quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;result=!value:~0,%%2!!substring!&quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else if not &quot;!size:~0,1!&quot; == &quot;-&quot; (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A restart=%%2+%%3%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for %%r in (!restart!) do set &quot;result=!value:~0,%%2!!substring!!value:~%%r!&quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;result=!value:~0,%%2!!substring!&quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if not &quot;%%3&quot; == &quot;-0&quot; set &quot;result=!result!!value:~%%3!&quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for %%v in (&quot;!result!&quot;) do endlocal ^&amp; set &quot;%%1=%%~v&quot;%\n%<br />&nbsp; &nbsp; &nbsp; )%\n%<br />&nbsp; &nbsp;) else setlocal enableDelayedExpansion ^&amp; set argv=<br /><br />for /F &quot;skip=4 delims=pR tokens=1,2&quot; %%a in (<br />&nbsp; &nbsp; &nbsp; &nbsp;'reg query hkcu\environment /v temp' ) do set TAB=%%b<br /><br /><br />setlocal EnableDelayedExpansion<br /><br />cls<br />echo/<br />echo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SET STRING=0123456789<br />echo/<br />for %%a in (0 4 -3 -0 13) do (<br />&nbsp; &nbsp; set string=0123456789<br />&nbsp; &nbsp; %set/s% string:~%%~a=abc<br />&nbsp; &nbsp; echo %%SET/S%% STRING:~%%~a=abc!TAB!!TAB!!string!<br />)<br />echo/<br />for %%a in (&quot;0,3&quot; &quot;4,4&quot;) do (<br />&nbsp; &nbsp; set string=0123456789<br />&nbsp; &nbsp; %set/s% string:~%%~a=abc<br />&nbsp; &nbsp; echo %%SET/S%% STRING:~%%~a=abc!TAB!!TAB!!string!<br />)<br />for %%a in (&quot;-3,1&quot; &quot;-0,2&quot; &quot;13,4&quot;) do (<br />&nbsp; &nbsp; set string=0123456789<br />&nbsp; &nbsp; %set/s% string:~%%~a=abc<br />&nbsp; &nbsp; echo %%SET/S%% STRING:~%%~a=abc!TAB!!string!<br />)<br />echo/<br />for %%a in (&quot;0,-3&quot; &quot;4,-4&quot; &quot;-3,-1&quot; &quot;-0,-2&quot; &quot;13,-4&quot;) do (<br />&nbsp; &nbsp; set string=0123456789<br />&nbsp; &nbsp; %set/s% string:~%%~a=abc<br />&nbsp; &nbsp; echo %%SET/S%% STRING:~%%~a=abc!TAB!!string!<br />)<br />echo/<br />for %%a in (&quot;0,-0&quot; &quot;4,-0&quot; &quot;-3,-0&quot; &quot;-0,-0&quot; &quot;13,-0&quot;) do (<br />&nbsp; &nbsp; set string=0123456789<br />&nbsp; &nbsp; %set/s% string:~%%~a=abc<br />&nbsp; &nbsp; echo %%SET/S%% STRING:~%%~a=abc!TAB!!string!<br />)<br />echo/<br /></code></pre></div>Results:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SET STRING=0123456789<br /><br />%SET/S% STRING:~0=abc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;abc0123456789<br />%SET/S% STRING:~4=abc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0123abc456789<br />%SET/S% STRING:~-3=abc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0123456abc789<br />%SET/S% STRING:~-0=abc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0123456789abc<br />%SET/S% STRING:~13=abc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0123456789&nbsp; &nbsp;abc<br /><br />%SET/S% STRING:~0,3=abc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;abc3456789<br />%SET/S% STRING:~4,4=abc&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0123abc89<br />%SET/S% STRING:~-3,1=abc&nbsp; &nbsp; &nbsp; &nbsp; 0123456abc89<br />%SET/S% STRING:~-0,2=abc&nbsp; &nbsp; &nbsp; &nbsp; 0123456789abc<br />%SET/S% STRING:~13,4=abc&nbsp; &nbsp; &nbsp; &nbsp; 0123456789&nbsp; &nbsp;abc<br /><br />%SET/S% STRING:~0,-3=abc&nbsp; &nbsp; &nbsp; &nbsp; abc789<br />%SET/S% STRING:~4,-4=abc&nbsp; &nbsp; &nbsp; &nbsp; 0123abc6789<br />%SET/S% STRING:~-3,-1=abc&nbsp; &nbsp; &nbsp; &nbsp;0123456abc9<br />%SET/S% STRING:~-0,-2=abc&nbsp; &nbsp; &nbsp; &nbsp;0123456789abc<br />%SET/S% STRING:~13,-4=abc&nbsp; &nbsp; &nbsp; &nbsp;0123456789&nbsp; &nbsp;abc<br /><br />%SET/S% STRING:~0,-0=abc&nbsp; &nbsp; &nbsp; &nbsp; abc<br />%SET/S% STRING:~4,-0=abc&nbsp; &nbsp; &nbsp; &nbsp; 0123abc<br />%SET/S% STRING:~-3,-0=abc&nbsp; &nbsp; &nbsp; &nbsp;0123456abc<br />%SET/S% STRING:~-0,-0=abc&nbsp; &nbsp; &nbsp; &nbsp;0123456789abc<br />%SET/S% STRING:~13,-0=abc&nbsp; &nbsp; &nbsp; &nbsp;0123456789&nbsp; &nbsp;abc<br /></code></pre></div><br /><strong class="text-strong">SET/A</strong> is a macro that execute a SET /A command, but first replace the values returned by Batch functions. For example:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>%SET/A% variable=Func2(Param1,Param2)+var*Func1(Param)+234-Func0()</code></pre></div>The functions are standard Batch subroutines with a last parameter that indicate the variable that recieve the numeric result. For example:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:Func2 Param1 Param2 Result=<br />setlocal EnableDelayedExpansion<br />rem Do some calculation on Param1 and Param2, and get Result<br />rem . . .<br />endlocal &amp; set %3=%result%<br />exit /B</code></pre></div>If the Batch function takes its numeric parameters via SET /A commands...<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set /A &quot;Param1=%~1&quot;<br />set /A &quot;Param2=%~2&quot;<br /></code></pre></div>... then function parameters in %SET/A% macro may also include expressions:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>%SET/A% variable=Func2(var3*var4,3*var5+6)+var*Func1(var1*2)+234-Func0()</code></pre></div><br />Remember that Batch parameter delimiters may be comma, semicolon or equal-sign, besides spaces, so &quot;FUNC3(P1,P2,P3)&quot; is the same as &quot;FUNC3(P1 P2 P3)&quot; and also &quot;FUNC3(P1;P2=P3)&quot;. If a parameter may include anyone of these characters, it must be enclosed in quotes.<br /><br />This is <strong class="text-strong">SET/A</strong> macro:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />::SET/A - Macro that expand function results in arithmetic expressions<br />::Antonio Perez Ayala<br />::Dec/26/2011 - v1.0 Parse functions, replace their return values, execute SET /A<br /><br />setlocal DisableDelayedExpansion<br />set LF=^<br /><br /><br />::Above 2 blank lines are required - do not remove<br />set ^&quot;\n=^^^%LF%%LF%^%LF%%LF%^^&quot;<br /><br />set set/a=for %%n in (1 2) do if %%n==2 (%\n%<br />&nbsp; &nbsp; &nbsp; rem 1- Store functions start and size in setA.F# array %\n%<br />&nbsp; &nbsp; &nbsp; for %%v in (N opPos exprLen) do set setA.%%v=0%\n%<br />&nbsp; &nbsp; &nbsp; for /L %%p in (12,-1,0) do (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A &quot;setA.exprLen|=1&lt;&lt;%%p&quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for %%l in (!setA.exprLen!) do if &quot;!setA.expr:~%%l,1!&quot;==&quot;&quot; set /A &quot;setA.exprLen&amp;=~1&lt;&lt;%%p&quot;%\n%<br />&nbsp; &nbsp; &nbsp; )%\n%<br />&nbsp; &nbsp; &nbsp; set &quot;setA.copyExpr=!setA.expr!&quot;%\n%<br />&nbsp; &nbsp; &nbsp; for %%o in (+ - / %%%% ^^! ^^^&gt; ^^^&lt; ^^^&amp; ^^^|) do set &quot;setA.copyExpr=!setA.copyExpr:%%o=*!&quot;%\n%<br />&nbsp; &nbsp; &nbsp; for %%v in (parenLevel namePos funcLevel) do set setA.%%v=%\n%<br />&nbsp; &nbsp; &nbsp; for /L %%c in (0,1,!setA.exprLen!) do (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set setA.char=!setA.copyExpr:~%%c,1!%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if defined setA.funcLevel (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &quot;!setA.char!&quot; == &quot;)&quot; (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A setA.funcLevel-=1%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if !setA.funcLevel! == 0 (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A setA.N+=1, setA.funcLevel=%%c-setA.namePos%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for %%n in (!setA.N!) do (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;setA.F%%n=!setA.namePos! !setA.funcLevel!&quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for %%v in (namePos funcLevel) do set setA.%%v=%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem noelse%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else if &quot;!setA.char!&quot; == &quot;(&quot; (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A setA.funcLevel+=1%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) else if defined setA.namePos (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &quot;!setA.char!&quot; == &quot;(&quot; (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set setA.funcLevel=1%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &quot;!setA.char!&quot; == &quot;=&quot; set setA.opPos=%%c^&amp; set setA.namePos=%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &quot;!setA.char!&quot; == &quot;*&quot; set setA.opPos=%%c^&amp; set setA.namePos=%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if &quot;!setA.char!&quot; == &quot;~&quot; set setA.opPos=%%c^&amp; set setA.namePos=%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) else if defined setA.parenLevel (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &quot;!setA.char!&quot; == &quot;)&quot; (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A setA.parenLevel-=1%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if !setA.parenLevel! == 0 set setA.parenLevel=%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else if &quot;!setA.char!&quot; == &quot;(&quot; (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set /A setA.parenLevel+=1%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) else if defined setA.opPos (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &quot;!setA.char!&quot; == &quot;(&quot; (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set setA.parenLevel=1%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set setA.opPos=%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else if not &quot;!setA.char!&quot; == &quot; &quot; (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set setA.namePos=%%c%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set setA.opPos=%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;) else (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &quot;!setA.char!&quot; == &quot;=&quot; set setA.opPos=%%c%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &quot;!setA.char!&quot; == &quot;*&quot; set setA.opPos=%%c%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if &quot;!setA.char!&quot; == &quot;~&quot; set setA.opPos=%%c%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)%\n%<br />&nbsp; &nbsp; &nbsp; )%\n%<br />&nbsp; &nbsp; &nbsp; rem 2- Call setA.F# functions and replace they by their return values %\n%<br />&nbsp; &nbsp; &nbsp; set setA.copyExpr=%\n%<br />&nbsp; &nbsp; &nbsp; set setA.lastStartCopy=0%\n%<br />&nbsp; &nbsp; &nbsp; for /L %%i in (1,1,!setA.N!) do (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /F &quot;tokens=1,2&quot; %%a in (&quot;!setA.F%%i!&quot;) do (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set setA.func=!setA.expr:~%%a,%%b!%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A setA.lastSizeCopy=%%a-setA.lastStartCopy%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A setA.newStartCopy=%%a+%%b+1%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /F &quot;tokens=1* delims=(&quot; %%a in (&quot;!setA.func!&quot;) do call %%a %%b setA.R=%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for /F &quot;tokens=1,2&quot; %%a in (&quot;!setA.lastStartCopy! !setA.lastSizeCopy!&quot;) do (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;setA.copyExpr=!setA.copyExpr!!setA.expr:~%%a,%%b!!setA.R!&quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;)%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set setA.lastStartCopy=!setA.newStartCopy!%\n%<br />&nbsp; &nbsp; &nbsp; )%\n%<br />&nbsp; &nbsp; &nbsp; set /A setA.lastSizeCopy=setA.exprLen-setA.lastStartCopy+1%\n%<br />&nbsp; &nbsp; &nbsp; for /F &quot;tokens=1,2&quot; %%a in (&quot;!setA.lastStartCopy! !setA.lastSizeCopy!&quot;) do (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set &quot;setA.copyExpr=!setA.copyExpr!!setA.expr:~%%a,%%b!&quot;%\n%<br />&nbsp; &nbsp; &nbsp; )%\n%<br />&nbsp; &nbsp; &nbsp; rem 3- Execute SET /A command on final expression %\n%<br />&nbsp; &nbsp; &nbsp; set /A !setA.copyExpr!%\n%<br />&nbsp; &nbsp;) else set setA.expr=<br /><br /><br />setlocal EnableDelayedExpansion<br /><br />set &quot;string=this has a length of 23&quot;<br />%set/a% length=:StrLen(string)<br />echo The result is: %length%<br />%set/a% sum=:StrLen(string) + :StrLen(&quot;And this have 16&quot;)<br />echo The sum of two lengths is: %sum%<br />%set/a% result=:StrLen(String)*1000 / sum<br />echo The first lenght times 1000 divided by the previous sum is: %result%<br />goto :EOF<br /><br /><br />:StrLen string &#91;result=&#91;adjust&#93;&#93;<br />setlocal enableDelayedExpansion<br />set str=%1<br />set str=!str:&quot;= !<br />if &quot;!str:~0,1!&quot; == &quot; &quot; (<br />&nbsp; &nbsp; set &quot;str=0%~1&quot;<br />) else (<br />&nbsp; &nbsp; set &quot;str=0!%1!&quot;<br />)<br />set len=0<br />for /L %%A in (12,-1,0) do (<br />&nbsp; &nbsp;set /A &quot;len|=1&lt;&lt;%%A&quot;<br />&nbsp; &nbsp;for %%B in (!len!) do if &quot;!str:~%%B,1!&quot; == &quot;&quot; set /A &quot;len&amp;=~1&lt;&lt;%%A&quot;<br />)<br />for %%v in (!len!) do endlocal&amp;if not &quot;%2&quot; == &quot;&quot; (set /A &quot;%2=%%v%3&quot;) else echo %%v<br />exit /B</code></pre></div>Results:<blockquote><div><cite>Output wrote:</cite>The result is: 23<br />The sum of two lengths is: 39<br />The first lenght times 1000 divided by the previous sum is: 589<br /></div></blockquote>You must be aware that SET/A macro does NOT include the usual SETLOCAL/ENDLOCAL commands.<br /><br />The original SET /A command may assign values to several variables in the same expression:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>SET /A var1=1*2+3, var2=123*456/321, var3=var1+var2</code></pre></div><br />To do the same thing in a local environment, SET/A macro would need to complete a much more detailed analysis of the expression and end with an ENDLOCAL command followed by several variable assignments; this behavior is beyond its original design. If SETLOCAL/ENDLOCAL commands are omitted in SET/A macro, the variable assignments in its expression will be directly done in the same environment of the caller program.<br /><br />To avoid modification of local variables, all variable names used in SET/A macro have the &quot;setA.&quot; prefix. However, if %set/a% macro would be used <em class="text-italics">in a nested way</em>, the function that create the nesting MUST include a SETLOCAL/ENDLOCAL pair, as described below.<br /><br /><strong class="text-strong">EDIT</strong>: I slightly modified StrLen function so it can get the string both as variable name or &quot;constant&quot; in quotes.</div>

			
													<div class="notice">
					Last edited by <a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a> on 01 Nov 2012 10:28, edited 4 times in total.
									</div>
			
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p12305" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile12305">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content12305">

						<h3 ><a href="#p12305">SET/A: Macro to expand function results in SET /A expression</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting9cda.html?mode=quote&amp;f=3&amp;p=12305" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopica69e.html?p=12305#p12305" onclick="prompt('Message #2',this.href); return false;">#2</a></span> 
									<a class="unread" href="viewtopica69e.html?p=12305#p12305" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>27 Dec 2011 00:09
			</p>
			
			
			
			<div class="content">2- <strong class="text-strong">Library of functions to be used in SET/A macro.</strong><br /><br />Let's define some stuff designed to be used with SET/A macro. Note that these functions does not check for any errors in order to keep them simple and fast. For example:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:NEG N R=-N<br />set /A &quot;%2=-(%~1)&quot;<br />exit /B<br /><br />:ABS N R=ABS(N)<br />set /A &quot;%2=%~1&quot;<br />if !%2! LSS 0 set /A %2=-%2<br />exit /B<br /></code></pre></div>Et cetera, the complete listing is shown later; it includes ISQRT function that get the integer square root of a number.<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:IHYPOT X Y R=SQRT(X^2+Y^2)<br />%set/a% %3=ISQRT((%~1)*(%~1)+(%~2)*(%~2))<br />exit /B<br /></code></pre></div>Note that when a program use IHYPOT, i.e.: <strong class="text-strong">%set/a% Radius=IHYPOT(X,Y)</strong>, IHYPOT in turn use %set/a% macro. Mean this detail that SET/A code is RE-ENTRANT? Not exactly. Execution of %set/a% in caller program use a <em class="text-italics">different expansion</em> of SET/A macro in IHYPOT function so, strictly speaking, both parts does not execute the <em class="text-italics">same</em> code. However, because SET/A macro does not include its own SETLOCAL/ENDLOCAL commands, IHYPOT <strong class="text-strong">MUST</strong> include them as previously explained.<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:IHYPOT X Y R=SQRT(X^2+Y^2)<br />setlocal<br />%set/a% r=ISQRT((%~1)*(%~1)+(%~2)*(%~2))<br />endlocal &amp; set %3=%r%<br />exit /B<br /></code></pre></div>(Yes, I know that IHYPOT could just CALL ISQRT (%~1)*(%~1)+(%~2)*(%~2) %3= to achieve the same thing, but this way is not as interesting as the former one, right?)<br /><br />Let's define now some Boolean stuff. To compare two numbers, the first idea is to define a series of relational functions:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:EQU A B R=<br />set %3=0<br />if %1 EQU %2 set %3=1<br />exit /B<br /><br />:NEQ A B R=<br />set %3=0<br />if %1 NEQ %2 set %3=1<br />exit /B<br /><br />:Etc. A B R=<br />set %3=0<br />if %1 Etc. %2 set %3=1<br />exit /B<br /></code></pre></div>However, it is more convenient to define a unique function that achieve any desired test:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:TEST A VS B R=<br />set %4=0<br />if %1 %2 %3 set %4=1<br />exit /B<br /></code></pre></div>This way, TEST function may be modified to achieve additional tests. For example, to add <strong class="text-strong">TEST c IN stringVar</strong> test:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:TEST A VS B R=<br />setlocal EnableDelayedExpansion<br />set r=0<br />if /I %2 == IN goto else<br />&nbsp; &nbsp;%set/a% &quot;a=%~1&quot;<br />&nbsp; &nbsp;%set/a% &quot;b=%~2&quot;<br />&nbsp; &nbsp;if !a! %2 !b! set r=1<br />&nbsp; &nbsp;goto endif<br />:else<br />&nbsp; &nbsp;REM TEST c IN stringVar<br />&nbsp; &nbsp;rem Next lines use ASCII 255 character, NOT a space<br />&nbsp; &nbsp;set &quot;temp=!%3:%1= !&quot;<br />&nbsp; &nbsp;if not &quot;!temp!&quot; == &quot;!%3!&quot; (<br />&nbsp; &nbsp; &nbsp; for /F &quot;delims= &quot; %%a in (&quot;0!temp!&quot;) do set &quot;temp=%%a&quot;<br />&nbsp; &nbsp; &nbsp; call :StrLen temp temp=-1<br />&nbsp; &nbsp; &nbsp; for %%i in (!temp!) do if &quot;!%3:~%%i,1!&quot; == &quot;%1&quot; set /A r=%%i+1<br />&nbsp; &nbsp;)<br />:endif<br />endlocal &amp; set %4=%r%<br />exit /B<br /><br />:NOT A R=!A<br />set %2=0<br />if %1 EQL 0 set %2=1<br />exit /B<br /><br />:AND A B R=A&amp;B<br />set /A %3=%1*%2<br />if %3 NEQ 0 set %3=1<br />exit /B<br /><br />:OR A B R=A|B<br />set /A %3=%1+%2<br />if %3 NEQ 0 set %3=1<br />exit /B<br /><br />:IFTE C X Y R=C?X:Y<br />if %1 NEQ 0 (<br />&nbsp; &nbsp;set %4=%2<br />) else (<br />&nbsp; &nbsp;set %4=%3<br />)<br />exit /B<br /></code></pre></div>Suppose we want to define a function to get the maximum of three values:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:MAX3 P1 P2 P3 R=MAX3(P1,P2,P3)<br />setlocal<br />%set/a% r=IFTE(&quot;TEST(%1 GTR %2)&quot;,MAX(%1,%3),MAX(%2,%3))<br />endlocal &amp; set %4=%r%<br />exit /B<br /></code></pre></div>Previous code needs to expand the value of three functions placed as parameters of a first one, but functions can not be enclosed in parentheses in original SET/A macro design. To solve this problem, take nested functions out from parentheses and use their return values <em class="text-italics">in a separate line</em> in the first function:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:MAX3 P1 P2 P3 R=MAX3(P1,P2,P3)<br />setlocal<br />%set/a% P1gtrP2=&quot;TEST(%1 GTR %2)&quot;, MaxP1P3=MAX(%1,%3), MaxP2P3=MAX(%2,%3)<br />%set/a% r=IFTE(%P1gtrP2%,%MaxP1P3%,%MaxP2P3%)<br />endlocal &amp; set %4=%r%<br /></code></pre></div>The four assignments can not be achieved in the same line because the way SET/A macro works: it FIRST execute the functions and replace return results, and THEN execute the final SET /A command. Another possible solution is to force an <em class="text-italics">immediate set</em> of the first variables via a function specifically designed to transgress SET/A macro rules.<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:IMMSET setVar=Expr Result=0<br />%set/a% %1=%2<br />set %3=0<br />exit /B<br /><br />:MAX3 P1 P2 P3 R=MAX3(P1,P2,P3)<br />setlocal EnableDelayedExpansion<br />%set/a% IMMSET(P1gtrP2=&quot;TEST(%1 GTR %2)&quot;), %\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IMMSET(MaxP1P3=MAX(%1,%3)),&nbsp; &nbsp; &nbsp;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;IMMSET(MaxP2P3=MAX(%2,%3)),&nbsp; &nbsp; &nbsp;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; r=IFTE(P1gtrP2,MaxP1P3,MaxP2P3)<br />endlocal &amp; set %4=%r%<br />exit /B<br /></code></pre></div>To become more standard, IMMSET function should pass the same assigned value to its %set/a% macro caller. It could also show the assigned value when requested, so we may use it to review a partial result in a long expression.<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:IMMSET &#91;/V&#93; setVar=Expr R=<br />setlocal<br />if /I %1 == /V shift<br />%set/a% &quot;v=%~2&quot;<br />if /I %0 == /V echo IMMSET: %1=%v%<br />endlocal &amp; set /A %1=%3=%v%<br />exit /B<br /></code></pre></div>If a function is frequently used with nested functions as parameters, it may take the values of its parameters via a nested %set/a% macro instead of the usual SET /A (like previous IMMSET). All Boolean functions of this library were written this way (in the library listing, not in the example text above). For example:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:IFTE C X Y R=C?X:Y<br />setlocal<br />%set/a% &quot;c=%~1&quot;<br />if %c% neq 0 (<br />&nbsp; &nbsp;%set/a% &quot;r=%~2&quot;<br />) else (<br />&nbsp; &nbsp;%set/a% &quot;r=%~3&quot;<br />)<br />endlocal &amp; set %4=%r%<br />exit /B<br /></code></pre></div>The only restriction to nest %set/a% macro in a function is the size of the final command to execute. For example, previous IF include <em class="text-italics">two expansions</em> of SET/A macro, so is important to keep it below 4 KB. Otherwise, the function must be rewritten in the old fashion way, with GOTO's.<br /><br />This way, the MAX3 function can be finally written as shown in the first example above...<br /><br />There is still a problem if both the first level and nested functions may require to enclose a parameter in quotes because in this case we should need <em class="text-italics">nested quotes</em> to correctly write they. The only solution to this problem is to improve SET/A macro capabilites to parse and execute nested functions. I am currently working on this point...<br /><br />You may easily test any library function with this code:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>echo/<br />echo Available values for character testing:<br />echo/<br />echo set digits=0123456789<br />echo set upcase=ABCDEFGHIJKLMNOPQRSTUVWXYZ<br />echo set lowcase=abcdefghijklmnopqrstuvwxyz<br />echo/<br />set digits=0123456789<br />set upcase=ABCDEFGHIJKLMNOPQRSTUVWXYZ<br />set lowcase=abcdefghijklmnopqrstuvwxyz<br />:loop<br />&nbsp; &nbsp;set expr=<br />&nbsp; &nbsp;set /P expr=Expression: <br />&nbsp; &nbsp;if not defined expr goto :EOF<br />&nbsp; &nbsp;%set/a% result=%expr%<br />&nbsp; &nbsp;echo Result:&nbsp; &nbsp; &nbsp;%result%<br />goto loop<br /></code></pre></div>Some examples:<blockquote><div><cite>Output wrote:</cite>Available values for character testing:<br /><br />set digits=0123456789<br />set upcase=ABCDEFGHIJKLMNOPQRSTUVWXYZ<br />set lowcase=abcdefghijklmnopqrstuvwxyz<br /><br />Expression: :StrLen(&quot;Ten letters&quot;)<br />Result:     11<br />Expression: :StrLen(&quot;Nineteen characters&quot;)<br />Result:     19<br />Expression: :StrLen(digits)*10+:StrLen(upcase)<br />Result:     126<br />Expression: :NEG(1)<br />Result:     -1<br />Expression: result*(5*8+3)<br />Result:     -43<br />Expression: :ABS(result)<br />Result:     43<br />Expression: :MAX(result,2*5+1)<br />Result:     43<br />Expression: :MIN(result,2*5+1)<br />Result:     11<br />Expression: result*result<br />Result:     121<br />Expression: result*result<br />Result:     14641<br />Expression: result*result<br />Result:     214358881<br />Expression: :ISQRT(result)<br />Result:     14641<br />Expression: :ISQRT(result)<br />Result:     121<br />Expression: :ISQRT(result)<br />Result:     11<br />Expression: :RANDOMAB(50*2,40*3)<br />Result:     105<br />Expression: :RANDOMAB(50*2,40*3)<br />Result:     109<br />Expression: :RANDOMAB(50*2,40*3)<br />Result:     103<br />Expression: :FACTORIAL(10)<br />Result:     3628800<br />Expression: :IPOW(2,10)<br />Result:     1024<br />Expression: result*1024<br />Result:     1048576<br />Expression: result*1024<br />Result:     1073741824<br />Expression: :IPOW(2,30)<br />Result:     1073741824<br />Expression: :IPOW(result,-20,2)<br />Result:     1024<br />Expression: :IHYPOT(3,4)<br />Result:     5<br />Expression: :TEST(3*15 GTR 2*20)<br />Result:     1<br />Expression: :IFTE(result,3*15,2*20)<br />Result:     45<br />Expression: :IFTE(&quot;:TEST(3*15 GTR 2*20)&quot;,3*15,2*20)<br />Result:     45<br />Expression: :IMMSET(/V,R1=3*15)+:IMMSET(/V,R2=2*20)<br />IMMSET: R1=45<br />IMMSET: R2=40<br />Result:     85<br />Expression: :IFTE(&quot;:TEST(R1 GTR R2)&quot;,R1,R2)<br />Result:     45<br />Expression: :TEST(x IN digits)<br />Result:     0<br />Expression: :IMMSET(/V,IsLower=&quot;:TEST(x IN lowcase)&quot;)*:IMMSET(/V,IsUpper=&quot;:TEST(x IN upcase)&quot;)*:IFTE(&quot;:OR(IsLower,IsUpper)&quot;,&quot;:OUT(x is Letter)&quot;,&quot;:OUT(x is NOT letter)&quot;)<br />IMMSET: IsLower=24<br />IMMSET: IsUpper=0<br />OUT: x is Letter<br />Result:     0<br />Expression: :IMMSET(/V,IsLower=&quot;:TEST(X IN lowcase)&quot;)*:IMMSET(/V,IsUpper=&quot;:TEST(X IN upcase)&quot;)*:IFTE(&quot;:OR(IsLower,IsUpper)&quot;,&quot;:OUT(X is Letter)&quot;,&quot;:OUT(X is NOT letter)&quot;)<br />IMMSET: IsLower=0<br />IMMSET: IsUpper=24<br />OUT: X is Letter<br />Result:     0<br />Expression: :IMMSET(/V,IsLower=&quot;:TEST(5 IN lowcase)&quot;)*:IMMSET(/V,IsUpper=&quot;:TEST(5 IN upcase)&quot;)*:IFTE(&quot;:OR(IsLower,IsUpper)&quot;,&quot;:OUT(5 is Letter)&quot;,&quot;:OUT(5 is NOT letter)&quot;)<br />IMMSET: IsLower=0<br />IMMSET: IsUpper=0<br />OUT: 5 is NOT letter<br />Result:     0<br />Expression: :IFTE(&quot;:TEST(5 IN digits)&quot;,&quot;:OUT(5 is Digit)&quot;,&quot;:OUT(5 is NOT Digit)&quot;)<br />OUT: 5 is Digit<br />Result:     0<br />Expression: :CHOOSE(1,&quot;31 28 31 30 31 30 31 31 30 31 30 31&quot;)<br />Result:     31<br />Expression: :CHOOSE(2,&quot;31 28 31 30 31 30 31 31 30 31 30 31&quot;)<br />Result:     28<br />Expression: :CHOOSE(4,&quot;31 28 31 30 31 30 31 31 30 31 30 31&quot;)<br />Result:     30<br />Expression:<br /></div></blockquote>Below is the complete library functions listing.<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>::SET/A Macro basic library functions<br />::Antonio Perez Ayala<br />::Dec/26/2011 - Arithmetic, Boolean and some Special functions.<br /><br /><br />REM Arithmetic functions<br /><br />:NEG N R=-N<br />set /A &quot;%2=-(%~1)&quot;<br />exit /B<br /><br />:ABS N R=ABS(N)<br />set /A &quot;%2=%~1&quot;<br />if !%2! LSS 0 set /A %2=-%2<br />exit /B<br /><br />:MAX A B R=MAX(A,B)<br />setlocal EnableDelayedExpansion<br />set /A &quot;r=(%~1), b=%~2&quot;<br />if %b% GTR %r% set r=%b%<br />endlocal &amp; set %3=%r%<br />exit /B<br /><br />:MIN A B R=MIN(A,B)<br />setlocal EnableDelayedExpansion<br />set /A &quot;r=(%~1), b=%~2&quot;<br />if %b% LSS %r% set r=%b%<br />endlocal &amp; set %3=%r%<br />exit /B<br /><br />:RANDOMAB A B R=RANDOM in A..B range<br />set /A &quot;%3=((%~2)-(%~1)+1)*%random%/32768+(%~1)&quot;<br />exit /B<br />&nbsp;<br />:FACTORIAL N R=N!<br />set %2=1<br />for /L %%i in (2,1,%1) do set /A %2*=%%i<br />exit /B<br /><br />:IPOW N E &#91;B&#93; R=N^E<br />REM If the Exponent is negative, the Base must be given<br />setlocal EnableDelayedExpansion<br />set /A &quot;n=(%~1), e=(%~2)&quot;<br />if %e% geq 0 (<br />&nbsp; &nbsp;set v=%3<br />&nbsp; &nbsp;set r=1<br />&nbsp; &nbsp;for /L %%i in (1,1,%e%) do set /A r*=n<br />) else (<br />&nbsp; &nbsp;set v=%4<br />&nbsp; &nbsp;set r=%n%<br />&nbsp; &nbsp;for /L %%i in (%e%,1,-1) do set /A r/=%3<br />)<br />endlocal &amp; set %v%=%r%<br />exit /B<br /><br />:ISQRT N R=Integer Square Root(N)<br />setlocal EnableDelayedExpansion<br />set /A &quot;n=%~1&quot;<br />call :StrLen n d=/2<br />if %n% lss 36 (set r0=5) else set /A r0=n/!n:~0,%d%!<br />:isqrtLoop<br />&nbsp; &nbsp;set /A r1=(n/r0+r0)/2<br />&nbsp; &nbsp;if %r1% geq %r0% goto isqrtEnd<br />&nbsp; &nbsp;set r0=%r1%<br />&nbsp; &nbsp;goto isqrtLoop<br />:isqrtEnd<br />endlocal &amp; set %2=%r0%<br />exit /B<br /><br />:IHYPOT X Y R=SQRT(X^2+Y^2)<br />call :ISQRT &quot;(%~1)*(%~1)+(%~2)*(%~2)&quot; %3=<br />exit /B<br /><br /><br />REM Boolean functions<br /><br />:TEST A VS B R=<br />setlocal EnableDelayedExpansion<br />set r=0<br />if /I %2 == IN goto else<br />&nbsp; &nbsp;%set/a% &quot;a=%~1&quot;<br />&nbsp; &nbsp;%set/a% &quot;b=%~2&quot;<br />&nbsp; &nbsp;if !a! %2 !b! set r=1<br />&nbsp; &nbsp;goto endif<br />:else<br />&nbsp; &nbsp;REM TEST strConst IN stringVar<br />&nbsp; &nbsp;rem Next lines use ASCII 255 character, NOT a space<br />&nbsp; &nbsp;set &quot;temp=!%3:%~1= !&quot;<br />&nbsp; &nbsp;if not &quot;!temp!&quot; == &quot;!%3!&quot; (<br />&nbsp; &nbsp; &nbsp; for /F &quot;delims= &quot; %%a in (&quot;0!temp!&quot;) do set &quot;temp=%%a&quot;<br />&nbsp; &nbsp; &nbsp; call :StrLen temp temp=-1<br />&nbsp; &nbsp; &nbsp; call :StrLen &quot;%~1&quot; const=<br />&nbsp; &nbsp; &nbsp; for /F &quot;tokens=1,2&quot; %%i in (&quot;!temp! !const!&quot;) do if &quot;!%3:~%%i,%%j!&quot; == &quot;%1&quot; set /A r=%%i+1<br />&nbsp; &nbsp;)<br />:endif<br />endlocal &amp; set %4=%r%<br />exit /B<br /><br />:NOT A R=!A<br />setlocal<br />%set/a% &quot;a=%~1&quot;<br />set r=0<br />if %a% eql 0 set r=1<br />endlocal &amp; set %2=%r%<br />exit /B<br /><br />:AND A B R=A&amp;B<br />setlocal<br />%set/a% &quot;a=%~1&quot;<br />%set/a% &quot;b=%~2&quot;<br />set /A r=a*b<br />if %r% neq 0 set r=1<br />endlocal &amp; set %3=%r%<br />exit /B<br /><br />:OR A B R=A|B<br />setlocal<br />%set/a% &quot;a=%~1&quot;<br />%set/a% &quot;b=%~2&quot;<br />set /A r=a+b<br />if %r% neq 0 set r=1<br />endlocal &amp; set %3=%r%<br />exit /B<br /><br />:IFTE C X Y R=C?X:Y<br />setlocal<br />%set/a% &quot;c=%~1&quot;<br />if %c% neq 0 (<br />&nbsp; &nbsp;%set/a% &quot;r=%~2&quot;<br />) else (<br />&nbsp; &nbsp;%set/a% &quot;r=%~3&quot;<br />)<br />endlocal &amp; set %4=%r%<br />exit /B<br /><br /><br />REM Special functions<br /><br />:IMMSET &#91;/V&#93; setVar=Expr R=<br />setlocal<br />if /I %1 == /V shift<br />%set/a% &quot;v=%~2&quot;<br />if /I %0 == /V echo IMMSET: %1=%v%<br />endlocal &amp; set /A %1=%3=%v%<br />exit /B<br /><br />:OUT Message R=0<br />setlocal<br />set message=%1<br />:outLoop<br />&nbsp; &nbsp;shift<br />&nbsp; &nbsp;if &quot;%2&quot; == &quot;&quot; goto outEndloop<br />&nbsp; &nbsp;set message=%message% %1<br />&nbsp; &nbsp;goto outLoop<br />:outEndloop<br />echo OUT: %message%<br />endlocal &amp; set %1=0<br />exit /B<br /><br />:CHOOSE I &quot;N1 N2 ...&quot; R=N%I%<br />for /F &quot;tokens=%1&quot; %%a in (%2) do set /A %3=%%a<br />exit /B<br /></code></pre></div></div>

			
													<div class="notice">
					Last edited by <a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a> on 10 Jan 2012 23:52, edited 1 time in total.
									</div>
			
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p12523" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile12523">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content12523">

						<h3 ><a href="#p12523">SET/A: Macro to expand function results in SET /A expression</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting4ed6.html?mode=quote&amp;f=3&amp;p=12523" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic7901.html?p=12523#p12523" onclick="prompt('Message #3',this.href); return false;">#3</a></span> 
									<a class="unread" href="viewtopic7901.html?p=12523#p12523" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>03 Jan 2012 19:38
			</p>
			
			
			
			<div class="content">3- <strong class="text-strong">Fractional (fixed point) operations using integer numbers.</strong><br /><br />Arithmetic operations of SET /A command use 32-bits signed numbers with this range of values: -2147483648 to 2147483647. If a certain result requires less <em class="text-italics">integer</em> digits, the rest may be used for <em class="text-italics">fractional</em> part. To do that, just choose a number of fractional digits and preserve it throughout the operations. We may develop a set of functions that manage fixed point numbers written in any way (even as floating point numbers with an exponent of ten) and adjust them as needed, but let's start from a simpler approach. The functions below assume that the numbers have the right value, so is up to us to write them correctly; this way, the functions are simpler and faster.<br /><br />These are the rules to achieve FixedPoint operations using integer numbers:<br /><ul><br /><li> &quot;ONE&quot; variable must contain a 1 followed by the right number of decimal zeros; this variable is used as the FP base value in several functions.</li><li> To convert a (well-written) FP number to integer, just remove the decimal point and delete left zeros.</li><li> If two FP numbers are added or subtracted, the result is correct.</li><li> If a FP number is multiplied or divided by an integer, the result is correct.</li><li> To multiply two FP numbers, divide the result by ONE: SET /A MUL=A*B/ONE.</li><li> To divide two FP numbers, multiply the first by ONE: SET /A DIV=A*ONE/B.</li></ul><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>::Jan/03/2012 - Fixed Point operations using integer numbers<br /><br />:FPTOINT I.F INT=<br />setlocal EnableDelayedExpansion<br />set num=%1<br />set sign=<br />if %num:~0,1% == - set num=%num:~1%&amp; set sign=-<br />set num=%num:.=%<br />:removeLeftZeros<br />&nbsp; &nbsp;if %num:~0,1% == 0 set num=%num:~1%&amp; if defined num goto removeLeftZeros<br />if not defined num set num=0&amp; set sign=<br />endlocal &amp; set %2=%sign%%num%<br />exit /B<br /><br />:INTTOFP INT &#91;I.F=&#93;<br />setlocal EnableDelayedExpansion<br />set /A &quot;num=%~1&quot;<br />set sign=<br />if %num% lss 0 set /A num=-num &amp; set sign=-<br />call :StrLen One digits=-1<br />call :StrLen num numLen=<br />for /L %%d in (%numLen%,1,%digits%) do set num=0!num!<br />set num=%sign%!num:~0,-%digits%!.!num:~-%digits%!<br />endlocal &amp; if &quot;%2&quot; == &quot;&quot; (echo %num%) else set %2=%num%<br />exit /B<br /><br />:FPMULFP A B R=A*B<br />set /A &quot;%3=(%~1)*(%~2)/One&quot;<br />exit /B<br /><br />:FPDIVFP A B R=A/B<br />set /A &quot;%3=(%~1)*One/(%~2)&quot;<br />exit /B<br /><br />:FPMUL_DIVFP A B C R=A*B/C<br />set /A &quot;%4=(%~1)*(%~2)/(%~3)&quot;<br />exit /B<br /><br />:FPSQRT N R=SQRT(N)<br />call :ISQRT &quot;(%~1)*One&quot; %2=<br />exit /B<br /><br />:FPHYPOT X Y R=SQRT(X^2+Y^2)<br />call :FPSQRT &quot;(%~1)*(%~1)/One+(%~2)*(%~2)/One&quot; %3=<br />exit /B<br /></code></pre></div>Note that the multiplication must always be done first; if the division would be achieved first, significant digits would be lost. This order limits the number of integer digits because the multiplication result must fit in the 32-bits signed value. FPMUL_DIVFP function provide a more precise result than two separated MUL and DIV.<br /><br />Some examples:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set One=100<br />%set/a% Result=:FPTOINT(1.25)*4-:FPTOINT(0.30)<br />call :INTTOFP Result Result=<br />echo 1.25 * 4 - 0.30 = %Result%<br /><br />set One=1000000000<br />call :INTTOFP One/3 OneThird=<br />echo 1/3 with 9 decimals: %OneThird%<br /><br />set One=1000000<br />call :INTTOFP 355*One/113 pi=<br />echo 355/113 approximation to PI with 6 decimals: %pi%<br /><br />set One=10000<br />%set/a% SqrtOf2=:FPSQRT(2*One)<br />call :INTTOFP SqrtOf2 SqrtOf2=<br />echo Square root of 2 with 4 decimals: %SqrtOf2%<br /><br />set One=1000<br />%set/a% Hypot=:FPHYPOT(3*One,4*One)<br />call :INTTOFP Hypot Hypot=<br />echo Hypotenuse of 3 and 4 catetos with 3 decimals: %Hypot%<br /><br />echo/<br />echo Iterative calculation of number e:<br />set One=100000000<br />set /A num=0, fac=1, summation=0<br />echo #- fac&nbsp; term=1/fac&nbsp; &nbsp;summation<br />:nextTerm<br />&nbsp; &nbsp;set /A term=One/fac, summation+=term<br />&nbsp; &nbsp;echo %num%- %fac%&nbsp; &nbsp; &nbsp;%term%&nbsp; &nbsp; %summation%<br />&nbsp; &nbsp;set /A num+=1, fac*=num<br />&nbsp; &nbsp;if %term% gtr 0 goto nextTerm<br />call :INTTOFP summation e=<br />echo Number e after %num% terms with 8 decimals: %e%<br />goto :EOF<br /></code></pre></div>Results:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>1.25 * 4 - 0.30 = 4.70<br />1/3 with 9 decimals: 0.333333333<br />355/113 approximation to PI with 6 decimals: 3.141592<br />Square root of 2 with 4 decimals: 1.4142<br />Hypotenuse of 3 and 4 catetos with 3 decimals: 5.000<br /><br />Iterative calculation of number e:<br />#- fac&nbsp; term=1/fac&nbsp; &nbsp;summation<br />0- 1&nbsp; &nbsp; &nbsp;100000000&nbsp; &nbsp; 100000000<br />1- 1&nbsp; &nbsp; &nbsp;100000000&nbsp; &nbsp; 200000000<br />2- 2&nbsp; &nbsp; &nbsp;50000000&nbsp; &nbsp; 250000000<br />3- 6&nbsp; &nbsp; &nbsp;16666666&nbsp; &nbsp; 266666666<br />4- 24&nbsp; &nbsp; &nbsp;4166666&nbsp; &nbsp; 270833332<br />5- 120&nbsp; &nbsp; &nbsp;833333&nbsp; &nbsp; 271666665<br />6- 720&nbsp; &nbsp; &nbsp;138888&nbsp; &nbsp; 271805553<br />7- 5040&nbsp; &nbsp; &nbsp;19841&nbsp; &nbsp; 271825394<br />8- 40320&nbsp; &nbsp; &nbsp;2480&nbsp; &nbsp; 271827874<br />9- 362880&nbsp; &nbsp; &nbsp;275&nbsp; &nbsp; 271828149<br />10- 3628800&nbsp; &nbsp; &nbsp;27&nbsp; &nbsp; 271828176<br />11- 39916800&nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; 271828178<br />12- 479001600&nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; 271828178<br />Number e after 13 terms with 8 decimals: 2.71828178<br /></code></pre></div></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p12729" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile12729">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist7125.html?mode=viewprofile&amp;u=417" class="username">jeb</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search73f1.html?author_id=417&amp;sr=posts">880</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 30 Aug 2007 08:05</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Germany, Bochum</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content12729">

						<h3 ><a href="#p12729">Re: SET/A: Macro to expand function results in SET /A expres</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting5f90.html?mode=quote&amp;f=3&amp;p=12729" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic0895.html?p=12729#p12729" onclick="prompt('Message #4',this.href); return false;">#4</a></span> 
									<a class="unread" href="viewtopic0895.html?p=12729#p12729" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist7125.html?mode=viewprofile&amp;u=417" class="username">jeb</a></strong> &raquo; </span>11 Jan 2012 13:45
			</p>
			
			
			
			<div class="content">+1<br /><br />Hi Aacini,<br /><br />absolute cool solution <img class="smilies" src="images/smilies/icon_cool.gif" alt="8)" title="Cool" /> <br />You create a new language inside of the batch, this way you could change the complete syntax or create a complete new one.<br />B#, Batch-Sharp  <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /><br /><br />I thought about writing an own interpreter with batch, but I never thought to interpret &quot;just in line&quot;  <img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" /> <br /><br />really impressive <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br /><br />jeb</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p12775" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile12775">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content12775">

						<h3 ><a href="#p12775">Re: SET/A: Macro to expand function results in SET /A expres</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingbc5a.html?mode=quote&amp;f=3&amp;p=12775" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic7fc1-2.html?p=12775#p12775" onclick="prompt('Message #5',this.href); return false;">#5</a></span> 
									<a class="unread" href="viewtopic7fc1-2.html?p=12775#p12775" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>13 Jan 2012 20:40
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>jeb wrote:</cite>absolute cool solution <img class="smilies" src="images/smilies/icon_cool.gif" alt="8)" title="Cool" /> </div></blockquote>Thanks a lot, jeb!  <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> <blockquote><div><cite>jeb wrote:</cite>You create a new language inside of the batch, this way you could change the complete syntax or create a complete new one.</div></blockquote>In my opinion, this macro feature is much more important than the faster execution. Another example of this new syntax is <a href="viewtopice128.html?f=3&amp;t=2707&amp;p=12359#p12359" class="postlink">WHILE macro</a>.<blockquote><div><cite>jeb wrote:</cite>B#, Batch-Sharp  <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />jeb</div></blockquote>I prefer Batch++, that is: &quot;Post-Incremented Batch&quot;  <img class="smilies" src="images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
	

	<div class="action-bar bar-bottom">
	
			<a href="posting19dc.html?mode=reply&amp;f=3&amp;t=2704" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
		
		<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic03e1.html?f=3&amp;t=2704&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>

			<form method="post" action="https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=2704">
		<div class="dropdown-container dropdown-container-left dropdown-button-control sort-tools">
	<span title="Display and sorting options" class="button button-secondary dropdown-trigger dropdown-select">
		<i class="icon fa-sort-amount-asc fa-fw" aria-hidden="true"></i>
		<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
	</span>
	<div class="dropdown hidden">
		<div class="pointer"><div class="pointer-inner"></div></div>
		<div class="dropdown-contents">
			<fieldset class="display-options">
							<label>Display: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
								<label>Sort by: <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label>
				<label>Direction: <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select></label>
								<hr class="dashed" />
				<input type="submit" class="button2" name="sort" value="Go" />
						</fieldset>
		</div>
	</div>
</div>
		</form>
	
	
	
			<div class="pagination">
			5 posts
							&bull; Page <strong>1</strong> of <strong>1</strong>
					</div>
	</div>


<div class="action-bar actions-jump">
		<p class="jumpbox-return">
		<a href="viewforum4d6b.html?f=3" class="left-box arrow-left" accesskey="r">
			<i class="icon fa-angle-left fa-fw icon-black" aria-hidden="true"></i><span>Return to “DOS Batch Forum”</span>
		</a>
	</p>
	
		<div class="jumpbox dropdown-container dropdown-container-right dropdown-up dropdown-left dropdown-button-control" id="jumpbox">
			<span title="Jump to" class="button button-secondary dropdown-trigger dropdown-select">
				<span>Jump to</span>
				<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
			</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																				<li><a href="viewforum31e6.html?f=4" class="jumpbox-cat-link"> <span> DosTips - Dos Batch</span></a></li>
																<li><a href="viewforum4d6b.html?f=3" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; DOS Batch Forum</span></a></li>
											</ul>
		</div>
	</div>

	</div>


			</div>


<div id="page-footer" class="page-footer" role="contentinfo">
	<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-footer" class="nav-footer linklist" role="menubar">
		<li class="breadcrumbs">
							<span class="crumb"><a href="../index.html" data-navbar-reference="home"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span>DosTips.com</span></a></span>									<span class="crumb"><a href="index.html" data-navbar-reference="index"><span>Board index</span></a></span>					</li>
		
				<li class="rightside">All times are <span title="UTC-6">UTC-06:00</span></li>
							<li class="rightside">
				<a href="ucp033a.html?mode=delete_cookies" data-ajax="true" data-refresh="true" role="menuitem">
					<i class="icon fa-trash fa-fw" aria-hidden="true"></i><span>Delete all board cookies</span>
				</a>
			</li>
												<li class="rightside" data-last-responsive="true">
				<a href="memberlist4bfd.html?mode=team" role="menuitem">
					<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
				</a>
			</li>
									<li class="rightside" data-last-responsive="true">
				<a href="memberlist8733.html?mode=contactadmin" role="menuitem">
					<i class="icon fa-envelope fa-fw" aria-hidden="true"></i><span>Contact us</span>
				</a>
			</li>
			</ul>

	</div>
</div>

	<div class="copyright">
				<!-- WARNING NO DELETE -->Style developer by <a href="http://tricolor.x-tk.ru/">support forum tricolor</a>, <!-- END WARNING NO DELETE -->Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
									</div>

	<div id="darkenwrapper" class="darkenwrapper" data-ajax-error-title="AJAX error" data-ajax-error-text="Something went wrong when processing your request." data-ajax-error-text-abort="User aborted request." data-ajax-error-text-timeout="Your request timed out; please try again." data-ajax-error-text-parsererror="Something went wrong with the request and the server returned an invalid reply.">
		<div id="darken" class="darken">&nbsp;</div>
	</div>

	<div id="phpbb_alert" class="phpbb_alert" data-l-err="Error" data-l-timeout-processing-req="Request timed out.">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<h3 class="alert_title">&nbsp;</h3><p class="alert_text"></p>
	</div>
	<div id="phpbb_confirm" class="phpbb_alert">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<div class="alert_text"></div>
	</div>
</div>

</div>

<div>
	<a id="bottom" class="anchor" accesskey="z"></a>
	<img src="cron5089.gif?cron_type=cron.task.text_reparser.post_text" width="1" height="1" alt="cron" /></div>

<script type="text/javascript" src="assets/javascript/jquery.mind772.js?assets_version=34"></script>
<script type="text/javascript" src="assets/javascript/cored772.js?assets_version=34"></script>



<script type="text/javascript" src="styles/prosilver/template/forum_fnd772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/prosilver/template/ajaxd772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/AllanStyle-SUBSILVER/template/jquery-uid772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/AllanStyle-SUBSILVER/template/collapsed772.js?assets_version=34"></script>



</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?t=2704 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:44:07 GMT -->
</html>
