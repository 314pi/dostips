<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=5057&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 08:29:21 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>DosTips.com &bull; Quotes when starting a batch file</title>

<link href="styles/AllanStyle-SUBSILVER/theme/print.css" rel="stylesheet">
</head>
<body id="phpbb">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>DosTips.com</h1>
		<p>A Forum all about DOS Batch<br /><a href="index-2.html">https://www.dostips.com/forum/</a></p>

		<h2>Quotes when starting a batch file</h2>
		<p><a href="viewtopicea37.html?f=3&amp;t=5057">https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=5057</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>Quotes when starting a batch file</h3>
				<div class="date">Posted: <strong>05 Nov 2013 13:59</strong></div>
				<div class="author">by <strong>jeb</strong></div>
				<div class="content">I hijack the thread <a href="http://stackoverflow.com/questions/19781569/cmd-failure-of-d0-when-call-quotes-the-name-of-the-batch-file" class="postlink">CMD: failure of %~d0 when CALL quotes the name of the batch file</a> opened by ChrisJJ.<br /><br />As this seems to be have other side effects which are too long and not related to the original question.<br /><br />The main question was, why %~dp0 or any other modifiers fails, when the drive/directory was changed in a batch file AND the batch file itself is started with quotes in the name.<br /><br />test.bat<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal<br />d:<br />echo %~f0</code></pre></div><br /><br />Start it with <br />&quot;TEST.bat&quot;<br /><blockquote><div><cite>Output wrote:</cite>D:\test.bat</div></blockquote><br /><br />This seems to be a problem, that cmd.exe can start the file, but doesn't remove the quotes correctly.<br />This can be tested with:<br /><br />&quot;&quot;&quot;&quot;TE&quot;S&quot;T.bat&quot;&quot;&quot;<br /><blockquote><div><cite>Output wrote:</cite>D:\&quot;&quot;&quot;TE&quot;S&quot;T.bat&quot;&quot;</div></blockquote><br /><br />But then I found another effect.<br /><br />Add another file into the same directory<br />**ExtraRetest.bat**<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />echo *** &quot;%~0&quot; ***</code></pre></div><br /><br />And now start your test.bat with (Yes, there is a redirection character)  <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br />&quot;&lt;test.bat&quot;<br /><blockquote><div><cite>Output wrote:</cite>*** &quot;&lt;test.bat&quot; ***</div></blockquote><br /><br />The output is obviously not from test.bat, it's from ExtraRetest.bat <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br /><br />This is really strange  <img class="smilies" src="images/smilies/icon_question.gif" alt=":?:" title="Question" /></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Quotes when starting a batch file</h3>
				<div class="date">Posted: <strong>05 Nov 2013 19:24</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" />  How in hell did you stumble on that  <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /><br /><br />Amazing and totally unexpected <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /> <br /><br />It turns out that  &gt;  also functions as a wildcard. I tested on both XP and Win 7.<br /><strong class="text-strong"><span style="color: #0000FF">The rules below are not quite correct. See penpen's post and my response below</span></strong><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Match 0 or more characters:&nbsp; &nbsp;*&nbsp; &nbsp;(can match dots)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;&nbsp; &nbsp;(cannot match dots)<br />------------------------------------------------------<br />&nbsp; &nbsp; Match 0 or 1 character:&nbsp; &nbsp;?&nbsp; &nbsp;(cannot match dots)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &gt;&nbsp; &nbsp;(cannot match dots)<br /></code></pre></div><br />All the above wildcards work in commands like DIR and COPY etc. The  &gt;  and  &lt;  symbols can be quoted or escaped if used within a parameter.<br /><br />Only  &lt;  and  &gt;  can be used within a command name, and only if quoted - escaping will not work.<br />When a command matches multiple files, the first one found is executed.<br />The  &lt;  and  &gt;  wildcards can only be used in the command name, never the command path.<br /><br />I created two bat files in my C:\test folder with the same content:  weird1x.bat  and  weird2.bat<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo Excecuting %~f0&nbsp; (%0)<br /></code></pre></div><br />Here are some interesting tests with results:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\test&gt;dir /b *ei*<br />weird1x.bat<br />weird2.bat<br /><br />C:\test&gt;dir /b &quot;&lt;ei&lt;&quot;<br />File Not Found<br /><br />C:\test&gt;dir /b &quot;&lt;ei&lt;.&lt;&quot;<br />weird1x.bat<br />weird2.bat<br /><br />C:\test&gt;dir /b &quot;?ei???????&quot;<br />File Not Found<br /><br />C:\test&gt;dir /b &quot;?ei???.???&quot;<br />weird2.bat<br /><br />C:\test&gt;dir /b &quot;?ei????.???&quot;<br />weird1x.bat<br />weird2.bat<br /><br />C:\test&gt;dir /b &quot;&gt;ei&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;<br />File Not Found<br /><br />C:\test&gt;dir /b &quot;&gt;ei&gt;&gt;&gt;.&gt;&gt;&gt;&quot;<br />weird2.bat<br /><br />C:\test&gt;dir /b &quot;&gt;ei&gt;&gt;&gt;&gt;.&gt;&gt;&gt;&quot;<br />weird1x.bat<br />weird2.bat<br /><br />C:\test&gt;dir /b &quot;&gt;ei&gt;&gt;&gt;&gt;.&gt;&gt;&quot;<br />File Not Found<br /><br />C:\test&gt;dir /b &quot;&gt;ei&gt;&gt;&gt;&gt;.&lt;&quot;<br />weird1x.bat<br />weird2.bat<br /><br />C:\test&gt;dir /b ^&lt;ei^&lt;.^&lt;<br />weird1x.bat<br />weird2.bat<br /><br />C:\test&gt;type *ei*<br /><br />weird1x.bat<br /><br /><br />@echo Excecuting %~f0&nbsp; (%0)<br /><br />weird2.bat<br /><br /><br />@echo Excecuting %~f0&nbsp; (%0)<br /><br />C:\test&gt;type &quot;&lt;ei&lt;.&lt;&quot; &amp; rem Note how file name headers are missing<br />@echo Excecuting %~f0&nbsp; (%0)<br />@echo Excecuting %~f0&nbsp; (%0)<br /><br />C:\test&gt;copy &quot;&lt;ei&gt;&gt;&gt;.&gt;&gt;&gt;&quot; &quot;&gt;.copy&quot;<br />The filename, directory name, or volume label syntax is incorrect.<br />&nbsp; &nbsp; &nbsp; &nbsp; 0 file(s) copied.<br /><br />C:\test&gt;copy &quot;&lt;ei&gt;&gt;&gt;.&gt;&gt;&gt;&quot; *.copy &amp; dir /b *.copy &amp; del *.copy<br />&nbsp; &nbsp; &nbsp; &nbsp; 1 file(s) copied.<br />weird2.copy<br /><br />C:\test&gt;copy ^&lt;ei^&gt;^&gt;^&gt;.^&gt;^&gt;^&gt; *.copy &amp; dir /b *.copy &amp; del *.copy<br />&nbsp; &nbsp; &nbsp; &nbsp; 1 file(s) copied.<br />weird2.copy<br /><br />C:\test&gt;*ei*.bat<br />'*ei*.bat' is not recognized as an internal or external command,<br />operable program or batch file.<br /><br />C:\test&gt;&quot;*ei*.bat&quot;<br />'&quot;*ei*.bat&quot;' is not recognized as an internal or external command,<br />operable program or batch file.<br /><br />C:\test&gt;^&lt;ei^&lt;.^&lt;<br />The syntax of the command is incorrect.<br /><br />C:\test&gt;&quot;&lt;ei&lt;.&lt;&quot;<br />Excecuting C:\test\weird1x.bat&nbsp; (&quot;&lt;ei&lt;.&lt;&quot;)<br /><br />C:\test&gt;&quot;&lt;ei&gt;&gt;&gt;&gt;.&lt;&quot;<br />Excecuting C:\test\weird1x.bat&nbsp; (&quot;&lt;ei&gt;&gt;&gt;&gt;.&lt;&quot;)<br /><br />C:\test&gt;&quot;&lt;ei&gt;&gt;&gt;.&lt;&quot;<br />Excecuting C:\test\weird2.bat&nbsp; (&quot;&lt;ei&gt;&gt;&gt;.&lt;&quot;)<br /><br />C:\test&gt;&quot;c:\test\&lt;ei&lt;.&lt;&quot;<br />Excecuting c:\test\weird1x.bat&nbsp; (&quot;c:\test\&lt;ei&lt;.&lt;&quot;)<br /><br />C:\test&gt;&quot;c:\t&gt;st\&lt;ei&lt;.&lt;&quot;<br />The filename, directory name, or volume label syntax is incorrect.<br /><br />C:\test&gt;<br /></code></pre></div><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Quotes when starting a batch file</h3>
				<div class="date">Posted: <strong>06 Nov 2013 13:26</strong></div>
				<div class="author">by <strong>penpen</strong></div>
				<div class="content">It is not fully true, that  the '&lt;' character cannot match dots (win 7):<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Z:\a&gt;dir /b<br />a<br />a.txt<br /><br />Z:\a&gt;dir &quot;&lt;&quot; /b<br />a<br /><br />Z:\a&gt;dir &quot;&lt;&lt;&quot; /b<br />a<br />a.txt<br /><br />Z:\a&gt;dir &quot;a&lt;txt&quot; /b<br />a.txt<br /><br />Z:\a&gt;<br /></code></pre></div><br />penpen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Quotes when starting a batch file</h3>
				<div class="date">Posted: <strong>06 Nov 2013 19:50</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">Good catch penpen <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />Based on some more experiments,  &lt;   can match any set of characters (including dots) in the base name, or it can match any set of characters (including the leading dot) in the extension. But a single  &lt;  cannot match characters from both the base name and the extension.<br /><br />The  &gt;  can match any character (including dot) anywhere in the name, except it cannot match the leading dot of the extension.<br /><br />I created c:\test\abc.123.xyz.txt<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\test&gt;dir /b &quot;abc&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&quot;<br />File Not Found<br /><br />C:\test&gt;dir /b &quot;abc&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;.&gt;&gt;&gt;&quot;<br />abc.123.xyz.txt<br /><br />C:\test&gt;dir /b &quot;abc&lt;&quot;<br />File Not Found<br /><br />C:\test&gt;dir /b &quot;abc&lt;&lt;&quot;<br />abc.123.xyz.txt<br /><br />C:\test&gt;<br /></code></pre></div><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Quotes when starting a batch file</h3>
				<div class="date">Posted: <strong>07 Nov 2013 18:18</strong></div>
				<div class="author">by <strong>Squashman</strong></div>
				<div class="content">I am beginning to think they were smokin alot more then Peyote in those early days in New Mexico.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Quotes when starting a batch file</h3>
				<div class="date">Posted: <strong>07 Nov 2013 19:11</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">So here is a summary of the updated wild card rules:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; &nbsp; &nbsp;Function&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |&nbsp; Restrictions&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Wildcard<br />-----------------------------+-------------------------------+----------<br />Match 0 or more characters&nbsp; &nbsp;| No restrictions&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; *<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;+-------------------------------+----------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Cannot match characters from&nbsp; |&nbsp; &nbsp; &lt;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| both base name and extension. |<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| Extension dot is considered&nbsp; &nbsp;|<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| to be part of base name.&nbsp; &nbsp; &nbsp; |<br />-----------------------------+-------------------------------+----------<br />Match exactly 1 character or | Cannot match dot in extension |&nbsp; &nbsp; ?<br />match 0 characters if at end |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|&nbsp; &nbsp; &gt;<br />of name or end of extension&nbsp; |&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;|<br />-----------------------------+-------------------------------+----------<br /></code></pre></div><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Quotes when starting a batch file</h3>
				<div class="date">Posted: <strong>07 Nov 2013 22:54</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">Returning to the original effect regarding quotes around the command.<br /><br /><blockquote><div><cite>jeb wrote:</cite>This seems to be a problem, that cmd.exe can start the file, but doesn't remove the quotes correctly.<br /></div></blockquote><br />I'm not convinced. Enclosing quotes without the extension seems to be a special case. Internal quotes without enclosing quotes don't cause a problem.<br /><br />C:\test\test.bat<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal<br />echo&nbsp; &nbsp; &nbsp; raw: %%0&nbsp; &nbsp; = %0<br />echo&nbsp; &nbsp; &nbsp;main: %%~tf0 = %~tf0<br />call :getPath<br />exit /b<br /><br />:getPath<br />echo function: %%~tf0 = %~tf0<br /></code></pre></div><br />No quotes works fine:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\test&gt;TEST<br />&nbsp; &nbsp; &nbsp;raw: %0&nbsp; &nbsp; = TEST<br />&nbsp; &nbsp; main: %~tf0 = 11/07/2013 11:05 PM C:\test\test.bat<br />function: %~tf0 = 11/07/2013 11:05 PM C:\test\test.bat<br /></code></pre></div><br />Enclosing quotes fails:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\test&gt;&quot;TEST&quot;<br />&nbsp; &nbsp; &nbsp;raw: %0&nbsp; &nbsp; = &quot;TEST&quot;<br />&nbsp; &nbsp; main: %~tf0 = C:\test\TEST<br />function: %~tf0 = 11/07/2013 11:05 PM C:\test\test.bat<br /></code></pre></div><br />Internal quotes works fine:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\test&gt;T&quot;ES&quot;T<br />&nbsp; &nbsp; &nbsp;raw: %0&nbsp; &nbsp; = T&quot;ES&quot;T<br />&nbsp; &nbsp; main: %~tf0 = 11/07/2013 11:05 PM C:\test\test.bat<br />function: %~tf0 = 11/07/2013 11:05 PM C:\test\test.bat<br /></code></pre></div><br />Enclosing quotes with full name works fine as long as working directory not changed:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\test&gt;&quot;TEST.BAT&quot;<br />&nbsp; &nbsp; &nbsp;raw: %0&nbsp; &nbsp; = &quot;TEST.BAT&quot;<br />&nbsp; &nbsp; main: %~tf0 = 11/07/2013 11:05 PM C:\test\test.bat<br />function: %~tf0 = 11/07/2013 11:05 PM C:\test\test.bat<br /></code></pre></div><br /><br />And now for some real fun <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /> I'll combine the quote problem with the newly discovered wildcard behavior. The quoted value containing wildcards can report the wrong file if the file is added after the script has begun  <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br /><br />C:\test\z2.bat<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />echo %0<br />echo %~f0<br />copy nul z1.bat &gt;nul<br />echo %~f0<br />call :getPath<br />del z1.bat<br />exit /b<br /><br />:getPath<br />echo %~f0<br />exit /b<br /></code></pre></div><br />--OUTPUT--<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\test&gt;&quot;Z&gt;.bat&quot;<br />&quot;Z&gt;.bat&quot;<br />C:\test\z2.bat<br />C:\test\z1.bat<br />C:\test\z2.bat<br /></code></pre></div><br /><br />Another obscure problem is the issue of names containing ! and/or ^ while delayed expansion is enabled.<br /><br />I've written a robust <strong class="text-strong">:currentScript</strong> function that should always retrieve the correct values, no matter what the circumstances. The first argument is required - the name of the variable to store the result. The second parameter is optional - a string of modifiers, without the tilde. The default modifier is F (equivalent to DPNX).<br /><br />The first part of the script is a test harness for the function. It tests the function under various scenarios. I intentionally gave the script a crazy name containing characters that don't play nice with delayed expansion.<br /><br />C:\test\test^it!.bat<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal disableDelayedExpansion<br />set arg0=%0<br />if &quot;%arg0:~0,1%%arg0:~0,1%&quot; equ &quot;&quot;&quot;&quot; (set &quot;arg0=Quoted&quot;) else set &quot;arg0=Unquoted&quot;<br /><br />call :header<br />echo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; %%~tzf0 = &quot;%~tzf0&quot;<br />call :currentScript rtn tzf<br />echo :currentScript result = &quot;%rtn%&quot;<br /><br />setlocal enableDelayedExpansion<br />call :header<br />echo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; %%~tzf0 = &quot;%~tzf0&quot;<br />call :currentScript rtn tzf<br />echo :currentScript result = &quot;!rtn!&quot;<br /><br />endlocal<br />d:<br />call :header<br />echo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; %%~tzf0 = &quot;%~tzf0&quot;<br />call :currentScript rtn tzf<br />echo :currentScript result = &quot;%rtn%&quot;<br /><br />setlocal enableDelayedExpansion<br />call :header<br />echo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; %%~tzf0 = &quot;%~tzf0&quot;<br />call :currentScript rtn tzf<br />echo :currentScript result = &quot;!rtn!&quot;<br /><br />exit /b<br />&nbsp;<br />:header<br />set &quot;rtn=&quot;<br />setlocal<br />echo(<br />echo(<br />if &quot;!&quot; equ &quot;&quot; (set &quot;delayed=ON&quot;) else set &quot;delayed=OFF&quot;<br />if &quot;%cd%\&quot; equ &quot;%~dp0&quot; (set &quot;cwd=Original&quot;) else set &quot;cwd=Modified&quot;<br />echo %arg0%: %cwd% working directory, Delayed expansion = %delayed%<br />echo ---------------------------------------------------------------------------<br />exit /b<br /><br />&nbsp;<br />:currentScript&nbsp; rtnVar&nbsp; &#91;options&#93;<br />setlocal<br />set &quot;notDelayed=!&quot;<br />setlocal disableDelayedExpansion<br />set &quot;options=%~2&quot;<br />if not defined options set &quot;options=f&quot;<br />call set &quot;rtn=%%~%options%0&quot;<br />if not defined notDelayed set &quot;rtn=%rtn:^=^^%&quot;<br />if not defined notDelayed set &quot;rtn=%rtn:!=^!%&quot;<br />endlocal &amp; endlocal &amp; set &quot;%~1=%rtn%&quot; !<br />exit /b<br /></code></pre></div><br />Here are the results using both an unquoted and a quoted call:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\test&gt;TEST^^IT!<br /><br /><br />Unquoted: Original working directory, Delayed expansion = OFF<br />---------------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%~tzf0 = &quot;11/07/2013 10:43 PM 1397 C:\test\test^it!.bat&quot;<br />:currentScript result = &quot;11/07/2013 10:43 PM 1397 C:\test\test^it!.bat&quot;<br /><br /><br />Unquoted: Original working directory, Delayed expansion = ON<br />---------------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%~tzf0 = &quot;11/07/2013 10:43 PM 1397 C:\test\testit.bat&quot;<br />:currentScript result = &quot;11/07/2013 10:43 PM 1397 C:\test\test^it!.bat&quot;<br /><br /><br />Unquoted: Modified working directory, Delayed expansion = OFF<br />---------------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%~tzf0 = &quot;11/07/2013 10:43 PM 1397 C:\test\test^it!.bat&quot;<br />:currentScript result = &quot;11/07/2013 10:43 PM 1397 C:\test\test^it!.bat&quot;<br /><br /><br />Unquoted: Modified working directory, Delayed expansion = ON<br />---------------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%~tzf0 = &quot;11/07/2013 10:43 PM 1397 C:\test\testit.bat&quot;<br />:currentScript result = &quot;11/07/2013 10:43 PM 1397 C:\test\test^it!.bat&quot;<br /><br />C:\test&gt;&quot;TEST^IT!&quot;<br /><br /><br />Quoted: Original working directory, Delayed expansion = OFF<br />---------------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%~tzf0 = &quot;C:\test\TEST^IT!&quot;<br />:currentScript result = &quot;11/07/2013 10:43 PM 1397 C:\test\test^it!.bat&quot;<br /><br /><br />Quoted: Original working directory, Delayed expansion = ON<br />---------------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%~tzf0 = &quot;C:\test\TESTIT&quot;<br />:currentScript result = &quot;11/07/2013 10:43 PM 1397 C:\test\test^it!.bat&quot;<br /><br /><br />Quoted: Modified working directory, Delayed expansion = OFF<br />---------------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%~tzf0 = &quot;D:\TEST^IT!&quot;<br />:currentScript result = &quot;11/07/2013 10:43 PM 1397 C:\test\test^it!.bat&quot;<br /><br /><br />Quoted: Modified working directory, Delayed expansion = ON<br />---------------------------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%~tzf0 = &quot;D:\TESTIT&quot;<br />:currentScript result = &quot;11/07/2013 10:43 PM 1397 C:\test\test^it!.bat&quot;<br /><br />C:\test&gt;<br /></code></pre></div><br />I also tested the function with batch files named <strong class="text-strong">test^it.bat</strong>, <strong class="text-strong">test!.bat</strong>, and <strong class="text-strong">test.bat</strong>, and all worked as expected (not shown)<br /><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Quotes when starting a batch file</h3>
				<div class="date">Posted: <strong>10 Nov 2013 08:27</strong></div>
				<div class="author">by <strong>penpen</strong></div>
				<div class="content"><blockquote><div><cite>dbenham wrote:</cite><blockquote><div><cite>jeb wrote:</cite>This seems to be a problem, that cmd.exe can start the file, but doesn't remove the quotes correctly.<br /></div></blockquote><br />I'm not convinced. Enclosing quotes without the extension seems to be a special case. Internal quotes without enclosing quotes don't cause a problem.<br /></div></blockquote>I agree beeing not convinced, but I think the special case is %0 without enclosing quotes, as its behaviour differs from all other cases.<br />Regarding to the help pages of for and call the behavior of the %0 case is unexpected, as it only should add the current volume descriptor, the current path, the given name, and the given extension:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:: test.bat<br />@echo off<br />setlocal<br />echo&nbsp; &nbsp; &nbsp;main: %%0&nbsp; &nbsp; = %0<br />echo&nbsp; &nbsp; &nbsp;main: %%1&nbsp; &nbsp; = %1<br />echo&nbsp; &nbsp; &nbsp;main: %%~tzf0 = %~tzf0<br />echo&nbsp; &nbsp; &nbsp;main: %%~tzf1 = %~tzf1<br />echo(<br />call :getPath :getPath<br /><br />setlocal enableDelayedExpansion<br />set &quot;__a=%%%%a&quot;<br />set &quot;__tzfa=%%%%~tzfa&quot;<br /><br />for %%a in (%0) do (<br />echo&nbsp; &nbsp; &nbsp; for: !__a!&nbsp; &nbsp; = %%a<br />echo&nbsp; &nbsp; &nbsp; for: !__tzfa! = %%~tzfa<br />)<br /><br />endlocal<br />exit /b<br /><br />:getPath<br />echo function: %%0&nbsp; &nbsp; = %0<br />echo function: %%1&nbsp; &nbsp; = %1<br />echo function: %%~tzf0 = %~tzf0<br />echo function: %%~tzf1 = %~tzf1<br />echo(<br /></code></pre></div><br />Result:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Z:\&gt;test test<br />&nbsp; &nbsp; main: %0&nbsp; &nbsp; = test<br />&nbsp; &nbsp; main: %1&nbsp; &nbsp; = test<br />&nbsp; &nbsp; main: %~tzf0 = 10.11.2013 15:10 4408 Z:\test.bat<br />&nbsp; &nbsp; main: %~tzf1 = Z:\test<br /><br />function: %0&nbsp; &nbsp; = :getPath<br />function: %1&nbsp; &nbsp; = :getPath<br />function: %~tzf0 = 10.11.2013 15:10 4408 Z:\test.bat<br />function: %~tzf1 = Z:\:getPath<br /><br />&nbsp; &nbsp; &nbsp;for: %%a&nbsp; &nbsp; = test<br />&nbsp; &nbsp; &nbsp;for: %%~tzfa = Z:\test<br /><br />Z:\&gt;test.bat test.bat<br />&nbsp; &nbsp; main: %0&nbsp; &nbsp; = test.bat<br />&nbsp; &nbsp; main: %1&nbsp; &nbsp; = test.bat<br />&nbsp; &nbsp; main: %~tzf0 = 10.11.2013 15:10 4408 Z:\test.bat<br />&nbsp; &nbsp; main: %~tzf1 = 10.11.2013 15:10 4408 Z:\test.bat<br /><br />function: %0&nbsp; &nbsp; = :getPath<br />function: %1&nbsp; &nbsp; = :getPath<br />function: %~tzf0 = 10.11.2013 15:10 4408 Z:\test.bat<br />function: %~tzf1 = Z:\:getPath<br /><br />&nbsp; &nbsp; &nbsp;for: %%a&nbsp; &nbsp; = test.bat<br />&nbsp; &nbsp; &nbsp;for: %%~tzfa = 10.11.2013 15:10 4408 Z:\test.bat<br /><br />Z:\&gt;&quot;test&quot; &quot;test&quot;<br />&nbsp; &nbsp; main: %0&nbsp; &nbsp; = &quot;test&quot;<br />&nbsp; &nbsp; main: %1&nbsp; &nbsp; = &quot;test&quot;<br />&nbsp; &nbsp; main: %~tzf0 = Z:\test<br />&nbsp; &nbsp; main: %~tzf1 = Z:\test<br /><br />function: %0&nbsp; &nbsp; = :getPath<br />function: %1&nbsp; &nbsp; = :getPath<br />function: %~tzf0 = 10.11.2013 15:10 4408 Z:\test.bat<br />function: %~tzf1 = Z:\:getPath<br /><br />&nbsp; &nbsp; &nbsp;for: %%a&nbsp; &nbsp; = &quot;test&quot;<br />&nbsp; &nbsp; &nbsp;for: %%~tzfa = Z:\test<br /><br />Z:\&gt;&quot;test.bat&quot; &quot;test.bat&quot;<br />&nbsp; &nbsp; main: %0&nbsp; &nbsp; = &quot;test.bat&quot;<br />&nbsp; &nbsp; main: %1&nbsp; &nbsp; = &quot;test.bat&quot;<br />&nbsp; &nbsp; main: %~tzf0 = 10.11.2013 15:10 4408 Z:\test.bat<br />&nbsp; &nbsp; main: %~tzf1 = 10.11.2013 15:10 4408 Z:\test.bat<br /><br />function: %0&nbsp; &nbsp; = :getPath<br />function: %1&nbsp; &nbsp; = :getPath<br />function: %~tzf0 = 10.11.2013 15:10 4408 Z:\test.bat<br />function: %~tzf1 = Z:\:getPath<br /><br />&nbsp; &nbsp; &nbsp;for: %%a&nbsp; &nbsp; = &quot;test.bat&quot;<br />&nbsp; &nbsp; &nbsp;for: %%~tzfa = 10.11.2013 15:10 4408 Z:\test.bat<br /><br />Z:\&gt;<br /></code></pre></div>So %f0 &quot;fails&quot; with no doublequotes around the command.<br />But i see this case as a special service, so it doesn't bother me.<br /><br />penpen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Quotes when starting a batch file</h3>
				<div class="date">Posted: <strong>08 May 2014 11:06</strong></div>
				<div class="author">by <strong>Liviu</strong></div>
				<div class="content"><blockquote><div><cite>dbenham wrote:</cite>Enclosing quotes without the extension seems to be a special case.</div></blockquote><br />Indeed. And that special case breaks self-referential batch code that relies on &quot;%~f0&quot; at the top level, such as:<br />- for/f rereading in order to display embedded help;<br />- relaunching &quot;%~f0&quot; in recursive or hybrid scenarios;<br />- defining CR using the copy/z construct - lest end up with &quot;!CR!&quot;==&quot;The&quot; from &quot;The system cannot find ...&quot; <img class="smilies" src="images/smilies/icon_wink.gif" alt=";-)" title="Wink" /><br /><br />Only recourse seems to be to guard any self-reference inside a called :label, where &quot;%~f0&quot; expands correctly, as noted above.<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />if &quot;%~x0&quot;==&quot;&quot; (call :self &amp; goto :eof)<br />:self<br />echo callee: %0 &quot;%~f0&quot; &quot;%~dpnx0&quot;</code></pre></div>Or, of course, require calling code to always specify an extension when quoting the target pathname.<br /><br />Liviu</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Quotes when starting a batch file</h3>
				<div class="date">Posted: <strong>23 Jan 2015 16:11</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">The discussion about undocumented wild cards &lt; and &gt; is continued at <!-- l --><a class="postlink-local" href="viewtopic4e3f.html?f=3&amp;t=6207">viewtopic.php?f=3&amp;t=6207</a><!-- l --><br /><br /><br />Dave Benham</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="UTC-6">UTC-06:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Limited<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=5057&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 08:29:21 GMT -->
</html>
