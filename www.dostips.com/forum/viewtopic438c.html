<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=1808 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 05:59:53 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>&quot;universal&quot; %DATE% parser - DosTips.com</title>


	<link rel="canonical" href="viewtopicb109.html?t=1808">

<!--
	phpBB style name: Allan Style - SUBSILVER
	Based on style:   prosilver (this is the default phpBB3 style)
	Based on style:   subsilver2 (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:  Allan ( http://x-tk.ru/ )
-->

<link href="assets/css/font-awesome.mind772.css?assets_version=34" rel="stylesheet">
<link href="styles/AllanStyle-SUBSILVER/theme/stylesheetd772.css?assets_version=34" rel="stylesheet">
<link href="styles/AllanStyle-SUBSILVER/theme/en/stylesheetd772.css?assets_version=34" rel="stylesheet">




<!--[if lte IE 9]>
	<link href="./styles/AllanStyle-SUBSILVER/theme/tweaks.css?assets_version=34" rel="stylesheet">
<![endif]-->




<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','../../www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-280191-1', 'auto');
	ga('send', 'pageview');
</script>

</head>
<body id="phpbb" class="nojs notouch section-viewtopic ltr ">

<div id="header-subsilver">
	<a id="top" class="top-anchor" accesskey="t"></a>
		<div class="headerbar" role="banner">
					<div class="inner">

			<div id="site-description" class="site-description">
				<a id="logo" class="logo" href="../index.html" title="DosTips.com"><span class="site_logo"></span></a>
				<h1>DosTips.com</h1>
				<p>A Forum all about DOS Batch</p>
				<p class="skiplink"><a href="#start_here">Skip to content</a></p>
			</div>

									<div id="search-box" class="search-box search-header" role="search">
				<form action="https://www.dostips.com/forum/search.php" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="search" maxlength="128" title="Search for keywords" class="inputbox search tiny" size="20" value="" placeholder="Search…" />
					<button class="button button-search" type="submit" title="Search">
						<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
					</button>
					<a href="search.html" class="button button-search-end" title="Advanced search">
						<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
					</a>
					
				</fieldset>
				</form>
			</div>
						
			</div>
					</div>
</div>


<div id="wrap" class="wrap">
	<div id="page-header">
				<div class="navbar-top" role="navigation">
	<div class="inner">

	<ul id="nav-main" class="nav-main linklist" role="menubar">

		<li id="quick-links" class="quick-links dropdown-container responsive-menu" data-skip-responsive="true">
			<a href="#" class="dropdown-trigger">
				<i class="icon fa-bars fa-fw" aria-hidden="true"></i><span>Quick links</span>
			</a>
			<div class="dropdown">
				<div class="pointer"><div class="pointer-inner"></div></div>
				<ul class="dropdown-contents" role="menu">
					
											<li class="separator"></li>
																									<li>
								<a href="search33a7.html?search_id=unanswered" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-gray" aria-hidden="true"></i><span>Unanswered topics</span>
								</a>
							</li>
							<li>
								<a href="search526f.html?search_id=active_topics" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-blue" aria-hidden="true"></i><span>Active topics</span>
								</a>
							</li>
							<li class="separator"></li>
							<li>
								<a href="search.html" role="menuitem">
									<i class="icon fa-search fa-fw" aria-hidden="true"></i><span>Search</span>
								</a>
							</li>
					
											<li class="separator"></li>
																			<li>
								<a href="memberlist4bfd.html?mode=team" role="menuitem">
									<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
								</a>
							</li>
																<li class="separator"></li>

									</ul>
			</div>
		</li>

				<li data-skip-responsive="true">
			<a href="app.php/help/faq.html" rel="help" title="Frequently Asked Questions" role="menuitem">
				<i class="icon fa-question-circle fa-fw" aria-hidden="true"></i><span>FAQ</span>
			</a>
		</li>
						
			<li class="rightside"  data-skip-responsive="true">
			<a href="ucp26c3.html?mode=login" title="Login" accesskey="x" role="menuitem">
				<i class="icon fa-power-off fa-fw" aria-hidden="true"></i><span>Login</span>
			</a>
		</li>
					<li class="rightside" data-skip-responsive="true">
				<a href="ucp8319.html?mode=register" role="menuitem">
					<i class="icon fa-pencil-square-o  fa-fw" aria-hidden="true"></i><span>Register</span>
				</a>
			</li>
						</ul>

	</div>
</div>

<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks" role="menubar">
						<li class="breadcrumbs">
							<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope=""><a href="../index.html" itemprop="url" data-navbar-reference="home"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span itemprop="title">DosTips.com</span></a></span>
										<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope=""><a href="index.html" itemprop="url" accesskey="h" data-navbar-reference="index"><span itemprop="title">Board index</span></a></span>

											<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="4"><a href="viewforum31e6.html?f=4" itemprop="url"><span itemprop="title">DosTips - Dos Batch</span></a></span>
															<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="3"><a href="viewforum4d6b.html?f=3" itemprop="url"><span itemprop="title">DOS Batch Forum</span></a></span>
												</li>
		
					<li class="rightside responsive-search">
				<a href="search.html" title="View the advanced search options" role="menuitem">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</a>
			</li>
			</ul>

	</div>
</div>

<div class="navbar-top-link">
	<div class="inner">
		<ul>
			<li class="navbar-top-link-left"><a href="search33a7.html?search_id=unanswered">Unanswered topics</a></li>
			<li class="navbar-top-link-left"><a href="search526f.html?search_id=active_topics">Active topics</a></li>

											</ul>
	</div>
</div>
	</div>

	
	<a id="start_here" class="anchor"></a>
	<div id="page-body" class="page-body" role="main">
		
		
<h2 class="topic-title"><a href="viewtopic438c.html?f=3&amp;t=1808">&quot;universal&quot; %DATE% parser</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Discussion forum for all Windows batch related topics.<br /></div>
<p>
	<strong>Moderator:</strong> <a href="memberlista6a8.html?mode=viewprofile&amp;u=5" class="username">DosItHelp</a>
</p>


<div class="action-bar bar-top">
	
			<a href="postingfa31.html?mode=reply&amp;f=3&amp;t=1808" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
	
			<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic91e5.html?f=3&amp;t=1808&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>
	
			<div class="search-box" role="search">
			<form method="get" id="topic-search" action="https://www.dostips.com/forum/search.php">
			<fieldset>
				<input class="inputbox search tiny"  type="search" name="keywords" id="search_keywords" size="20" placeholder="Search this topic…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="search.html" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				<input type="hidden" name="t" value="1808" />
<input type="hidden" name="sf" value="msgonly" />

			</fieldset>
			</form>
		</div>
	
			<div class="pagination">
			18 posts
							<ul>
		<li class="active"><span>1</span></li>
				<li><a class="button" href="viewtopic0cd9.html?f=3&amp;t=1808&amp;start=15" role="button">2</a></li>
				<li class="arrow next"><a class="button button-icon-only" href="viewtopic0cd9.html?f=3&amp;t=1808&amp;start=15" rel="next" role="button"><i class="icon fa-chevron-right fa-fw" aria-hidden="true"></i><span class="sr-only">Next</span></a></li>
	</ul>
					</div>
		</div>




<div id="subsilver-nav-topic">
	<div class="inner"><div class="post has-profile">
		<div class="leftsided postbody subsilver-topic-title">Message</div>
		<div class="leftsided postprofile subsilver-topic-author">Author</div>
	</div></div>
</div>

			<div id="p7170" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile7170">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha86d.html?author_id=2258&amp;sr=posts">2152</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 Feb 2011 21:02</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> United States (east coast)</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content7170">

						<h3 class="first"><a href="#p7170">&quot;universal&quot; %DATE% parser</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting5bdc.html?mode=quote&amp;f=3&amp;p=7170" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic9afc.html?p=7170#p7170" onclick="prompt('Message #1',this.href); return false;">#1</a></span> 
									<a class="unread" href="viewtopic9afc.html?p=7170#p7170" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a></strong> &raquo; </span>10 May 2011 21:43
			</p>
			
			
			
			<div class="content">There are many situations where %DATE% must be parsed into numeric year, month, and day components. But the format of %DATE% is highly variable depending on locality and personal preference. It is fairly easy to develop custom code for each individual situation. But it would be great to have a &quot;universal&quot; function that could parse any &quot;normal&quot; %DATE% format.<br /><br />I believe there are existing robust methods that rely on reading the registry. But many employees cannot access the registry on their workplace computers, so that is not a good solution.<br /><br />The DosTips :Unique function gives a good start to a general solution. It can handle formats with the year, month, and date in any order. But it is dependent on the DATE command prompt using standard English date format tokens of yy, mm and dd. In the <a href="viewtopicd0cd.html?f=3&amp;t=1793&amp;start=15" class="postlink">md and move Help experts</a> thread aGerman pointed out to me how the tokens can vary by language. For example German uses JJ, MM and TT instead.<br /><br />Below is my attempt at a &quot;universal&quot; date parser that does not require access to the registry. It currently supports English and German (or any other language that happens to use the same date tokens). It should be trivial to add support for additional languages by adding the appropriate token translation maps. I'm only able to test the English translation, but I think the German should work as well.<br /><br />I'd like to hear from anyone who can contribute additional translation maps for the function.<br /><br />I'm also keenly interested if anyone sees a problem with the code, has optimizations to contribute, or perhaps has an entirely different algorithm.<br /><br />Of course any code can be broken if someone sets the date format to something out ot the ordinary. But I'm happy as long as the &quot;universal&quot; function supports &quot;normal&quot; formats.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:parseDate yyVar mmVar ddVar<br />::<br />:: Parses %DATE% into numeric year, month, and date components<br />::<br />::&nbsp; &nbsp;yyVar = name of variable to hold numeric year value<br />::&nbsp; &nbsp;mmVar = name ov variable to hold numeric month value<br />::&nbsp; &nbsp;ddVar = name of variable to hold numeric day value<br /><br />&nbsp; setlocal enableDelayedExpansion<br />&nbsp; <br />&nbsp; :: Parse the native date format tokens output by the DATE command<br />&nbsp; for /f &quot;skip=1 tokens=2-4 delims=(-)&quot; %%a in ('&quot;echo:|date&quot;') do (<br />&nbsp; <br />&nbsp; &nbsp; rem Parse the numeric date components of %DATE%<br />&nbsp; &nbsp; for /f &quot;tokens=1-3 delims=/.- &quot; %%A in (&quot;%date:* =%&quot;) do (<br />&nbsp; <br />&nbsp; &nbsp; &nbsp; rem Set variables named after native date tokens to appropriate numeric date component values<br />&nbsp; &nbsp; &nbsp; set %%a=%%A<br />&nbsp; &nbsp; &nbsp; set %%b=%%B<br />&nbsp; &nbsp; &nbsp; set %%c=%%C<br />&nbsp; <br />&nbsp; &nbsp; &nbsp; rem Create string of sorted native date format tokens<br />&nbsp; &nbsp; &nbsp; if %%a lss %%b if %%b lss %%c set &quot;tokens=%%a %%b %%c&quot;<br />&nbsp; &nbsp; &nbsp; if %%a lss %%c if %%c lss %%b set &quot;tokens=%%a %%c %%b&quot;<br />&nbsp; &nbsp; &nbsp; if %%b lss %%a if %%a lss %%c set &quot;tokens=%%b %%a %%c&quot;<br />&nbsp; &nbsp; &nbsp; if %%b lss %%c if %%c lss %%a set &quot;tokens=%%b %%c %%a&quot;<br />&nbsp; &nbsp; &nbsp; if %%c lss %%a if %%a lss %%b set &quot;tokens=%%c %%a %%b&quot;<br />&nbsp; &nbsp; &nbsp; if %%c lss %%b if %%b lss %%a set &quot;tokens=%%c %%b %%a&quot;<br />&nbsp; &nbsp; )<br />&nbsp; )<br />&nbsp; :: We now have variables with the correct values, but the code doesn't know<br />&nbsp; :: the name of the variables! We must translate the unknown native variable<br />&nbsp; :: names into known English names<br />&nbsp; <br />&nbsp; :: Initialize the translation of native tokens to English tokens<br />&nbsp; set translate=<br />&nbsp; set T_yy=<br />&nbsp; set T_mm=<br />&nbsp; set T_dd=<br />&nbsp; <br />&nbsp; :: Determine the correct token translation map<br />&nbsp; :: Each map in the for list should contain the space delimited English tokens<br />&nbsp; :: on the left followed by a semicolon followed by the space delimited native<br />&nbsp; :: tokens on the right. The native tokens should be sorted alphabetically<br />&nbsp; :: and the English tokens should be in the matching logical order.<br />&nbsp; :: Currently supports English and German. Additional translation maps<br />&nbsp; :: should be added for additional language support.<br />&nbsp; for %%t in (<br />&nbsp; &nbsp; &quot;dd mm yy;dd mm yy&quot;<br />&nbsp; &nbsp; &quot;yy mm dd;JJ MM TT&quot;<br />&nbsp; ) do (<br />&nbsp; &nbsp; set test=%%~t<br />&nbsp; &nbsp; if &quot;!test:*;=!&quot;==&quot;%tokens%&quot; set translate=%%~t<br />&nbsp; )<br />&nbsp; <br />&nbsp; :: Parse the token translation map into variables used for translation<br />&nbsp; for /f &quot;tokens=1-6 delims=; &quot; %%a in (&quot;%translate%&quot;) do (<br />&nbsp; &nbsp; set T_%%a=%%d<br />&nbsp; &nbsp; set T_%%b=%%e<br />&nbsp; &nbsp; set T_%%c=%%f<br />&nbsp; )<br />&nbsp; <br />&nbsp; :: Transfer the values from native date variables to English date variables<br />&nbsp; set E_yy=!%T_yy%!<br />&nbsp; set E_mm=!%T_mm%!<br />&nbsp; set E_dd=!%T_dd%!<br />&nbsp; <br />&nbsp; :: Eliminate leading zeros so that numbers aren't interpreted as octal<br />&nbsp; set /a &quot;E_yy=10000%E_yy% %%10000, E_mm=100%E_mm% %%100, E_dd=100%E_dd% %%100&quot;<br />&nbsp; <br />&nbsp; :: Return the date values<br />&nbsp; (endlocal<br />&nbsp; &nbsp; set %~1=%E_yy%<br />&nbsp; &nbsp; set %~2=%E_mm%<br />&nbsp; &nbsp; set %~3=%E_dd%<br />&nbsp; )<br />exit /b<br /></code></pre></div><br /><br />Dave Benham</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7172" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile7172">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistf906.html?mode=viewprofile&amp;u=1470" class="username">amel27</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search45e1.html?author_id=1470&amp;sr=posts">177</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 04 Jun 2010 20:05</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Russia</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content7172">

						<h3 ><a href="#p7172">Re: &quot;universal&quot; %DATE% parser</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting4638.html?mode=quote&amp;f=3&amp;p=7172" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicd5b2.html?p=7172#p7172" onclick="prompt('Message #2',this.href); return false;">#2</a></span> 
									<a class="unread" href="viewtopicd5b2.html?p=7172#p7172" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistf906.html?mode=viewprofile&amp;u=1470" class="username">amel27</a></strong> &raquo; </span>11 May 2011 01:54
			</p>
			
			
			
			<div class="content">interesting topic, <strong class="text-strong">dbenham</strong><br />another way of sorting... but in reverse order:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set &quot;tokens=&quot;<br />for %%x in (&quot;%%a %%b %%c&quot; &quot;%%b %%a %%c&quot; &quot;%%c %%a %%b&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;%%a %%c %%b&quot; &quot;%%b %%c %%a&quot; &quot;%%c %%b %%a&quot;<br />) do if &quot;!tokens!&quot; lss &quot;%%~x&quot; set &quot;tokens=%%~x&quot;</code></pre></div><br />russian map (in your order):  <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /> <br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>yy dd mm;гг дд мм</code></pre></div></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7187" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile7187">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search661c.html?author_id=1265&amp;sr=posts">3386</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 22 Jan 2010 18:01</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Germany</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content7187">

						<h3 ><a href="#p7187">Re: &quot;universal&quot; %DATE% parser</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting30c1.html?mode=quote&amp;f=3&amp;p=7187" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic1a76.html?p=7187#p7187" onclick="prompt('Message #3',this.href); return false;">#3</a></span> 
									<a class="unread" href="viewtopic1a76.html?p=7187#p7187" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a></strong> &raquo; </span>11 May 2011 10:25
			</p>
			
			
			
			<div class="content">It works for me as expected <img class="smilies" src="images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /><br />It's a real good alternative if you don't have access to the registry.<br /><br />Regards<br />aGerman</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7190" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile7190">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha86d.html?author_id=2258&amp;sr=posts">2152</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 Feb 2011 21:02</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> United States (east coast)</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content7190">

						<h3 ><a href="#p7190">Re: &quot;universal&quot; %DATE% parser</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postinge15a.html?mode=quote&amp;f=3&amp;p=7190" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic7b3e-2.html?p=7190#p7190" onclick="prompt('Message #4',this.href); return false;">#4</a></span> 
									<a class="unread" href="viewtopic7b3e-2.html?p=7190#p7190" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a></strong> &raquo; </span>11 May 2011 15:15
			</p>
			
			
			
			<div class="content">Thanks for the good news aGerman!<br /><br />amel27 - Good idea for sorting!<br /><br />Your idea is easily adapted for an ascending sort<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set tokens=&quot;%%c %%b %%a&quot;<br />for %%x in (&quot;%%a %%b %%c&quot; &quot;%%b %%a %%c&quot; &quot;%%c %%a %%b&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;%%a %%c %%b&quot; &quot;%%b %%c %%a&quot;<br />) do if &quot;!tokens!&quot; gtr &quot;%%~x&quot; set &quot;tokens=%%~x&quot;<br /></code></pre></div><br /><br />I'm worried that localized character collation sequences may have the potential to break the algorithm.<br /><br />I think the following sort algorithm at least partially avoids potential collation problems:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set &quot;tokens=&quot;<br />for /f %%x in ('^(for %%t in ^(%%a %%b %%c^) do @echo %%t^)^|sort /L C') do set &quot;tokens=!tokens! %%x&quot;<br />set &quot;tokens=!tokens:~1!&quot;<br /></code></pre></div><br />The above should always work as long as characters less than ASCII 128 collate the same regardless of locality. Does anyone know if collation of characters less than ASCII 128 can vary?<br /><br />I think <a href="viewtopic09ed.html?f=3&amp;t=1811" class="postlink">Sorting tokens within a string</a> is an interesting topic that deserves its own thread, so I started one.<br /><br /><br />amel27 - How did you post those (Cyrillic?) characters? And more importantly, how do I get them in my code? I've never tried to deal with languages other than English before, so I'm pretty ignorant to the ins and outs of internationalization.<br /><br />I'm still hoping one function can handle all languages supported by Windows, given the correct set of translation maps. But I won't be surprised if we run into problems.<br /><br /><br />Dave Benham</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7193" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile7193">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistf906.html?mode=viewprofile&amp;u=1470" class="username">amel27</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search45e1.html?author_id=1470&amp;sr=posts">177</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 04 Jun 2010 20:05</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Russia</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content7193">

						<h3 ><a href="#p7193">Re: &quot;universal&quot; %DATE% parser</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingdc98.html?mode=quote&amp;f=3&amp;p=7193" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic0df8.html?p=7193#p7193" onclick="prompt('Message #5',this.href); return false;">#5</a></span> 
									<a class="unread" href="viewtopic0df8.html?p=7193#p7193" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistf906.html?mode=viewprofile&amp;u=1470" class="username">amel27</a></strong> &raquo; </span>12 May 2011 02:28
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>dbenham wrote:</cite>amel27 - How did you post those (Cyrillic?) characters?</div></blockquote>Simple copy/paste from DOS, but my IE font is UTF-8. Thus, I can copy/paste text from IE to notepad, then save file as Unicode (UTF16LE), and convert this text file to appropriate OEM via BAT:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />for /f &quot;tokens=2 delims=:&quot; %%a in ('chcp') do set/a &quot;ch=%%a&quot;<br />&gt;nul chcp 858<br />type &quot;cp858_16le.txt&quot;&gt;cp858.txt<br />&gt;nul chcp %ch%</code></pre></div><br />In this sample I convert unicode text from your <a href="viewtopicbcfc.html?p=7189#p7189" class="postlink">sample post</a> to OEM 858. For my Russian you should take 866 OEM code page for converting.</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7203" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile7203">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha86d.html?author_id=2258&amp;sr=posts">2152</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 Feb 2011 21:02</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> United States (east coast)</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content7203">

						<h3 ><a href="#p7203">Re: &quot;universal&quot; %DATE% parser</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting43a1-2.html?mode=quote&amp;f=3&amp;p=7203" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic0cc4.html?p=7203#p7203" onclick="prompt('Message #6',this.href); return false;">#6</a></span> 
									<a class="unread" href="viewtopic0cc4.html?p=7203#p7203" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a></strong> &raquo; </span>12 May 2011 16:29
			</p>
			
			
			
			<div class="content">Thanks amel27<br /><br />So a binary hex dump of the sorted Russian space delimited tokens would be:<br />A3 A3 20 A4 A4 20 AC AC<br /><br />Did I get that right?<br /><br />So if I were to send you a binary copy of the code below and you installed it on your Russian machine, the 3rd map would appear in Russian and everything would work for you, correct?<br /><br />But because this forum doesn't support attachments, you are unable to get the binary image directly. So you copy and paste the code into a Unicode document. You then temporarily set your code page to OEM 858 (Multilingual Latin 1 + Euro) which corresponds to what my English text editor produced. (I'm taking your word on this, I have no idea. My text editor display does not match my DOS setting of OEM 437) You then type the Unicode file, redirecting the output to a file, which effectively converts the Unicode into OEM 858 and you have your binary image. You reset your code page back to OEM 866 Russian and everything is ready to go. Did I get this right?<br /><br /><br />For clarity I think it would be good if the hex dump and the supported language(s) are appended to each translation map as comments. This requires some minor changes to the code.<br /><br />If anyone else would like to contribute an additional language translation map to this function, please include a hex dump of your sorted native date format tokens. I also need the English translation in the same sort order.<br /><br /><br />I've given some more thought to the localized character collation sequence. As long as the sequence is consistant for a given locale, I don't think it should matter.<br /><br />I do have some concern for Asian (or other) languages that use Multi-Byte characters. Not all byte combinations are valid, and some translation maps might have invalid sequences for a given language. I'm curious how tolerant Windows &quot;DOS&quot; would be if it ran accross such a situation.<br /><br />Here is the updated code with the Russian map and an ascending version of amel27's sort technique.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:parseDate yyVar mmVar ddVar<br />::<br />:: Parses %DATE% into numeric year, month, and date components<br />::<br />::&nbsp; &nbsp;yyVar = name of variable to hold numeric year value<br />::&nbsp; &nbsp;mmVar = name ov variable to hold numeric month value<br />::&nbsp; &nbsp;ddVar = name of variable to hold numeric day value<br /><br />&nbsp; setlocal enableDelayedExpansion<br />&nbsp; <br />&nbsp; :: Parse the native date format tokens output by the DATE command<br />&nbsp; for /f &quot;skip=1 tokens=2-4 delims=(-)&quot; %%a in ('&quot;echo:|date&quot;') do (<br />&nbsp; <br />&nbsp; &nbsp; rem Parse the numeric date components of %DATE%<br />&nbsp; &nbsp; for /f &quot;tokens=1-3 delims=/.- &quot; %%A in (&quot;%date:* =%&quot;) do (<br /><br />&nbsp; &nbsp; &nbsp; rem Set variables named after native date tokens to appropriate numeric date component values<br />&nbsp; &nbsp; &nbsp; set %%a=%%A<br />&nbsp; &nbsp; &nbsp; set %%b=%%B<br />&nbsp; &nbsp; &nbsp; set %%c=%%C<br />&nbsp; <br />&nbsp; &nbsp; &nbsp; rem Create a string of sorted native date format tokens<br />&nbsp; &nbsp; &nbsp; set &quot;tokens=%%c %%b %%a&quot;<br />&nbsp; &nbsp; &nbsp; for %%x in (&quot;%%a %%b %%c&quot; &quot;%%b %%a %%c&quot; &quot;%%c %%a %%b&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;%%a %%c %%b&quot; &quot;%%b %%c %%a&quot;<br />&nbsp; &nbsp; &nbsp; ) do if &quot;!tokens!&quot; gtr &quot;%%~x&quot; set &quot;tokens=%%~x&quot;<br />&nbsp; &nbsp; )<br />&nbsp; )<br />&nbsp; :: We now have variables with the correct values along with a list of the<br />&nbsp; :: variable names. But the code doesn't know how to interpret the names!<br />&nbsp; :: We must translate the native names into English names.<br /><br />&nbsp; :: Initialize the translation of native date format tokens to English tokens<br />&nbsp; set translate=<br />&nbsp; set T_yy=<br />&nbsp; set T_mm=<br />&nbsp; set T_dd=<br /><br />&nbsp; :: Determine the correct token translation map.<br />&nbsp; ::<br />&nbsp; :: Each map in the for list should contain the space delimited English tokens<br />&nbsp; :: on the left followed by a comma followed by the space delimited native<br />&nbsp; :: tokens on the right. The native tokens should be sorted alphabetically<br />&nbsp; :: and the English tokens should be in the matching logical order. A comment<br />&nbsp; :: should be appended starting with a semicolon followed by a hexdump of each<br />&nbsp; :: map's native binary representation as well as the language(s) it supports.<br />&nbsp; :: A map with codes greater than 0x7F may not appear correct unless viewed on<br />&nbsp; :: a machine that supports that language.<br />&nbsp; ::<br />&nbsp; for %%t in (<br />&nbsp; &nbsp; &quot;dd mm yy,dd mm yy; 64 64 20 6D 6D 20 79 79 - English&quot;<br />&nbsp; &nbsp; &quot;yy mm dd,JJ MM TT; 4A 4A 20 4D 4D 20 54 54 - German&quot;<br />&nbsp; &nbsp; &quot;yy dd mm,££ ¤¤ ¬¬; A3 A3 20 A4 A4 20 AC AC - Russian&quot;<br />&nbsp; ) do (<br />&nbsp; &nbsp; for /f &quot;delims=;&quot; %%m in (%%t) do set map=%%m<br />&nbsp; &nbsp; if &quot;!map:*,=!&quot;==&quot;%tokens%&quot; set translate=!map!<br />&nbsp; )<br /><br />&nbsp; :: Parse the token translation map into variables used for translation<br />&nbsp; for /f &quot;tokens=1-6 delims=, &quot; %%a in (&quot;%translate%&quot;) do (<br />&nbsp; &nbsp; set T_%%a=%%d<br />&nbsp; &nbsp; set T_%%b=%%e<br />&nbsp; &nbsp; set T_%%c=%%f<br />&nbsp; )<br />&nbsp; <br />&nbsp; :: Transfer the values from native date variables to English date variables<br />&nbsp; set E_yy=!%T_yy%!<br />&nbsp; set E_mm=!%T_mm%!<br />&nbsp; set E_dd=!%T_dd%!<br />&nbsp; <br />&nbsp; :: Eliminate leading zeros so that numbers aren't interpreted as octal<br />&nbsp; set /a &quot;E_yy=10000%E_yy% %%10000, E_mm=100%E_mm% %%100, E_dd=100%E_dd% %%100&quot;<br />&nbsp; <br />&nbsp; :: Return the date values in year, month, day order<br />&nbsp; (endlocal<br />&nbsp; &nbsp; set %~1=%E_yy%<br />&nbsp; &nbsp; set %~2=%E_mm%<br />&nbsp; &nbsp; set %~3=%E_dd%<br />&nbsp; )<br />exit /b<br /></code></pre></div><br /><br />Dave Benham</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7204" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile7204">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistf906.html?mode=viewprofile&amp;u=1470" class="username">amel27</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search45e1.html?author_id=1470&amp;sr=posts">177</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 04 Jun 2010 20:05</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Russia</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content7204">

						<h3 ><a href="#p7204">Re: &quot;universal&quot; %DATE% parser</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting6bf6.html?mode=quote&amp;f=3&amp;p=7204" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopice1c1.html?p=7204#p7204" onclick="prompt('Message #7',this.href); return false;">#7</a></span> 
									<a class="unread" href="viewtopice1c1.html?p=7204#p7204" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistf906.html?mode=viewprofile&amp;u=1470" class="username">amel27</a></strong> &raquo; </span>12 May 2011 18:59
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>dbenham wrote:</cite>So a binary hex dump of the sorted Russian space delimited tokens would be:<br />A3 A3 20 A4 A4 20 AC AC<br /><br />Did I get that right?</div></blockquote>Yes, it is correct dump. <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br /><blockquote><div><cite>dbenham wrote:</cite>So you copy and paste the code into a Unicode document. You then temporarily set your code page to OEM 858 (Multilingual Latin 1 + Euro) which corresponds to what my English text editor produced. (I'm taking your word on this, I have no idea. My text editor display does not match my DOS setting of OEM 437) You then type the Unicode file, redirecting the output to a file, which effectively converts the Unicode into OEM 858 and you have your binary image. You reset your code page back to OEM 866 Russian and everything is ready to go. Did I get this right?</div></blockquote>In fact, we should store multilanguage text in Unicode (UTF16LE preffered), but before using it as BAT code, we can convert it to actual OEM. Windows automatically recoded Unicode file depending on localized adjustments.<br /><br /><blockquote><div><cite>dbenham wrote:</cite>Here is the updated code with the Russian map and an ascending version of amel27's sort technique.</div></blockquote>No, this unicode representation incorrect, probably, because you copied not from unicode source. Binary dump of this representation differs from the original: 3F 3F 20 FD FD 20 BF BF</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7205" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile7205">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha86d.html?author_id=2258&amp;sr=posts">2152</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 Feb 2011 21:02</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> United States (east coast)</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content7205">

						<h3 ><a href="#p7205">Re: &quot;universal&quot; %DATE% parser</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting72a4.html?mode=quote&amp;f=3&amp;p=7205" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicac4c.html?p=7205#p7205" onclick="prompt('Message #8',this.href); return false;">#8</a></span> 
									<a class="unread" href="viewtopicac4c.html?p=7205#p7205" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a></strong> &raquo; </span>12 May 2011 21:03
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>amel27 wrote:</cite>In fact, we should store multilanguage text in Unicode (UTF16LE preffered), but before using it as BAT code, we can convert it to actual OEM. Windows automatically recoded Unicode file depending on localized adjustments.<br /></div></blockquote><br />Ah, we may have a philosophical difference of opinion here.  <img class="smilies" src="images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /><br />I realize that a batch file is an interpreted text file, and Unicode is the best way (only reliable standard way) to store text with any arbitrary combination of languages. BUT, my original intent was to have a <strong class="text-strong">functioning</strong> batch file that could be passed back and forth and work properly with &quot;any&quot; language. As you pointed out, a batch file in Unicode cannot be executed. If we follow your suggestion, then when the first person converts the Unicode to his/her OEM character set, all the unsupported characters are irreversibly translated into question marks &quot;?&quot;. The batch file is no longer universal in that it cannot be passed on to the next person that requires the corrupted translation maps.<br /><br />The problem is even more acute if you consider the <a href="viewtopic3aa7.html?t=1733" class="postlink">:asc, :chr, :str2hex, :hex2str</a> functions. These require a string that represents all byte values from 0x01 - 0xFF. The Unicode representation will change from language to language, but the binary representation of the functioning batch file will not.<br /><br />In my mind the problem is solved by treating the batch file not as text but as binary. The meaning of each character (byte) greater than 0x7F changes between languages, but the &quot;universal&quot; function(s) continue(s) to work as intended. In theory anyway, I'm still not sure what happens with multi-byte languages. I acknowledge that my strategy introduces its own set of issues, probably some that I'm not aware of. An obvious one is how to post a binary representation of a batch file on this site.<br /><br />I don't think there is a perfect answer to this debate. I'd love input from more people on their opinion of the best way to proceed. Does the community at large think that treating a batch file as binary is a bad idea? Or is it worth pursuing?<br /><br />With regard to my last posted code:<br /><blockquote><div><cite>amel27 wrote:</cite>No, this unicode representation incorrect, probably, because you copied not from unicode source. Binary dump of this representation differs from the original: 3F 3F 20 FD FD 20 BF BF<br /></div></blockquote><br />Well, as per my earlier discussion, I was not attempting to post Unicode. Can you tell me if the steps I outlined in my prior post work for you?<br /><span style="color: #BF0000"><strong class="text-strong">Addendum added 2011-05-13</strong></span><br />Oops! I misunderstood what you wrote. I see that you already did try it and OEM 858 is obviously incorrect.<br /><br />Try these maps using OEM 437. With correct manipulation using DOS OEM/Unicode conversion I am able to reconstruct the Russian, so I think it should work for you as well.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; &quot;dd mm yy,dd mm yy; 64 64 20 6D 6D 20 79 79 - English&quot;<br />&nbsp; &nbsp; &quot;yy mm dd,JJ MM TT; 4A 4A 20 4D 4D 20 54 54 - German&quot;<br />&nbsp; &nbsp; &quot;yy dd mm,úú ññ ¼¼; A3 A3 20 A4 A4 20 AC AC - Russian&quot;<br /></code></pre></div><br /><br />In the mean time I will try to figure out what character set my editor is using for display.<br /><br />Thanks amel27 for your valued help and input<br /><br />Dave Benham</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7215" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile7215">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha86d.html?author_id=2258&amp;sr=posts">2152</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 Feb 2011 21:02</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> United States (east coast)</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content7215">

						<h3 ><a href="#p7215">Re: &quot;universal&quot; %DATE% parser</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting974f.html?mode=quote&amp;f=3&amp;p=7215" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic8ede.html?p=7215#p7215" onclick="prompt('Message #9',this.href); return false;">#9</a></span> 
									<a class="unread" href="viewtopic8ede.html?p=7215#p7215" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a></strong> &raquo; </span>13 May 2011 15:05
			</p>
			
			
			
			<div class="content">Erueka!  <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> <br /><br />I've determined that my most recent post of the full code was using Windows 1252 character set (CHCP 1252).<br /><br />I was able to reconstruct the russian characters via the following steps:<br /><br />1) copy and paste the posted code into Notepad and save as Unicode.<br />2)from command line set CHCP=1252<br />3) then type unicode file with redirection into a 1252 text file.<br /><br />At this point the file should be the binary image that I intended.<br /><br />4) cmd /U<br />5) CHCP=866<br />6) type 1252 file with redirection into russian unicode text file.<br /><br />The 3rd map should now be in Russian!<br /><br />Dave Benham</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7218" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile7218">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist941f.html?mode=viewprofile&amp;u=1572" class="username">orange_batch</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search325b.html?author_id=1572&amp;sr=posts">442</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 01 Aug 2010 17:13</dd>		
		
																<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Canadian Pacific</dd>
							
							<dd class="profile-contact">
				<strong>Contact:</strong>
				<div class="dropdown-container dropdown-left">
					<a href="#" class="dropdown-trigger" title="Contact orange_batch">
						<i class="icon fa-commenting-o fa-fw icon-lg" aria-hidden="true"></i><span class="sr-only">Contact orange_batch</span>
					</a>
					<div class="dropdown">
						<div class="pointer"><div class="pointer-inner"></div></div>
						<div class="dropdown-contents contact-icons">
																																								<div>
																	<a href="http://ss64.com/nt/" title="Website" class="last-cell">
										<span class="contact-icon phpbb_website-icon">Website</span>
									</a>
																	</div>
																					</div>
					</div>
				</div>
			</dd>
				
		</dl>

		<div class="postbody">
						<div id="post_content7218">

						<h3 ><a href="#p7218">Re: &quot;universal&quot; %DATE% parser</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingfee8.html?mode=quote&amp;f=3&amp;p=7218" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic0924.html?p=7218#p7218" onclick="prompt('Message #10',this.href); return false;">#10</a></span> 
									<a class="unread" href="viewtopic0924.html?p=7218#p7218" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist941f.html?mode=viewprofile&amp;u=1572" class="username">orange_batch</a></strong> &raquo; </span>14 May 2011 02:03
			</p>
			
			
			
			<div class="content">I studied the relationships between unicode and command prompt extensively and came up with some ingenious solutions for certain problems. They don't relate in this case though. Just know that there are different types of unicode that behave differently under command prompt, for example I don't know if asian languages would work with this. In any case it seems you found the solution for most unicode, it would involve chcp usually. By the way, chcp 65001 is UTF-8.<br /><br />Also, as an alternative, there must be a way to retrieve standardized date/time information through WMI via WMIC or simple VBScript. It might require certain privileges though, I don't know.</div>

			
													<div class="notice">
					Last edited by <a href="memberlist941f.html?mode=viewprofile&amp;u=1572" class="username">orange_batch</a> on 14 May 2011 05:31, edited 1 time in total.
									</div>
			
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7219" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile7219">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistf906.html?mode=viewprofile&amp;u=1470" class="username">amel27</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search45e1.html?author_id=1470&amp;sr=posts">177</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 04 Jun 2010 20:05</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Russia</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content7219">

						<h3 ><a href="#p7219">Re: &quot;universal&quot; %DATE% parser</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingd7f7.html?mode=quote&amp;f=3&amp;p=7219" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic4272.html?p=7219#p7219" onclick="prompt('Message #11',this.href); return false;">#11</a></span> 
									<a class="unread" href="viewtopic4272.html?p=7219#p7219" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistf906.html?mode=viewprofile&amp;u=1470" class="username">amel27</a></strong> &raquo; </span>14 May 2011 02:35
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>dbenham wrote:</cite>But because this forum doesn't support attachments, you are unable to get the binary image directly.</div></blockquote>On the other hand, we can reproduce the binary data via script (WSH for example).<br />This BAT regenerate itself to new BAT file from <a href="viewtopic0cc4.html?p=7203#p7203" class="postlink">this</a> post.  <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /> <div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@set @x=0 /*<br />@echo off<br />set &quot;MAP=&quot;&amp; set &quot;CRLF=\x0D\x0A&quot;<br /><br />:: ---------------------------------------------------------<br />set &quot;MAP=%MAP%&nbsp; &nbsp; &quot;dd mm yy,\x64\x64\x20\x6D\x6D\x20\x79\x79; English &quot; %CRLF%&quot;<br />set &quot;MAP=%MAP%&nbsp; &nbsp; &quot;yy mm dd,\x4A\x4A\x20\x4D\x4D\x20\x54\x54; German&nbsp; &quot; %CRLF%&quot;<br />set &quot;MAP=%MAP%&nbsp; &nbsp; &quot;yy dd mm,\xA3\xA3\x20\xA4\xA4\x20\xAC\xAC; Russian &quot; %CRLF%&quot;<br />:: ---------------------------------------------------------<br /><br />(echo/:parseDate yyVar mmVar ddVar<br />&nbsp;echo/::<br />&nbsp;echo/:: Parses %%DATE%% into numeric year, month, and date components<br />&nbsp;echo/::<br />&nbsp;echo/::&nbsp; &nbsp;yyVar = name of variable to hold numeric year value<br />&nbsp;echo/::&nbsp; &nbsp;mmVar = name ov variable to hold numeric month value<br />&nbsp;echo/::&nbsp; &nbsp;ddVar = name of variable to hold numeric day value<br />&nbsp;echo/<br />&nbsp;echo/&nbsp; setlocal enableDelayedExpansion<br />&nbsp;echo/&nbsp; <br />&nbsp;echo/&nbsp; :: Parse the native date format tokens output by the DATE command<br />&nbsp;echo/&nbsp; for /f &quot;skip=1 tokens=2-4 delims=(-)&quot; %%%%a in ('&quot;echo:|date&quot;'^) do (<br />&nbsp;echo/&nbsp; <br />&nbsp;echo/&nbsp; &nbsp; rem Parse the numeric date components of %%DATE%%<br />&nbsp;echo/&nbsp; &nbsp; for /f &quot;tokens=1-3 delims=/.- &quot; %%%%A in (&quot;%%date:* =%%&quot;^) do (<br />&nbsp;echo/<br />&nbsp;echo/&nbsp; &nbsp; &nbsp; rem Set variables named after native date tokens to appropriate numeric date component values<br />&nbsp;echo/&nbsp; &nbsp; &nbsp; set %%%%a=%%%%A<br />&nbsp;echo/&nbsp; &nbsp; &nbsp; set %%%%b=%%%%B<br />&nbsp;echo/&nbsp; &nbsp; &nbsp; set %%%%c=%%%%C<br />&nbsp;echo/&nbsp; <br />&nbsp;echo/&nbsp; &nbsp; &nbsp; rem Create a string of sorted native date format tokens<br />&nbsp;echo/&nbsp; &nbsp; &nbsp; set &quot;tokens=%%%%c %%%%b %%%%a&quot;<br />&nbsp;echo/&nbsp; &nbsp; &nbsp; for %%%%x in (&quot;%%%%a %%%%b %%%%c&quot; &quot;%%%%b %%%%a %%%%c&quot; &quot;%%%%c %%%%a %%%%b&quot;<br />&nbsp;echo/&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;%%%%a %%%%c %%%%b&quot; &quot;%%%%b %%%%c %%%%a&quot;<br />&nbsp;echo/&nbsp; &nbsp; &nbsp; ^) do if &quot;!tokens!&quot; gtr &quot;%%%%~x&quot; set &quot;tokens=%%%%~x&quot;<br />&nbsp;echo/&nbsp; &nbsp; ^)<br />&nbsp;echo/&nbsp; ^)<br />&nbsp;echo/&nbsp; :: We now have variables with the correct values along with a list of the<br />&nbsp;echo/&nbsp; :: variable names. But the code doesn't know how to interpret the names!<br />&nbsp;echo/&nbsp; :: We must translate the native names into English names.<br />&nbsp;echo/<br />&nbsp;echo/&nbsp; :: Initialize the translation of native date format tokens to English tokens<br />&nbsp;echo/&nbsp; set translate=<br />&nbsp;echo/&nbsp; set T_yy=<br />&nbsp;echo/&nbsp; set T_mm=<br />&nbsp;echo/&nbsp; set T_dd=<br />&nbsp;echo/<br />&nbsp;echo/&nbsp; :: Determine the correct token translation map.<br />&nbsp;echo/&nbsp; ::<br />&nbsp;echo/&nbsp; :: Each map in the for list should contain the space delimited English tokens<br />&nbsp;echo/&nbsp; :: on the left followed by a comma followed by the space delimited native<br />&nbsp;echo/&nbsp; :: tokens on the right. The native tokens should be sorted alphabetically<br />&nbsp;echo/&nbsp; :: and the English tokens should be in the matching logical order. A comment<br />&nbsp;echo/&nbsp; :: should be appended starting with a semicolon followed by a hexdump of each<br />&nbsp;echo/&nbsp; :: map's native binary representation as well as the language(s^) it supports.<br />&nbsp;echo/&nbsp; :: A map with codes greater than 0x7F may not appear correct unless viewed on<br />&nbsp;echo/&nbsp; :: a machine that supports that language.<br />&nbsp;echo/&nbsp; ::<br />&nbsp;echo/&nbsp; for %%%%t in (<br />)&gt;&quot;%~n0.tmp&quot;<br /><br />cscript/nologo /e:jscript &quot;%~f0&quot; &quot;%~n0.tmp&quot; &quot;%MAP:&quot;=\x22%&quot;<br /><br />(echo/&nbsp; ^) do (<br />&nbsp;echo/&nbsp; &nbsp; for /f &quot;delims=;&quot; %%%%m in (%%%%t^) do set map=%%%%m<br />&nbsp;echo/&nbsp; &nbsp; if &quot;!map:*,=!&quot;==&quot;%%tokens%%&quot; set translate=!map!<br />&nbsp;echo/&nbsp; ^)<br />&nbsp;echo/<br />&nbsp;echo/&nbsp; :: Parse the token translation map into variables used for translation<br />&nbsp;echo/&nbsp; for /f &quot;tokens=1-6 delims=, &quot; %%%%a in (&quot;%%translate%%&quot;^) do (<br />&nbsp;echo/&nbsp; &nbsp; set T_%%%%a=%%%%d<br />&nbsp;echo/&nbsp; &nbsp; set T_%%%%b=%%%%e<br />&nbsp;echo/&nbsp; &nbsp; set T_%%%%c=%%%%f<br />&nbsp;echo/&nbsp; ^)<br />&nbsp;echo/<br />&nbsp;echo/&nbsp; :: Transfer the values from native date variables to English date variables<br />&nbsp;echo/&nbsp; set E_yy=!%%T_yy%%!<br />&nbsp;echo/&nbsp; set E_mm=!%%T_mm%%!<br />&nbsp;echo/&nbsp; set E_dd=!%%T_dd%%!<br />&nbsp;echo/&nbsp; <br />&nbsp;echo/&nbsp; :: Eliminate leading zeros so that numbers aren't interpreted as octal<br />&nbsp;echo/&nbsp; set /a &quot;E_yy=10000%%E_yy%% %%%%10000, E_mm=100%%E_mm%% %%%%100, E_dd=100%%E_dd%% %%%%100&quot;<br />&nbsp;echo/&nbsp; <br />&nbsp;echo/&nbsp; :: Return the date values in year, month, day order<br />&nbsp;echo/&nbsp; (endlocal<br />&nbsp;echo/&nbsp; &nbsp; set %%~1=%%E_yy%%<br />&nbsp;echo/&nbsp; &nbsp; set %%~2=%%E_mm%%<br />&nbsp;echo/&nbsp; &nbsp; set %%~3=%%E_dd%%<br />&nbsp;echo/&nbsp; ^)<br />&nbsp;echo/exit /b<br />)&gt;&gt;&quot;%~n0.tmp&quot;<br /><br />del/f &quot;%~nx0&quot;&amp;&amp; ren &quot;%~n0.tmp&quot; &quot;%~nx0&quot;<br /><br />@exit */<br />inp=new ActiveXObject(&quot;ADODB.Stream&quot;);<br />inp.Type=2;<br />inp.Open();<br />inp.WriteText(eval(&quot;'&quot;+WScript.Arguments(1)+&quot;'&quot;));<br />out=new ActiveXObject(&quot;ADODB.Stream&quot;);<br />out.Type=2;<br />out.Charset='ISO-8859-1';<br />out.Open();<br />out.LoadFromFile(WScript.Arguments(0));<br />inp.Position=0;<br />out.Position=out.Size;<br />inp.CopyTo(out);<br />inp.Close();<br />out.SaveToFile(WScript.Arguments(0),2);<br />out.Close();</code></pre></div></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7227" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile7227">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistf906.html?mode=viewprofile&amp;u=1470" class="username">amel27</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search45e1.html?author_id=1470&amp;sr=posts">177</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 04 Jun 2010 20:05</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Russia</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content7227">

						<h3 ><a href="#p7227">Re: &quot;universal&quot; %DATE% parser</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting286d.html?mode=quote&amp;f=3&amp;p=7227" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic8fa2.html?p=7227#p7227" onclick="prompt('Message #12',this.href); return false;">#12</a></span> 
									<a class="unread" href="viewtopic8fa2.html?p=7227#p7227" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistf906.html?mode=viewprofile&amp;u=1470" class="username">amel27</a></strong> &raquo; </span>14 May 2011 20:48
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>dbenham wrote:</cite>I've determined that my most recent post of the full code was using Windows 1252 character set (CHCP 1252).</div></blockquote>Hm.. 1252 is ANSI (1-byte), but if I switch my browser to any ANSI/DOS font, russian chars in yor posts takes 2 bytes... <img class="smilies" src="images/smilies/icon_confused.gif" alt=":?" title="Confused" /></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7247" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile7247">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha86d.html?author_id=2258&amp;sr=posts">2152</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 Feb 2011 21:02</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> United States (east coast)</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content7247">

						<h3 ><a href="#p7247">Re: &quot;universal&quot; %DATE% parser</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting198b.html?mode=quote&amp;f=3&amp;p=7247" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic1540.html?p=7247#p7247" onclick="prompt('Message #13',this.href); return false;">#13</a></span> 
									<a class="unread" href="viewtopic1540.html?p=7247#p7247" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a></strong> &raquo; </span>16 May 2011 14:20
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>amel27 wrote:</cite>Hm.. 1252 is ANSI (1-byte), but if I switch my browser to any ANSI/DOS font, russian chars in yor posts takes 2 bytes... <br /></div></blockquote><br />I assume everything works when your browser is set to UTF-8? If so, then this reminds me of an old joke.<br /><br />    Patient - &quot;Doctor, I hope you can help me. It hurts when I do this!&quot;<br />    Doctor - &quot;Then don't do that.&quot;<br /><br />But I see your point. This is another possible point of failure for the transfer of the correct code.<br /><br />I like the basic idea of your code re-generator. But it takes a fair amount of manipulation to prepare the file. I've refined the technique below to something I think is much easier to administer. It should be easily adabtable to any file. The only thing that needs to change is the definition of the output file near the top, and the text between the BEGIN and END markers.<br /><br />I also had an 'aha' moment when I realized I can completely avoid the need to sort the native tokens. The new translation technique simply requires a map with the 3 space delimited native tokens in year, month, day order. The code is significantly shorter and simpler, and now I know definitively I don't have to worry about local character collation sequences. What really surprises me is the new code is actually 10% slower to execute on my machine then the prior version. Regardless, I like the simplicity of the new version, and it is still plenty fast.<br /><br />So here is the &quot;refined&quot; function - packaged in a variant of amel27's code re-generator. Please note that this code re-generator operates differently then what amel27 has - It is hard coded to create a file named  &quot;parseDate.bat&quot;, and the original code re-generator file will remain untouched.<br /><br />makeParseDate.bat<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@set @junk=0 /* The 1st 3 lines should not be changed<br />@echo off &amp; set &quot;@junk=&quot;<br />setlocal<br /><br />:: define the name of the output file<br />set file=&quot;parseDate.bat&quot;<br /><br />if exist %file% del %file%<br />set &quot;output=&quot;<br />for /f &quot;skip=2 tokens=1,* delims=&#91;&#93;&quot; %%a in ('find /v /n &quot;&quot; %~f0') do (<br />&nbsp; if defined output (<br />&nbsp; &nbsp; if &quot;%%b&quot;==&quot;END&quot; (set &quot;output=&quot;) else (set &quot;ln=%%b&quot;)&amp;call :procLn<br />&nbsp; ) else if &quot;%%b&quot;==&quot;BEGIN&quot; set output=true<br />)<br />exit /b<br />:procLn<br />&nbsp; setlocal enableDelayedExpansion<br />&nbsp; if &quot;!ln:~0,4!&quot; neq &quot;HEX:&quot; (echo:!ln!&gt;&gt;!file!)&amp;exit /b<br />&nbsp; set &quot;ln=!ln:~4!&quot;<br />&nbsp; call cscript/nologo /e:jscript &quot;%~f0&quot; !file! &quot;!ln:&quot;=\x22!\x0D\x0A&quot;<br />exit /b<br /><br />** BEGIN marks the beginning of the intended file<br />**<br />** END marks the end of the intended file<br />**<br />** HEX: marks a line containing hex that must be processed by the jscript.<br />**&nbsp; &nbsp; &nbsp; Only lines containing characters greater than 0x7F need be prepared<br />**&nbsp; &nbsp; &nbsp; as HEX (also lines containing 0x09)<br />********************************************************************************<br />BEGIN<br />:parseDate yyVar mmVar ddVar<br />::<br />:: Parses %DATE% into numeric year, month, and date components<br />::<br />::&nbsp; &nbsp;yyVar = name of variable to hold numeric year value<br />::&nbsp; &nbsp;mmVar = name ov variable to hold numeric month value<br />::&nbsp; &nbsp;ddVar = name of variable to hold numeric day value<br /><br />&nbsp; setlocal enableDelayedExpansion<br />&nbsp; for /f &quot;delims==&quot; %%v in ('2^&gt;nul set $') do set &quot;%%v=&quot;<br /><br />&nbsp; :: Parse the native date format tokens output by the DATE command<br />&nbsp; for /f &quot;skip=1 tokens=2-4 delims=(-)&quot; %%a in ('&quot;echo:|date&quot;') do (<br />&nbsp; &nbsp; rem Parse the numeric date components of %DATE%<br />&nbsp; &nbsp; for /f &quot;tokens=1-3 delims=/.- &quot; %%A in (&quot;%date:* =%&quot;) do (<br />&nbsp; &nbsp; &nbsp; rem Set variables named after native date tokens to appropriate numeric date component values<br />&nbsp; &nbsp; &nbsp; set $N_%%a=%%A<br />&nbsp; &nbsp; &nbsp; set $N_%%b=%%B<br />&nbsp; &nbsp; &nbsp; set $N_%%c=%%C<br />&nbsp; &nbsp; )<br />&nbsp; )<br />&nbsp;<br />&nbsp; :: Translate the native variables with unknown meaning into English variables<br />&nbsp; :: with known meaning.<br />&nbsp; ::<br />&nbsp; :: Each map in the for list should contain the space delimited native date<br />&nbsp; :: format tokens in Year Month Day order. Optional Documentation should<br />&nbsp; :: follow the map consisting of the hex dump of the native tokens, and the<br />&nbsp; :: language(s) the map supports.<br />&nbsp; ::<br />&nbsp; :: A map with codes greater than 0x7F may not appear correct unless viewed on<br />&nbsp; :: a machine that supports that language.<br />&nbsp; ::<br />&nbsp; for %%m in (<br />&nbsp; &nbsp; &quot;yy mm dd - 79 79 20 6D 6D 20 64 64 - English&quot;<br />&nbsp; &nbsp; &quot;JJ MM TT - 4A 4A 20 4D 4D 20 54 54 - German&quot;<br />HEX:&nbsp; &nbsp; &quot;\xA3\xA3 \xAC\xAC \xA4\xA4 - A3 A3 20 AC AC 20 A4 A4 - Russian&quot;<br />&nbsp; ) do (<br />&nbsp; &nbsp; for /f &quot;tokens=1-3 delims= &quot; %%a in (%%m) do (<br />&nbsp; &nbsp; &nbsp; rem Only the correct map will have all 3 variables defined<br />&nbsp; &nbsp; &nbsp; if defined $N_%%a if defined $N_%%b if defined $N_%%c (<br />&nbsp; &nbsp; &nbsp; &nbsp; set $E_yy=!$N_%%a!<br />&nbsp; &nbsp; &nbsp; &nbsp; set $E_mm=!$N_%%b!<br />&nbsp; &nbsp; &nbsp; &nbsp; set $E_dd=!$N_%%c!<br />&nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; )<br />&nbsp; )<br />&nbsp;<br />&nbsp; :: Eliminate leading zeros so that numbers aren't interpreted as octal<br />&nbsp; set /a &quot;$E_yy=10000%$E_yy% %%10000, $E_mm=100%$E_mm% %%100, $E_dd=100%$E_dd% %%100&quot;<br />&nbsp;<br />&nbsp; :: Return the date values in year, month, day order<br />&nbsp; (endlocal<br />&nbsp; &nbsp; set %~1=%$E_yy%<br />&nbsp; &nbsp; set %~2=%$E_mm%<br />&nbsp; &nbsp; set %~3=%$E_dd%<br />&nbsp; )<br />exit /b<br />END<br />&nbsp;<br />******* The remainder is the jscript used to insert the HEX ******/<br />inp=new ActiveXObject(&quot;ADODB.Stream&quot;);<br />inp.Type=2;<br />inp.Open();<br />inp.WriteText(eval(&quot;'&quot;+WScript.Arguments(1)+&quot;'&quot;));<br />out=new ActiveXObject(&quot;ADODB.Stream&quot;);<br />out.Type=2;<br />out.Charset='ISO-8859-1';<br />out.Open();<br />out.LoadFromFile(WScript.Arguments(0));<br />inp.Position=0;<br />out.Position=out.Size;<br />inp.CopyTo(out);<br />inp.Close();<br />out.SaveToFile(WScript.Arguments(0),2);<br />out.Close();<br /></code></pre></div><br /><br />Dave Benham</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7249" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile7249">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search661c.html?author_id=1265&amp;sr=posts">3386</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 22 Jan 2010 18:01</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Germany</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content7249">

						<h3 ><a href="#p7249">Re: &quot;universal&quot; %DATE% parser</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting9463.html?mode=quote&amp;f=3&amp;p=7249" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic97f9.html?p=7249#p7249" onclick="prompt('Message #14',this.href); return false;">#14</a></span> 
									<a class="unread" href="viewtopic97f9.html?p=7249#p7249" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistf667.html?mode=viewprofile&amp;u=1265" style="color: #00AA00;" class="username-coloured">aGerman</a></strong> &raquo; </span>16 May 2011 15:41
			</p>
			
			
			
			<div class="content">Sorry guys, but now I'm totally confused. On the right hand you use JScript-injection, on the left hand nobody has the idea to use it for getting the date directly <img class="smilies" src="images/smilies/icon_confused.gif" alt=":?" title="Confused" />  Why not <img class="smilies" src="images/smilies/icon_question.gif" alt=":?:" title="Question" /> <br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@set @junk=0 /* The 1st 3 lines should not be changed<br />@echo off &amp; set &quot;@junk=&quot;<br />setlocal<br /><br />for /f &quot;tokens=1-3&quot; %%a in ('cscript //nologo //e:jscript &quot;%~f0&quot;') do (<br />&nbsp; set /a yy=%%a, mm=%%b, dd=%%c<br />)<br />echo year&nbsp; %yy%<br />echo month %mm%<br />echo day&nbsp; &nbsp;%dd%<br />pause<br />goto :eof<br />*/<br /><br />var d = new Date();<br />WScript.Echo(d.getFullYear() + ' ' + (d.getMonth() + 1) + ' ' + d.getDate());<br /></code></pre></div><br /><br />Regards<br />aGerman</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p7250" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile7250">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searcha86d.html?author_id=2258&amp;sr=posts">2152</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 Feb 2011 21:02</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> United States (east coast)</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content7250">

						<h3 ><a href="#p7250">Re: &quot;universal&quot; %DATE% parser</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingf9b3.html?mode=quote&amp;f=3&amp;p=7250" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopica2a8.html?p=7250#p7250" onclick="prompt('Message #15',this.href); return false;">#15</a></span> 
									<a class="unread" href="viewtopica2a8.html?p=7250#p7250" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist3d77.html?mode=viewprofile&amp;u=2258" style="color: #00AA00;" class="username-coloured">dbenham</a></strong> &raquo; </span>16 May 2011 16:21
			</p>
			
			
			
			<div class="content"><blockquote><div><cite>aGerman wrote:</cite>Sorry guys, but now I'm totally confused. On the right hand you use JScript-injection, on the left hand nobody has the idea to use it for getting the date directly  Why not  <br /></div></blockquote><br />Orange_batch nearly got there - he suggested VBScript or WMI, which I imagine could work as well. <br /><br />But the intent was for a pure batch solution. Unfortunately the solution contains extended ASCII characters that can be problematic when posted on this forum, especially when the poster and the reader are using different character sets. The JScript-injected file is simply a method to transmit a binary image of the pure batch solution over this forum. If we could simply post binary attachments then it would be a non-issue.<br /><br />BTW - I like your JScript solution  <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /><br />But if one were to go the JScript route, what happens if there are multiple injections in the same file. Is there a way to direct a specific set of lines to cscript, without using a temporary or external file? <br /><br />Dave Benham</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
	

	<div class="action-bar bar-bottom">
	
			<a href="postingfa31.html?mode=reply&amp;f=3&amp;t=1808" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
		
		<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopic91e5.html?f=3&amp;t=1808&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>

			<form method="post" action="https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=1808">
		<div class="dropdown-container dropdown-container-left dropdown-button-control sort-tools">
	<span title="Display and sorting options" class="button button-secondary dropdown-trigger dropdown-select">
		<i class="icon fa-sort-amount-asc fa-fw" aria-hidden="true"></i>
		<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
	</span>
	<div class="dropdown hidden">
		<div class="pointer"><div class="pointer-inner"></div></div>
		<div class="dropdown-contents">
			<fieldset class="display-options">
							<label>Display: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
								<label>Sort by: <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label>
				<label>Direction: <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select></label>
								<hr class="dashed" />
				<input type="submit" class="button2" name="sort" value="Go" />
						</fieldset>
		</div>
	</div>
</div>
		</form>
	
	
	
			<div class="pagination">
			18 posts
							<ul>
		<li class="active"><span>1</span></li>
				<li><a class="button" href="viewtopic0cd9.html?f=3&amp;t=1808&amp;start=15" role="button">2</a></li>
				<li class="arrow next"><a class="button button-icon-only" href="viewtopic0cd9.html?f=3&amp;t=1808&amp;start=15" rel="next" role="button"><i class="icon fa-chevron-right fa-fw" aria-hidden="true"></i><span class="sr-only">Next</span></a></li>
	</ul>
					</div>
	</div>


<div class="action-bar actions-jump">
		<p class="jumpbox-return">
		<a href="viewforum4d6b.html?f=3" class="left-box arrow-left" accesskey="r">
			<i class="icon fa-angle-left fa-fw icon-black" aria-hidden="true"></i><span>Return to “DOS Batch Forum”</span>
		</a>
	</p>
	
		<div class="jumpbox dropdown-container dropdown-container-right dropdown-up dropdown-left dropdown-button-control" id="jumpbox">
			<span title="Jump to" class="button button-secondary dropdown-trigger dropdown-select">
				<span>Jump to</span>
				<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
			</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																				<li><a href="viewforum31e6.html?f=4" class="jumpbox-cat-link"> <span> DosTips - Dos Batch</span></a></li>
																<li><a href="viewforum4d6b.html?f=3" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; DOS Batch Forum</span></a></li>
											</ul>
		</div>
	</div>

	</div>


			</div>


<div id="page-footer" class="page-footer" role="contentinfo">
	<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-footer" class="nav-footer linklist" role="menubar">
		<li class="breadcrumbs">
							<span class="crumb"><a href="../index.html" data-navbar-reference="home"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span>DosTips.com</span></a></span>									<span class="crumb"><a href="index.html" data-navbar-reference="index"><span>Board index</span></a></span>					</li>
		
				<li class="rightside">All times are <span title="UTC-6">UTC-06:00</span></li>
							<li class="rightside">
				<a href="ucp033a.html?mode=delete_cookies" data-ajax="true" data-refresh="true" role="menuitem">
					<i class="icon fa-trash fa-fw" aria-hidden="true"></i><span>Delete all board cookies</span>
				</a>
			</li>
												<li class="rightside" data-last-responsive="true">
				<a href="memberlist4bfd.html?mode=team" role="menuitem">
					<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
				</a>
			</li>
									<li class="rightside" data-last-responsive="true">
				<a href="memberlist8733.html?mode=contactadmin" role="menuitem">
					<i class="icon fa-envelope fa-fw" aria-hidden="true"></i><span>Contact us</span>
				</a>
			</li>
			</ul>

	</div>
</div>

	<div class="copyright">
				<!-- WARNING NO DELETE -->Style developer by <a href="http://tricolor.x-tk.ru/">support forum tricolor</a>, <!-- END WARNING NO DELETE -->Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
									</div>

	<div id="darkenwrapper" class="darkenwrapper" data-ajax-error-title="AJAX error" data-ajax-error-text="Something went wrong when processing your request." data-ajax-error-text-abort="User aborted request." data-ajax-error-text-timeout="Your request timed out; please try again." data-ajax-error-text-parsererror="Something went wrong with the request and the server returned an invalid reply.">
		<div id="darken" class="darken">&nbsp;</div>
	</div>

	<div id="phpbb_alert" class="phpbb_alert" data-l-err="Error" data-l-timeout-processing-req="Request timed out.">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<h3 class="alert_title">&nbsp;</h3><p class="alert_text"></p>
	</div>
	<div id="phpbb_confirm" class="phpbb_alert">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<div class="alert_text"></div>
	</div>
</div>

</div>

<div>
	<a id="bottom" class="anchor" accesskey="z"></a>
	<img src="cron5495.gif?cron_type=cron.task.text_reparser.poll_title" width="1" height="1" alt="cron" /></div>

<script type="text/javascript" src="assets/javascript/jquery.mind772.js?assets_version=34"></script>
<script type="text/javascript" src="assets/javascript/cored772.js?assets_version=34"></script>



<script type="text/javascript" src="styles/prosilver/template/forum_fnd772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/prosilver/template/ajaxd772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/AllanStyle-SUBSILVER/template/jquery-uid772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/AllanStyle-SUBSILVER/template/collapsed772.js?assets_version=34"></script>



</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=1808 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:00:14 GMT -->
</html>
