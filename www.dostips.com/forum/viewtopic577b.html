<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=6044&start=210&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 08:00:41 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>DosTips.com &bull; JREPL.BAT v7.14 - regex text processor now with Unicode and XRegExp support - Page 15</title>

<link href="styles/AllanStyle-SUBSILVER/theme/print.css" rel="stylesheet">
</head>
<body id="phpbb">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>DosTips.com</h1>
		<p>A Forum all about DOS Batch<br /><a href="index-2.html">https://www.dostips.com/forum/</a></p>

		<h2>JREPL.BAT v7.14 - regex text processor now with Unicode and XRegExp support</h2>
		<p><a href="viewtopicb16d.html?f=3&amp;t=6044">https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=6044</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>15</strong> of <strong>27</strong></div>
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>23 Jul 2016 07:26</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">I see no reason to user JREPL (or any other regex tool) for this problem.<br /><br />Once you know the length of the folder path, then a simple substring is all you need - a standard feature of variable expansion.<br /><br />It is easy to avoid problems with exclamation points and delayed expansion within a FOR loop if you toggle the delayed expansion on and off.<br /><br />On my machine, the ICACLS command outputs a summation line at the end that must be ignored - Something like <strong class="text-strong"><em class="text-italics">&quot;Successfully processed 1 files; Failed processing 0 files&quot;</em></strong> I could use FINDSTR to filter out lines that begin with &quot;Successfully&quot;, but then I could not process a folder that begins with that value. So I use a trick to process the previous line within a loop, thus the last line is never processed.<br /><br />I also redirect stderr to stdout so that you get nice output if you pass in an invalid path.<br /><br />I avoid having to add one to the string length by appending an extra character to the variable definition.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal disableDelayedExpansion<br /><br />for %%F in (<br />&nbsp; &quot;c:\Program Files (x86)&quot;<br />&nbsp; &quot;c:\Program Files\Common Files&quot;<br />&nbsp; .<br />&nbsp; SomeInvalidPath<br />) do (<br />&nbsp; set &quot;folder=x%%~F&quot;<br />&nbsp; call :strLen len folder<br />&nbsp; echo CurrentFolder: __________ %%~F<br />&nbsp; set &quot;ln=&quot;<br />&nbsp; for /f &quot;eol=: delims=&quot; %%A in ('icacls &quot;%%~F&quot; 2^&gt;^&amp;1') do (<br />&nbsp; &nbsp; if defined ln (<br />&nbsp; &nbsp; &nbsp; setlocal enableDelayedExpansion<br />&nbsp; &nbsp; &nbsp; for %%N in (!len!) do echo !ln:~%%N!<br />&nbsp; &nbsp; &nbsp; endlocal<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;ln=%%A&quot;<br />&nbsp; )<br />&nbsp; echo(<br />)<br />exit /b<br /><br />:strlen &lt;resultVar&gt; &lt;stringVar&gt;<br />(<br />&nbsp; &nbsp; setlocal EnableDelayedExpansion<br />&nbsp; &nbsp; set &quot;s=!%~2!#&quot;<br />&nbsp; &nbsp; set &quot;len=0&quot;<br />&nbsp; &nbsp; for %%P in (4096 2048 1024 512 256 128 64 32 16 8 4 2 1) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; if &quot;!s:~%%P,1!&quot; NEQ &quot;&quot; (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;len+=%%P&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;s=!s:~%%P!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; )<br />)<br />(<br />&nbsp; &nbsp; endlocal<br />&nbsp; &nbsp; set &quot;%~1=%len%&quot;<br />&nbsp; &nbsp; exit /b<br />)<br /></code></pre></div><br /><br />It is easy to solve the problem with JREPL with a minimal amount of code, but it really is actually significantly slower due to start up times for each JREPL instantiation. And it feels like I am going out of my way to use JREPL when the actual problem does not really call for regular expressions.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal disableDelayedExpansion<br /><br />for %%F in (<br />&nbsp; &quot;c:\Program Files (x86)&quot;<br />&nbsp; &quot;c:\Program Files\Common Files&quot;<br />&nbsp; .<br />&nbsp; someInvalidPath<br />) do (<br />&nbsp; echo CurrentFolder: __________ %%~F<br />&nbsp; for /f %%N in ('echo %%~F^|jrepl &quot;^.*&quot; &quot;$0.length+1&quot; /j') do (<br />&nbsp; &nbsp; icacls &quot;%%~F&quot; 2&gt;&amp;1 | jrepl &quot;.{%%N}(.*)&quot; &quot;$1&quot; /jmatch /exc -1<br />&nbsp; )<br />&nbsp; echo(<br />)<br /></code></pre></div><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>23 Jul 2016 15:53</strong></div>
				<div class="author">by <strong>mirrormirror</strong></div>
				<div class="content">Thanks Dave, your solution works even with a crazy folder named &quot;1% . a! b! c! ^ 'name1 = name +2&quot;. <br /><br />I like the following and will remember it for next time:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>I avoid having to add one to the string length by appending an extra character to the variable definition.</code></pre></div><br />I do have a few questions:<br /><br /><strong class="text-strong"><span style="color: #00BF00">1:</span></strong> In jrepl, are there any rules for quoting the regex matched groups?  For example the <strong class="text-strong"><span style="color: #FF0000">$1</span></strong> is quoted on one example but not in the other:<br />jrepl &quot;.{%myLen%}(.*)$&quot; <strong class="text-strong"><span style="color: #FF0000">$1</span></strong> /jmatch<br />jrepl &quot;.{%%N}(.*)&quot; &quot;<strong class="text-strong"><span style="color: #FF0000">$1</span></strong>&quot; /jmatch<br /><br /><strong class="text-strong"><span style="color: #00BF00">2:</span></strong> I did not see the &quot;.length&quot; property documented in jrepl. Can you give a bit of info. on this and if there are any other properties like this that can be used?  From your example:<br />jrepl &quot;^.*&quot; &quot;$0.<strong class="text-strong"><span style="color: #FF0000">length</span></strong>+1&quot;<br /><br /><strong class="text-strong"><span style="color: #00BF00">3:</span></strong> The jrepl  solution fails to properly trim the output on the crazy folder name - you can below the sample script and output - I think the &lt;CARET&gt; causes the problem:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off &amp;setlocal disableDelayedExpansion<br />SET &quot;directory=1% . a! b! c! ^ 'name1 = name +2&quot;<br />IF NOT EXIST &quot;%directory%&quot; MD &quot;%directory%&quot;<br /><br />for %%F in (<br />&nbsp; &quot;c:\Program Files (x86)&quot;<br />&nbsp; &quot;c:\Program Files\Common Files&quot;<br />&nbsp; &quot;%directory%&quot;<br />&nbsp; .<br />&nbsp; someInvalidPath<br />) do (<br />&nbsp; echo CurrentFolder: __________ %%~F<br />&nbsp; for /f %%N in ('echo %%~F^|jrepl &quot;^.*&quot; &quot;$0.length+1&quot; /j') do (<br />&nbsp; &nbsp; icacls &quot;%%~F&quot; 2&gt;&amp;1 | jrepl &quot;.{%%N}(.*)&quot; &quot;$1&quot; /jmatch /exc -1<br />&nbsp; )<br />&nbsp; echo(<br />)</code></pre></div>Output:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>CurrentFolder: __________ c:\Program Files\Common Files<br />NT SERVICE\TrustedInstaller:(F)<br />NT SERVICE\TrustedInstaller:(CI)(IO)(F)<br />NT AUTHORITY\SYSTEM:(M)<br />NT AUTHORITY\SYSTEM:(OI)(CI)(IO)(F)<br />BUILTIN\Administrators:(M)<br />BUILTIN\Administrators:(OI)(CI)(IO)(F)<br />BUILTIN\Users:(RX)<br />BUILTIN\Users:(OI)(CI)(IO)(GR,GE)<br />CREATOR OWNER:(OI)(CI)(IO)(F)<br /><br />CurrentFolder: __________ 1 . a! b! c! ^ 'name1 = name +2<br />&nbsp;BUILTIN\Administrators:(I)(F)<br />&nbsp;BUILTIN\Administrators:(I)(OI)(CI)(IO)(F)<br />&nbsp;NT AUTHORITY\SYSTEM:(I)(F)<br />&nbsp;NT AUTHORITY\SYSTEM:(I)(OI)(CI)(IO)(F)<br />&nbsp;NT AUTHORITY\Authenticated Users:(I)(M)<br />&nbsp;NT AUTHORITY\Authenticated Users:(I)(OI)(CI)(IO)(M)<br />&nbsp;BUILTIN\Users:(I)(RX)<br />&nbsp;BUILTIN\Users:(I)(OI)(CI)(IO)(GR,GE)</code></pre></div><br /><br /><blockquote class="uncited"><div>It is easy to solve the problem with JREPL with a minimal amount of code, but it really is actually significantly slower due to start up times for each JREPL instantiation.</div></blockquote>I'm not super concerned with the added delay of using jrepl in this instance as is seems insignificant compared to the time it takes to run recursive &quot;icacls&quot; commands <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /> But I did wonder about the speed hit of jrepl compared to running :strlen+setlocal/endlocal+findstr but for this particular task any minor speed difference isn't worth the time to set up and run the tests.<br /><br />If the jrepl solution can be tweaked to reliably handle special characters I may prefer it simply due to it consisting of 3 lines of code compared to the length of the other solution.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>23 Jul 2016 16:30</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><blockquote><div><cite>mirrormirror wrote:</cite><strong class="text-strong"><span style="color: #00BF00">1:</span></strong> In jrepl, are there any rules for quoting the regex matched groups?  For example the <strong class="text-strong"><span style="color: #FF0000">$1</span></strong> is quoted on one example but not in the other:<br />jrepl &quot;.{%myLen%}(.*)$&quot; <strong class="text-strong"><span style="color: #FF0000">$1</span></strong> /jmatch<br />jrepl &quot;.{%%N}(.*)&quot; &quot;<strong class="text-strong"><span style="color: #FF0000">$1</span></strong>&quot; /jmatch<br /></div></blockquote>The quotes are not needed around $1, but I generally like to use them for consistency (but of course I'm not really consistent). The rules are the same as for with any batch argument. Any argument that contains any of the token delimiters &lt;space&gt;, &lt;comma&gt;, &lt;semicolon&gt;, &lt;equal&gt;, &lt;tab&gt;, or &lt;0xFF&gt; must be quoted. Arguments that contain poison characters like &amp; | &lt; &gt; should be quoted, unless you want to escape them.<br /><br /><blockquote><div><cite>mirrormirror wrote:</cite><strong class="text-strong"><span style="color: #00BF00">2:</span></strong> I did not see the &quot;.length&quot; property documented in jrepl. Can you give a bit of info. on this and if there are any other properties like this that can be used?  From your example:<br />jrepl &quot;^.*&quot; &quot;$0.<strong class="text-strong"><span style="color: #FF0000">length</span></strong>+1&quot;<br /></div></blockquote>That is a standard JScript string property. You have access to the entire JScript language when you use the /J or /JMATCH options. I only documented the global non-standard objects that I define within JREPL.<br /><br /><blockquote><div><cite>mirrormirror wrote:</cite><strong class="text-strong"><span style="color: #00BF00">3:</span></strong> The jrepl  solution fails to properly trim the output on the crazy folder name...<br /></div></blockquote>I don't see what you are driving at. I especially don't see a trim issue. I do see a percent in your definition of directory that gets stripped, but that has nothing to do with JREPL. If you want a percent in the value, then you have to double the percent in the line that defines the variable.<br /><br /><blockquote><div><cite>mirrormirror wrote:</cite><blockquote class="uncited"><div>It is easy to solve the problem with JREPL with a minimal amount of code, but it really is actually significantly slower due to start up times for each JREPL instantiation.</div></blockquote>I'm not super concerned with the added delay of using jrepl in this instance as is seems insignificant compared to the time it takes to run recursive &quot;icacls&quot; commands <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /> But I did wonder about the speed hit of jrepl compared to running :strlen+setlocal/endlocal+findstr but for this particular task any minor speed difference isn't worth the time to set up and run the tests.<br /><br />If the jrepl solution can be tweaked to reliably handle special characters I may prefer it simply due to it consisting of 3 lines of code compared to the length of the other solution.</div></blockquote>JREPL is designed to handle all possible characters, one way or another. But you would have to show me a specific problem that you are having. I am sure there is a simple solution.<br /><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>23 Jul 2016 16:39</strong></div>
				<div class="author">by <strong>mirrormirror</strong></div>
				<div class="content"><blockquote class="uncited"><div>But you would have to show me a specific problem that you are having. I am sure there is a simple solution.</div></blockquote><br />If you run this code you can see the issue:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off &amp;setlocal disableDelayedExpansion<br />SET &quot;directory=1% . a! b! c! ^ 'name1 = name +2&quot;<br />IF NOT EXIST &quot;%directory%&quot; MD &quot;%directory%&quot;<br /><br />for %%F in (<br />&nbsp; &quot;c:\Program Files (x86)&quot;<br />&nbsp; &quot;c:\Program Files\Common Files&quot;<br />&nbsp; &quot;%directory%&quot;<br />&nbsp; .<br />&nbsp; someInvalidPath<br />) do (<br />&nbsp; echo CurrentFolder: __________ %%~F<br />&nbsp; for /f %%N in ('echo %%~F^|jrepl &quot;^.*&quot; &quot;$0.length+1&quot; /j') do (<br />&nbsp; &nbsp; icacls &quot;%%~F&quot; 2&gt;&amp;1 | jrepl &quot;.{%%N}(.*)&quot; &quot;$1&quot; /jmatch /exc -1<br />&nbsp; )<br />&nbsp; echo(<br />)</code></pre></div><br />Notice the &lt;space&gt; preceedint the username in the 2nd example (output truncated for clarity) - right before <strong class="text-strong"><span style="color: #FF0000">BUILTIN\Administrators</span></strong>:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>CurrentFolder: __________ c:\Program Files\Common Files<br />NT SERVICE\TrustedInstaller:(F)<br />.....<br /><br />CurrentFolder: __________ 1 . a! b! c! ^ 'name1 = name +2<br />&nbsp;BUILTIN\Administrators:(I)(F)<br /></code></pre></div></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>23 Jul 2016 17:25</strong></div>
				<div class="author">by <strong>mirrormirror</strong></div>
				<div class="content">In addition to my response above I discovered another issue with the way the FOR loops strip out percents - it affects the test cases also - detailed more here:<br /><br /><strong class="text-strong">http://www.dostips.com/forum/viewtopic.php?f=3&amp;t=7305&amp;p=48003#p48003</strong></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>23 Jul 2016 17:52</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">I see the problem. Again, it has nothing to do with JREPL.<br /><br />The file name with the caret gets corrupted when I echo it unquoted through the pipe. The situation is even worse if the folder name contains &amp;.<br /><br />I see two possible solutions:<br /><br />1) Abandon the pipe and use the JREPL /S option to read the value from a variable<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal disableDelayedExpansion<br /><br />for %%F in (<br />&nbsp; &quot;c:\Program Files (x86)&quot;<br />&nbsp; &quot;c:\Program Files\Common Files&quot;<br />&nbsp; .<br />&nbsp; asdfasdf<br />&nbsp; &quot;1 . a! b! c! ^ 'name1 = name +2&quot;<br />&nbsp; &quot;A&amp;B&quot;<br />) do (<br />&nbsp; echo CurrentFolder: __________ &quot;%%~F&quot;<br />&nbsp; set &quot;folder=%%~F&quot;<br />&nbsp; for /f %%N in ('jrepl &quot;^.*&quot; &quot;$0.length+1&quot; /j /s folder') do (<br />&nbsp; &nbsp; icacls &quot;%%~F&quot; 2&gt;&amp;1 | jrepl &quot;.{%%N}(.*)&quot; &quot;$1&quot; /jmatch /exc -1<br />&nbsp; )<br />&nbsp; echo(<br />)<br /></code></pre></div>However, I think there may be an obscure issue with extended ASCII characters when JREPL reads from a variable.<br /><br />The other option is to use delayed expansion with the pipe:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal disableDelayedExpansion<br /><br />for %%F in (<br />&nbsp; &quot;c:\Program Files (x86)&quot;<br />&nbsp; &quot;c:\Program Files\Common Files&quot;<br />&nbsp; .<br />&nbsp; asdfasdf<br />&nbsp; &quot;1 . a! b! c! ^ 'name1 = name +2&quot;<br />&nbsp; &quot;A&amp;B&quot;<br />) do (<br />&nbsp; echo CurrentFolder: __________ &quot;%%~F&quot;<br />&nbsp; set &quot;folder=%%~F&quot;<br />&nbsp; for /f %%N in ('cmd /v:on /c echo !folder!^|jrepl &quot;^.*&quot; &quot;$0.length+1&quot; /j') do (<br />&nbsp; &nbsp; icacls &quot;%%~F&quot; 2&gt;&amp;1 | jrepl &quot;.{%%N}(.*)&quot; &quot;$1&quot; /jmatch /exc -1<br />&nbsp; )<br />&nbsp; echo(<br />)<br /></code></pre></div><br /><br />Or you could use the batch strlen function to get the length of the path, and only use JREPL to print out the results of ICALC <img class="smilies" src="images/smilies/icon_mrgreen.gif" alt=":mrgreen:" title="Mr. Green" /> <br /><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>23 Jul 2016 18:09</strong></div>
				<div class="author">by <strong>mirrormirror</strong></div>
				<div class="content">Ok, thanks again - I appreciate your attention to detail and in writing up nice code (i.e. adding extra error handling &amp; stripping out endlines, etc.). For me, these posts are not just about finding immediate solutions, but also learning.  I think I have my solution.<br /><br />One more question...<br /><br />Concerning the :strlen function.  The one I used (I think I got it from SO) is here:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:strlen &lt;resultVar&gt; &lt;stringVar&gt;<br />(&nbsp; &nbsp;<br />&nbsp; &nbsp; setlocal EnableDelayedExpansion<br />&nbsp; &nbsp; set &quot;s=!%~2!#&quot;<br />&nbsp; &nbsp; set &quot;len=0&quot;<br />&nbsp; &nbsp; for %%P in (4096 2048 1024 512 256 128 64 32 16 8 4 2 1) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; if &quot;!s:~%%P,1!&quot; NEQ &quot;&quot; ( <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;len+=%%P&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;s=!s:~%%P!&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; )<br />)<br />( <br />&nbsp; &nbsp; endlocal<br />&nbsp; &nbsp; set &quot;%~1=%len%&quot;<br />&nbsp; &nbsp; exit /b<br />)</code></pre></div><br />aGerman used the one from here:<br /><strong class="text-strong">http://www.dostips.com/DtTipsStringOperations.php#Function.strLen</strong><br /><br />Are there and advantages/reasons to use one of these solutions over the other?</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>23 Jul 2016 20:41</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">That is really off topic for this thread, but...<br /><br />I don't think there is much substantive difference. They both use the same algorithm.<br /><br />I think jeb's version is every so slightly more efficient (splitting hairs really). I prefer the calling sequence of the DOS Tips version, where the string is first, and the return variable is 2nd. But that is really cosmetic.<br /><br />I haven't had much need for strlen recenly, but when I do use it, I usually take jeb's SO version, but rework it to swap the arguments.<br /><br />The algorithm was developed (or adapted) for batch at <!-- l --><a class="postlink-local" href="viewtopic91ea.html?p=5385">viewtopic.php?p=5385</a><!-- l -->, and there is an explanation at <!-- l --><a class="postlink-local" href="viewtopicf118.html?p=5537#p5537">viewtopic.php?p=5537#p5537</a><!-- l --><br /><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>28 Jul 2016 16:26</strong></div>
				<div class="author">by <strong>mirrormirror</strong></div>
				<div class="content">Hello Dave, I have a feature request for your next release of jrepl <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />Based on my most recent help request in this forum here: <a href="viewtopic3e4c.html?f=3&amp;t=6044&amp;start=195#p47986" class="postlink">http://www.dostips.com/forum/viewtopic.php?f=3&amp;t=6044&amp;start=195#p47986</a><br /><br />Could you add a straight text SEARCH / REPLACE without using regex?  Based on my prior issue where regex can have difficulty finding literal strings containing backslashes &quot;\&quot;.  I often work with file paths (as I suppose many others here do) and backslashes are omnipresent <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />A complete wishlist would be:<br />- LITERAL text search<br />- Enable / Disable case sensitivity<br />- Option to output just the search matches (like /JMatch)<br />- REPLACE functionality<br />- Other standard jrepl features applied (read from stdin, variable file, etc.)<br /><br />This is just a wish list for the next time you decide to update the code.<br /><br />Changing topics slightly. You suggested:<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>1) Abandon the pipe and use the JREPL /S option to read the value from a variable</code></pre></div>So I've begun trying this and like it.  Is there an option put the OUTPUT into a variable? I've checked out the /V option but it looks like it is still related only to searching/replacing rather than OUTPUT.<br /><br />If there is no option to place the output into a variable - I'd like to add this feature to my &quot;wish list&quot;.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>However, I think there may be an obscure issue with extended ASCII characters when JREPL reads from a variable.</code></pre></div><br />I can't think of any cases where I am using extended ascii at the moment, but can you provide any details so I can avoid cases which may fail?<br /><br />Thank you...</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>28 Jul 2016 18:21</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><blockquote><div><cite>mirrormirror wrote:</cite>Could you add a straight text SEARCH / REPLACE without using regex?  Based on my prior issue where regex can have difficulty finding literal strings containing backslashes &quot;\&quot;.  I often work with file paths (as I suppose many others here do) and backslashes are omnipresent <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /><br /><br />A complete wishlist would be:<br />- LITERAL text search<br />- Enable / Disable case sensitivity<br />- Option to output just the search matches (like /JMatch)<br />- REPLACE functionality<br />- Other standard jrepl features applied (read from stdin, variable file, etc.)<br /><br />This is just a wish list for the next time you decide to update the code.<br /></div></blockquote> <img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" /> <br />Seriously <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" />  <img class="smilies" src="images/smilies/icon_question.gif" alt=":?:" title="Question" />  <img class="smilies" src="images/smilies/icon_rolleyes.gif" alt=":roll:" title="Rolling Eyes" /> <br /><br />You couldn't take the time to read the documentation <img class="smilies" src="images/smilies/icon_question.gif" alt=":?:" title="Question" />  or any of the countless examples within this thread <img class="smilies" src="images/smilies/icon_question.gif" alt=":?:" title="Question" /> <br /><br />Everything you requested is already handled.<br /><ul><li> /L option for literal search.</li><li> /I option to ignore case.</li><li> /JMATCH to output only matches. It might be nice to have a /MATCH option corollary to avoid user supplied JScript, but that would require significant additional parsing in my code. If all you want is to return matching strings without tranformation, then simply use /JMATCH with &quot;$0&quot; as the replace string.</li><li> <em class="text-italics">Replace functionality</em> - ummm that tells me nothing</li><li> It already reads stdin by default, with /F option to read from a file, and /S option to read from a variable</li></ul><br /><blockquote><div><cite>mirrormirror wrote:</cite>Changing topics slightly. You suggested:<blockquote><div><cite>dbenham wrote:</cite>1) Abandon the pipe and use the JREPL /S option to read the value from a variable</div></blockquote>So I've begun trying this and like it.  Is there an option put the OUTPUT into a variable? I've checked out the /V option but it looks like it is still related only to searching/replacing rather than OUTPUT.<br /><br />If there is no option to place the output into a variable - I'd like to add this feature to my &quot;wish list&quot;.<br /><br /><blockquote><div><cite>dbenham wrote:</cite>However, I think there may be an obscure issue with extended ASCII characters when JREPL reads from a variable.</div></blockquote><br />I can't think of any cases where I am using extended ascii at the moment, but can you provide any details so I can avoid cases which may fail?<br /></div></blockquote><br />The fundamental concept of JREPL is not conducive to writing the result to an environment variable. A variable can only receive one value, but JREPL can return many values. Even when the input is from a single variable using /S, there can be many outputs if /JMATCH is used.<br /><br />At one point I developed <a href="viewtopic74f7.html?f=3&amp;t=5492" class="postlink">REPLVAR.BAT</a> precisely to do what you ask. It was an offshoot of REPL.BAT (the precursor to JREPL.BAT). But I ran into problems regarding unicode vs extended ASCII, environment variable vs file, code page issues... <img class="smilies" src="images/smilies/icon_confused.gif" alt=":?" title="Confused" /> And so I abandoned the effort. I believe the REPLVAR.BAT issues may also impact JREPL.BAT when using /S.<br /><br />The information you need is embedded within that REPLVAR.BAT thread, but it quickly gets very confusing. I don't have any interest in climbing down that rabbit hole again to provide any better explanation.<br /><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>28 Jul 2016 18:40</strong></div>
				<div class="author">by <strong>mirrormirror</strong></div>
				<div class="content"><blockquote class="uncited"><div>You couldn't take the time to read the documentation <img class="smilies" src="images/smilies/icon_question.gif" alt=":?:" title="Question" /> or any of the countless examples within this thread </div></blockquote><br /> <img class="smilies" src="images/smilies/icon_redface.gif" alt=":oops:" title="Embarassed" /> sorry - I skimmed through the documentation, found the /V option and simply focused on that and stopped there.<br />I've been trying to understand macros in order to get a couple of them written before the weekend and have done a ton of reading the past couple of days in my spare time so - no excuse on my part though.<br /><br />No worries on the &quot;output to variable&quot; request - I thought about the variable length challenges, etc. and realized there would be challenges.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>30 Jul 2016 08:55</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">I've created version 4.3 by adding an rpad() function, and improving lpad(). Both functions are useful with the /J and /JMATCH options.<br /><br />Here is the relevant documentation, extracted from the JREPL /?JSCRIPT help:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; &nbsp; lpad( value, padString )<br />&nbsp; &nbsp; &nbsp; lpad( value, length &#91;,padString&#93; )<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Used to left pad a value to a minimum width string. If the<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;value already has string width &gt;= the desired length, then no<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;change is made. Otherwise it left pads the value with the<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;characters of the pad string to the desired length. If only<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padString is specified, then the value is padded to the length<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;of padString. If length is specified with a padString, then<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padString is replicated as needed to get the desired length.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;If length is specified without padString, then spaces are used<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for the padString.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Examples:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lpad(15,'&nbsp; &nbsp; ')&nbsp; &nbsp; &nbsp; &nbsp; returns '&nbsp; 15'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lpad(15,4)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;returns '&nbsp; 15'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lpad(15,'0000')&nbsp; &nbsp; &nbsp; &nbsp; returns '0015'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lpad(15,4,'0')&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;returns '0015'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lpad(19011,4,'0')&nbsp; &nbsp; &nbsp; returns '19011'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lpad('A','. . . . .')&nbsp; returns '. . . . .A'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lpad('A',9,'. ')&nbsp; &nbsp; &nbsp; &nbsp;returns '. . . . .A'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lpad('AB','. . . . .') returns '. . . . AB'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lpad('AB',9,'. ')&nbsp; &nbsp; &nbsp; returns '. . . . AB'<br /><br />&nbsp; &nbsp; &nbsp; rpad( value, padString )<br />&nbsp; &nbsp; &nbsp; rpad( value, length &#91;,padString&#93; )<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Used to right pad a value to a minimum width string. If the<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;value already has string width &gt;= the desired length, then no<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;change is made. Otherwise it right pads the value with the<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;characters of the pad string to the desired length. If only<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padString is specified, then the value is padded to the length<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;of padString. If length is specified with a padString, then<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;padString is replicated as needed to get the desired length.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;If length is specified without padString, then spaces are used<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for the padString.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Examples:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rpad('hello','&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ')&nbsp; returns 'hello&nbsp; &nbsp; &nbsp;'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rpad('hello',10)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; returns 'hello&nbsp; &nbsp; &nbsp;'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rpad('hello',' . . . . .')&nbsp; returns 'hello. . .'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rpad('hello',,10,' .')&nbsp; &nbsp; &nbsp; returns 'hello. . .'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rpad('hell',' . . . . .')&nbsp; &nbsp;returns 'hell . . .'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rpad('hell',10,' .')&nbsp; &nbsp; &nbsp; &nbsp; returns 'hell . . .'<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; rpad('hello',2)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;returns 'hello'<br />&nbsp;</code></pre></div><br /><br />And here is <strong class="text-strong">JREPL.BAT version 4.3</strong><br /><div class="inline-attachment">
			
		
		
				<dl class="file">
			<dt><span class="imageset icon_topic_attach"></span> <a class="postlink" href="download/filee371.php?id=18">JREPL4.3.zip</a></dt>
						<dd>(12.14 KiB) Downloaded 88 times</dd>
		</dl>
		
		
			</div><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>02 Aug 2016 18:10</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">Version 4.4 fixes a bug with the /C option - the line count was off by 1 when the last line did not end with line feed.<br /><div class="inline-attachment">
			
		
		
				<dl class="file">
			<dt><span class="imageset icon_topic_attach"></span> <a class="postlink" href="download/filea9bc.php?id=19">JREPL4.4.zip</a></dt>
						<dd>(12.2 KiB) Downloaded 92 times</dd>
		</dl>
		
		
			</div><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>03 Aug 2016 17:20</strong></div>
				<div class="author">by <strong>foxidrive</strong></div>
				<div class="content">Love your work, Dave.<br /><br />I checked out EXC and INC in the docs - neat stuff!<br />/N minwidth is very useful too.  <br /><br />These are all too good to hide in the documentation. <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /><br /><br /><span style="color: green">EXC</span> excludes lines from the source file by line number or by negative number from the bottom of the file.  Lots of numbers can be excluded.<br /><span style="color: green">INC</span> includes lines in the same way.<br /><span style="color: green">/N minwidth</span>  numbers each line and can pad the number to a certain number of places.<br /><br />Dave, can I suggest that /N use a pipe instead of a colon after the number, or better still have an option for that character?<br /><br />EG: <span style="color: green">/N 3 &quot;|&quot; </span><br /><br />That would allow extra parsing of the numbered lines in a for-in-do loop and be able to control which character at the start of the line are filtered out with the &quot;DELIMS=|&quot; option.<br /><br />I was also looking for the switch to write the output to an environment variable but I couldn't see one in searching the docs.<br /><br />The <span style="color: green">/V</span> documentation seems unclear and I wondered if that was it.<br />I tried using /v name just in case but got this:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>c:\Files\aaa\bat&gt;jrepl &quot;^(.*)&quot; &quot;$1&quot; /v variable&nbsp; /f file.bat<br />ERROR: Too many arguments.</code></pre></div><br /><br /><br /><br />In my view Jrepl is better than sliced bread!<br /><br /><span style="color: #bfbfbf">(For those who haven't heard the expression it's used as in 'Some useful item is better than sliced bread!')</span></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>03 Aug 2016 20:43</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><blockquote><div><cite>foxidrive wrote:</cite>Love your work, Dave...<br />...In my view Jrepl is better than sliced bread!<br /></div></blockquote> <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> Thanks, I do feel that JREPL is a bit of a Swiss Army Knife.<br /><br /><blockquote><div><cite>foxidrive wrote:</cite>Dave, can I suggest that /N use a pipe instead of a colon after the number, or better still have an option for that character?<br /><br />EG: <span style="color: green">/N 3 &quot;|&quot; </span><br /><br />That would allow extra parsing of the numbered lines in a for-in-do loop and be able to control which character at the start of the line are filtered out with the &quot;DELIMS=|&quot; option.<br /></div></blockquote> <img class="smilies" src="images/smilies/icon_idea.gif" alt=":idea:" title="Idea" />  <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /> Good idea, except I cannot add the delimiter as a second argument to the /N switch because it would break existing scripts. But I can (and did  <img class="smilies" src="images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /> ) add a /D delimiter option to specify the delmiter. The new option is in version 4.5 at the end of this post.<br /><br /><blockquote><div><cite>foxidrive wrote:</cite>I was also looking for the switch to write the output to an environment variable but I couldn't see one in searching the docs.<br /><br />The <span style="color: green">/V</span> documentation seems unclear and I wondered if that was it.<br />I tried using /v name just in case but got this:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>c:\Files\aaa\bat&gt;jrepl &quot;^(.*)&quot; &quot;$1&quot; /v variable&nbsp; /f file.bat<br />ERROR: Too many arguments.<br /></code></pre></div><br /></div></blockquote>I just responded to mirrormirror about that very subject in the 2nd half of <a href="viewtopic57db-2.html?f=3&amp;t=6044&amp;start=210#p48170" class="postlink">this post</a>. At one point I wanted to have that feature, but I have abandoned that idea. <strong class="text-strong"><em class="text-italics"><span style="color: #BF0000">Update - I ended up implementing this after all in version 6.5 <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> </span></em></strong> There are too many issues that make it extremely difficult, (actually impossible I think) to provide a robust solution for that feature. Many of those issues are the same as what you face when trying to do text modification with pure batch, which is what drove me to develop JREPL in the first place.<br /><br />The /V option is actually quite simple. It is a switch - it does not take an argument. Without /V, the search and replace strings are the actual strings, and /JBEG etc strings are the actual code. But with the /V switch, they are interpreted as variable names instead, and the needed values are read from the environment variable.<br /><br />For example, this silly example<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>call jrepl &quot;Y&quot; &quot;N&quot; /jbegln &quot;skip=(ln==5)&quot; /f test.txt<br /></code></pre></div>Becomes this if the /V option is used.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set &quot;find=Y&quot;<br />set &quot;repl=N&quot;<br />set &quot;begLn=skip=(ln==5)&quot;<br />call jrepl find repl /v /jbegln begLn /f test.txt<br /></code></pre></div><br /><br /><strong class="text-strong">Here is version 4.5 with the new /D option:</strong><br /><div class="inline-attachment">
			
		
		
				<dl class="file">
			<dt><span class="imageset icon_topic_attach"></span> <a class="postlink" href="download/filee5cc.php?id=20">JREPL4.5.zip</a></dt>
						<dd>(12.34 KiB) Downloaded 93 times</dd>
		</dl>
		
		
			</div><br /><br />Dave Benham</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="UTC-6">UTC-06:00</span><br />Page <strong>15</strong> of <strong>27</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Limited<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=6044&start=210&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 08:00:41 GMT -->
</html>
