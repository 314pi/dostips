<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=3803&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 09:21:39 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>DosTips.com &bull; Rules for label names vs GOTO and CALL</title>

<link href="styles/AllanStyle-SUBSILVER/theme/print.css" rel="stylesheet">
</head>
<body id="phpbb">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>DosTips.com</h1>
		<p>A Forum all about DOS Batch<br /><a href="index-2.html">https://www.dostips.com/forum/</a></p>

		<h2>Rules for label names vs GOTO and CALL</h2>
		<p><a href="viewtopic494f.html?f=3&amp;t=3803">https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=3803</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>4</strong></div>
					<div class="post">
				<h3>Rules for label names vs GOTO and CALL</h3>
				<div class="date">Posted: <strong>25 Sep 2012 06:02</strong></div>
				<div class="author">by <strong>jeb</strong></div>
				<div class="content">Hi,<br /><br />I will try to discover a bit the rules for legal label names and how they work.<br /><br />Normally you choose a name containing numbers and characters.<br />But you could also use any character with different effects.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set &quot;amp=^&amp;&quot;<br />set &quot;pipe=^|&quot;<br />set &quot;lt=^&lt;&quot;<br />set &quot;gt=^&gt;&quot;<br />call :%%%%this%%%%&quot;label&quot;^looks:%%lt%%a%%pipe%%bit%%gt%%^^odd<br />exit /b<br /><br />:%this%&quot;label&quot;^looks&lt;quite|a&gt; ^^:+bit&amp;normally<br />echo The function is called via &quot;%0&quot;<br />exit /b<br /></code></pre></div><br /><blockquote><div><cite>Output wrote:</cite>The function is called via &quot;:%this%&quot;label&quot;looks:&lt;a|bit&gt;^odd&quot;<br /></div></blockquote><br />It seems that the label does not fit to the calling name, but both labels and call-names have different rules.<br /><br />A call-name (the destination label behind a CALL) is parsed normally and stored in %0 by the normal argument rules.<br />But the destination label can be shorter than %0, as there exists some STOP characters.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>+:,;=&nbsp; &lt;space&gt;,&lt;TAB&gt; and &lt;LF&gt;</code></pre></div><br />These characters stop the call-name, independent if they are escaped or quoted.<br /><br />There exists some more characters which can be used, but they are a bit more tricky to handle, like<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>|&amp;&lt;&gt;(</code></pre></div><br />They can be used but only with <em class="text-italics">late expansion </em>in the call.<br />Like<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set &quot;amp=^&amp;&quot;<br />call :Test%%amp%%yes<br />exit /b<br /><br />:test^&amp;yes<br />echo Called by &quot;%0&quot;<br />exit /b<br /></code></pre></div><br /><br />At this point it's necessary to understand, how the CALL build the name. As each CALL parses a line two times, you need to escape each special character two times.<br />And as you can't escape it directly two times with carets, I used here <em class="text-italics">late percent expansion</em>. <br />You could also use the late expansion only for the caret, like<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set &quot;caret=^&quot;<br />call :test%%caret%%^&amp;yes<br />exit /b<br /><br />:test^&amp;yes<br />echo Called by &quot;%0&quot;<br />exit /b<br /></code></pre></div><br /><br />GOTO is similar to CALL, but as it uses only one parse phase, it's easier to create the GOTO-names.<br /><br />Now the label names.<br />They also use STOP characters, but not the same, I only know two  <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:+</code></pre></div><br />So these labels are equivalent<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:one<br />:one:two<br />:one+two<br />:one^<br /><br /></code></pre></div><br />Btw. label names have completly different parser phases, only a bit escaping is done, <br />but the percent expansion nor the remove phase for CR's are executed.<br />A caret escape the next character, even in quotes, but it can't be used as multiline character (for the label name).<br /><br />And a label can be found even if it does not begin with a colon <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br />These labels are all equivalent<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:label<br />=,,;;&nbsp; ,;= :label<br />X =,,;;&nbsp; ,;= :label<br />&lt; :label</code></pre></div><br />The rule is here:<br />&lt;Anyone character or none&gt; followed by any ,;=&lt;space&gt; then the colon and the name.<br /><br />This can sometimes be handy.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />cls<br />call :#;#<br />%:#+~%,=*<br />&gt;=,;=;,,=,;:%%+,=;echo\=%01&gt;&amp;2&amp;call=;:%%%%%%%%;%*<br />echo *%*</code></pre></div><br /><br />hope it helps<br />jeb</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Rules for label names vs GOTO and CALL</h3>
				<div class="date">Posted: <strong>25 Sep 2012 08:47</strong></div>
				<div class="author">by <strong>Ed Dyreen</strong></div>
				<div class="content">'<br />Cats n keyboards <img class="smilies" src="images/smilies/icon_rolleyes.gif" alt=":roll:" title="Rolling Eyes" /> <br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />cls<br />call :#;#<br /><br />:#<br />echo.label=%0_<br />echo. args=%*_<br /><br />&gt; :%% echo. &amp;call ;:%%%%%%%%;%*<br />echo.label=%0_<br />echo. args=%*_<br /><br />pause<br />exit<br /></code></pre></div>Nice one, it occupied me 30mins <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> LOL</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Rules for label names vs GOTO and CALL</h3>
				<div class="date">Posted: <strong>25 Sep 2012 14:51</strong></div>
				<div class="author">by <strong>Liviu</strong></div>
				<div class="content">Holy smoke <img class="smilies" src="images/smilies/icon_wink.gif" alt=";-)" title="Wink" /> ...err, I mean, really neat find!<br /><br />Following tried on XP sp3.<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br /><br />call :tee 1 2 3<br />call ::tee 1 2 3<br />call :::tee 1 2 3<br />call :tee:::::::::::::: 1 2 3<br /><br />if exist &quot;%~dp0logfile.txt&quot; del &quot;%~dp0logfile.txt&quot;<br />call :tee+&quot;%~dp0logfile.txt&quot; 1 2 3<br />call :tee+&quot;%~dp0logfile.txt&quot; 1 2 3 4 5 6 7 8 9 10 11 12 13<br />goto :eof<br /><br />:tee<br />echo %0 ^( %* ^)<br />setlocal &amp; set tee=%0<br />if not %tee::=%==tee (<br />&nbsp; &gt;&gt;%tee:*+=% echo %0 ^( %* ^)<br />)<br />endlocal</code></pre></div>Output.<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\tmp&gt;calltest<br />:tee ( 1 2 3 )<br />::tee ( 1 2 3 )<br />The system cannot find the batch label specified -<br />:tee:::::::::::::: ( 1 2 3 )<br />:tee+&quot;C:\tmp\logfile.txt&quot; ( 1 2 3 )<br />:tee+&quot;C:\tmp\logfile.txt&quot; ( 1 2 3 4 5 6 7 8 9 10 11 12 13 )<br /><br />C:\tmp&gt;type logfile.txt<br />:tee+&quot;C:\tmp\logfile.txt&quot; ( 1 2 3 )<br />:tee+&quot;C:\tmp\logfile.txt&quot; ( 1 2 3 4 5 6 7 8 9 10 11 12 13 )</code></pre></div><br />One point is that parsing is indeed strange - &quot;call :tee&quot; and &quot;call ::tee&quot; work, but &quot;call :::tee&quot; appears to resolve to an empty label and fails. Trailing : colons don't seem to have any limit.<br /><br />The other point is that it gives a way to pass additional arguments to a call'd label, outside the regular %1, %2 etc list. This might be useful in cases where the called subroutine needs to work on the entire %* line, as opposed to individual arguments. For a quick-and-dirty example, the :tee above takes an optional filename appended to its %0 label, and appends a copy of the standard output to that file. The classical way, this would require significantly more complicated code to (a) identify the filename among other parameters, and (b) shift the rest of the parameters and manually rebuild a &quot;shifted&quot; %*.<br /><br />Liviu</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Rules for label names vs GOTO and CALL</h3>
				<div class="date">Posted: <strong>25 Sep 2012 15:50</strong></div>
				<div class="author">by <strong>jeb</strong></div>
				<div class="content"><blockquote><div><cite>Liviu wrote:</cite>One point is that parsing is indeed strange - &quot;call :tee&quot; and &quot;call ::tee&quot; work, but &quot;call :::tee&quot; appears to resolve to an empty label and fails. </div></blockquote>Interessting, I never thought about to test it  <img class="smilies" src="images/smilies/icon_surprised.gif" alt=":o" title="Surprised" /> <br />But GOTO does only accept one or zero colons in front <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br /><br />And another differenece between CALL and GOTO, a CALL to an undefined label prints an error message and continues.<br />A GOTO prints the same error message, but then it works like a GOTO :EOF, it works like an RETURN.<br /><br /><blockquote><div><cite>Liviu wrote:</cite>Trailing : colons don't seem to have any limit.<br /></div></blockquote>No, as the first colon stops the called label name.<br /><br />I played a bit with some extreme called label names, like embedding a linefeed or carriage return.<br />A carriage return can be a valid label name, but I can only access it via a GOTO, as I'm not able to create a CALL without removing my CR.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion <br />for /f %%a in ('copy /Z &quot;%~dpf0&quot; nul') do set &quot;CR=%%a&quot;<br />goto :1!CR!x<br />echo Never reached<br />:1&lt;CR&gt;x<br />echo It works<br /></code></pre></div><br />I replaced the text &lt;CR&gt; in : 1&lt;CR&gt;x with a good editor to a single CR-character!<br /><br />Or a line feed<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal EnableDelayedExpansion <br />set lf=^<br /><br /><br />set &quot;xlf=^^!lf!!lf!&quot;<br />call :AAA:^^%%XLF%%%%XLF%%BBB<br />exit /b<br /><br />:AAA<br />echo CALLED by #%0#<br />exit /b<br /></code></pre></div><br /><br /><blockquote><div><cite>Output wrote:</cite>CALLED by #:AAA:<br />BBB#</div></blockquote><br /><br />jeb</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Rules for label names vs GOTO and CALL</h3>
				<div class="date">Posted: <strong>25 Sep 2012 19:41</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" /> Curioser and curioser. Well done jeb (and Liviu)<br /><br />So a line consisting of a path (including drive letter) to a batch (or other executable) can function as both a label and an instantiation of the batch.<br /><br />Assuming my batch script is TEST.BAT residing somewhere on the C: drive<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal<br />pushd &quot;%~dp0&quot;<br /><br />if &quot;%~1&quot;==&quot;stop&quot; (<br />&nbsp; echo stopping<br />&nbsp; exit /b<br />)<br /><br />call :test<br />echo before label<br />C:test stop<br />echo after label<br /></code></pre></div><br />results<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>after label<br />before label<br />stopping<br /></code></pre></div><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Rules for label names vs GOTO and CALL</h3>
				<div class="date">Posted: <strong>25 Sep 2012 21:47</strong></div>
				<div class="author">by <strong>Liviu</strong></div>
				<div class="content"><blockquote><div><cite>dbenham wrote:</cite>So a line consisting of a path (including drive letter) to a batch (or other executable) can function as both a label and an instantiation of the batch.</div></blockquote><br />Nice!  FWIW the same happens with partially quoted names even when continuations past the closing quote don't match. For example, saving the following as &quot;t e s t.cmd&quot;<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal<br />pushd &quot;%~dp0&quot;<br /><br />if &quot;%~1&quot;==&quot;stop&quot; (<br />&nbsp; echo stopping = %0 ^( %* ^)<br />&nbsp; exit /b<br />)<br /><br />call :&quot;t e s t&quot; 123<br />echo before label = %0 ^( %* ^)<br />C:&quot;t e s t&quot; stop<br />echo after label = %0 ^( %* ^)<br /></code></pre></div>gives<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\tmp&gt;&quot;t e s t&quot; 987<br />after label = :&quot;t e s t&quot; ( 123 )<br />before label = &quot;t e s t&quot; ( 987 )<br />stopping = C:&quot;t e s t&quot; ( stop )</code></pre></div><br />Liviu<br /><br />P.S. This is all jeb's doing, none of my fault <img class="smilies" src="images/smilies/icon_wink.gif" alt=";-)" title="Wink" /></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Rules for label names vs GOTO and CALL</h3>
				<div class="date">Posted: <strong>25 Sep 2012 22:20</strong></div>
				<div class="author">by <strong>foxidrive</strong></div>
				<div class="content">If anyone actually uses that in a batch file to help someone, I will have to take drastic action.  *polishes Uzi*<br /><br /><br />Bloody crackpot batch users. <img class="smilies" src="images/smilies/icon_wink.gif" alt=";)" title="Wink" /></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Rules for label names vs GOTO and CALL</h3>
				<div class="date">Posted: <strong>26 Sep 2012 02:57</strong></div>
				<div class="author">by <strong>jeb</strong></div>
				<div class="content"><blockquote><div><cite>foxidrive wrote:</cite>If anyone actually uses that in a batch file to help someone, I will have to take drastic action. *polishes Uzi*<br /></div></blockquote><br />I use it  <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /> <br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>call :myFunc<br />echo back again<br /><br />:myFunc ^<br />echo This is function %0 &amp; exit /b<br />echo ERROR: You don't call the function <br />exit /b<br /></code></pre></div><br /><br />Also my batch library uses a simple trick<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>REM 1. Prepare the BatchLibrary for the start command<br />call BatchLib.bat<br /><br />REM 2. Start of the Batchlib, acquisition of the command line parameters, swtich to the temporary LibTest1.BLibTmp.bat<br />&lt;:%BL.Start%<br /></code></pre></div><br /><br /><blockquote><div><cite>BL.Start contains wrote:</cite>BL.Start=:&lt; nul ( setlocal EnableDelayedExpansion &amp; set &quot;bl.cmdcmdline=!cmdcmdline!&quot; &amp; call set &quot;bl.param[0]=%~f0&quot; &amp; FOR /L %n IN (1,1,9) DO ( call set &quot;bl.para<br />m[%n]=%~1&quot; &amp; shift /1 ) )       &amp; &quot;D:\Projekte\EHS\Batch\BatchLib\BatchLib.bat&quot; /INTERN_START &quot;!bl.param[0]!&quot;</div></blockquote><br />Or formatted<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>BL.Start=:&lt; nul ( <br />&nbsp; setlocal EnableDelayedExpansion<br />&nbsp; set &quot;bl.cmdcmdline=!cmdcmdline!&quot; <br />&nbsp; call set &quot;bl.param&#91;0&#93;=%~f0&quot;<br />&nbsp; FOR /L %n IN (1,1,9) DO ( <br />&nbsp; &nbsp; call set &quot;bl.param&#91;%n&#93;=%~1&quot;<br />&nbsp; &nbsp; shift /1 <br />&nbsp; ) <br />)&nbsp; &nbsp; &nbsp;<br />&quot;D:\Projekte\EHS\Batch\BatchLib\BatchLib.bat&quot; /INTERN_START &quot;!bl.param&#91;0&#93;!&quot;</code></pre></div><br /><br />The trick is here that the first time <br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&lt;:%BL.Start%</code></pre></div><br />is expanded to an executable statement.<br />And later it can be used as a label  <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /> <br /><br />jeb</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Rules for label names vs GOTO and CALL</h3>
				<div class="date">Posted: <strong>26 Sep 2012 05:03</strong></div>
				<div class="author">by <strong>Ed Dyreen</strong></div>
				<div class="content">'<br />defrag.EXE Jeb: /f /v <img class="smilies" src="images/smilies/icon_mrgreen.gif" alt=":mrgreen:" title="Mr. Green" /> <br /><a href="viewtopicb9e3.html?f=3&amp;t=1011&amp;hilit=cat" class="postlink">Experiment with call and label</a><br /><a href="viewtopic2d26.html?f=3&amp;t=1626&amp;hilit=batchlib" class="postlink">BatchLibrary or how to include batch files</a></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Rules for label names vs GOTO and CALL</h3>
				<div class="date">Posted: <strong>26 Sep 2012 11:39</strong></div>
				<div class="author">by <strong>Liviu</strong></div>
				<div class="content"><blockquote><div><cite>jeb wrote:</cite>The rule is here:<br />&lt;Anyone character or none&gt; followed by any ,;=&lt;space&gt; then the colon and the name.</div></blockquote><br />Another oddity is that parsing appears to be based on the &quot;physical&quot; text lines in the source file, and recognizes a label even on a line which is in fact a continuation of the previous one i.e. when the line above it ends with a ^ caret.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal<br />pushd &quot;%~dp0&quot;<br />echo wscript.echo &quot;***&nbsp; :ads.vbs ( &quot; ^&amp; wscript.arguments(0) ^&amp; &quot; ) ***&quot; &gt;test2.cmd:ads.vbs<br />call :ads.vbs 123<br />echo before label = %0 ^( %* ^)<br />cscript //nologo test2.cmd^<br />:ads.vbs 456<br />echo after label = %0 ^( %* ^)</code></pre></div>This code saved as test2.cmd on an NTFS drive and run on XP sp3 outputs...<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\tmp&gt;test2 987<br />after label = :ads.vbs ( 123 )<br />before label = test2 ( 987 )<br />***&nbsp; :ads.vbs ( 456 ) ***<br />after label = test2 ( 987 )</code></pre></div><br />Note that using the vbscript code embedded as an NTFS ADS (alternate data stream) is just for fun, and to give foxidrive more ammunition of course <img class="smilies" src="images/smilies/icon_wink.gif" alt=";-)" title="Wink" />  but is not essential to the main point, which is that the :ads.vbs label is recognized in the middle of a split line.<br /><br />Liviu</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Rules for label names vs GOTO and CALL</h3>
				<div class="date">Posted: <strong>26 Sep 2012 11:49</strong></div>
				<div class="author">by <strong>Squashman</strong></div>
				<div class="content"><blockquote><div><cite>foxidrive wrote:</cite>If anyone actually uses that in a batch file to help someone, I will have to take drastic action.  *polishes Uzi*<br /><br /><br />Bloody crackpot batch users. <img class="smilies" src="images/smilies/icon_wink.gif" alt=";)" title="Wink" /></div></blockquote><br />I agree and for our U.S. users I have been polishing mine in case I meet Roger Goodell in a dark alley!!!!!   <img class="smilies" src="images/smilies/icon_evil.gif" alt=":evil:" title="Evil or Very Mad" /></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Rules for label names vs GOTO and CALL</h3>
				<div class="date">Posted: <strong>16 Nov 2012 02:44</strong></div>
				<div class="author">by <strong>jeb</strong></div>
				<div class="content">There exists an interesting additional parser phase.<br /><br />Normally delayed expansion is evaluated only once, even in a call or call call statement.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />set &quot;perVar=%%perVar%% percent-expansion,&quot;<br />set &quot;delVar=!delVar! delayed-expansion,&quot;<br />echo %perVar%<br />call echo %perVar%<br />call call echo %perVar%<br />setlocal EnableDelayedExpansion<br />echo !delVar!<br />call echo !delVar!<br />call call echo !delVar!</code></pre></div><br /><blockquote><div><cite>output wrote:</cite>%perVar% percent-expansion,<br />%perVar% percent-expansion, percent-expansion,<br />%perVar% percent-expansion, percent-expansion, percent-expansion,<br />!delVar! delayed-expansion,<br />!delVar! delayed-expansion,<br />!delVar! delayed-expansion,</div></blockquote><br /><br />That's not new and the standard behaviour of the parser, but now ... <img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" /> <br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>setlocal EnableDelayedExpansion<br />set &quot;var=myLabel&quot;<br />set &quot;pVar=^!var^!&quot;<br />echo !pVar!<br />call echo !pVar!<br />call :!pVar!<br />exit /b<br /><br />:myLabel<br />setlocal DisableDelayedExpansion<br />echo myLabel is called, the func name is %0<br />exit /b</code></pre></div><br /><blockquote><div><cite>Output wrote:</cite>!var!<br />!var!<br />myLabel is called, the func name is :!var!</div></blockquote><br /><br />Obviously !var! is also expanded, but only when call to find a label, not if it only echo something.<br />And %0 doesn't contain the correct label name then.<br /><br />jeb</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Rules for label names vs GOTO and CALL</h3>
				<div class="date">Posted: <strong>16 Nov 2012 07:27</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" /> Wow jeb, that is amazing. <br /><br />The extra round of delayed expansion only works with CALL, it does not work with GOTO. I guess that is &quot;expected&quot;.<br /><br />Liviu's discovery about physical parsing of lines is also very interesting. Label lines support line continuation during normal parsing, but do not continue if discovered by CALL or GOTO.<br /><br />This example is fun to trace  <img class="smilies" src="images/smilies/icon_wink.gif" alt=":wink:" title="Wink" /> <br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal enableDelayedExpansion<br /><br />set &quot;var=myLabel&quot;<br />set &quot;dvar=^!var^!&quot;<br />echo before CALL<br />call :!dvar!<br />echo after CALL<br /><br />:ContinuedLabel with embedded commands that only execute if this label is called ^<br />echo After ContinuedLabel &amp; exit /b<br /><br />echo This continued line has an embedded label { ^<br />:myLabel } followed by an embedded ^<br />goto continue that only works if :myLabel is called &amp; exit /b<br />goto !dvar!<br /><br />:continue<br />setlocal disableDelayedExpansion<br />echo Inside call to %0<br />endlocal<br />goto :ContinuedLabel<br /></code></pre></div><br />output<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>before CALL<br />Inside call to :!var!<br />After ContinuedLabel<br />after CALL<br />This continued line has an embedded label { :myLabel } followed by an embedded goto continue that only works if :myLabel is called<br /></code></pre></div><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Rules for label names vs GOTO and CALL</h3>
				<div class="date">Posted: <strong>19 Nov 2012 03:20</strong></div>
				<div class="author">by <strong>jeb</strong></div>
				<div class="content">I retested a bit and have to correct myself.<br /><br />CR and LF seems to be always stop characters, (my samples were to simple).<br /><br /><blockquote><div><cite>jeb wrote:</cite>Btw. label names have completly different parser phases, only a bit escaping is done,<br />but the percent expansion nor the remove phase for CR's are executed.<br />A caret escape the next character, even in quotes, but it can't be used as multiline character (for the label name).</div></blockquote><br />There seems to be one open possibility. A caret do some sort of multiline, but I can't figure out how the label is called then.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />set pVar=!var!<br />set LF=^<br /><br /><br />setlocal EnableDelayedExpansion<br />call :lab&nbsp; &nbsp; test1<br />call :label&nbsp; test2<br />set &quot;var=lab^el&quot;<br />call :!pVar! test3<br />set &quot;var=lab^^el&quot;<br />call :!pVar! test4<br />set &quot;var=lab!LF!el&quot;<br />call :!pVar! test5<br />set &quot;var=lab^^!LF!el&quot;<br />call :!pVar! test6<br />exit /b<br /><br />:lab^<br />el<br />echo Currently I can't call this</code></pre></div><br /><br />Btw. Do ALWAYS append a parameter to your call, if experimenting with ending carets, else the cmd.exe can crash completly <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" /> <br /><br /><span style="color: #FF0000">EDIT:</span><br /><blockquote><div><cite>dbenham wrote:</cite>The extra round of delayed expansion only works with CALL, it does not work with GOTO. I guess that is &quot;expected&quot;.</div></blockquote><br />Yes, I expected this, as GOTO haven't a second parser round like CALL at all.<br /><br />CALL seems to have a special mode for calling labels, as the second delayed expansion only works if a colon is found before, <br />it fails if the colon would only be visible after the second expansion.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set &quot;pVar=!var!&quot;<br />setlocal EnableDelayedExpansion<br />set &quot;var=label&quot;<br />call :!pVar! works<br />set &quot;var=:Label&quot;<br />call !pVar! failed<br />exit /b<br /><br />:label<br />echo It works<br />exit /b</code></pre></div><br />jeb</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: Rules for label names vs GOTO and CALL</h3>
				<div class="date">Posted: <strong>25 Jun 2014 14:25</strong></div>
				<div class="author">by <strong>npocmaka_</strong></div>
				<div class="content">I'm not sure if this is exactly applicable for this thread but seems that for bot GOTO and CALL the<br />string <span style="color: #BF0000">&quot;/?&quot;</span> is with highest priority and both commands ignore everything else when this is string is passed and print the help:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />call :blah/?blah<br />goto :blah/?blah<br /><br />call :label1 /?<br />goto :label1 /?<br /><br />exit /b 0<br /><br />:label1<br />echo --------------- </code></pre></div></div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="UTC-6">UTC-06:00</span><br />Page <strong>1</strong> of <strong>4</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Limited<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=3803&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 09:21:39 GMT -->
</html>
