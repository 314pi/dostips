<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=6044&start=315&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 07:59:41 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>DosTips.com &bull; JREPL.BAT v7.14 - regex text processor now with Unicode and XRegExp support - Page 22</title>

<link href="styles/AllanStyle-SUBSILVER/theme/print.css" rel="stylesheet">
</head>
<body id="phpbb">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>DosTips.com</h1>
		<p>A Forum all about DOS Batch<br /><a href="index-2.html">https://www.dostips.com/forum/</a></p>

		<h2>JREPL.BAT v7.14 - regex text processor now with Unicode and XRegExp support</h2>
		<p><a href="viewtopicb16d.html?f=3&amp;t=6044">https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=6044</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>22</strong> of <strong>27</strong></div>
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>25 Aug 2017 06:08</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><blockquote><div><cite>eugenemon wrote:</cite>I have tried both codes and now I understand the structure for the capture groups. However, the output file I received shows 3 blank lines when I opened it with notepad++. The file size is now 4 bytes compared to previously (when I did it wrongly) 0kb. I guess that's an improvement.   <img class="smilies" src="images/smilies/icon_confused.gif" alt=":?" title="Confused" /> <br /></div></blockquote>  <img class="smilies" src="images/smilies/icon_question.gif" alt=":?:" title="Question" />  <img class="smilies" src="images/smilies/icon_confused.gif" alt=":?" title="Confused" /> <br /><br />I've tested the code using the example input file you provided, and it worked perfectly. Either the input format differs from what you have posted, or else your source files are in Unicode. JREPL only supports ASCII format (though this solution should work with UTF-8)<br /><br /><blockquote><div><cite>eugenemon wrote:</cite>Also, I would like to consolidate all output to one file. I read from a previous post that I can use the following to append the result to the same file. <blockquote class="uncited"><div>&gt;&gt; output.csv</div></blockquote> <br /></div></blockquote><br />Sure, you can remove the /O parameter and replace it with redirection. If you do, you may want to introduce a blank line between each output to make the result easier to read.<br /><br />I would use:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set &quot;end=output.WriteLine(head+'\r\n'+data+'\r\n')&quot;<br /></code></pre></div><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>25 Aug 2017 13:58</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><span style="font-size: 150%; line-height: normal">Here is JREPL.BAT Version 6.8</span><br /><div class="inline-attachment">
			
		
		
				<dl class="file">
			<dt><span class="imageset icon_topic_attach"></span> <a class="postlink" href="download/filecf23.php?id=223">JREPL6.8.zip</a></dt>
			<dd><em>Also downloaded 119 times from the main release page in 2 weeks</em></dd>			<dd>(19.38 KiB) Downloaded 82 times</dd>
		</dl>
		
		
			</div> <br /><span style="font-size: 150%; line-height: normal">There are 3 new features:</span><br /> <br /><strong class="text-strong"><span style="font-size: 150%; line-height: normal">1) New \c caret escape sequence available with the /X option</span></strong><br /> <br />JREPL typically requires CALL when used within a batch script. The CALL command has an unfortunate side effect whereby it doubles all quoted caret literals (<strong class="text-strong">call echo &quot;^&quot;</strong> becomes <strong class="text-strong">echo &quot;^^&quot;</strong>). This is not an issue when using ^ as a line beginning anchor, because regular expressions &quot;^Beginning of line&quot; and &quot;^^Beginning of line&quot; are functionally equivalent. But it is an issue if ^ is used as a negative character set, or as a string literal.<br /> <br /><strong class="text-strong">call jrepl &quot;[^ ]&quot; ...</strong>  is intended to match anything that is not a space, but instead it matches anything that is not a space or a caret.<br /> <br />Prior to v6.8, there were only two solution:<br />- Put the find and replace strings in variables and use the /V option, which may not be convenient<br />- Or else use the \x5E escape sequence, which is difficult to remember.<br /> <br />Now with v6.8 you can add the <strong class="text-strong">/X</strong> option and use <strong class="text-strong">\c</strong>.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal<br />set &quot;str=A B C ^ 1 2 3&quot;<br />:: Desired operation: substitute . for all characters except space.<br />&nbsp;<br />:: Caret doubling issue demonstration:<br />call jrepl &quot;&#91;^ &#93;&quot; &quot;.&quot; /s str<br />&nbsp;<br />:: Solution with /X option and \c escape sequence:<br />call jrepl &quot;&#91;\c &#93;&quot; &quot;.&quot; /x /s str<br /></code></pre></div>--OUTPUT--<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>. . . ^ . . .<br />. . . . . . .<br /></code></pre></div><br /> <br /><strong class="text-strong"><span style="font-size: 150%; line-height: normal">2) New \APP option for use with \O causes output to be appended to any pre-existing output file, rather than overwriting it.</span></strong><br /> <br /><strong class="text-strong">jrepl ... /O outFile /APP</strong>  is equivalent to  <strong class="text-strong">jrepl ... &gt;&gt;outFile</strong><br /> <br />However, the <strong class="text-strong">/APP</strong> option does provide one new function in that it can also be used with <strong class="text-strong">/F inFile /O - /APP</strong>, which allows new content (the result) to be appended to the original source file.<br /> <br /> <br /><strong class="text-strong"><span style="font-size: 150%; line-height: normal">3) New openFile() JScript function allows the destination of output to change midstream.</span></strong><br /> <br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; &nbsp; openOutput( fileName &#91;,appendBoolean&#93; )<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Open a new TextStream object for writing and assign it to the<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;output variable. If appendBoolean is truthy, then open the file<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for appending.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;If fileName is falsey, then assign output to stdout.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;All subsequent output will be written to the new destination.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Any prior output file is automatically closed.<br /></code></pre></div><br />For example, <a href="https://stackoverflow.com/q/45852445/1012053" class="postlink">This StackOverflow question</a> wanted to split an input file into multiple output files, breaking at each HD record. The name of each output file is extracted from the HD line, and any lines prior to the first HD line are discarded.<br /> <br /><strong class="text-strong">source.txt</strong><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>File Date Source Target<br />HD|out1.txt|Field 2|Field 3<br />ITEM 1|Other fields 1<br />ITEM 2|Other fields 2<br />HD|out2.txt|Field A|Field B<br />ITEM A|Other fields A<br />ITEM B|Other fields B<br />ITEM C|Other fields C<br /></code></pre></div><br /> <div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>jrepl &quot;^HD\|(&#91;^|&#93;+)&quot; &quot;openOutput($1);$txt=$0&quot; /jq /f &quot;source.txt&quot; &gt;nul<br /></code></pre></div>--RESULT--<br /><strong class="text-strong">out1.txt</strong><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>HD|out1.txt|Field 2|Field 3<br />ITEM 1|Other fields 1<br />ITEM 2|Other fields 2<br /></code></pre></div><strong class="text-strong">out2.txt</strong><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>HD|out2.txt|Field A|Field B<br />ITEM A|Other fields A<br />ITEM B|Other fields B<br />ITEM C|Other fields C<br /></code></pre></div><br /> <br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>JREPL.BAT v7.0 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>07 Sep 2017 21:46</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><span style="font-size: 150%; line-height: normal">Here is version 7<span style="color: #0000FF">.3</span> - A major new release with Unicode and XRegExp support</span><br /><div class="inline-attachment">
			
		
		
				<dl class="file">
			<dt><span class="imageset icon_topic_attach"></span> <a class="postlink" href="download/file0445.php?id=243">JREPL7.3.zip</a></dt>
			<dd><em>Version 7.3 was downloaded 23 times from the main release page over 2 days while it was the current version.</em></dd>			<dd>(22.46 KiB) Downloaded 76 times</dd>
		</dl>
		
		
			</div><span style="font-size: 75%; line-height: normal">Bugged v7.1 was download 172 times in 15 days</span><br /><br />Rather than write a new summary of the changes, I will post the relevant built in help text to catalog the enhancements.<br /><br /><span style="font-size: 150%; line-height: normal">Summary of changes</span><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&gt;jrepl /?history<br /><br />&nbsp; &nbsp; 2017-09-23 v7.3: Fixed /O - support for ADO input.<br />&nbsp; &nbsp; 2017-09-23 v7.2: Improved documentation of new 7.0 features.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Bug fix - /T FILE ADO support was broken<br />&nbsp; &nbsp; 2017-09-08 v7.1: Bug fix - v7.0 failed if Find or Replace contained )<br />&nbsp; &nbsp; 2017-09-08 v7.0: Added /XREG and /TFLAG for XRegExp regex support.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Added /UTF for UTF-16LE support.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Added /X support for the \u{N} unicode escape sequence.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Added |CharSet syntax for file names to allow reading<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;and writing via ADO with a specified character set.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Exposed the fso FileSystemObject to user JScript.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Augmented openOutput for Unicode and ADO support.<br />... &lt;truncated&gt;<br /></code></pre></div><br /><br /><span style="font-size: 150%; line-height: normal">Native Unicode 16 Little Endian support (UTF-16LE) for input and output</span><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&gt;jrepl /?/utf<br /><br />&nbsp; &nbsp; &nbsp; /UTF - All input and output encodings are Unicode UTF-16 Little<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Endian (UTF-16LE). This includes stdin and stdout. The only<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; exceptions are /JLIB and /XREG files, which are still read<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; as ASCII.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The \xFF\xFE BOM is optional for input.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Output files will automatically have the \xFF\xFE BOM inserted.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; But stdout will not have the BOM.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Extended ASCII escape sequences (\x80 - \xFF) should not be used<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; with /UTF combined with /X.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Regular expression support of Unicode can be improved by using<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the /XREG option.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Variable values are no longer written to temporary files when<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /X is used if /UTF is also used.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Unfortunately, /UTF is incompatible with /RTN.<br /></code></pre></div><br /><br /><span style="font-size: 150%; line-height: normal">Read and write files using virtually any character set (including UTF-8) via ADO</span><br />A list of valid character set names and their corresponding code page can be found at <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd317756(v=vs.85).aspx" class="postlink">https://msdn.microsoft.com/en-us/library/windows/desktop/dd317756(v=vs.85).aspx</a><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&gt;jrepl /?/f &amp; jrepl /?/o &amp; jrepl /?/t<br /><br />&nbsp; &nbsp; &nbsp; /F InFile&#91;|CharSet&#93;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Input is read from file InFile instead of stdin.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; -&gt;&nbsp; If |CharSet (internet character set name) is appended to InFile,<br />&nbsp; &nbsp; &nbsp; &nbsp; -&gt;&nbsp; then the file is opened via ADO using the specified CharSet value.<br />&nbsp; &nbsp; &nbsp; &nbsp; -&gt;&nbsp; JREPL still recognizes both \n and \r\n as input line terminators<br />&nbsp; &nbsp; &nbsp; &nbsp; -&gt;&nbsp; when using ADO. Both ADO and the CharSet must be available on the<br />&nbsp; &nbsp; &nbsp; &nbsp; -&gt;&nbsp; local system.<br /><br /><br />&nbsp; &nbsp; &nbsp; /O OutFile&#91;|CharSet&#93;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Output is written to file OutFile instead of stdout. Any existing<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; OutFile is overwritten unless the /APP option is also used.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; -&gt;&nbsp; If |CharSet (internet character set name) is appended to OutFile,<br />&nbsp; &nbsp; &nbsp; &nbsp; -&gt;&nbsp; then the file is opened via ADO using the specified CharSet value.<br />&nbsp; &nbsp; &nbsp; &nbsp; -&gt;&nbsp; The output line terminator still defaults to \r\n when using ADO,<br />&nbsp; &nbsp; &nbsp; &nbsp; -&gt;&nbsp; and may be changed to \n with the \U option. Both ADO and the<br />&nbsp; &nbsp; &nbsp; &nbsp; -&gt;&nbsp; CharSet must be available on the local system.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;If /F InFile is also used, then an OutFile value of &quot;-&quot; overwrites<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;the original InFile with the output, preserving the character set.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;The output is first written to a temporary file with the same path<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;and name, with .new appended. Upon completion, the temp file is<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;moved to replace the InFile. It is not valid to use &quot;-|CharSet&quot;<br /><br /><br />&nbsp; &nbsp; &nbsp; /T DelimiterChar<br />&nbsp; &nbsp; &nbsp; /T FILE<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The /T option is very similar to the Oracle Translate() function,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; or the unix tr command, or the sed y command.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The Search represents a set of search expressions, and Replace<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; is a like sized set of replacement expressions. Expressions are<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delimited by DelimiterChar (a single character). If DelimiterChar<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; is an empty string, then each character is treated as its own<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; expression. The /L option is implicitly set if DelimiterChar is<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; empty. Escape sequences are interpreted after the search and<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; replace strings are split into expressions, so escape sequences<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cannot be used without a delimiter.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; An alternate syntax is to specify the word FILE instead of a<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DelimiterChar, in which case the Search and Replace parameters<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; specify files that contain the search and replace expressions,<br />&nbsp; &nbsp; &nbsp; &nbsp; -&gt;&nbsp; one expression per line. Each file can be opened via ADO if<br />&nbsp; &nbsp; &nbsp; &nbsp; -&gt;&nbsp; |CharSet (internet character set name) is appended to the file<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name. Note that the /V option does not apply to Search and Replace<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if /T FILE is used.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ... &lt;truncated&gt;<br /></code></pre></div><br /><br /><span style="font-size: 150%; line-height: normal">Add Unicode support to objects available to user supplied JScript</span><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&gt;jrepl /?jscript<br /><br />&nbsp; The following global JScript variables/objects/functions are available for<br />&nbsp; use in JScript code associated with the /Jxxx options.<br />&nbsp; &nbsp;... &lt;truncated&gt;<br /><br />&nbsp; &nbsp; &nbsp; input&nbsp; - The TextStream object from which input is read.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;This may be stdin or a file.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;If the file was opened by ADO with |CharSet, then input is<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;an object that partially emulates a TextStream object, with<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;a private ADO Stream doing the actual work. The following<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;public members are available to the ADO object:<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Property&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Method<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -------------&nbsp; &nbsp; &nbsp; -----------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AtEndOfStream&nbsp; &nbsp; &nbsp; Read<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ReadLine<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;SkipLine<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Write<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;WriteLine<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Close<br /><br />&nbsp; &nbsp; &nbsp; output - The TextStream object to which the output is written.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;This may be stdout or a file. ... &lt;truncated&gt;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;If the file was opened by ADO with |CharSet, then output is<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;an object that partially emulates a TextStream object (see the<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;input object).<br /><br />&nbsp; &nbsp; &nbsp; openOutput( fileName&#91;|CharSet&#93; &#91;,appendBoolean &#91;,utfBoolean&#93;&#93; )<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Open a new TextStream object for writing and assign it to the<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;output variable. If appendBoolean is truthy, then open the file<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;for appending.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;If |CharSet is appended to the fileName, then open the file<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;using ADO and the specified internet character set name. The<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;output variable will be set to an object that partially<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;emulates a TextStream object (see the input object).<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;If utfBoolean is truthy, then output is encoded as unicode<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;(UTF-16LE). The unicode file will automatically have the BOM<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;unless opened for appending. The utfBoolean argument is ignored<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if |CharSet is also specified.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;If fileName is falsey, then output is written to stdout.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;All subsequent output will be written to the new destination.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Any prior output file is automatically closed.<br /><br />... &lt;truncated&gt;<br /></code></pre></div><br /><br /><span style="font-size: 150%; line-height: normal">New escape sequence \u{N} for access to any Unicode code point, including &quot;Astral&quot; (supplemental) planes</span><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&gt;jrepl /?/x<br /><br />&nbsp; &nbsp; &nbsp; /X&nbsp; - ... &lt;truncated&gt;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Also enables extended substitution pattern syntax with support<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for the following escape sequences within the Replace string:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ... &lt;truncated&gt;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \u{N}&nbsp; -&nbsp; Any Unicode code point where N is 1 to 6 hex digits<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Also enables the \q, \c, and \u{N} escape sequences for the Search<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string. The other escape sequences are already standard for a<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; regular expression Search string.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ... &lt;truncated&gt;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; When using \xnn with /X, JREPL assumes your machine defaults to<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Windows-1252, which is generally true for Western Europe and North<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; and South America. If your machine doesn't use Windows-1252, then<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; you should not use \xnn with values above 7F unless you force<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; input and output to use Windows-1252 via /F &quot;inFile|Windows-1252&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; and /O &quot;outFile|Windows-1252&quot; (or /O -).<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Note that without the /X option, \xnn within a regex search string<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; maps to unicode code points.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br /></code></pre></div><br /><br /><span style="font-size: 150%; line-height: normal">Enhanced regular expression syntax via <a href="http://xregexp.com/" class="postlink">XRegExp (xregexp.com)</a></span><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&gt;jrepl /?/xreg &amp; jrepl /?/tflag<br /><br />&nbsp; &nbsp; &nbsp; /XREG FileList<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Adds support for XRegExp by loading the xregexp files specified<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; in FileList before any /JLIB code is loaded. Multiple files are<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delimited by forward slashes (/). If FileList is simply a dot,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; then substitute the value of environment variable XREGEXP for<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the FileList.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The simplest option is to load &quot;xregexp-all.js&quot;, but this<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; includes all available XRegExp options and addons, some of which<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; are unlikely to be useful to JREPL. Alternatively you can load<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; only the specific modules you need, but they must be loaded in the<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; correct order.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Once the XRegExp module(s) are loaded, all user supplied regular<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; expressions are created using the XRegExp constructor rather than<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; the standard RegExp constructor. Also, XRegExp.install('natives')<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; is executed so that many standard regular expression methods are<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; overridden by XRegExp methods.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /XREG requires XRegExp version 2.0.0 or 3.x.x. JREPL will not<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; support version 4.x.x (when it is released) because v4.x.x<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; is scheduled to drop support for XRegExp.install('natives').<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; One of the key features of XRegExp is that it extends the JScript<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; regular expression syntax to support named capture groups, as in<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (?&lt;name&gt;anyCapturedExpression). Named groups can be referenced<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; in Replace strings as ${name}, and in Replace JScript code as<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $0.name<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; The /T option is no longer limited to 99 capture groups when<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /XREG is used. However, /T replace expressions must reference a<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; captured group by name if the capture index is 100 or above.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Every /T search expression is automatically given a capture group<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; name of Tn, where n is the 0 based index of the /T expression.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; XRegExp also adds support for non-standard mode flags:<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; n - Explicit capture<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s - Dot matches all<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; x - Free spacing and line comments<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; A - Astral<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; These flags can generally be applied by using (?flags) syntax<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; at the begining of any regex. This is true for /P, /INC, /EXC,<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; and most Find regular expressions. The one exception is /T doesn't<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; support (?flags) at the beginning of the Find string. The /TFLAG<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; option should be used to specify XRegExp flags for use with /T.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; XRegExp also improves regular expression support for Unicode via<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \p{Category}, \p{Script}, \p{InBlock}, \p{Property} escape<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; sequences, as well as the negated forms \P{...} and \p{^...}.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Note that example usage on xregexp.com shows use of doubled back<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; slashes like \\p{...}. But JREPL automatically does the doubling<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for you, so you should use \p{...} instead.<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; See xregexp.com for more information about the capabilities of<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; XRegExp, and for links to download XRegExp.<br /><br /><br />&nbsp; &nbsp; &nbsp; /TFLAG Flags<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Used to specify XRegExp non-standard mode flags for use with /T.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; /TFLAG is ignored unless both /T and /XREG are used.<br /></code></pre></div><br /><br />The enhancements were implemented in a fairly surgical manner, but they have a profound impact on the entire functioning of the utility. I have only done limited testing, so I won't be surprised if I have introduced some bugs.<br /><br />I encourage everyone to try out the new features, and please report any problems that you find.<br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>07 Sep 2017 23:51</strong></div>
				<div class="author">by <strong>eugenemon</strong></div>
				<div class="content"><blockquote><div><cite>dbenham wrote:</cite>I've tested the code using the example input file you provided, and it worked perfectly. Either the input format differs from what you have posted, or else your source files are in Unicode. JREPL only supports ASCII format (though this solution should work with UTF-8)<br /></div></blockquote><br /><br />Omg, it's amazing! It worked. Sorry for the late reply. I output all txt files into ASCII encoding and JREPL read them perfectly. I am finally able to get the right data out from the mess. Thank you so much for this.<br /><br /><blockquote><div><cite>dbenham wrote:</cite>Here is version 7.0 - A major new release with Unicode and XRegExp support</div></blockquote><br /><br />Does this means unicode can now be recognized?</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>08 Sep 2017 02:59</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><blockquote><div><cite>eugenemon wrote:</cite><blockquote><div><cite>dbenham wrote:</cite>Here is version 7.0 - A major new release with Unicode and XRegExp support</div></blockquote><br /><br />Does this means unicode can now be recognized?</div></blockquote><br />Yes it does, as long as you know the encoding and use the correct options. <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /><br />Go up two posts for details.<br /><br />If your source file is encoded as UTF-16LE, then simply add the <span style="color: #0000FF"><strong class="text-strong">/UTF</strong></span> option to your command. JREPL will use the native CSCRIPT ability to read and write UTF-16 little endian format.<br /><br />If your source file uses some other encoding, then you must use the &quot;fileName|CharSet&quot; ADO syntax for both the input and output. But this only works if your machine has ADO as well as the correct character set installed. Assuming your source uses UTF-16BE encoding, then you would use <span style="color: #0000FF"><strong class="text-strong">/F &quot;%%F|UTF-16BE&quot; /O=&quot;%%~nF.csv|UTF-16BE&quot;</strong></span>.<br /><br />When using ADO, the output encoding can differ from the input. For example, both <span style="color: #0000FF"><strong class="text-strong">/F &quot;%%F|UTF-16BE&quot; /O &quot;%%~nF.csv|UTF-16LE&quot;</strong></span> and <span style="color: #0000FF"><strong class="text-strong">/F &quot;%%F|UTF-16BE&quot; /O &quot;%%~nF.csv&quot; /UTF</strong></span> would read UTF-16BE and write UTF-16LE. Other likely output formats would be UTF-8 or US-ASCII. But bear in mind that US-ASCII will corrupt the output if your source has any non-ASCII characters.<br /><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.1 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>08 Sep 2017 08:33</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">Ugh - I had a stupid nasty bug that caused v7.0 to fail if the Find or Replace strings contained )<br />I think it would also fail if there was a poison character  <img class="smilies" src="images/smilies/icon_evil.gif" alt=":evil:" title="Evil or Very Mad" />   <img class="smilies" src="images/smilies/icon_redface.gif" alt=":oops:" title="Embarassed" /> <br /><br />I've fixed the bug and updated my <a href="viewtopica39a.html?f=3&amp;t=6044&amp;p=53901#p53886" class="postlink">v7.0 post</a> to v7.1.<br /><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.1 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>08 Sep 2017 16:56</strong></div>
				<div class="author">by <strong>aGerman</strong></div>
				<div class="content">Great job, Dave!<br /><br />I don't try to fully understand your code. Anyway, there is a section that draws my attention beginning at line 1958<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; &nbsp; &nbsp;case 'x80': return '\u20AC';</code></pre></div>Assuming that byte 0x80 is the Euro currency symbol actually means that you expect the incoming encoding is extended latin as Windows-1250, -1252 and the like. There are a lot of code pages (in fact the majority) where 0x80 is a completely differnt character (like Windows-1251, OEM code pages, etc.). As I said - I don't understand your code and maybe you're aware of it ...<br /><br />Steffen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.1 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>08 Sep 2017 17:31</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">All of those 'xNN' translations in the decode function have been there since the beginning to support processing of extended ASCII. They have nothing to do with the Unicode support.<br /><br />CSCRIPT always interprets extended ASCII bytes the same way (perhaps Windows-1250, but not sure), regardless what the cmd.exe active code page is.<br /><br />When CSCRIPT reads a 0x80 byte while in ASCII mode, it is interpreted as unicode code point 20AC. But a '\x80' escape sequence would be unicode '0080', a totally different character. So I need to translate the '\x80' escape sequence to get the expected extended ASCII result. When the character is written back out as ASCII, CSCRIPT translates back into a 0x80 byte.<br /><br />That is why my documentation states you should not use the '\xNN' escape sequence when working with unicode input/output. You should use \uNNNN instead,  (or \u{N...} with /X). Though technically, my extended ASCII translation only  occurs when you use the /X option. So you could safely use '\xNN' with Unicode as long as you don't use the /X option.<br /><br />In summary:<br /><br />Unicode input/output - only use \xNN without /X<br />extended ASCII input/output - only use \xNN with /X<br /><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.1 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>09 Sep 2017 11:45</strong></div>
				<div class="author">by <strong>aGerman</strong></div>
				<div class="content">It's quite difficult for me to explain. I'll try again.<br />If you say &quot;extended ASCII&quot; you obvioulsy refer to a certain ANSI code page.<br /><br />For you and for me the default ANSI code page is <a href="https://en.wikipedia.org/wiki/Windows-1252" class="postlink">Windows-1252</a>. That means if we write an € (Euro symbol) in Notepad and save it ANSI-encoded then Byte 0x80 was written to the file. The Unicode code point for the Euro symbol is u20AC. So far everything seems to be okay with the line that I quoted above.<br /><br />A Serbian writes character Ђ (capital letter dje) in Notepad and saves it. His ANSI setting defaults to <a href="https://en.wikipedia.org/wiki/Windows-1251" class="postlink">Windows-1251</a> and thus, the same Byte 0x80 was written to his file as for our Euro symbol in Windows-1252. But now your hard-coded conversion to u20AC is wrong because the code point for Ђ is u0402.<br /><br />I just hope you understand my point, Dave. I believe a hard-coded conversion is ambiguous and the only reason why I write this comment is because your tool is great and it would be a pity if some features can't be properly used in other environments.<br /><br />Steffen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.1 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>09 Sep 2017 12:20</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><blockquote><div><cite>aGerman wrote:</cite>A Serbian writes character Ђ (capital letter dje) in Notepad and saves it. His ANSI setting defaults to <a href="https://en.wikipedia.org/wiki/Windows-1251" class="postlink">Windows-1251</a> and thus, the same Byte 0x80 was written to his file as for our Euro symbol in Windows-1252. But now your hard-coded conversion to u20AC is wrong because the code point for Ђ is u0402.<br /><br />I just hope you understand my point, Dave. I believe a hard-coded conversion is ambiguous and the only reason why I write this comment is because your tool is great and it would be a pity if some features can't be properly used in other environments.<br /></div></blockquote><br />I absolutely understand your point. Now I'll try to do a better job explaining why my code is structured the way it is.<br /><br />JScript (CSCRIPT) stores all strings internally as UTF-16LE. When a CSCRIPT ASCII TextStream reads a 0x80 byte, it <strong class="text-strong"><em class="text-italics">always</em></strong> treats it as code point u20AC, regardless what code page cmd.exe is using. Somewhere on StackOverflow I saw a post claiming VBScript (CSCRIPT in general) uses Windows-1250. So JScript interprets the code incorrectly. But that is OK, as long as the same translation is used when the character is written back out (which it does). Now it will not look correct if JREPL writes directly to the console, but if saved as a file, then it will indeed be a 0x80 byte.<br /><br />So if a user specifies a character using a \x80 escape sequence, then I need to interpret that escape sequence the same way that CSCRIPT interprets a 0x80 byte.<br /><br />Hope that helps.<br /><br /><br />Dave</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.1 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>09 Sep 2017 12:47</strong></div>
				<div class="author">by <strong>aGerman</strong></div>
				<div class="content"><blockquote><div><cite>dbenham wrote:</cite>When a CSCRIPT ASCII TextStream reads a 0x80 byte, it <strong class="text-strong"><em class="text-italics">always</em></strong> treats it as code point u20AC ... Somewhere on StackOverflow I saw a post claiming VBScript (CSCRIPT in general) uses Windows-1250.</div></blockquote><br />If this is true for all environments then I would agree . In that case you do it the right way for the bug in CSCRIPT <img class="smilies" src="images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" /> But I'm still afraid that CSCRIPT determines the default ANSI code page of your computer settings (which has nothing to do with the default or temporary OEM code page in CMD).<br /><br />Thanks for your explanation!<br /><br />Steffen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.1 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>09 Sep 2017 14:58</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content"><blockquote><div><cite>aGerman wrote:</cite>But I'm still afraid that CSCRIPT determines the default ANSI code page of your computer settings (which has nothing to do with the default or temporary OEM code page in CMD).</div></blockquote>Ooh, that is an interesting idea that would indeed cause problems. <img class="smilies" src="images/smilies/icon_exclaim.gif" alt=":!:" title="Exclamation" />  <img class="smilies" src="images/smilies/icon_sad.gif" alt=":(" title="Sad" /> <br /><br />I've had a hard time finding definitive info about how CSCRIPT interprets extended ASCII (ANSI).<br /><br />Is that a theory on your part? Or is that something you have experience with, or have you read (semi) official documentation?<br /><br />If you are right, then I don't know what I can do. Even if I knew what code page was actually being used, it wouldn't do me any good. I would need to know how each byte code is being interpreted by CSCRIPT - the mapping from byte code to unicode. And for variable or multi-byte character sets like Japanese, that could be particularly troublesome, especially if the source code has invalid character sequences. Invalid character sequences can definitely occur with binary data if it is interpreted as a text stream (which is what JREPL does)<br /><br />I must admit that my statement claiming &quot;always...&quot; can't possibly be true, because I did get one PM from a user with Japanase locale, using code page 932, that said JREPL was corrupting binary data when using the \xnn escape sequences. The find replace was supposed to preserve the total length, but the output was shortened. Your theory could explain why it failed for that person.<br /><br />Hopefully the new /UTF option and/or the ADO capability will alleviate any problems that people might have. Users can specify exactly what character set they are using, and stick to the \unnnn or \u{N} escape sequences.<br /><br />For editing binary data, it should be possible to use ADO with the exact character set that matches my decode function. I think it is time to get a definitive answer on the code page that my code is using.<br /><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.1 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>09 Sep 2017 15:32</strong></div>
				<div class="author">by <strong>aGerman</strong></div>
				<div class="content"><blockquote><div><cite>dbenham wrote:</cite>Is that a theory on your part? Or is that something you have experience with, or have you read (semi) official documentation?</div></blockquote><br />At the moment it's only a theory based on my experiences with Windows scripts. I think it could be proved though. You read that CSCRIPT always uses Windows-1250 but your default is Windows-1252. You only have to find the different characters and do some test against them.<br /><br />And yes, I also think that the ADO streams should be able to solve the problem even if it could be more difficult. Most likely you have to iterate through the byte array of a binary stream to replace bytes.<br /><br />Steffen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.1 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>09 Sep 2017 16:30</strong></div>
				<div class="author">by <strong>aGerman</strong></div>
				<div class="content">It's really hard to find something about how CSCRIPT handles character encoding. There is a hint in a post of Eric Lippert (who was one of the developers working on the WSH at that time).<br /><a href="https://blogs.msdn.microsoft.com/ericlippert/2004/02/11/unicode-output-and-the-windows-script-host/" class="postlink">https://blogs.msdn.microsoft.com/ericlippert/2004/02/11/unicode-output-and-the-windows-script-host/</a><br />He wrote that they use Windows API functions such as MultiByteToWideChar and WideCharToMultiByte which was not surprising for me (I use the same as core functions in my CONVERTCP utility). More interesting was that he mentioned to use the CP_OEMCP constant (or even CP_ACP as the first commenter assumed). Those are macros defined with 1 for CP_OEMCP and 0 for CP_ACP. They are no real code page identifiers. The system default settings are used instead.<br /><br />Steffen</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT v7.1 - regex text processor now with Unicode and XRegExp support</h3>
				<div class="date">Posted: <strong>09 Sep 2017 22:51</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">Mystery solved <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /><br />CSCRIPT on my machine definitely interprets extended ASCII as Windows-1252.<br /><br />And if you use ADO with Windows-1252 for both input and output, plus the /X and /M options, then you can safely manipulate binary files using any \xnn escape sequence, regardless what default code page your machine uses.<br /><br />I tested by first creating a binary file length 256 containing bytes 0x00 through 0xFF, called bytes.txt<br /><br />I then used JREPL to read the file using the default encoding, and wrote the result out as UTF-16BE via ADO.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>jrepl &quot;^&quot; &quot;&quot; /m /f &quot;bytes.txt&quot; /o &quot;bytes-default.txt|UTF-16BE&quot;<br /></code></pre></div><br />Next I did nearly the same thing, except this time I explicitly read the input as Windows-1252 via ADO<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>jrepl &quot;^&quot; &quot;&quot; /m /f &quot;bytes.txt|Windows-1252&quot; /o &quot;bytes-1252.txt|UTF-16BE&quot;<br /></code></pre></div><br />I used FC to look for differences, and the two outputs were identical <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" /> <br /><br />The only byte codes that do not translate to the same unicode code point are byte codes in the range 0x80 through 0x9F.<br />Here are the unicode code points that map to that range:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; &nbsp; 0&nbsp; &nbsp; 1&nbsp; &nbsp; 2&nbsp; &nbsp; 3&nbsp; &nbsp; 4&nbsp; &nbsp; 5&nbsp; &nbsp; 6&nbsp; &nbsp; 7&nbsp; &nbsp; 8&nbsp; &nbsp; 9&nbsp; &nbsp; A&nbsp; &nbsp; B&nbsp; &nbsp; C&nbsp; &nbsp; D&nbsp; &nbsp; E&nbsp; &nbsp; F<br />8&nbsp; 20AC 0081 201A 0192 201E 2026 2020 2021 02C6 2030 0160 2039 0152 008D 017D 008F<br />9&nbsp; 0090 2018 2019 201C 201D 2022 2013 2014 02DC 2122 0161 203A 0153 009D 017E 0178<br /></code></pre></div><br />I looked at the decode escape sequence translations that JREPL uses with the /X option, and they match the results above.<br /><br />Thanks for your help Steffen.<br /><br /><br />Dave</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="UTC-6">UTC-06:00</span><br />Page <strong>22</strong> of <strong>27</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Limited<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=6044&start=315&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 07:59:41 GMT -->
</html>
