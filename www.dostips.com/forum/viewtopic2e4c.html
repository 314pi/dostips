<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=4790&p=54440 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 08:40:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>Batch macro vs function call test - DosTips.com</title>


	<link rel="canonical" href="viewtopic5ac3.html?t=4790">

<!--
	phpBB style name: Allan Style - SUBSILVER
	Based on style:   prosilver (this is the default phpBB3 style)
	Based on style:   subsilver2 (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:  Allan ( http://x-tk.ru/ )
-->

<link href="assets/css/font-awesome.mind772.css?assets_version=34" rel="stylesheet">
<link href="styles/AllanStyle-SUBSILVER/theme/stylesheetd772.css?assets_version=34" rel="stylesheet">
<link href="styles/AllanStyle-SUBSILVER/theme/en/stylesheetd772.css?assets_version=34" rel="stylesheet">




<!--[if lte IE 9]>
	<link href="./styles/AllanStyle-SUBSILVER/theme/tweaks.css?assets_version=34" rel="stylesheet">
<![endif]-->




<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','../../www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-280191-1', 'auto');
	ga('send', 'pageview');
</script>

</head>
<body id="phpbb" class="nojs notouch section-viewtopic ltr ">

<div id="header-subsilver">
	<a id="top" class="top-anchor" accesskey="t"></a>
		<div class="headerbar" role="banner">
					<div class="inner">

			<div id="site-description" class="site-description">
				<a id="logo" class="logo" href="../index.html" title="DosTips.com"><span class="site_logo"></span></a>
				<h1>DosTips.com</h1>
				<p>A Forum all about DOS Batch</p>
				<p class="skiplink"><a href="#start_here">Skip to content</a></p>
			</div>

									<div id="search-box" class="search-box search-header" role="search">
				<form action="https://www.dostips.com/forum/search.php" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="search" maxlength="128" title="Search for keywords" class="inputbox search tiny" size="20" value="" placeholder="Search…" />
					<button class="button button-search" type="submit" title="Search">
						<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
					</button>
					<a href="search.html" class="button button-search-end" title="Advanced search">
						<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
					</a>
					
				</fieldset>
				</form>
			</div>
						
			</div>
					</div>
</div>


<div id="wrap" class="wrap">
	<div id="page-header">
				<div class="navbar-top" role="navigation">
	<div class="inner">

	<ul id="nav-main" class="nav-main linklist" role="menubar">

		<li id="quick-links" class="quick-links dropdown-container responsive-menu" data-skip-responsive="true">
			<a href="#" class="dropdown-trigger">
				<i class="icon fa-bars fa-fw" aria-hidden="true"></i><span>Quick links</span>
			</a>
			<div class="dropdown">
				<div class="pointer"><div class="pointer-inner"></div></div>
				<ul class="dropdown-contents" role="menu">
					
											<li class="separator"></li>
																									<li>
								<a href="search33a7.html?search_id=unanswered" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-gray" aria-hidden="true"></i><span>Unanswered topics</span>
								</a>
							</li>
							<li>
								<a href="search526f.html?search_id=active_topics" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-blue" aria-hidden="true"></i><span>Active topics</span>
								</a>
							</li>
							<li class="separator"></li>
							<li>
								<a href="search.html" role="menuitem">
									<i class="icon fa-search fa-fw" aria-hidden="true"></i><span>Search</span>
								</a>
							</li>
					
											<li class="separator"></li>
																			<li>
								<a href="memberlist4bfd.html?mode=team" role="menuitem">
									<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
								</a>
							</li>
																<li class="separator"></li>

									</ul>
			</div>
		</li>

				<li data-skip-responsive="true">
			<a href="app.php/help/faq.html" rel="help" title="Frequently Asked Questions" role="menuitem">
				<i class="icon fa-question-circle fa-fw" aria-hidden="true"></i><span>FAQ</span>
			</a>
		</li>
						
			<li class="rightside"  data-skip-responsive="true">
			<a href="ucp26c3.html?mode=login" title="Login" accesskey="x" role="menuitem">
				<i class="icon fa-power-off fa-fw" aria-hidden="true"></i><span>Login</span>
			</a>
		</li>
					<li class="rightside" data-skip-responsive="true">
				<a href="ucp8319.html?mode=register" role="menuitem">
					<i class="icon fa-pencil-square-o  fa-fw" aria-hidden="true"></i><span>Register</span>
				</a>
			</li>
						</ul>

	</div>
</div>

<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks" role="menubar">
						<li class="breadcrumbs">
							<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope=""><a href="../index.html" itemprop="url" data-navbar-reference="home"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span itemprop="title">DosTips.com</span></a></span>
										<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope=""><a href="index.html" itemprop="url" accesskey="h" data-navbar-reference="index"><span itemprop="title">Board index</span></a></span>

											<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="4"><a href="viewforum31e6.html?f=4" itemprop="url"><span itemprop="title">DosTips - Dos Batch</span></a></span>
															<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="3"><a href="viewforum4d6b.html?f=3" itemprop="url"><span itemprop="title">DOS Batch Forum</span></a></span>
												</li>
		
					<li class="rightside responsive-search">
				<a href="search.html" title="View the advanced search options" role="menuitem">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</a>
			</li>
			</ul>

	</div>
</div>

<div class="navbar-top-link">
	<div class="inner">
		<ul>
			<li class="navbar-top-link-left"><a href="search33a7.html?search_id=unanswered">Unanswered topics</a></li>
			<li class="navbar-top-link-left"><a href="search526f.html?search_id=active_topics">Active topics</a></li>

											</ul>
	</div>
</div>
	</div>

	
	<a id="start_here" class="anchor"></a>
	<div id="page-body" class="page-body" role="main">
		
		
<h2 class="topic-title"><a href="viewtopiccbbc.html?f=3&amp;t=4790">Batch macro vs function call test</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Discussion forum for all Windows batch related topics.<br /></div>
<p>
	<strong>Moderator:</strong> <a href="memberlista6a8.html?mode=viewprofile&amp;u=5" class="username">DosItHelp</a>
</p>


<div class="action-bar bar-top">
	
			<a href="posting32eb.html?mode=reply&amp;f=3&amp;t=4790" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
	
			<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopicc808.html?f=3&amp;t=4790&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>
	
			<div class="search-box" role="search">
			<form method="get" id="topic-search" action="https://www.dostips.com/forum/search.php">
			<fieldset>
				<input class="inputbox search tiny"  type="search" name="keywords" id="search_keywords" size="20" placeholder="Search this topic…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="search.html" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				<input type="hidden" name="t" value="4790" />
<input type="hidden" name="sf" value="msgonly" />

			</fieldset>
			</form>
		</div>
	
			<div class="pagination">
			19 posts
							<ul>
		<li class="active"><span>1</span></li>
				<li><a class="button" href="viewtopicf4db-2.html?f=3&amp;t=4790&amp;start=15" role="button">2</a></li>
				<li class="arrow next"><a class="button button-icon-only" href="viewtopicf4db-2.html?f=3&amp;t=4790&amp;start=15" rel="next" role="button"><i class="icon fa-chevron-right fa-fw" aria-hidden="true"></i><span class="sr-only">Next</span></a></li>
	</ul>
					</div>
		</div>




<div id="subsilver-nav-topic">
	<div class="inner"><div class="post has-profile">
		<div class="leftsided postbody subsilver-topic-title">Message</div>
		<div class="leftsided postprofile subsilver-topic-author">Author</div>
	</div></div>
</div>

			<div id="p27697" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile27697">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist7557.html?mode=viewprofile&amp;u=4243" class="username">carlsomo</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search15dd.html?author_id=4243&amp;sr=posts">91</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 02 Oct 2012 17:21</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content27697">

						<h3 class="first"><a href="#p27697">Batch macro vs function call test</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingcee2.html?mode=quote&amp;f=3&amp;p=27697" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic4e61-2.html?p=27697#p27697" onclick="prompt('Message #1',this.href); return false;">#1</a></span> 
									<a class="unread" href="viewtopic4e61-2.html?p=27697#p27697" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist7557.html?mode=viewprofile&amp;u=4243" class="username">carlsomo</a></strong> &raquo; </span>28 Jul 2013 17:01
			</p>
			
			
			
			<div class="content">I modified Don Cross' Pi.bat with function calls and replaced the 6 easy ones with macros.<br />The remaining functions contain loops or are not called till the end of the program.<br /><br />It uses the formula:<br />π = 48*arctan(1/18) + 32*arctan(1/57) - 20*arctan(1/239)<br />and calculates pi to 108 decimal places.<br /><br />Time trials on my Win7 laptop (64 bit Intel dual core i3 @ 2.10 GHz):<br /><br />Function Version  Average(8): 5.81375 secs<br />Macros not loaded   Avg time: 4.65125 secs<br />.                          Difference: 1.16250 secs<br />Macros loaded  Average time: 4.63625 secs<br />.                          Difference: 0.015    secs<br /><br />I didn't see much baggage to loading the macros at routine startup vs pre loading in this case.<br />Pi.bat will accept an optional Arg1 to load the result into, then all display is suppressed.<br />Macro version has a 'load' option to run once and put macros into environment for future runs.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>::pi_function_version.bat<br />@echo off<br />setlocal EnableDelayedExpansion<br />if not &#91;%1&#93;==&#91;&#93; (set GNL=^&gt;nul) else (set GNL=)<br />echo.pi.bat&nbsp; -&nbsp; By Don Cross&nbsp; -&nbsp; http://cosinekitty.com%GNL%<br />set /a NumQuads = 30<br />set /a MaxQuadIndex = NumQuads - 1<br />echo.%GNL%<br />echo.%time% - started%GNL%<br />echo.%GNL%<br /><br />call :PiEngine 48 18 32 57 -20 239 tempi<br />::call :PiEngine 16 5 -4 239 tempi<br />endlocal&amp;if not &#91;%1&#93;==&#91;&#93; call set &quot;%1=3%%%tempi%%%&quot;<br />exit /b 0<br /><br />:PiEngine<br />&nbsp; &nbsp; call :SetToInteger Pi 0<br />&nbsp; &nbsp; set Formula=<br />&nbsp; &nbsp; :PiTermLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; if &quot;%1&quot; == &quot;tempi&quot; (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Print pi %1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.%GNL%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.!time! - finished !Formula!%GNL%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.%GNL%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; call :ArctanRecip PiTerm %2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PiEngineFactor=%1<br />&nbsp; &nbsp; &nbsp; &nbsp; if !PiEngineFactor! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a PiEngineFactor *= -1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Formula=!Formula!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :MultiplyByInteger PiTerm !PiEngineFactor!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Subtract Pi PiTerm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=-<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :MultiplyByInteger PiTerm %1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Add Pi PiTerm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=+<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; if defined Formula (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Formula=!Formula! !Operator! !PiEngineFactor!*arctan^(1/%2^)<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Formula=ã = %1*arctan^(1/%2^)<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; shift <br />&nbsp; &nbsp; &nbsp; &nbsp; shift<br />&nbsp; &nbsp; goto PiTermLoop<br />&nbsp; &nbsp; <br />:SetToInteger<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = 0<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a %1_!MaxQuadIndex! = %2<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:Print<br />&nbsp; &nbsp; set PrintBuffer=x<br />&nbsp; &nbsp; REM&nbsp; Omit a couple of least significant quads, because they will have roundoff errors.<br />&nbsp; &nbsp; if defined PiDebug (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=0<br />&nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=2<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a PrintMaxQuadIndex = MaxQuadIndex - 1<br />&nbsp; &nbsp; for /L %%i in (!PrintMinQuadIndex!, 1, !PrintMaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=!%1_%%i!<br />&nbsp; &nbsp; &nbsp; &nbsp; if !PrintDigit! lss 1000 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !PrintDigit! lss 100 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !PrintDigit! lss 10 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=000!PrintDigit!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=00!PrintDigit!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=0!PrintDigit!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set PrintBuffer=!PrintDigit!!PrintBuffer!<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set PrintBuffer=!%1_%MaxQuadIndex%!.!PrintBuffer:x=!<br />&nbsp; &nbsp; echo.|(set /p=ã = )%GNL%&amp;echo.!PrintBuffer! %GNL%<br />&nbsp; &nbsp; set &quot;%2=!PrintBuffer!&quot;<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:DivideByInteger<br />&nbsp; &nbsp; if defined PiDebug echo.DivideByInteger %1 %2<br />&nbsp; &nbsp; set /a DBI_Carry = 0<br />&nbsp; &nbsp; for /L %%i in (!MaxQuadIndex!, -1, 0) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a DBI_Digit = DBI_Carry*10000 + %1_%%i<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a DBI_Carry = DBI_Digit %% %2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = DBI_Digit / %2<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:MultiplyByInteger<br />&nbsp; &nbsp; if defined PiDebug echo.MultiplyByInteger %1 %2<br />&nbsp; &nbsp; set /a MBI_Carry = 0<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a MBI_Digit = %1_%%i * %2 + MBI_Carry<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = MBI_Digit %% 10000<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a MBI_Carry = MBI_Digit / 10000<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; goto :EOF&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />:ArctanRecip<br />&nbsp; &nbsp; if defined PiDebug echo.ArctanRecip %1 %2<br />&nbsp; &nbsp; call :SetToInteger %1 1<br />&nbsp; &nbsp; call :DivideByInteger %1 %2<br />&nbsp; &nbsp; call :CopyValue AR_Recip %1<br />&nbsp; &nbsp; set /a AR_Toggle = -1&nbsp; &nbsp; <br />&nbsp; &nbsp; set /a AR_K = 3<br />&nbsp; &nbsp; :ArctanLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; if defined PiDebug (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.ArctanRecip&nbsp; AR_K=!AR_K!&nbsp; &nbsp; ---------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Recip %2<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Recip %2<br />&nbsp; &nbsp; &nbsp; &nbsp; call :CopyValue AR_Term AR_Recip<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Term !AR_K!<br />&nbsp; &nbsp; &nbsp; &nbsp; call :CopyValue AR_PrevSum %1<br />&nbsp; &nbsp; &nbsp; &nbsp; if !AR_Toggle! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Subtract %1 AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Add %1 AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; call :Compare AR_EqualFlag %1 AR_PrevSum<br />&nbsp; &nbsp; &nbsp; &nbsp; if !AR_EqualFlag! == true goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a AR_K += 2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a AR_Toggle *= -1<br />&nbsp; &nbsp; goto ArctanLoop<br />&nbsp; &nbsp; <br />:CopyValue<br />&nbsp; &nbsp; if defined PiDebug echo.CopyValue %1 %2<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = %2_%%i<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:Add <br />&nbsp; &nbsp; if defined PiDebug echo.Add %1 %2<br />&nbsp; &nbsp; if defined PiDebug call :Print %1<br />&nbsp; &nbsp; if defined PiDebug call :Print %2<br />&nbsp; &nbsp; set /a Add_Carry = 0<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Add_Digit = Add_Carry + %1_%%i + %2_%%i<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = Add_Digit %% 10000<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Add_Carry = Add_Digit / 10000<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; goto :EOF&nbsp; &nbsp; <br /><br />:Subtract <br />&nbsp; &nbsp; if defined PiDebug echo.Subtract %1 %2<br />&nbsp; &nbsp; if defined PiDebug call :Print %1<br />&nbsp; &nbsp; if defined PiDebug call :Print %2<br />&nbsp; &nbsp; set /a Subtract_Borrow = 0<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Subtract_Digit = %1_%%i - %2_%%i - Subtract_Borrow<br />&nbsp; &nbsp; &nbsp; &nbsp; if !Subtract_Digit! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a Subtract_Digit += 10000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a Subtract_Borrow = 1<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a Subtract_Borrow = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = Subtract_Digit<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; goto :EOF&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />:Compare<br />&nbsp; &nbsp; if defined PiDebug echo.Compare %1 %2 %3<br />&nbsp; &nbsp; if defined PiDebug call :Print %2<br />&nbsp; &nbsp; if defined PiDebug call :Print %3<br />&nbsp; &nbsp; set /a Compare_Index = 0<br />&nbsp; &nbsp; set %1=true<br />&nbsp; &nbsp; :CompareLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; if not !%2_%Compare_Index%! == !%3_%Compare_Index%! (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if defined PiDebug echo.!%2_%Compare_Index%! neq !%3_%Compare_Index%!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set %1=false<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Compare_Index += 1<br />&nbsp; &nbsp; &nbsp; &nbsp; if !Compare_Index! gtr !MaxQuadIndex! (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if defined PiDebug echo.Compare equal<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; goto CompareLoop&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />REM&nbsp; &nbsp; $Log: pi.bat,v $<br />REM&nbsp; &nbsp; Revision 1.2&nbsp; 2007/09/06 21:49:15&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Added time stamps and display of formula.<br />REM<br />REM&nbsp; &nbsp; Revision 1.1&nbsp; 2007/09/06 21:12:36&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Batch file for calculating pi<br />REM<br /></code></pre></div><br /><br />Here is the macro version:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>::pi_macro_version.bat<br />@echo off<br />if /i &quot;%~1&quot; equ &quot;load&quot; goto :Pi_Macros<br />setlocal DisableDelayedExpansion<br />if not defined Pi_Macros_Loaded call :Pi_Macros<br />setlocal EnableDelayedExpansion<br />if not &#91;%1&#93;==&#91;&#93; (set GNL=^&gt;nul) else (set GNL=)<br />echo.pi.bat&nbsp; -&nbsp; By Don Cross&nbsp; -&nbsp; http://cosinekitty.com%GNL%<br />echo.%GNL%<br />echo.%time% - started%GNL%<br />echo.%GNL%<br />set pidebug=<br />set /a NumQuads = 30<br />set /a MaxQuadIndex = NumQuads - 1<br /><br />call :PiEngine 48 18 32 57 -20 239 tempi<br />::call :PiEngine 16 5 -4 239 tempi<br />endlocal&amp;endlocal&amp;if not &#91;%1&#93;==&#91;&#93; call set &quot;%1=3%%%tempi%%%&quot;<br />exit /b 0<br /><br />:PiEngine<br />&nbsp; &nbsp; %SetToInteger% Pi 0 MaxQuadIndex<br />&nbsp; &nbsp; set Formula=<br />&nbsp; &nbsp; :PiTermLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; if &quot;%1&quot; == &quot;tempi&quot; (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Print pi %1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.%GNL%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.!time! - finished !Formula!%GNL%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.%GNL%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; call :ArctanRecip PiTerm %2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PiEngineFactor=%1<br />&nbsp; &nbsp; &nbsp; &nbsp; if !PiEngineFactor! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a PiEngineFactor *= -1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Formula=!Formula!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; %MultiplyByInteger% PiTerm !PiEngineFactor! MaxQuadIndex<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; %Subtract% Pi PiTerm MaxQuadIndex<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=-<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; %MultiplyByInteger% PiTerm %1 MaxQuadIndex<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; %Add% Pi PiTerm MaxQuadIndex<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=+<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; if defined Formula (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Formula=!Formula! !Operator! !PiEngineFactor!*arctan^(1/%2^)<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Formula=ã = %1*arctan^(1/%2^)<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; shift <br />&nbsp; &nbsp; &nbsp; &nbsp; shift<br />&nbsp; &nbsp; goto PiTermLoop<br />&nbsp; &nbsp; <br />:ArctanRecip<br />&nbsp; &nbsp; if defined PiDebug echo.ArctanRecip %1 %2<br />&nbsp; &nbsp; %SetToInteger% %1 1 MaxQuadIndex<br />&nbsp; &nbsp; %DivideByInteger% %1 %2 MaxQuadIndex<br />&nbsp; &nbsp; %CopyValue% AR_Recip %1 MaxQuadIndex<br />&nbsp; &nbsp; set /a AR_Toggle = -1&nbsp; &nbsp; <br />&nbsp; &nbsp; set /a AR_K = 3<br />&nbsp; &nbsp; :ArctanLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; if defined PiDebug (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.ArctanRecip&nbsp; AR_K=!AR_K!&nbsp; &nbsp; ---------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; %DivideByInteger% AR_Recip %2 MaxQuadIndex<br />&nbsp; &nbsp; &nbsp; &nbsp; %DivideByInteger% AR_Recip %2 MaxQuadIndex<br />&nbsp; &nbsp; &nbsp; &nbsp; %CopyValue% AR_Term AR_Recip MaxQuadIndex<br />&nbsp; &nbsp; &nbsp; &nbsp; %DivideByInteger% AR_Term !AR_K! MaxQuadIndex<br />&nbsp; &nbsp; &nbsp; &nbsp; %CopyValue% AR_PrevSum %1 MaxQuadIndex<br />&nbsp; &nbsp; &nbsp; &nbsp; if !AR_Toggle! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; %Subtract% %1 AR_Term MaxQuadIndex<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; %Add% %1 AR_Term MaxQuadIndex<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; call :Compare AR_EqualFlag %1 AR_PrevSum<br />&nbsp; &nbsp; &nbsp; &nbsp; if !AR_EqualFlag! == true goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a AR_K += 2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a AR_Toggle *= -1<br />&nbsp; &nbsp; goto ArctanLoop<br />&nbsp; &nbsp; <br />:Compare<br />&nbsp; &nbsp; if defined PiDebug echo.Compare %1 %2 %3<br />&nbsp; &nbsp; if defined PiDebug call :Print %2<br />&nbsp; &nbsp; if defined PiDebug call :Print %3<br />&nbsp; &nbsp; set /a Compare_Index = 0<br />&nbsp; &nbsp; set %1=true<br />&nbsp; &nbsp; :CompareLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; if not !%2_%Compare_Index%! == !%3_%Compare_Index%! (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if defined PiDebug echo.!%2_%Compare_Index%! neq !%3_%Compare_Index%!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set %1=false<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Compare_Index += 1<br />&nbsp; &nbsp; &nbsp; &nbsp; if !Compare_Index! gtr !MaxQuadIndex! (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if defined PiDebug echo.Compare equal<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; goto CompareLoop&nbsp; &nbsp; <br /><br />:Print<br />&nbsp; &nbsp; set PrintBuffer=x<br />&nbsp; &nbsp; REM&nbsp; Omit a couple of least significant quads, because they will have roundoff errors.<br />&nbsp; &nbsp; if defined PiDebug (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=0<br />&nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=2<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a PrintMaxQuadIndex = MaxQuadIndex - 1<br />&nbsp; &nbsp; for /L %%i in (!PrintMinQuadIndex!, 1, !PrintMaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=!%1_%%i!<br />&nbsp; &nbsp; &nbsp; &nbsp; if !PrintDigit! lss 1000 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !PrintDigit! lss 100 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !PrintDigit! lss 10 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=000!PrintDigit!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=00!PrintDigit!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=0!PrintDigit!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set PrintBuffer=!PrintDigit!!PrintBuffer!<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set PrintBuffer=!%1_%MaxQuadIndex%!.!PrintBuffer:x=!<br />&nbsp; &nbsp; echo.|(set /p=ã = )%GNL%&amp;echo.!PrintBuffer! %GNL%<br />&nbsp; &nbsp; set &quot;%2=!PrintBuffer!&quot;<br />&nbsp; &nbsp; goto :EOF<br /><br />REM&nbsp; &nbsp; $Log: pi.bat,v $<br />REM&nbsp; &nbsp; Revision 1.2&nbsp; 2007/09/06 21:49:15&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Added time stamps and display of formula.<br />REM<br />REM&nbsp; &nbsp; Revision 1.1&nbsp; 2007/09/06 21:12:36&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Batch file for calculating pi<br />REM<br /><br />:Pi_Macros<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Pi Macros<br />::<br />:: Define a Carriage Return string, only useable as !#CR!<br />for /f %%a in ('copy /Z &quot;%~dpf0&quot; nul') do set &quot;#CR=%%a&quot;<br /><br />:: Define a Line Feed (newline) string (normally only used as !#LF!)<br />set #LF=^<br /><br /><br />:: Above 2 blank lines are required - do not remove<br /><br />:: Define a newline with line continuation<br />set ^&quot;\n=^^^%#LF%%#LF%^%#LF%%#LF%^^&quot;<br /><br />:MultiplyByInteger<br />set MultiplyByInteger=for %%n in (1 2) do if %%n==2 (%\n%<br />&nbsp; for /F &quot;tokens=1,2,3 delims=, &quot; %%1 in (&quot;!args!&quot;) do (%\n%<br />&nbsp; &nbsp; set /a &quot;MBI_Carry = 0&quot;%\n%<br />&nbsp; &nbsp; for /L %%i in (0, 1, !%%~3!) do (%\n%<br />&nbsp; &nbsp; &nbsp; set /a &quot;MBI_Digit = %%~1_%%i * %%~2 + MBI_Carry&quot;%\n%<br />&nbsp; &nbsp; &nbsp; set /a &quot;%%~1_%%i = MBI_Digit %% 10000&quot;%\n%<br />&nbsp; &nbsp; &nbsp; set /a &quot;MBI_Carry = MBI_Digit / 10000&quot;%\n%<br />&nbsp; &nbsp; )%\n%<br />&nbsp; )%\n%<br />) else set args=,<br /><br />:Subtract %1 %2 MaxQuadIndex<br />set Subtract=for %%n in (1 2) do if %%n==2 (%\n%<br />&nbsp; for /F &quot;tokens=1,2,3 delims=, &quot; %%1 in (&quot;!args!&quot;) do (%\n%<br />&nbsp; &nbsp; set /a &quot;Subtract_Borrow = 0&quot;%\n%<br />&nbsp; &nbsp; for /L %%i in (0, 1, !%%~3!) do (%\n%<br />&nbsp; &nbsp; &nbsp; set /a &quot;Subtract_Digit = %%~1_%%i - %%~2_%%i - Subtract_Borrow&quot;%\n%<br />&nbsp; &nbsp; &nbsp; if !Subtract_Digit! lss 0 (%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;Subtract_Digit += 10000&quot;%\n%<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;Subtract_Borrow = 1&quot;%\n%<br />&nbsp; &nbsp; &nbsp; ) else set /a &quot;Subtract_Borrow = 0&quot;%\n%<br />&nbsp; &nbsp; &nbsp; set /a &quot;%%~1_%%i = Subtract_Digit&quot;%\n%<br />&nbsp; &nbsp; )%\n%<br />&nbsp; )%\n%<br />) else set args=,<br /><br />:Add&nbsp; %1 %2 MaxQuadIndex<br />set Add=for %%n in (1 2) do if %%n==2 (%\n%<br />&nbsp; for /F &quot;tokens=1,2,3 delims=, &quot; %%1 in (&quot;!args!&quot;) do (%\n%<br />&nbsp; &nbsp; set /a &quot;Add_Carry = 0&quot;%\n%<br />&nbsp; &nbsp; for /L %%i in (0, 1, !%%~3!) do (%\n%<br />&nbsp; &nbsp; &nbsp; set /a &quot;Add_Digit = Add_Carry + %%~1_%%i + %%~2_%%i&quot;%\n%<br />&nbsp; &nbsp; &nbsp; set /a &quot;%%~1_%%i = Add_Digit %% 10000&quot;%\n%<br />&nbsp; &nbsp; &nbsp; set /a &quot;Add_Carry = Add_Digit / 10000&quot;%\n%<br />&nbsp; &nbsp; )%\n%<br />&nbsp; )%\n%<br />) else set args=,<br /><br />:DivideByInteger %1 %2 MaxQuadIndex<br />set DivideByInteger=for %%n in (1 2) do if %%n==2 (%\n%<br />&nbsp; for /F &quot;tokens=1,2,3 delims=, &quot; %%1 in (&quot;!args!&quot;) do (%\n%<br />&nbsp; &nbsp; set /a &quot;DBI_Carry = 0&quot;%\n%<br />&nbsp; &nbsp; for /L %%i in (!%%~3!, -1, 0) do (%\n%<br />&nbsp; &nbsp; &nbsp; set /a &quot;DBI_Digit = DBI_Carry*10000 + %%~1_%%i&quot;%\n%<br />&nbsp; &nbsp; &nbsp; set /a &quot;DBI_Carry = DBI_Digit %% %%~2&quot;%\n%<br />&nbsp; &nbsp; &nbsp; set /a &quot;%%~1_%%i = DBI_Digit / %%~2&quot;%\n%<br />&nbsp; &nbsp; )%\n%<br />&nbsp; )%\n%<br />) else set args=,<br /><br />:SetToInteger %1 %2 MaxQuadIndex<br />set SetToInteger=for %%n in (1 2) do if %%n==2 (%\n%<br />&nbsp; for /F &quot;tokens=1,2,3 delims=, &quot; %%1 in (&quot;!args!&quot;) do (%\n%<br />&nbsp; &nbsp; for /L %%i in (0, 1, !%%~3!) do (%\n%<br />&nbsp; &nbsp; &nbsp; set /a &quot;%%~1_%%i = 0&quot;%\n%<br />&nbsp; &nbsp; )%\n%<br />&nbsp; &nbsp; set /a &quot;%%~1_!%%~3! = %%~2&quot;%\n%<br />&nbsp; )%\n%<br />) else set args=,<br /><br />:CopyValue&nbsp; %1 %2 MaxQuadIndex<br />set CopyValue=for %%n in (1 2) do if %%n==2 (%\n%<br />&nbsp; for /F &quot;tokens=1,2,3 delims=, &quot; %%1 in (&quot;!args!&quot;) do (%\n%<br />&nbsp; &nbsp; for /L %%i in (0, 1, !%%~3!) do (%\n%<br />&nbsp; &nbsp; &nbsp; set /a &quot;%%~1_%%i = %%~2_%%i&quot;%\n%<br />&nbsp; &nbsp; )%\n%<br />&nbsp; )%\n%<br />) else set args=,<br /><br />set/a Pi_Macros_Loaded=1<br /><br />exit/b 0<br /></code></pre></div><br /><br />I actually thought the macro version would be faster than it turned out and I am a bit surprised that preloading the macros didn't shave off much time on my pc.<br /><br />Carl</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p45440" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile45440">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searche2bd.html?author_id=3864&amp;sr=posts">762</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 15 Jun 2012 13:16</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Italy, Rome</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content45440">

						<h3 ><a href="#p45440">Re: Batch macro vs function call test</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingcf83.html?mode=quote&amp;f=3&amp;p=45440" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopica92c.html?p=45440#p45440" onclick="prompt('Message #2',this.href); return false;">#2</a></span> 
									<a class="unread" href="viewtopica92c.html?p=45440#p45440" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a></strong> &raquo; </span>24 Feb 2016 05:43
			</p>
			
			
			
			<div class="content">The major problem for achieve better performance is reduce the number of call/goto.<br />Then there is a possibility to empy the environment and use this in clever mode (variable position, naming).<br /><br />In the arctan function there is a while loop too (to implement).<br /><br />Einstein1969</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54208" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile54208">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searche2bd.html?author_id=3864&amp;sr=posts">762</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 15 Jun 2012 13:16</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Italy, Rome</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54208">

						<h3 ><a href="#p54208">Re: Batch macro vs function call test</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postinga34a.html?mode=quote&amp;f=3&amp;p=54208" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic28a2-2.html?p=54208#p54208" onclick="prompt('Message #3',this.href); return false;">#3</a></span> 
									<a class="unread" href="viewtopic28a2-2.html?p=54208#p54208" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a></strong> &raquo; </span>01 Oct 2017 08:59
			</p>
			
			
			
			<div class="content">I post the original code too (not modified):<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@if defined talk (echo on) else (echo off)<br />setlocal EnableDelayedExpansion<br />echo.pi.bat&nbsp; -&nbsp; By Don Cross&nbsp; -&nbsp; http://cosinekitty.com<br />set /a NumQuads = 30<br />set /a MaxQuadIndex = NumQuads - 1<br /><br />echo.<br />echo.%time% - started<br />echo.<br /><br />call :PiEngine 48 18 32 57 -20 239<br />call :PiEngine 16 5 -4 239<br />goto :EOF<br /><br />:PiEngine<br />&nbsp; &nbsp; call :SetToInteger Pi 0<br />&nbsp; &nbsp; set Formula=<br />&nbsp; &nbsp; :PiTermLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; if &quot;%1&quot; == &quot;&quot; (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Print pi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.!time! - finished !Formula!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; call :ArctanRecip PiTerm %2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PiEngineFactor=%1<br />&nbsp; &nbsp; &nbsp; &nbsp; if !PiEngineFactor! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a PiEngineFactor *= -1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Formula=!Formula!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :MultiplyByInteger PiTerm !PiEngineFactor!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Subtract Pi PiTerm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=-<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :MultiplyByInteger PiTerm %1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Add Pi PiTerm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=+<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; if defined Formula (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Formula=!Formula! !Operator! !PiEngineFactor!*arctan^(1/%2^)<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Formula=pi = %1*arctan^(1/%2^)<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; shift <br />&nbsp; &nbsp; &nbsp; &nbsp; shift<br />&nbsp; &nbsp; goto PiTermLoop<br />&nbsp; &nbsp; <br />:SetToInteger<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = 0<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a %1_!MaxQuadIndex! = %2<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:Print<br />&nbsp; &nbsp; set PrintBuffer=x<br />&nbsp; &nbsp; REM&nbsp; Omit a couple of least significant quads, because they will have roundoff errors.<br />&nbsp; &nbsp; if defined PiDebug (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=0<br />&nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=2<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a PrintMaxQuadIndex = MaxQuadIndex - 1<br />&nbsp; &nbsp; for /L %%i in (!PrintMinQuadIndex!, 1, !PrintMaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=!%1_%%i!<br />&nbsp; &nbsp; &nbsp; &nbsp; if !PrintDigit! lss 1000 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !PrintDigit! lss 100 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !PrintDigit! lss 10 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=000!PrintDigit!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=00!PrintDigit!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=0!PrintDigit!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set PrintBuffer=!PrintDigit!!PrintBuffer!<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set PrintBuffer=!%1_%MaxQuadIndex%!.!PrintBuffer:x=!<br />&nbsp; &nbsp; echo.%1 = !PrintBuffer!<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:DivideByInteger<br />&nbsp; &nbsp; if defined PiDebug echo.DivideByInteger %1 %2<br />&nbsp; &nbsp; set /a DBI_Carry = 0<br />&nbsp; &nbsp; for /L %%i in (!MaxQuadIndex!, -1, 0) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a DBI_Digit = DBI_Carry*10000 + %1_%%i<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a DBI_Carry = DBI_Digit %% %2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = DBI_Digit / %2<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:MultiplyByInteger<br />&nbsp; &nbsp; if defined PiDebug echo.MultiplyByInteger %1 %2<br />&nbsp; &nbsp; set /a MBI_Carry = 0<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a MBI_Digit = %1_%%i * %2 + MBI_Carry<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = MBI_Digit %% 10000<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a MBI_Carry = MBI_Digit / 10000<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; goto :EOF&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />:ArctanRecip<br />&nbsp; &nbsp; if defined PiDebug echo.ArctanRecip %1 %2<br />&nbsp; &nbsp; call :SetToInteger %1 1<br />&nbsp; &nbsp; call :DivideByInteger %1 %2<br />&nbsp; &nbsp; call :CopyValue AR_Recip %1<br />&nbsp; &nbsp; set /a AR_Toggle = -1&nbsp; &nbsp; <br />&nbsp; &nbsp; set /a AR_K = 3<br />&nbsp; &nbsp; :ArctanLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; if defined PiDebug (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.ArctanRecip&nbsp; AR_K=!AR_K!&nbsp; &nbsp; ---------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Recip %2<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Recip %2<br />&nbsp; &nbsp; &nbsp; &nbsp; call :CopyValue AR_Term AR_Recip<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Term !AR_K!<br />&nbsp; &nbsp; &nbsp; &nbsp; call :CopyValue AR_PrevSum %1<br />&nbsp; &nbsp; &nbsp; &nbsp; if !AR_Toggle! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Subtract %1 AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Add %1 AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; call :Compare AR_EqualFlag %1 AR_PrevSum<br />&nbsp; &nbsp; &nbsp; &nbsp; if !AR_EqualFlag! == true goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a AR_K += 2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a AR_Toggle *= -1<br />&nbsp; &nbsp; goto ArctanLoop<br />&nbsp; &nbsp; <br />:CopyValue<br />&nbsp; &nbsp; if defined PiDebug echo.CopyValue %1 %2<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = %2_%%i<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:Add <br />&nbsp; &nbsp; if defined PiDebug echo.Add %1 %2<br />&nbsp; &nbsp; if defined PiDebug call :Print %1<br />&nbsp; &nbsp; if defined PiDebug call :Print %2<br />&nbsp; &nbsp; set /a Add_Carry = 0<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Add_Digit = Add_Carry + %1_%%i + %2_%%i<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = Add_Digit %% 10000<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Add_Carry = Add_Digit / 10000<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; goto :EOF&nbsp; &nbsp; <br /><br />:Subtract <br />&nbsp; &nbsp; if defined PiDebug echo.Subtract %1 %2<br />&nbsp; &nbsp; if defined PiDebug call :Print %1<br />&nbsp; &nbsp; if defined PiDebug call :Print %2<br />&nbsp; &nbsp; set /a Subtract_Borrow = 0<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Subtract_Digit = %1_%%i - %2_%%i - Subtract_Borrow<br />&nbsp; &nbsp; &nbsp; &nbsp; if !Subtract_Digit! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a Subtract_Digit += 10000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a Subtract_Borrow = 1<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a Subtract_Borrow = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = Subtract_Digit<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; goto :EOF&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />:Compare<br />&nbsp; &nbsp; if defined PiDebug echo.Compare %1 %2 %3<br />&nbsp; &nbsp; if defined PiDebug call :Print %2<br />&nbsp; &nbsp; if defined PiDebug call :Print %3<br />&nbsp; &nbsp; set /a Compare_Index = 0<br />&nbsp; &nbsp; set %1=true<br />&nbsp; &nbsp; :CompareLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; if not !%2_%Compare_Index%! == !%3_%Compare_Index%! (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if defined PiDebug echo.!%2_%Compare_Index%! neq !%3_%Compare_Index%!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set %1=false<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Compare_Index += 1<br />&nbsp; &nbsp; &nbsp; &nbsp; if !Compare_Index! gtr !MaxQuadIndex! (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if defined PiDebug echo.Compare equal<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; goto CompareLoop&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />REM&nbsp; &nbsp; $Log: pi.bat,v $<br />REM&nbsp; &nbsp; Revision 1.2&nbsp; 2007/09/06 21:49:15&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Added time stamps and display of formula.<br />REM<br />REM&nbsp; &nbsp; Revision 1.1&nbsp; 2007/09/06 21:12:36&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Batch file for calculating pi<br />REM<br /></code></pre></div><br /><br /><br />edit :correct number of quad to 30<br /><br />einstein1969</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54289" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile54289">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searche2bd.html?author_id=3864&amp;sr=posts">762</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 15 Jun 2012 13:16</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Italy, Rome</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54289">

						<h3 ><a href="#p54289">Re: Batch macro vs function call test</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingcd99.html?mode=quote&amp;f=3&amp;p=54289" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic01c5.html?p=54289#p54289" onclick="prompt('Message #4',this.href); return false;">#4</a></span> 
									<a class="unread" href="viewtopic01c5.html?p=54289#p54289" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a></strong> &raquo; </span>07 Oct 2017 07:35
			</p>
			
			
			
			<div class="content">I have done some test.<br /><br />I have changed the original pi with input the NUMQUADS parameter.<br /><br />Then I have tested at 15,30,45,60,75 NUMQUADS.<br /><br />The time is show in this table:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Quads | Time<br />---------------<br />15&nbsp; &nbsp; &nbsp; &nbsp; 3 sec.&nbsp; &nbsp;||| <br />30&nbsp; &nbsp; &nbsp;&nbsp; &nbsp;8 sec.&nbsp; &nbsp;|||||||| <br />45&nbsp; &nbsp; &nbsp; &nbsp;18 sec.&nbsp; &nbsp;||||||||||||||||||<br />60&nbsp; &nbsp; &nbsp; &nbsp;34 sec.&nbsp; &nbsp;||||||||||||||||||||||||||||||||||<br />75&nbsp; &nbsp; &nbsp; &nbsp;56 sec.&nbsp; &nbsp;||||||||||||||||||||||||||||||||||||||||||||||||||||||||<br /></code></pre></div><br /><br />The time is not linear!<br /><br />The time with the macro version at 75 NUMQUADS is 53 sec. <br /><br />I thinks that the problem is the SET /A with a large environment. <br /><br />What do you think?<br /><br />einstein1969</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54291" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile54291">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54291">

						<h3 ><a href="#p54291">Re: Batch macro vs function call test</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postinga523.html?mode=quote&amp;f=3&amp;p=54291" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicd9c2.html?p=54291#p54291" onclick="prompt('Message #5',this.href); return false;">#5</a></span> 
									<a class="unread" href="viewtopicd9c2.html?p=54291#p54291" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>07 Oct 2017 08:10
			</p>
			
			
			
			<div class="content"><!-- l --><a class="postlink-local" href="viewtopice0d8.html?f=3&amp;t=2597">viewtopic.php?f=3&amp;t=2597</a><!-- l --><br /><br />Antonio</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54292" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile54292">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searche2bd.html?author_id=3864&amp;sr=posts">762</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 15 Jun 2012 13:16</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Italy, Rome</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54292">

						<h3 ><a href="#p54292">Re: Batch macro vs function call test</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting992e.html?mode=quote&amp;f=3&amp;p=54292" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic9784.html?p=54292#p54292" onclick="prompt('Message #6',this.href); return false;">#6</a></span> 
									<a class="unread" href="viewtopic9784.html?p=54292#p54292" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a></strong> &raquo; </span>07 Oct 2017 08:45
			</p>
			
			
			
			<div class="content">Thanks for the link.<br /><br />What is the best method for optimize this? <br /><br />I have profiled for 30 Numquads and the results are this:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>C:\Users\ACER\Desktop&gt;pi.bat 30<br />pi.bat&nbsp; -&nbsp; By Don Cross&nbsp; -&nbsp; http://cosinekitty.com<br /><br />NumQuads=30<br /><br /><br />16:38:44,18 - started<br /><br />pi = 3.141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086<br /><br />16:38:54,15 - finished pi = 48*arctan(1/18) + 32*arctan(1/57) - 20*arctan(1/239)<br /><br />SetToInteger=4<br />DivideByInteger=309<br />MultiplyByInteger=3<br />ArctanRecip=99<br />CopyValue=207<br />Add=52<br />Subtract=53<br />Compare=87<br /><br />pi = 3.141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086<br /><br />16:39:05,03 - finished pi = 16*arctan(1/5) - 4*arctan(1/239)<br /><br />SetToInteger=3<br />DivideByInteger=317<br />MultiplyByInteger=2<br />ArctanRecip=103<br />CopyValue=212<br />Add=53<br />Subtract=54<br />Compare=107<br /></code></pre></div><br /><br /><br />this is the code:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@if defined talk (echo on) else (echo off)<br />setlocal EnableDelayedExpansion<br />echo.pi.bat&nbsp; -&nbsp; By Don Cross&nbsp; -&nbsp; http://cosinekitty.com<br /><br />rem Add input parameter NumQuads<br /><br />if &quot;%~1&quot; == &quot;&quot; (set /a NumQuads = 30) else (set /a NumQuads=%~1)<br />if !NumQuads! EQU 0&nbsp; set /a NumQuads = 30<br />echo.<br />echo.NumQuads=!NumQuads!<br />echo.<br />set /a MaxQuadIndex = NumQuads - 1<br /><br />pushd %tmp%<br /><br />echo.<br />echo.%time% - started<br />echo.<br /><br />call :PiEngine 48 18 32 57 -20 239<br />call :PiEngine 16 5 -4 239<br /><br />popd<br /><br />goto :EOF<br /><br />:PiEngine<br />&nbsp; &nbsp; call :SetToInteger Pi 0<br />&nbsp; &nbsp; set Formula=<br />&nbsp; &nbsp; :PiTermLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; if &quot;%1&quot; == &quot;&quot; (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Print pi<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.!time! - finished !Formula!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo SetToInteger=!SetToInteger!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo DivideByInteger=!DivideByInteger!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo MultiplyByInteger=!MultiplyByInteger!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo ArctanRecip=!ArctanRecip!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo CopyValue=!CopyValue!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo Add=!Add!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo Subtract=!Subtract!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo Compare=!Compare!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a SetToInteger=0, DivideByInteger=0, MultiplyByInteger=0, ArctanRecip=0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a CopyValue=0, Add=0, Subtract=0, Compare=0<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; call :ArctanRecip PiTerm %2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PiEngineFactor=%1<br />&nbsp; &nbsp; &nbsp; &nbsp; if !PiEngineFactor! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a PiEngineFactor *= -1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Formula=!Formula!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :MultiplyByInteger PiTerm !PiEngineFactor!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Subtract Pi PiTerm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=-<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :MultiplyByInteger PiTerm %1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Add Pi PiTerm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=+<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; if defined Formula (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Formula=!Formula! !Operator! !PiEngineFactor!*arctan^(1/%2^)<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Formula=pi = %1*arctan^(1/%2^)<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; shift <br />&nbsp; &nbsp; &nbsp; &nbsp; shift<br />&nbsp; &nbsp; goto PiTermLoop<br />&nbsp; &nbsp; <br />:SetToInteger<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = 0<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a %1_!MaxQuadIndex! = %2<br />&nbsp; &nbsp; set /a SetToInteger+=1<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:Print<br />&nbsp; &nbsp; set PrintBuffer=x<br />&nbsp; &nbsp; REM&nbsp; Omit a couple of least significant quads, because they will have roundoff errors.<br />&nbsp; &nbsp; if defined PiDebug (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=0<br />&nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=2<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a PrintMaxQuadIndex = MaxQuadIndex - 1<br />&nbsp; &nbsp; for /L %%i in (!PrintMinQuadIndex!, 1, !PrintMaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=!%1_%%i!<br />&nbsp; &nbsp; &nbsp; &nbsp; if !PrintDigit! lss 1000 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !PrintDigit! lss 100 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !PrintDigit! lss 10 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=000!PrintDigit!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=00!PrintDigit!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set PrintDigit=0!PrintDigit!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set PrintBuffer=!PrintDigit!!PrintBuffer!<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set PrintBuffer=!%1_%MaxQuadIndex%!.!PrintBuffer:x=!<br />&nbsp; &nbsp; echo.%1 = !PrintBuffer!<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:DivideByInteger<br />&nbsp; &nbsp; if defined PiDebug echo.DivideByInteger %1 %2<br />&nbsp; &nbsp; set /a DBI_Carry = 0<br />&nbsp; &nbsp; for /L %%i in (!MaxQuadIndex!, -1, 0) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a DBI_Digit = DBI_Carry*10000 + %1_%%i<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a DBI_Carry = DBI_Digit %% %2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = DBI_Digit / %2<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a DivideByInteger+=1<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:MultiplyByInteger<br />&nbsp; &nbsp; if defined PiDebug echo.MultiplyByInteger %1 %2<br />&nbsp; &nbsp; set /a MBI_Carry = 0<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a MBI_Digit = %1_%%i * %2 + MBI_Carry<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = MBI_Digit %% 10000<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a MBI_Carry = MBI_Digit / 10000<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a MultiplyByInteger+=1<br />&nbsp; &nbsp; goto :EOF&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />:ArctanRecip<br />&nbsp; &nbsp; if defined PiDebug echo.ArctanRecip %1 %2<br />&nbsp; &nbsp; call :SetToInteger %1 1<br />&nbsp; &nbsp; call :DivideByInteger %1 %2<br />&nbsp; &nbsp; call :CopyValue AR_Recip %1<br />&nbsp; &nbsp; set /a AR_Toggle = -1&nbsp; &nbsp; <br />&nbsp; &nbsp; set /a AR_K = 3<br />&nbsp; &nbsp; :ArctanLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; if defined PiDebug (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.ArctanRecip&nbsp; AR_K=!AR_K!&nbsp; &nbsp; ---------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Recip %2<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Recip %2<br />&nbsp; &nbsp; &nbsp; &nbsp; call :CopyValue AR_Term AR_Recip<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Term !AR_K!<br />&nbsp; &nbsp; &nbsp; &nbsp; call :CopyValue AR_PrevSum %1<br />&nbsp; &nbsp; &nbsp; &nbsp; if !AR_Toggle! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Subtract %1 AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Add %1 AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; call :Compare AR_EqualFlag %1 AR_PrevSum<br />&nbsp; &nbsp; &nbsp; &nbsp; if !AR_EqualFlag! == true goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a AR_K += 2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a AR_Toggle *= -1<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a ArctanRecip+=1<br />&nbsp; &nbsp; goto ArctanLoop<br />&nbsp; &nbsp; <br />:CopyValue<br />&nbsp; &nbsp; if defined PiDebug echo.CopyValue %1 %2<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = %2_%%i<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a CopyValue+=1<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:Add <br />&nbsp; &nbsp; if defined PiDebug echo.Add %1 %2<br />&nbsp; &nbsp; if defined PiDebug call :Print %1<br />&nbsp; &nbsp; if defined PiDebug call :Print %2<br />&nbsp; &nbsp; set /a Add_Carry = 0<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Add_Digit = Add_Carry + %1_%%i + %2_%%i<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = Add_Digit %% 10000<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Add_Carry = Add_Digit / 10000<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a Add+=1<br />&nbsp; &nbsp; goto :EOF&nbsp; &nbsp; <br /><br />:Subtract <br />&nbsp; &nbsp; if defined PiDebug echo.Subtract %1 %2<br />&nbsp; &nbsp; if defined PiDebug call :Print %1<br />&nbsp; &nbsp; if defined PiDebug call :Print %2<br />&nbsp; &nbsp; set /a Subtract_Borrow = 0<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Subtract_Digit = %1_%%i - %2_%%i - Subtract_Borrow<br />&nbsp; &nbsp; &nbsp; &nbsp; if !Subtract_Digit! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a Subtract_Digit += 10000<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a Subtract_Borrow = 1<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a Subtract_Borrow = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = Subtract_Digit<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a Subtract+=1<br />&nbsp; &nbsp; goto :EOF&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />:Compare<br />&nbsp; &nbsp; if defined PiDebug echo.Compare %1 %2 %3<br />&nbsp; &nbsp; if defined PiDebug call :Print %2<br />&nbsp; &nbsp; if defined PiDebug call :Print %3<br />&nbsp; &nbsp; set /a Compare_Index = 0<br />&nbsp; &nbsp; set %1=true<br />&nbsp; &nbsp; :CompareLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; if not !%2_%Compare_Index%! == !%3_%Compare_Index%! (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if defined PiDebug echo.!%2_%Compare_Index%! neq !%3_%Compare_Index%!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set %1=false<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Compare_Index += 1<br />&nbsp; &nbsp; &nbsp; &nbsp; if !Compare_Index! gtr !MaxQuadIndex! (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if defined PiDebug echo.Compare equal<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a Compare+=1<br />&nbsp; &nbsp; goto CompareLoop&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />REM&nbsp; &nbsp; $Log: pi.bat,v $<br />REM&nbsp; &nbsp; Revision 1.2&nbsp; 2007/09/06 21:49:15&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Added time stamps and display of formula.<br />REM<br />REM&nbsp; &nbsp; Revision 1.1&nbsp; 2007/09/06 21:12:36&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Batch file for calculating pi<br />REM<br /></code></pre></div><br />einstein1969</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54310" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile54310">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54310">

						<h3 ><a href="#p54310">Re: Batch macro vs function call test</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting19a1.html?mode=quote&amp;f=3&amp;p=54310" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic77bc.html?p=54310#p54310" onclick="prompt('Message #7',this.href); return false;">#7</a></span> 
									<a class="unread" href="viewtopic77bc.html?p=54310#p54310" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>08 Oct 2017 17:01
			</p>
			
			
			
			<div class="content">I completed several different modifications to <em class="text-italics">the original code</em> in this topic. After each modification was done a certain amount of running time was decreased, so after all modifications were combined, the final code decreased the original running time in 55%. This is a summary of the modifications:<br /><br /><ul><li> Several small modifications that simplify the code and increase the efficiency, like the method used to insert up to 3 leading zeros to a value in : Print routine:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; &nbsp; &nbsp; set /A PrintDigit=10000 + %1_%%i<br /></code></pre></div><br />... instead of the 3 nested IF commands; just use <strong class="text-strong">set &quot;PrintBuffer=!PrintDigit:~1!!PrintBuffer!&quot;</strong> to insert the digit.<br /></li><li> The equivalent result of all FOR iterative routines were expanded, each one into a long arithmetic expression that is stored in a (macro) variable, so each original CALL command (and the execution of the subroutine with a FOR command) was replaced by a SET /A command. The only exception was :Compare routine that was preserved as a loop, but it was simplified and modified to make it more efficient (via a FOR instead of GOTO) and embedded into the calling code in order to avoid the CALL.<br /></li><li> This procedure:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; :ArctanLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Recip %2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AR_Recip&nbsp; /= %2<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Recip %2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AR_Recip&nbsp; /= %2<br />&nbsp; &nbsp; &nbsp; &nbsp; call :CopyValue AR_Term AR_Recip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AR_Term&nbsp; &nbsp; = AR_Recip<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Term !AR_K!&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AR_Term&nbsp; &nbsp;/= AR_K<br />&nbsp; &nbsp; &nbsp; &nbsp; call :CopyValue AR_PrevSum PiTerm&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AR_PrevSum = PiTerm<br />&nbsp; &nbsp; &nbsp; &nbsp; if !AR_Toggle! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Subtract PiTerm AR_Term&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PiTerm -= AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Add PiTerm AR_Term&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PiTerm += AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a AR_K += 2,&nbsp; AR_Toggle *= -1<br />&nbsp; &nbsp; &nbsp; &nbsp; call :Compare AR_EqualFlag PiTerm AR_PrevSum&nbsp; &nbsp; IF PiTerm neq AR_PrevSum<br />&nbsp; &nbsp; if !AR_EqualFlag! neq true goto ArctanLoop&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto ArctanLoop<br /></code></pre></div><br />... was replaced by this simpler one:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>&nbsp; &nbsp; :ArctanLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Recip %2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AR_Recip&nbsp; /= %2<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Recip %2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;AR_Recip&nbsp; /= %2<br />&nbsp; &nbsp; &nbsp; &nbsp; call :CopyValue AR_Term AR_Recip&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AR_Term&nbsp; &nbsp; = AR_Recip<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Term !AR_K!&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AR_Term&nbsp; &nbsp;/= AR_K<br />&nbsp; &nbsp; &nbsp; &nbsp; call :IsZero AR_IsZeroFlag AR_Term&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; IF AR_Term equ 0<br />&nbsp; &nbsp; &nbsp; &nbsp; if !AR_IsZeroFlag! equ true exit /B&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;exit /B<br />&nbsp; &nbsp; &nbsp; &nbsp; if !AR_Toggle! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Subtract PiTerm AR_Term&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;PiTerm -= AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Add PiTerm AR_Term&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PiTerm += AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a AR_K += 2,&nbsp; AR_Toggle *= -1<br />&nbsp; &nbsp; goto ArctanLoop&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;goto ArctanLoop<br /></code></pre></div><br />This modification not only eliminates the <strong class="text-strong">call :CopyValue AR_PrevSum PiTerm</strong> command, but also eliminates the last Add/Subtract operation in the loop and <em class="text-italics">one array variable</em> from the environment, that is, a NumQuads number of variables with values with up to four digits each.<br /></li><li> The environment was emptied before the process start.</li></ul><br /><br />This is the new code:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@if defined talk (echo on) else (echo off)<br />setlocal EnableDelayedExpansion<br />echo pi.bat&nbsp; -&nbsp; By Don Cross&nbsp; -&nbsp; http://cosinekitty.com<br /><br />REM Empty the environment<br />for /F &quot;delims==&quot; %%v in ('set') do set &quot;%%v=&quot;<br /><br />set /a NumQuads = 30<br />set /a MaxQuadIndex = NumQuads - 1<br /><br />call :CreateMacros<br />echo %time% - started<br />echo/<br /><br />call :PiEngine 48 18 32 57 -20 239<br />call :PiEngine 16 5 -4 239<br />goto :EOF<br /><br />:PiEngine<br />&nbsp; &nbsp; set /A &quot;%SetToInteger:var=Pi%=0&quot;<br />&nbsp; &nbsp; set &quot;Formula=&quot;<br />&nbsp; &nbsp; :PiTermLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; call :ArctanRecip PiTerm %2<br />&nbsp; &nbsp; &nbsp; &nbsp; if %1 lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;N=-%1,%MultiplyByInteger:var=PiTerm%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%Subtract_Pi:v2=PiTerm%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=-<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;N=%1,%MultiplyByInteger:var=PiTerm%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%Add_Pi:v2=PiTerm%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=+<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined Formula (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;Formula=pi = %1*arctan(1/%2)&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;Formula=%Formula% %Operator% %N%*arctan(1/%2)&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; shift <br />&nbsp; &nbsp; &nbsp; &nbsp; shift<br />&nbsp; &nbsp; if &quot;%1&quot; neq &quot;&quot; goto PiTermLoop<br />&nbsp; &nbsp; call :Print Pi<br />&nbsp; &nbsp; echo %time% - finished %Formula%<br />exit /B<br /><br /><br />:Print<br />&nbsp; &nbsp; set &quot;PrintBuffer=&quot;<br />&nbsp; &nbsp; REM&nbsp; Omit a couple of least significant quads, because they will have roundoff errors.<br />&nbsp; &nbsp; if defined PiDebug (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=0<br />&nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=2<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a PrintMaxQuadIndex = MaxQuadIndex - 1<br />&nbsp; &nbsp; for /L %%i in (%PrintMinQuadIndex%, 1, %PrintMaxQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A PrintDigit=10000 + %1%%i<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;PrintBuffer=!PrintDigit:~1!!PrintBuffer!&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set PrintBuffer=!%1%MaxQuadIndex%!.%PrintBuffer%<br />&nbsp; &nbsp; echo %1 = %PrintBuffer%<br />&nbsp; &nbsp; echo/<br />exit /B<br /><br /><br />:ArctanRecip&nbsp; &nbsp;%1 = PiTerm *always*<br />&nbsp; &nbsp; set /A &quot;%SetToInteger:var=PiTerm%=1&quot;<br />&nbsp; &nbsp; set /A &quot;N=%2,%DivideByInteger:var=PiTerm%&quot;<br />&nbsp; &nbsp; set /A &quot;%CopyValue_AR_Recip:v2=PiTerm%&quot;<br />&nbsp; &nbsp; set /a AR_Toggle = -1,&nbsp; AR_K = 3<br />&nbsp; &nbsp; :ArctanLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;N=%2,%DivideByInteger:var=AR_Recip%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;N=%2,%DivideByInteger:var=AR_Recip%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%CopyValue_AR_Term:v2=AR_Recip%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;N=AR_K,%DivideByInteger:var=AR_Term%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; REM call :IsZero AR_IsZeroFlag AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; for /L %%i in (0, 1, %MaxQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !AR_Term%%i! neq 0 goto :Accum_AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; exit /B<br />&nbsp; &nbsp; &nbsp; &nbsp; :Accum_AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; if !AR_Toggle! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%Subtract_PiTerm:v2=AR_Term%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%Add_PiTerm:v2=AR_Term%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a AR_K += 2, AR_Toggle *= -1<br />&nbsp; &nbsp; goto ArctanLoop<br /><br /><br />REM&nbsp; &nbsp; $Log: pi.bat,v $<br />REM&nbsp; &nbsp; Revision 1.2&nbsp; 2007/09/06 21:49:15&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Added time stamps and display of formula.<br />REM<br />REM&nbsp; &nbsp; Revision 1.1&nbsp; 2007/09/06 21:12:36&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Batch file for calculating pi<br />REM<br /><br /><br />:CreateMacros<br /><br />&nbsp; &nbsp; set &quot;SetToInteger=&quot;<br />&nbsp; &nbsp; for /L %%i in (0, 1, %MaxQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;SetToInteger=!SetToInteger!var%%i=&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;SetToInteger=%SetToInteger%0,var%MaxQuadIndex%&quot;<br /><br />&nbsp; &nbsp; set &quot;MultiplyByInteger=F=10000,C=0&quot;<br />&nbsp; &nbsp; for /L %%i in (0, 1, %MaxQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;MultiplyByInteger=!MultiplyByInteger!,D=C+var%%i*N,var%%i=D%%F,C=D/F&quot;<br />&nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; set &quot;DivideByInteger=F=10000,C=0&quot;<br />&nbsp; &nbsp; for /L %%i in (%MaxQuadIndex%, -1, 0) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;DivideByInteger=!DivideByInteger!,D=C*F+var%%i,C=D%%N,var%%i=D/N&quot;<br />&nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; set &quot;CopyValue=v10=v20&quot;<br />&nbsp; &nbsp; for /L %%i in (1, 1, %MaxQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;CopyValue=!CopyValue!,v1%%i=v2%%i&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;CopyValue_AR_Recip=%CopyValue:v1=AR_Recip%&quot;<br />&nbsp; &nbsp; set &quot;CopyValue_AR_Term=%CopyValue:v1=AR_Term%&quot;<br />&nbsp; &nbsp; set &quot;CopyValue=&quot;<br /><br />&nbsp; &nbsp; set &quot;Add=F=10000,C=0&quot;<br />&nbsp; &nbsp; for /L %%i in (0, 1, %MaxQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;Add=!Add!,D=C+v1%%i+v2%%i,v1%%i=D%%F,C=D/F&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;Add_Pi=%Add:v1=Pi%&quot;<br />&nbsp; &nbsp; set &quot;Add_PiTerm=%Add:v1=PiTerm%&quot;<br />&nbsp; &nbsp; set &quot;Add=&quot;<br /><br />&nbsp; &nbsp; set &quot;Subtract=F=10000,B=0&quot;<br />&nbsp; &nbsp; for /L %%i in (0, 1, %MaxQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;Subtract=!Subtract!,D=v1%%i-v2%%i+B,B=D&gt;&gt;31,v1%%i=D-B*F&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;Subtract_Pi=%Subtract:v1=Pi%&quot;<br />&nbsp; &nbsp; set &quot;Subtract_PiTerm=%Subtract:v1=PiTerm%&quot;<br />&nbsp; &nbsp; set &quot;Subtract=&quot;<br /><br />exit /B<br /></code></pre></div><br />In my (old and cheap) computer the original program takes 38.16 seconds:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>pi.bat&nbsp; -&nbsp; By Don Cross&nbsp; -&nbsp; http://cosinekitty.com<br />15:37:47.18 - started<br /><br />pi = 3.141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086<br /><br />15:38:05.86 - finished pi = 48*arctan(1/18) + 32*arctan(1/57) - 20*arctan(1/239)<br /><br />pi = 3.141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086<br /><br />15:38:25.34 - finished pi = 16*arctan(1/5) - 4*arctan(1/239)<br /></code></pre></div><br />... but the modified code takes just 17.33 seconds:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>pi.bat&nbsp; -&nbsp; By Don Cross&nbsp; -&nbsp; http://cosinekitty.com<br />15:41:29.65 - started<br /><br />Pi = 3.141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086<br /><br />15:41:38.14 - finished pi = 48*arctan(1/18) + 32*arctan(1/57) - 20*arctan(1/239)<br /><br />Pi = 3.141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117067982148086<br /><br />15:41:46.98 - finished pi = 16*arctan(1/5) - 4*arctan(1/239)<br /></code></pre></div><br />This means that the modified code requires just the 45% of the original running time (or decreases the original time in 55%).<br /><br />I completed several tests with the modified code varying the number of quads in the arrays; this is the result:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Quads&nbsp; &nbsp; &nbsp; &nbsp; Digits&nbsp; &nbsp;Time in seconds<br /><br />30&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;110&nbsp; &nbsp; &nbsp; 17.25<br />45 (1.5)&nbsp; &nbsp; &nbsp;170&nbsp; &nbsp; &nbsp; 52.54&nbsp; (3.05)<br />60 (2.0)&nbsp; &nbsp; &nbsp;230&nbsp; &nbsp; &nbsp; 118.75 (6.88)<br />75 (2.5)&nbsp; &nbsp; &nbsp;290&nbsp; &nbsp; &nbsp; 224.42 (13.01)<br />90 (3.0)&nbsp; &nbsp; &nbsp;350&nbsp; &nbsp; &nbsp; 380.84 (22.08)<br /></code></pre></div><br />The non-linear increment of the running time vs. the number of quads is the expected one as described <a href="viewtopice0d8.html?f=3&amp;t=2597" class="postlink">elsewhere</a>.<br /><br />A drawback that this code have is that the maximum number of quads that can be managed is limited by the 8191 characters that the expanded macro expression over all the array elements may have, so this number mainly depends on the length of the names used for the arrays.<br /><br />The next step is modify the name of the array variables in a way that all of them have just one character, select the letter used for each array so the most frequently modified variables be towards the bottom of the environment, and pre-allocate enough environment space as described in my posts at <a href="viewtopice0d8.html?f=3&amp;t=2597" class="postlink">this topic</a>. I am pretty sure that these modifications may gain another (perhaps not so) small percentage of the running time that should be larger as the number of quads increase. As comparison, the &quot;Empty Environment&quot; modification <em class="text-italics">alone</em> caused to gain 13% in the running time!<br /><br />Antonio</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54335" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile54335">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searche2bd.html?author_id=3864&amp;sr=posts">762</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 15 Jun 2012 13:16</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Italy, Rome</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54335">

						<h3 ><a href="#p54335">Re: Batch macro vs function call test</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postinga1c6.html?mode=quote&amp;f=3&amp;p=54335" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic1e2f.html?p=54335#p54335" onclick="prompt('Message #8',this.href); return false;">#8</a></span> 
									<a class="unread" href="viewtopic1e2f.html?p=54335#p54335" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a></strong> &raquo; </span>10 Oct 2017 09:02
			</p>
			
			
			
			<div class="content"><img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" /> <br /><br />very clever solution for minimize number of SET istruction.<br /><br />The limit on 8192 is in also the variable PRINTBUFFER. It is possible eliminate this problem on variable PRINTBUFFER?<br /><br />I'm working on a version that eliminate the use of variable. It use some files but is very slow at moment but the time is better for big NUMQUADS.<br /><br />I thinks that is possible use both solutions for a ideal faster solution.<br /><br />for example:<br />the code for subroutine DIVIDEBYINTEGER is like this<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:DivideByInteger<br />&nbsp; &nbsp; if defined PiDebug echo.DivideByInteger %1 %2<br />&nbsp; &nbsp; set /a DBI_Carry = 0<br />&nbsp; &nbsp; for /L %%i in (!MaxQuadIndex!, -1, 0) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined %1_%%i (set/p &quot;%1_%%i=&quot;&lt;%1_%%i.txt)<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a DBI_Digit = DBI_Carry*10000 + %1_%%i <br />&nbsp; &nbsp; &nbsp; &nbsp; set /a DBI_Carry = DBI_Digit %% %2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = DBI_Digit / %2<br />&nbsp; &nbsp; &nbsp; &nbsp; echo.!%1_%%i!&gt;%1_%%i.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;%1_%%i=&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;DBI_Carry=&quot;<br />&nbsp; &nbsp; set &quot;DBI_Digit=&quot;<br />&nbsp; &nbsp; goto :EOF<br /></code></pre></div><br />I'm working on this method for big NUMQUAD.<br /><br />Francesco</div>

			
													<div class="notice">
					Last edited by <a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a> on 11 Oct 2017 07:02, edited 1 time in total.
									</div>
			
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54343" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile54343">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searche2bd.html?author_id=3864&amp;sr=posts">762</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 15 Jun 2012 13:16</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Italy, Rome</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54343">

						<h3 ><a href="#p54343">Re: Batch macro vs function call test</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingbb9f.html?mode=quote&amp;f=3&amp;p=54343" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic1809.html?p=54343#p54343" onclick="prompt('Message #9',this.href); return false;">#9</a></span> 
									<a class="unread" href="viewtopic1809.html?p=54343#p54343" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a></strong> &raquo; </span>11 Oct 2017 06:38
			</p>
			
			
			
			<div class="content">I have made some tests.<br /><br />The original pi are better for low NUMQUAD, but the pi on file is faster on big NUMQUAD.<br /><br />These are results. (Time in seconds)<br />QUADS<br /><img src="../../i63.tinypic.com/28mjnsm.png" class="postimage" alt="Image" /><br /><br />The pi on file include major change token from AAcini version  <img class="smilies" src="images/smilies/icon_cool.gif" alt="8)" title="Cool" /> <br /><br />This is the version on file. EDIT: I have resolved the PRINTBUFFER problem.<br /><br />the code:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@if defined talk (echo on) else (echo off)<br />setlocal EnableDelayedExpansion<br />echo.pi.bat&nbsp; -&nbsp; By Don Cross&nbsp; -&nbsp; http://cosinekitty.com<br /><br />pushd %tmp%<br /><br />rem empty the environment for faster execution<br />(<br />&nbsp; for /F &quot;Tokens=1 delims==&quot; %%v in ('set') do set &quot;%%v=&quot;<br />&nbsp; set pidebug=%pidebug%<br />)<br /><br />rem Add input parameter NumQuads<br /><br />if &quot;%~1&quot; == &quot;&quot; (set /a NumQuads = 30) else (set /a NumQuads=%~1)<br />if !NumQuads! EQU 0&nbsp; set /a NumQuads = 30<br />echo.<br />echo.NumQuads=!NumQuads!<br />echo.<br />set /a MaxQuadIndex = NumQuads - 1<br />set &quot;NumQuads=&quot;<br /><br />echo.<br />echo.%time% - started<br />echo.<br /><br />rem Pi = 48*arctan(1/18) + 32*arctan(1/57) - 20*arctan(1/239)<br />call :PiEngine 48 18 32 57 -20 239<br /><br />set _CC=0<br /><br />rem Pi = 16*arctan(1/5) - 4*arctan(1/239)<br />call :PiEngine 16 5 -4 239<br /><br />set _CC=0<br /><br />rem pi = 176*arctan(1/57) + 28*arctan(1/239) - 48*arctan(1/682) + 96*arctan(1/12943)<br />call :PiEngine 176 57 28 239 -48 682 96 12943<br /><br /><br />popd<br /><br />goto :EOF<br /><br /><br />:PiEngine<br />&nbsp; &nbsp; call :SetToInteger Pi 0<br />&nbsp; &nbsp; set &quot;_Formula=&quot;<br />&nbsp; &nbsp; :PiTermLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; call :ArctanRecip PiTerm %2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;N=(((%1)&gt;&gt;31|1)*(%1))&quot; &amp; rem N=ABS(%1)<br />&nbsp; &nbsp; &nbsp; &nbsp; call :MultiplyByInteger PiTerm %N%<br />&nbsp; &nbsp; &nbsp; &nbsp; if %1 lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Subtract Pi PiTerm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=-<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Add Pi PiTerm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=+<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; if defined _Formula (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;_Formula=%_Formula% %Operator% %N%*arctan(1/%2)&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;_Formula=pi = %1*arctan(1/%2)&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; shift <br />&nbsp; &nbsp; &nbsp; &nbsp; shift<br />&nbsp; &nbsp; if &quot;%1&quot; neq &quot;&quot; goto PiTermLoop<br />&nbsp; &nbsp; call :Print Pi<br />&nbsp; &nbsp; echo.<br />&nbsp; &nbsp; echo %time% - finished %_Formula%<br />&nbsp; &nbsp; echo.<br />goto :EOF<br />&nbsp; &nbsp; <br />:Print<br />&nbsp; &nbsp; call :load %1<br />&nbsp; &nbsp; REM&nbsp; Omit a couple of least significant quads, because they will have roundoff errors.<br />&nbsp; &nbsp; if defined PiDebug (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=0<br />&nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=2<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a PrintMaxQuadIndex = MaxQuadIndex - 1<br />&nbsp; &nbsp; set /p &quot;=%1 = !%1_%MaxQuadIndex%!.&quot; &lt; nul:<br />&nbsp; &nbsp; for /L %%i in (%PrintMaxQuadIndex%, -1, %PrintMinQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A PrintDigit=10000 + %1_%%i<br />&nbsp; &nbsp; &nbsp; &nbsp; set /p &quot;=!PrintDigit:~1!&quot; &lt; nul:<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; echo.<br />&nbsp; &nbsp; call :unload %1<br />&nbsp; &nbsp; set &quot;PrintDigit=&quot;<br />&nbsp; &nbsp; set &quot;PrintMaxQuadIndex=&quot;<br />&nbsp; &nbsp; set &quot;PrintMinQuadIndex=&quot;<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp;<br />:SetToInteger<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; rem set /a %1_%%i = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; echo.0&gt;%1_%%i.txt<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a %1_%MaxQuadIndex% = %2<br />&nbsp; &nbsp; echo.!%1_%MaxQuadIndex%!&gt;%1_%MaxQuadIndex%.txt<br />&nbsp; &nbsp; set &quot;%1_%MaxQuadIndex%=&quot;<br />&nbsp; &nbsp; goto :EOF<br />&nbsp;<br />:DivideByInteger<br />&nbsp; &nbsp; if defined PiDebug echo.DivideByInteger %1 %2<br />&nbsp; &nbsp; rem C=Carry, D=Digit<br />&nbsp; &nbsp; set /a C = 0<br />&nbsp; &nbsp; for /L %%i in (!MaxQuadIndex!, -1, 0) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined %1_%%i (set/p &quot;%1_%%i=&quot;&lt;%1_%%i.txt)<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a D = C*10000 + %1_%%i, C = D %% %2, %1_%%i = D / %2<br />&nbsp; &nbsp; &nbsp; &nbsp; echo.!%1_%%i!&gt;%1_%%i.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;%1_%%i=&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a _CC+=1, perc=_CC*100/(MaxQuadIndex*11)<br />&nbsp; &nbsp; title %perc%%% (%_CC%) %_Formula% &#91;%time:~0,-3%&#93;<br />&nbsp; &nbsp; set &quot;C=&quot;<br />&nbsp; &nbsp; set &quot;D=&quot;<br />&nbsp; &nbsp; set &quot;perc=&quot;<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:MultiplyByInteger<br />&nbsp; &nbsp; if defined PiDebug echo.MultiplyByInteger %1 %2<br />&nbsp; &nbsp; call :load %1<br />&nbsp; &nbsp; set /a MBI_Carry = 0<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a MBI_Digit = %1_%%i * %2 + MBI_Carry<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = MBI_Digit %% 10000<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a MBI_Carry = MBI_Digit / 10000<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; call :unload %1<br />&nbsp; &nbsp; set &quot;MBI_Carry=&quot;<br />&nbsp; &nbsp; set &quot;MBI_Digit=&quot;<br />&nbsp; &nbsp; goto :EOF&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />:ArctanRecip<br />&nbsp; &nbsp; if defined PiDebug echo.ArctanRecip %1 %2<br />&nbsp; &nbsp; call :SetToInteger %1 1<br />&nbsp; &nbsp; call :DivideByInteger %1 %2<br />&nbsp; &nbsp; call :CopyValue AR_Recip %1<br />&nbsp; &nbsp; set /a AR_Toggle = -1, AR_K = 3<br />&nbsp; &nbsp; :ArctanLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; if defined PiDebug (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.ArctanRecip&nbsp; AR_K=!AR_K!&nbsp; &nbsp; ---------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Recip %2<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Recip %2<br />&nbsp; &nbsp; &nbsp; &nbsp; call :CopyValue AR_Term AR_Recip<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Term !AR_K!<br />&nbsp; &nbsp; &nbsp; &nbsp; REM call :IsZero AR_IsZeroFlag AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; for /L %%i in (0, 1, %MaxQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if not defined AR_Term_%%i (set/p &quot;AR_Term_%%i=&quot;&lt;AR_Term_%%i.txt)<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !AR_Term_%%i! neq 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set AR_Term_%%i=<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;goto :Accum_AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set AR_Term_%%i=<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;AR_K=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;AR_Toggle=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; exit /B<br />&nbsp; &nbsp; &nbsp; &nbsp; :Accum_AR_Term<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; if !AR_Toggle! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Subtract %1 AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Add %1 AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a AR_K += 2, AR_Toggle *= -1<br />&nbsp; &nbsp; goto ArctanLoop<br />&nbsp; &nbsp; <br />:CopyValue<br />&nbsp; &nbsp; if defined PiDebug echo.CopyValue %1 %2<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined %2_%%i (set/p &quot;%2_%%i=&quot;&lt;%2_%%i.txt)<br />&nbsp; &nbsp; &nbsp; &nbsp; rem set /a %1_%%i = %2_%%i<br />&nbsp; &nbsp; &nbsp; &nbsp; echo.!%2_%%i!&gt;%1_%%i.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;%2_%%i=&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:Add <br />&nbsp; &nbsp; if defined PiDebug echo.Add %1 %2<br />&nbsp; &nbsp; if defined PiDebug call :Print %1<br />&nbsp; &nbsp; if defined PiDebug call :Print %2<br />&nbsp; &nbsp; set /a Add_Carry = 0<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined %1_%%i (set/p &quot;%1_%%i=&quot;&lt;%1_%%i.txt)<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined %2_%%i (set/p &quot;%2_%%i=&quot;&lt;%2_%%i.txt)<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Add_Digit = Add_Carry + %1_%%i + %2_%%i<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = Add_Digit %% 10000<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Add_Carry = Add_Digit / 10000<br />&nbsp; &nbsp; &nbsp; &nbsp; echo.!%1_%%i!&gt;%1_%%i.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;%1_%%i=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;%2_%%i=&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;Add_Carry=&quot;<br />&nbsp; &nbsp; set &quot;Add_Digit=&quot;<br />&nbsp; &nbsp; goto :EOF&nbsp; &nbsp; <br /><br />:Subtract&nbsp; <br />&nbsp; &nbsp; if defined PiDebug echo.Subtract %1 %2<br />&nbsp; &nbsp; if defined PiDebug call :Print %1<br />&nbsp; &nbsp; if defined PiDebug call :Print %2<br />&nbsp; &nbsp; rem B=Subtract_Borrow, D=Subtract_Digit<br />&nbsp; &nbsp; set /a B = 0<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined %1_%%i (set/p &quot;%1_%%i=&quot;&lt;%1_%%i.txt)<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined %2_%%i (set/p &quot;%2_%%i=&quot;&lt;%2_%%i.txt)<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;D = %1_%%i - %2_%%i + B, B=D&gt;&gt;31, %1_%%i=D-B*10000&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; echo.!%1_%%i!&gt;%1_%%i.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;%1_%%i=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;%2_%%i=&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;B=&quot;<br />&nbsp; &nbsp; set &quot;D=&quot;<br />&nbsp; &nbsp; goto :EOF<br /><br />:load<br />&nbsp; &nbsp;for /L %%i in (0,1,!MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp;set/p &quot;%1_%%i=&quot;&lt;%1_%%i.txt <br />&nbsp; &nbsp;)<br />&nbsp; &nbsp;goto :EOF<br /><br />:unload<br />&nbsp; &nbsp;for /L %%i in (0,1,!MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp;echo.!%1_%%i!&gt;%1_%%i.txt<br />&nbsp; &nbsp; &nbsp;set &quot;%1_%%i=&quot;<br />&nbsp; &nbsp;)<br />&nbsp; &nbsp;goto :EOF<br />&nbsp; <br />&nbsp; &nbsp; <br />REM&nbsp; &nbsp; $Log: pi.bat,v $<br />REM&nbsp; &nbsp; Revision 1.2&nbsp; 2007/09/06 21:49:15&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Added time stamps and display of formula.<br />REM<br />REM&nbsp; &nbsp; Revision 1.1&nbsp; 2007/09/06 21:12:36&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Batch file for calculating pi<br />REM<br /></code></pre></div><br /><br /><br />EDIT: Correct the print subroutine on above code. <br />EDIT2:Add faster method :<br />pi = 176*arctan(1/57) + 28*arctan(1/239) - 48*arctan(1/682) + 96*arctan(1/12943)<br />call <img class="smilies" src="images/smilies/icon_razz.gif" alt=":P" title="Razz" />iEngine 176 57 28 239 -48 682 96 12943<br /><br /><br />Francesco</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54386" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile54386">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54386">

						<h3 ><a href="#p54386">Re: Batch macro vs function call test</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting6f1e.html?mode=quote&amp;f=3&amp;p=54386" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic9c32.html?p=54386#p54386" onclick="prompt('Message #10',this.href); return false;">#10</a></span> 
									<a class="unread" href="viewtopic9c32.html?p=54386#p54386" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>13 Oct 2017 09:24
			</p>
			
			
			
			<div class="content">I completed the additional modifications described in my previous (version1 code) post. The new, version2 code achieved an additional 29% running time decrease from version1; this means that version2 code just requires 32% the running time of original code, that is, a 68% decrease.<br /><br />The variables in version2 code are renamed and distributed in the environment accordingly to this schema:<br /><br /><ol style="list-style-type: upper-alpha"><li> Static, macro and less-used variables<br /><ol style="list-style-type: decimal"><li> A_NumQuads (static)</li><li> A_MaxQuadIndex (static)</li><li> C, D, F (used in SET /A expressions)</li><li> M_Add</li><li> M_CopyValue</li><li> M_DivideByIntegerN</li><li> M_MultiplyByIntegerN</li><li> M_SetToInteger</li><li> M_Subtract</li><li> N_Formula</li></ol></li><li> Array variables<br /><ol style="list-style-type: decimal"><li> P &lt;- Pi</li><li> Q &lt;- PiTerm</li><li> R &lt;- AR_Recip</li><li> T &lt;- AR_Term</li></ol></li><li> Single variables<br /><ol style="list-style-type: decimal"><li> V_AR_Toggle</li><li> V_AR_K</li></ol></li></ol><br />This is the new version2 code:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@if defined talk (echo on) else (echo off)<br />setlocal EnableDelayedExpansion<br />echo pi.bat&nbsp; -&nbsp; By Don Cross&nbsp; -&nbsp; http://cosinekitty.com<br /><br />REM Empty the environment<br />for /F &quot;delims==&quot; %%v in ('set') do set &quot;%%v=&quot;<br /><br />set /a A_NumQuads = 30<br />set /a A_MaxQuadIndex = A_NumQuads-1, F = 10000<br /><br />call :CreateMacros<br />echo %time% - started<br /><br />call :PiEngine 48 18 32 57 -20 239<br />call :PiEngine 16 5 -4 239<br />goto :EOF<br /><br />:PiEngine<br />&nbsp; &nbsp; set /A &quot;%M_SetToInteger:var=P%=0&quot;<br />&nbsp; &nbsp; set &quot;N_Formula=&quot;<br />&nbsp; &nbsp; :PiTermLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; call :ArctanRecip PiTerm %2<br />&nbsp; &nbsp; &nbsp; &nbsp; if %1 lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;N=-%1,%M_MultiplyByIntegerN:var=Q%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_Subtract_Pi:v=Q%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=-<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;N=%1,%M_MultiplyByIntegerN:var=Q%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_Add_Pi:v=Q%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=+<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined N_Formula (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;N_Formula=pi = %1*arctan(1/%2)&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;N_Formula=%N_Formula% %Operator% %N%*arctan(1/%2)&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; shift <br />&nbsp; &nbsp; &nbsp; &nbsp; shift<br />&nbsp; &nbsp; if &quot;%1&quot; neq &quot;&quot; goto PiTermLoop<br />&nbsp; &nbsp; call :Print P<br />&nbsp; &nbsp; echo %time% - finished %N_Formula%<br />exit /B<br /><br /><br />:Print<br />&nbsp; &nbsp; REM&nbsp; Omit a couple of least significant quads, because they will have roundoff errors.<br />&nbsp; &nbsp; if defined PiDebug (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=0<br />&nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=2<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a PrintMaxQuadIndex = A_MaxQuadIndex - 1<br />&nbsp; &nbsp; echo/<br />&nbsp; &nbsp; &lt;nul (<br />&nbsp; &nbsp; set /P &quot;=%1 = !%1%A_MaxQuadIndex%!.&quot;<br />&nbsp; &nbsp; for /L %%i in (%PrintMaxQuadIndex%, -1, %PrintMinQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A PrintDigit=10000 + %1%%i<br />&nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;=!PrintDigit:~1!&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; echo/<br />&nbsp; &nbsp; echo/<br />&nbsp; &nbsp; for %%v in (PrintMinQuadIndex PrintMaxQuadIndex PrintDigit) do set &quot;%%v=&quot;<br />exit /B<br /><br /><br />:ArctanRecip&nbsp; &nbsp;%1 = PiTerm *always*<br />&nbsp; &nbsp; set /A &quot;%M_SetToInteger:var=Q%=1&quot;<br />&nbsp; &nbsp; set /A &quot;N=%2,%M_DivideByIntegerN:var=Q%&quot;<br />&nbsp; &nbsp; set /A &quot;%M_CopyValue_AR_Recip:var=Q%&quot;<br />&nbsp; &nbsp; set /A V_AR_Toggle = -1,&nbsp; V_AR_K = 3<br />&nbsp; &nbsp; :ArctanLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;N=%2,%M_DivideByIntegerN:var=R%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;N=%2,%M_DivideByIntegerN:var=R%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_CopyValue_AR_Term:var=R%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;N=V_AR_K,%M_DivideByIntegerN:var=T%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; REM call :IsZero AR_IsZeroFlag AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; for /L %%i in (0, 1, %A_MaxQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !T%%i! neq 0 goto :Accum_AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; exit /B<br />&nbsp; &nbsp; &nbsp; &nbsp; :Accum_AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; if !V_AR_Toggle! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_Subtract_PiTerm:v=T%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_Add_PiTerm:v=T%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a V_AR_K += 2, V_AR_Toggle *= -1<br />&nbsp; &nbsp; goto ArctanLoop<br />exit /B<br /><br /><br />REM&nbsp; &nbsp; $Log: pi.bat,v $<br />REM&nbsp; &nbsp; Revision 1.2&nbsp; 2007/09/06 21:49:15&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Added time stamps and display of formula.<br />REM<br />REM&nbsp; &nbsp; Revision 1.1&nbsp; 2007/09/06 21:12:36&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Batch file for calculating pi<br />REM<br /><br /><br />:CreateMacros<br /><br />&nbsp; &nbsp; set /A A_MaxQuadIndexM1 = A_MaxQuadIndex - 1<br />&nbsp; &nbsp; set &quot;M_SetToInteger=&quot;<br />&nbsp; &nbsp; for /L %%i in (0, 1, %A_MaxQuadIndexM1%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_SetToInteger=!M_SetToInteger!var%%i=&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;M_SetToInteger=%M_SetToInteger%0,var%A_MaxQuadIndex%&quot;<br />&nbsp; &nbsp; set &quot;A_MaxQuadIndexM1=&quot;<br /><br />&nbsp; &nbsp; set &quot;M_MultiplyByIntegerN=C=0&quot;<br />&nbsp; &nbsp; for /L %%i in (0, 1, %A_MaxQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_MultiplyByIntegerN=!M_MultiplyByIntegerN!,D=C+var%%i*N,var%%i=D%%F,C=D/F&quot;<br />&nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; set &quot;M_DivideByIntegerN=C=0&quot;<br />&nbsp; &nbsp; for /L %%i in (%A_MaxQuadIndex%, -1, 0) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_DivideByIntegerN=!M_DivideByIntegerN!,D=C*F+var%%i,C=D%%N,var%%i=D/N&quot;<br />&nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; set &quot;M_CopyValue=u0=var0&quot;<br />&nbsp; &nbsp; for /L %%i in (1, 1, %A_MaxQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_CopyValue=!M_CopyValue!,u%%i=var%%i&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;M_CopyValue_AR_Recip=%M_CopyValue:u=R%&quot;<br />&nbsp; &nbsp; set &quot;M_CopyValue_AR_Term=%M_CopyValue:u=T%&quot;<br />&nbsp; &nbsp; set &quot;M_CopyValue=&quot;<br /><br />&nbsp; &nbsp; set &quot;M_Add=C=0&quot;<br />&nbsp; &nbsp; for /L %%i in (0, 1, %A_MaxQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_Add=!M_Add!,D=C+u%%i+v%%i,u%%i=D%%F,C=D/F&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;M_Add_Pi=%M_Add:u=P%&quot;<br />&nbsp; &nbsp; set &quot;M_Add_PiTerm=%M_Add:u=Q%&quot;<br />&nbsp; &nbsp; set &quot;M_Add=&quot;<br /><br />&nbsp; &nbsp; set &quot;M_Subtract=C=0&quot;<br />&nbsp; &nbsp; for /L %%i in (0, 1, %A_MaxQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_Subtract=!M_Subtract!,D=u%%i-v%%i+C,C=D&gt;&gt;31,u%%i=D-C*F&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;M_Subtract_Pi=%M_Subtract:u=P%&quot;<br />&nbsp; &nbsp; set &quot;M_Subtract_PiTerm=%M_Subtract:u=Q%&quot;<br />&nbsp; &nbsp; set &quot;M_Subtract=&quot;<br /><br />exit /B<br /></code></pre></div><br />I repeated previous tests with version2 code varying the number of quads in the arrays; this is the result.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Quads&nbsp; &nbsp; &nbsp; &nbsp; Digits&nbsp; &nbsp;Time version1&nbsp; &nbsp; &nbsp;Time version2<br /><br />30&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;110&nbsp; &nbsp; &nbsp; 17.25&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;12.30<br />45 (1.5)&nbsp; &nbsp; &nbsp;170&nbsp; &nbsp; &nbsp; 52.54&nbsp; (3.05)&nbsp; &nbsp; &nbsp;35.90&nbsp; (2.91)<br />60 (2.0)&nbsp; &nbsp; &nbsp;230&nbsp; &nbsp; &nbsp; 118.75 (6.88)&nbsp; &nbsp; &nbsp;80.12&nbsp; (6.51)<br />75 (2.5)&nbsp; &nbsp; &nbsp;290&nbsp; &nbsp; &nbsp; 224.42 (13.01)&nbsp; &nbsp; 152.08 (12.36)<br />90 (3.0)&nbsp; &nbsp; &nbsp;350&nbsp; &nbsp; &nbsp; 380.84 (22.08)&nbsp; &nbsp; 255.45 (20.77)<br /></code></pre></div><br /><br />Antonio</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54409" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile54409">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searche2bd.html?author_id=3864&amp;sr=posts">762</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 15 Jun 2012 13:16</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Italy, Rome</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54409">

						<h3 ><a href="#p54409">Re: Batch macro vs function call test</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingbe01.html?mode=quote&amp;f=3&amp;p=54409" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic79bd.html?p=54409#p54409" onclick="prompt('Message #11',this.href); return false;">#11</a></span> 
									<a class="unread" href="viewtopic79bd.html?p=54409#p54409" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a></strong> &raquo; </span>15 Oct 2017 07:52
			</p>
			
			
			
			<div class="content">I have just realized that SET/P is slower than FOR/F<br /><br />this version substitute the precedent. The break even point (BEP) is passed from about 500 NumQuads to about 400 NumQuads.<br /><br /><img src="../../i63.tinypic.com/qswo6a.png" class="postimage" alt="Image" /><br /><br />the new code:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@if defined talk (echo on) else (echo off)<br />setlocal EnableDelayedExpansion<br />echo.pi.bat&nbsp; -&nbsp; By Don Cross&nbsp; -&nbsp; http://cosinekitty.com<br /><br />pushd %tmp%<br /><br />rem empty the environment for faster execution<br />(<br />&nbsp; for /F &quot;Tokens=1 delims==&quot; %%v in ('set') do set &quot;%%v=&quot;<br />&nbsp; set pidebug=%pidebug%<br />)<br /><br />rem Add input parameter NumQuads<br /><br />if &quot;%~1&quot; == &quot;&quot; (set /a NumQuads = 30) else (set /a NumQuads=%~1)<br />if !NumQuads! EQU 0&nbsp; set /a NumQuads = 30<br />echo.<br />echo.NumQuads=!NumQuads!<br />echo.<br />set /a MaxQuadIndex = NumQuads - 1<br />set &quot;NumQuads=&quot;<br /><br />set /a _RNDL=32768/10 <br /><br />echo.<br />echo.%time% - started<br />echo.<br /><br /><br />rem Pi = 48*arctan(1/18) + 32*arctan(1/57) - 20*arctan(1/239)<br />call :PiEngine 48 18 32 57 -20 239<br /><br />set _CC=0<br /><br />rem Pi = 16*arctan(1/5) - 4*arctan(1/239)<br />call :PiEngine 16 5 -4 239<br /><br />set _CC=0<br /><br />rem ref.&nbsp; &nbsp;http://www.jjj.de/arctan/&nbsp; &nbsp;<br />rem others http://caramba.loria.fr/sem-slides/200805231000.pdf<br /><br />rem pi = 176*arctan(1/57) + 28*arctan(1/239) - 48*arctan(1/682) + 96*arctan(1/12943)<br />call :PiEngine 176 57 28 239 -48 682 96 12943<br /><br />set _CC=0<br /><br />rem pi = 352*arctan(1/192) + 156*arctan(1/239) + 400*arctan(1/515) - 128*arctan(1/1068) - 224*arctan(1/173932)<br />call :PiEngine 352 192 156 239 400 515 -128 1068 -224 173932<br /><br />popd<br /><br />goto :EOF<br /><br /><br />:PiEngine<br />&nbsp; &nbsp; call :SetToInteger Pi 0<br />&nbsp; &nbsp; set &quot;_Formula=&quot;<br />&nbsp; &nbsp; :PiTermLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; call :ArctanRecip PiTerm %2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;N=(((%1)&gt;&gt;31|1)*(%1))&quot; &amp; rem N=ABS(%1)<br />&nbsp; &nbsp; &nbsp; &nbsp; call :MultiplyByInteger PiTerm %N%<br />&nbsp; &nbsp; &nbsp; &nbsp; if %1 lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Subtract Pi PiTerm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=-<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Add Pi PiTerm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set Operator=+<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; if defined _Formula (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;_Formula=%_Formula% %Operator% %N%*arctan(1/%2)&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;_Formula=pi = %1*arctan(1/%2)&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; shift <br />&nbsp; &nbsp; &nbsp; &nbsp; shift<br />&nbsp; &nbsp; if &quot;%1&quot; neq &quot;&quot; goto PiTermLoop<br />&nbsp; &nbsp; call :Print Pi<br />&nbsp; &nbsp; echo.<br />&nbsp; &nbsp; echo %time% - finished %_Formula%<br />&nbsp; &nbsp; echo.<br />goto :EOF<br />&nbsp; &nbsp; <br />:Print<br />&nbsp; &nbsp; call :load %1<br />&nbsp; &nbsp; REM&nbsp; Omit a couple of least significant quads, because they will have roundoff errors.<br />&nbsp; &nbsp; if defined PiDebug (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=0<br />&nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a PrintMinQuadIndex=2<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a PrintMaxQuadIndex = MaxQuadIndex - 1<br />&nbsp; &nbsp; set /p &quot;=%1 = !%1_%MaxQuadIndex%!.&quot; &lt; nul:<br />&nbsp; &nbsp; for /L %%i in (%PrintMaxQuadIndex%, -1, %PrintMinQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A PrintDigit=10000 + %1_%%i<br />&nbsp; &nbsp; &nbsp; &nbsp; set /p &quot;=!PrintDigit:~1!&quot; &lt; nul:<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; echo.<br />&nbsp; &nbsp; call :unload %1<br />&nbsp; &nbsp; set &quot;PrintDigit=&quot;<br />&nbsp; &nbsp; set &quot;PrintMaxQuadIndex=&quot;<br />&nbsp; &nbsp; set &quot;PrintMinQuadIndex=&quot;<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp;<br />:SetToInteger<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; rem set /a %1_%%i = 0<br />&nbsp; &nbsp; &nbsp; &nbsp; echo.0&gt;%1_%%i.txt<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; echo.%2&gt;%1_%MaxQuadIndex%.txt<br />&nbsp; &nbsp; goto :EOF<br />&nbsp;<br />:DivideByInteger<br />&nbsp; &nbsp; if defined PiDebug echo.DivideByInteger %1 %2<br />&nbsp; &nbsp; rem C=Carry, D=Digit<br />&nbsp; &nbsp; set /a C = 0<br />&nbsp; &nbsp; for /L %%i in (!MaxQuadIndex!, -1, 0) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined %1_%%i for /f %%f in (%1_%%i.txt) do set &quot;%1_%%i=%%f&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a D = C*10000 + %1_%%i, C = D %% %2, %1_%%i = D / %2<br />&nbsp; &nbsp; &nbsp; &nbsp; echo(!%1_%%i!&gt;%1_%%i.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;%1_%%i=&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a _CC+=1, perc=_CC*100/(MaxQuadIndex*11)<br />&nbsp; &nbsp; title %perc%%% (%_CC%) %_Formula% &#91;%time:~0,-3%&#93;<br />&nbsp; &nbsp; set &quot;C=&quot;<br />&nbsp; &nbsp; set &quot;D=&quot;<br />&nbsp; &nbsp; set &quot;perc=&quot;<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:MultiplyByInteger<br />&nbsp; &nbsp; if defined PiDebug echo.MultiplyByInteger %1 %2<br />&nbsp; &nbsp; call :load %1<br />&nbsp; &nbsp; set /a MBI_Carry = 0<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a MBI_Digit = %1_%%i * %2 + MBI_Carry<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = MBI_Digit %% 10000<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a MBI_Carry = MBI_Digit / 10000<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; call :unload %1<br />&nbsp; &nbsp; set &quot;MBI_Carry=&quot;<br />&nbsp; &nbsp; set &quot;MBI_Digit=&quot;<br />&nbsp; &nbsp; goto :EOF&nbsp; &nbsp; <br />&nbsp; &nbsp; <br />:ArctanRecip<br />&nbsp; &nbsp; if defined PiDebug echo.ArctanRecip %1 %2<br />&nbsp; &nbsp; call :SetToInteger %1 1<br />&nbsp; &nbsp; call :DivideByInteger %1 %2<br />&nbsp; &nbsp; call :CopyValue AR_Recip %1<br />&nbsp; &nbsp; set /a AR_Toggle = -1, AR_K = 3<br />&nbsp; &nbsp; :ArctanLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; if defined PiDebug (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo.ArctanRecip&nbsp; AR_K=!AR_K!&nbsp; &nbsp; ---------------------------------------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Recip %2<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Recip %2<br />&nbsp; &nbsp; &nbsp; &nbsp; call :CopyValue AR_Term AR_Recip<br />&nbsp; &nbsp; &nbsp; &nbsp; call :DivideByInteger AR_Term !AR_K!<br />&nbsp; &nbsp; &nbsp; &nbsp; REM call :IsZero AR_IsZeroFlag AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; for /L %%i in (0, 1, %MaxQuadIndex%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if not defined AR_Term_%%i for /f %%f in (AR_Term_%%i.txt) do set &quot;AR_Term_%%i=%%f&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if !AR_Term_%%i! neq 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set AR_Term_%%i=<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;goto :Accum_AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;set AR_Term_%%i=<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;AR_K=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;AR_Toggle=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; exit /B<br />&nbsp; &nbsp; &nbsp; &nbsp; :Accum_AR_Term<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; if !AR_Toggle! lss 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Subtract %1 AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; call :Add %1 AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a AR_K += 2, AR_Toggle *= -1<br />&nbsp; &nbsp; goto ArctanLoop<br />&nbsp; &nbsp; <br />:CopyValue<br />&nbsp; &nbsp; if defined PiDebug echo.CopyValue %1 %2<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined %2_%%i for /f %%f in (%2_%%i.txt) do set &quot;%2_%%i=%%f&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; rem set /a %1_%%i = %2_%%i<br />&nbsp; &nbsp; &nbsp; &nbsp; echo.!%2_%%i!&gt;%1_%%i.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;%2_%%i=&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; goto :EOF<br />&nbsp; &nbsp; <br />:Add <br />&nbsp; &nbsp; if defined PiDebug echo.Add %1 %2<br />&nbsp; &nbsp; if defined PiDebug call :Print %1<br />&nbsp; &nbsp; if defined PiDebug call :Print %2<br />&nbsp; &nbsp; set /a Add_Carry = 0<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined %1_%%i for /f %%f in (%1_%%i.txt) do set &quot;%1_%%i=%%f<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined %2_%%i for /f %%f in (%2_%%i.txt) do set &quot;%2_%%i=%%f<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Add_Digit = Add_Carry + %1_%%i + %2_%%i<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a %1_%%i = Add_Digit %% 10000<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a Add_Carry = Add_Digit / 10000<br />&nbsp; &nbsp; &nbsp; &nbsp; echo.!%1_%%i!&gt;%1_%%i.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;%1_%%i=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;%2_%%i=&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;Add_Carry=&quot;<br />&nbsp; &nbsp; set &quot;Add_Digit=&quot;<br />&nbsp; &nbsp; goto :EOF&nbsp; &nbsp; <br /><br />:Subtract&nbsp; <br />&nbsp; &nbsp; if defined PiDebug echo.Subtract %1 %2<br />&nbsp; &nbsp; if defined PiDebug call :Print %1<br />&nbsp; &nbsp; if defined PiDebug call :Print %2<br />&nbsp; &nbsp; rem B=Subtract_Borrow, D=Subtract_Digit<br />&nbsp; &nbsp; set /a B = 0<br />&nbsp; &nbsp; for /L %%i in (0, 1, !MaxQuadIndex!) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined %1_%%i for /f %%f in (%1_%%i.txt) do set &quot;%1_%%i=%%f&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined %2_%%i for /f %%f in (%2_%%i.txt) do set &quot;%2_%%i=%%f&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;D = %1_%%i - %2_%%i + B, B=D&gt;&gt;31, %1_%%i=D-B*10000&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; echo.!%1_%%i!&gt;%1_%%i.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;%1_%%i=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;%2_%%i=&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;B=&quot;<br />&nbsp; &nbsp; set &quot;D=&quot;<br />&nbsp; &nbsp; goto :EOF<br /><br />:load<br />&nbsp; &nbsp;for /L %%i in (0,1,!MaxQuadIndex!) do for /f %%f in (%1_%%i.txt) do set &quot;%1_%%i=%%f&quot; <br />exit /B<br /><br />:unload<br />&nbsp; &nbsp;for /L %%i in (0,1,!MaxQuadIndex!) do (echo.!%1_%%i!&gt;%1_%%i.txt &amp; set &quot;%1_%%i=&quot;)<br />exit /B<br />&nbsp; <br />&nbsp; &nbsp; <br />REM&nbsp; &nbsp; $Log: pi.bat,v $<br />REM&nbsp; &nbsp; Revision 1.2&nbsp; 2007/09/06 21:49:15&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Added time stamps and display of formula.<br />REM<br />REM&nbsp; &nbsp; Revision 1.1&nbsp; 2007/09/06 21:12:36&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Batch file for calculating pi<br />REM<br /></code></pre></div><br /><br />Francesco</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54432" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile54432">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54432">

						<h3 ><a href="#p54432">Re: Batch macro vs function call test</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting90e2.html?mode=quote&amp;f=3&amp;p=54432" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic846b-2.html?p=54432#p54432" onclick="prompt('Message #12',this.href); return false;">#12</a></span> 
									<a class="unread" href="viewtopic846b-2.html?p=54432#p54432" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>17 Oct 2017 12:01
			</p>
			
			
			
			<div class="content">I completed a new version of this code based on a different method. In this Version 3 all big numbers are managed in files. This phrase means that a big number is stored in a text file with lines that contain a group of 25 quads each plus a heading line number. For example, this is the big number 1 (file <strong class="text-strong">One.txt</strong>) when the number of lines is 4 (NumQuads=100):<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>01 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0<br />02 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0<br />03 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0<br />04 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1<br /></code></pre></div><br />Each number is read from a file, processed and stored back in its file. The processing of each number is done via a FOR /F loop that read the 25 quads per line, operate all quads via a single SET /A command, and store the 25 results in a result file via an ECHO command. This approach allows to keep the number of environment variables low and constant no matter how many lines and quads have the big numbers, so this method should run faster than the other methods that increase the number of environment variables with the quads.<br /><br />This method also allows to manage certain operations over numbers using the usual commands to manage files. For example, the <strong class="text-strong">call :SetToInteger Pi 0</strong> line becomes <strong class="text-strong">copy Zero.txt Pi.txt</strong> command, <strong class="text-strong">call :CopyValue AR_Term AR_Recip</strong> becomes <strong class="text-strong">copy AR_Recip.txt AR_Term.txt</strong>, and to check if AR_Term is not zero, just use <strong class="text-strong">fc AR_Term.txt Zero.txt &gt; nul</strong> followed by <strong class="text-strong">if errorlevel 1 goto AR_Term_not_zero</strong>.<br /><br />This is the new <strong class="text-strong">Version 3</strong> code:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@if defined talk (echo on) else (echo off)<br />setlocal EnableDelayedExpansion<br />echo pi.bat&nbsp; -&nbsp; By Don Cross&nbsp; -&nbsp; http://cosinekitty.com<br /><br />REM Empty the environment<br />for /F &quot;delims=&quot; %%a in ('where sort') do set &quot;sort=%%a&quot;<br />(<br />for /F &quot;delims==&quot; %%v in ('set') do set &quot;%%v=&quot;<br />set &quot;sort=%sort%&quot;<br />)<br /><br />REM Define the number of groups = 25 Quads = 100 digits<br />set /A A_NumGroups = 3<br />set /A A_NumQuads = NumGroups*25, A_MaxQuadIndex = A_NumQuads-1, @ = 10000<br /><br />call :CreateMacros<br />echo %time% - started<br /><br />call :PiEngine 48 18 32 57 -20 239<br />call :PiEngine 16 5 -4 239<br />goto :EOF<br /><br />:PiEngine<br />&nbsp; &nbsp; REM call :SetToInteger Pi 0<br />&nbsp; &nbsp; copy /Y Zero.txt Pi.txt &gt; NUL<br />&nbsp; &nbsp; set &quot;N_Formula=&quot;<br /><br />&nbsp; &nbsp; :PiTermLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; call :ArctanRecip PiTerm %2<br />&nbsp; &nbsp; &nbsp; &nbsp; if %1 lss 0 (<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REM call :MultiplyByInteger PiTerm -%1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;#=-%1,'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (for /F &quot;tokens=1-26&quot; %%A in (PiTerm.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_MultiplyByInteger#%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; del PiTerm.txt &amp; ren Result.txt PiTerm.txt<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REM call :Subtract Pi PiTerm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt; PiTerm.txt (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%A in (Pi.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;oper2=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%a in (&quot;!oper2!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_Subtract%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; del Pi.txt &amp; ren Result.txt Pi.txt<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;Operator=-&quot;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REM call :MultiplyByInteger PiTerm %1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;#=%1,'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (for /F &quot;tokens=1-26&quot; %%A in (PiTerm.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_MultiplyByInteger#%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; del PiTerm.txt &amp; ren Result.txt PiTerm.txt<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REM call :Add Pi PiTerm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt; PiTerm.txt (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%A in (Pi.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;oper2=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%a in (&quot;!oper2!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_Add%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; del Pi.txt &amp; ren Result.txt Pi.txt<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;Operator=+&quot;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined N_Formula (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;N_Formula=pi = %1*arctan(1/%2)&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;N_Formula=%N_Formula% %Operator% %#%*arctan(1/%2)&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; shift <br />&nbsp; &nbsp; &nbsp; &nbsp; shift<br />&nbsp; &nbsp; if &quot;%1&quot; neq &quot;&quot; goto PiTermLoop<br />&nbsp; &nbsp; call :Print Pi<br />&nbsp; &nbsp; echo %time% - finished %N_Formula%<br />exit /B<br /><br /><br />:ArctanRecip&nbsp; &nbsp;%1 = PiTerm *always*<br /><br />&nbsp; &nbsp; REM call :SetToInteger PiTerm 1<br />&nbsp; &nbsp; copy /Y One.txt PiTerm.txt &gt; NUL<br /><br />&nbsp; &nbsp; REM call :DivideByInteger PiTerm %2<br />&nbsp; &nbsp; set /A &quot;#=%2,'=0&quot;<br />&nbsp; &nbsp; (for /F &quot;tokens=1-26&quot; %%A in ('&quot;%sort%&quot; /R PiTerm.txt') do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_DivideRbyInteger#%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &quot;%sort%&quot; Result.txt /O PiTerm.txt<br /><br />&nbsp; &nbsp; REM call :CopyValue AR_Recip PiTerm<br />&nbsp; &nbsp; copy /Y PiTerm.txt AR_Recip.txt &gt; NUL<br /><br />&nbsp; &nbsp; set /A V_AR_Toggle = -1,&nbsp; V_AR_K = 3<br /><br />&nbsp; &nbsp; :ArctanLoop<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; REM call :DivideByInteger AR_Recip %2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;#=%2,'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; (for /F &quot;tokens=1-26&quot; %%A in ('&quot;%sort%&quot; /R AR_Recip.txt') do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_DivideRbyInteger#%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; REM call :DivideByInteger AR_Recip %2<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; (for /F &quot;tokens=1-26&quot; %%A in (Result.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_DivideRbyInteger#%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; )) &gt; AR_Recip.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;%sort%&quot; AR_Recip.txt /O AR_Recip.txt<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; REM call :CopyValue AR_Term AR_Recip<br />&nbsp; &nbsp; &nbsp; &nbsp; copy /Y AR_Recip.txt AR_Term.txt &gt; NUL<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; REM call :DivideByInteger AR_Term !AR_K!<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;#=V_AR_K,'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; (for /F &quot;tokens=1-26&quot; %%A in ('&quot;%sort%&quot; /R AR_Term.txt') do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_DivideRbyInteger#%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;%sort%&quot; Result.txt /O AR_Term.txt<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; REM call :IsZero AR_IsZeroFlag AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; for %%a in (&quot;%sort%&quot;) do &quot;%%~DPafc.exe&quot; AR_Term.txt Zero.txt &gt; NUL<br />&nbsp; &nbsp; &nbsp; &nbsp; if %errorlevel% equ 0 exit /B<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; if !V_AR_Toggle! lss 0 (<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REM call :Subtract PiTerm AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt; AR_Term.txt (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%A in (PiTerm.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;oper2=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%a in (&quot;!oper2!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_Subtract%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; del PiTerm.txt &amp; ren Result.txt PiTerm.txt<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REM call :Add PiTerm AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt; AR_Term.txt (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%A in (PiTerm.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;oper2=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%a in (&quot;!oper2!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_Add%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; del PiTerm.txt &amp; ren Result.txt PiTerm.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a V_AR_K += 2, V_AR_Toggle *= -1<br /><br />&nbsp; &nbsp; goto ArctanLoop<br />exit /B<br /><br /><br />:Print<br />&nbsp; &nbsp; echo/<br />&nbsp; &nbsp; &lt; NUL (<br />&nbsp; &nbsp; set /P &quot;=%1 = &quot;<br />&nbsp; &nbsp; set &quot;line=0&quot;<br />&nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%A in ('&quot;%sort%&quot; /R %1.txt') do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;line+=1,%M_PrintAdjust%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; if !line! equ 1 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;=%M_PrintFormat:!Z:~1!=!Z:~-1!.%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else if !line! lss %A_NumGroups% (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;=%M_PrintFormat%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;=%M_PrintFormat:!C:~1!!B:~1!=%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; ))<br />&nbsp; &nbsp; echo/<br />&nbsp; &nbsp; echo/<br />exit /B<br /><br /><br />REM&nbsp; &nbsp; $Log: pi.bat,v $<br />REM&nbsp; &nbsp; Revision 1.2&nbsp; 2007/09/06 21:49:15&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Added time stamps and display of formula.<br />REM<br />REM&nbsp; &nbsp; Revision 1.1&nbsp; 2007/09/06 21:12:36&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Batch file for calculating pi<br />REM<br /><br /><br />:CreateMacros<br /><br />&nbsp; &nbsp; set &quot;n=&quot;<br />&nbsp; &nbsp; for /L %%i in (2,1,25) do set &quot;n=!n!0 &quot;<br />&nbsp; &nbsp; set /A &quot;i=101&quot;<br />&nbsp; &nbsp; (<br />&nbsp; &nbsp; for /L %%i in (2,1,%A_NumGroups%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; echo !i:~1! %n%0<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A i+=1<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; echo !i:~1! %n%1<br />&nbsp; &nbsp; ) &gt; One.txt<br />&nbsp; &nbsp; set /A &quot;i=101&quot;<br />&nbsp; &nbsp; (for /L %%i in (1,1,%A_NumGroups%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; echo !i:~1! %n%0<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A i+=1<br />&nbsp; &nbsp; )) &gt; Zero.txt<br /><br />&nbsp; &nbsp; set&nbsp; &quot;upCase=A B C D E F G H I J K L M N O P Q R S T U V W X Y Z&quot;<br />&nbsp; &nbsp; set &quot;lowCase=a b c d e f g h i j k l m n o p q r s t u v w x y z&quot;<br /><br />&nbsp; &nbsp; REM One-char variables: $=Digit, '=Carry, @=10000, #=int number for multiply/divide<br /><br />&nbsp; &nbsp; set &quot;M_MultiplyByInteger#=&quot;<br />&nbsp; &nbsp; for %%i in (%upCase:~2%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_MultiplyByInteger#=!M_MultiplyByInteger#!,$='+%%%%i*#,%%i=$%%@,'=$/@&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;M_MultiplyByInteger#=!M_MultiplyByInteger#:~1!&quot;<br /><br />&nbsp; &nbsp; set &quot;M_DivideRbyInteger#=&quot;<br />&nbsp; &nbsp; for %%i in (%upCase:~2%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_DivideRbyInteger#=$='*@+%%%%i,%%i=$/#,'=$%%#,!M_DivideRbyInteger#!&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;M_DivideRbyInteger#=!M_DivideRbyInteger#:~0,-1!&quot;<br /><br />&nbsp; &nbsp; set &quot;lowCase2=%lowCase:~2%&quot;<br />&nbsp; &nbsp; set &quot;M_Add=&quot;<br />&nbsp; &nbsp; for %%i in (%upCase:~2%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1*&quot; %%j in (&quot;!lowCase2!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_Add=!M_Add!,$='+%%%%i+%%%%j,%%i=$%%@,'=$/@&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;lowCase2=%%k&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;M_Add=%M_Add:~1%&quot;<br /><br />&nbsp; &nbsp; set &quot;lowCase2=%lowCase:~2%&quot;<br />&nbsp; &nbsp; set &quot;M_Subtract=&quot;<br />&nbsp; &nbsp; for %%i in (%upCase:~2%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1*&quot; %%j in (&quot;!lowCase2!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_Subtract=!M_Subtract!,$=%%%%i-%%%%j+','=$&gt;&gt;31,%%i=$-'*@&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;lowCase2=%%k&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;M_Subtract=%M_Subtract:~1%&quot;<br /><br />&nbsp; &nbsp; set &quot;M_Result=&quot;<br />&nbsp; &nbsp; for %%i in (%upCase:~2%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_Result=!M_Result! ^!%%i^!&quot;<br />&nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; set &quot;M_PrintAdjust=&quot;<br />&nbsp; &nbsp; set &quot;M_PrintFormat=&quot;<br />&nbsp; &nbsp; for %%i in (%upCase:~2%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_PrintAdjust=!M_PrintAdjust!,%%i=@+%%%%i&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_PrintFormat=^!%%i:~1^!!M_PrintFormat!&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;M_PrintAdjust=%M_PrintAdjust:~1%&quot;<br /><br />&nbsp; &nbsp; set &quot;upCase=&quot;<br />&nbsp; &nbsp; set &quot;lowCase=&quot;<br /><br />exit /B<br /></code></pre></div><br />I repeated a series of tests with the original and the three different versions of my code. These are the results; all times are in seconds:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Quads&nbsp; &nbsp;Original&nbsp; &nbsp; V1:Efficient&nbsp; &nbsp;V2:V1+Environ&nbsp; &nbsp;V3:File<br /><br />&nbsp; 25&nbsp; &nbsp; &nbsp; &nbsp;27.93&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.81&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8.01&nbsp; &nbsp; &nbsp; &nbsp; 27.15<br />&nbsp; 50&nbsp; &nbsp; &nbsp; 103.00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;69.97&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 48.18&nbsp; &nbsp; &nbsp; &nbsp; 62.31<br />&nbsp;100&nbsp; &nbsp; &nbsp; 511.39&nbsp; &nbsp; &nbsp; &nbsp; 515.69&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;345.57&nbsp; &nbsp; &nbsp; &nbsp;150.95<br />&nbsp;150&nbsp; &nbsp; &nbsp;1458.53&nbsp; &nbsp; &nbsp; &nbsp;1759.33&nbsp; &nbsp; &nbsp; &nbsp; 1158.11&nbsp; &nbsp; &nbsp; &nbsp;266.01<br />&nbsp;200&nbsp; &nbsp; &nbsp;3157.66&nbsp; &nbsp; &nbsp; &nbsp;-------&nbsp; &nbsp; &nbsp; &nbsp; 2737.64&nbsp; &nbsp; &nbsp; &nbsp;400.80<br />&nbsp;250&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 570.67<br />&nbsp;300&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 740.29<br /></code></pre></div><br />These results show some interesting points: in the original code, the time vs. the number of quads increase in a non-linear (exponential) relation as expected. Although the Version1 code run faster than the original, because it is more efficient, it also presents the same behaviour related to the environment grow. However, when the number of quads is about 100, the large environment combined with the complexity of the very long SET /A commands increments the running time <em class="text-italics">above</em> the original time. Conclusion: a SET /A command that becomes every time larger may eventually be less efficient than an equivalent FOR loop. Also, this Version1 have a limit in the number of quads restricted by the largest SET /A expression that can be stored in a variable, so it can not process 200 quads.<br /><br />It is interesting to note that the <em class="text-italics">only difference</em> between Version2 and Version1 is that the size of the environment is lesser, but this modification alone decrease the running time in an important amount and also allows to manage a larger number of quads.<br /><br />The results of the Version3 code are the expected ones: the objective of this version is to decrease the size of the environment as much as possible, so the big numbers are stored in disk files instead of environment variables. The idea is that the time involved in the management of disk files be lesser than the time involved in the management of a very large environment. The results confirmed this point: the times are not just much lesser, but the increment in the time vs. the number of quads is much more flat.<br /><br />This Version3 code can be improved in several ways. For example, the Division FOR loop requires that the lines with 25 quads be in reverse order, so a SORT /R is required before the division loop and another SORT after it (in order to leave the result in the right order) Below :ArctanLoop label there are <em class="text-italics">two divisions</em> in series over the same number, so an improvement already made was that after the first division the number is <em class="text-italics">not</em> sorted again because the next division require it also in reversed order, so just the final result of the second division is sorted again; this mod saves two SORT commands. Several similar modifications can be made to this code; I will post they in the next version...<br /><br />Antonio</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54434" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile54434">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchdc63.html?author_id=2923&amp;sr=posts">1540</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 06 Dec 2011 22:15</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> México City, México</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54434">

						<h3 ><a href="#p54434">Re: Batch macro vs function call test</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting00e9.html?mode=quote&amp;f=3&amp;p=54434" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic3f9c.html?p=54434#p54434" onclick="prompt('Message #13',this.href); return false;">#13</a></span> 
									<a class="unread" href="viewtopic3f9c.html?p=54434#p54434" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist07be.html?mode=viewprofile&amp;u=2923" style="color: #00AA00;" class="username-coloured">Aacini</a></strong> &raquo; </span>17 Oct 2017 21:55
			</p>
			
			
			
			<div class="content">I completed several modifications to previous Version 3 code that decrease the running time. This is a list of the changes made in this new Version 4:<br /><br /><ul><li> The <strong class="text-strong">One.txt</strong> file is now created in reversed order. This file is copied to PiTerm before the first division, so one SORT /R command was eliminated.</li><li> After first division, PiTerm in reversed order is copied into AR_Recip. Another SORT command is eliminated in second division.</li><li> AR_Recip is used in division operations <em class="text-italics">only</em>, so it is never re-sorted again. One SORT command was eliminated.</li><li> AR_Term is copied from AR_Recip and then used in a division, so its SORT /R command was eliminated.</li><li> The <strong class="text-strong">FC AR_Term.txt Zero.txt</strong> command was replaced by a SET /A expression that indicate if AR_Term is zero.</li><li> The loop at :ArctanLoop label assembled with GOTO was changed by an infinite <strong class="text-strong">FOR /L %%i in ( )</strong> loop executed in a new cmd.exe context that is break by an EXIT (no /B switch) command (while loop). This modification not only runs this code segment faster, but also allows to remove all macro variables from the environment after they were expanded.</li></ul><br />This is the new <strong class="text-strong">Version 4</strong> code:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@if defined talk (echo on) else (echo off)<br />setlocal EnableDelayedExpansion<br />if &quot;%1&quot; equ &quot;ArctanLoop&quot; goto ArctanLoop<br /><br />echo pi.bat&nbsp; -&nbsp; By Don Cross&nbsp; -&nbsp; http://cosinekitty.com<br /><br />REM Empty the environment<br />for /F &quot;delims=&quot; %%a in ('where sort') do set &quot;sort=%%a&quot;<br />(<br />for /F &quot;delims==&quot; %%v in ('set') do set &quot;%%v=&quot;<br />set &quot;sort=%sort%&quot;<br />)<br /><br />REM Define the number of groups = 25 Quads = 100 digits<br />set /A A_NumGroups = 3<br />set /A A_NumQuads = NumGroups*25, A_MaxQuadIndex = A_NumQuads-1, @ = 10000<br /><br />call :CreateMacros<br />echo %time% - started<br /><br />call :PiEngine 48 18 32 57 -20 239<br />call :PiEngine 16 5 -4 239<br />goto :EOF<br /><br />:PiEngine<br />&nbsp; &nbsp; REM call :SetToInteger Pi 0<br />&nbsp; &nbsp; copy /Y Zero.txt Pi.txt &gt; NUL<br />&nbsp; &nbsp; set &quot;N_Formula=&quot;<br /><br />&nbsp; &nbsp; :PiTermLoop<br />&nbsp; &nbsp; &nbsp; &nbsp; call :ArctanRecip PiTerm %2<br />&nbsp; &nbsp; &nbsp; &nbsp; if %1 lss 0 (<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REM call :MultiplyByInteger PiTerm -%1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;#=-%1,'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (for /F &quot;tokens=1-26&quot; %%A in (PiTerm.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_MultiplyByInteger#%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; del PiTerm.txt &amp; ren Result.txt PiTerm.txt<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REM call :Subtract Pi PiTerm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt; PiTerm.txt (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%A in (Pi.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;oper2=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%a in (&quot;!oper2!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_Subtract%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; del Pi.txt &amp; ren Result.txt Pi.txt<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;Operator=-&quot;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REM call :MultiplyByInteger PiTerm %1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;#=%1,'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (for /F &quot;tokens=1-26&quot; %%A in (PiTerm.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_MultiplyByInteger#%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; del PiTerm.txt &amp; ren Result.txt PiTerm.txt<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REM call :Add Pi PiTerm<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt; PiTerm.txt (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%A in (Pi.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;oper2=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%a in (&quot;!oper2!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_Add%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; del Pi.txt &amp; ren Result.txt Pi.txt<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;Operator=+&quot;<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; if not defined N_Formula (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;N_Formula=pi = %1*arctan(1/%2)&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;N_Formula=%N_Formula% %Operator% %#%*arctan(1/%2)&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; shift <br />&nbsp; &nbsp; &nbsp; &nbsp; shift<br />&nbsp; &nbsp; if &quot;%1&quot; neq &quot;&quot; goto PiTermLoop<br />&nbsp; &nbsp; call :Print Pi<br />&nbsp; &nbsp; echo %time% - finished %N_Formula%<br />exit /B<br /><br /><br />:ArctanRecip&nbsp; &nbsp;%1 = PiTerm *always*<br /><br />&nbsp; &nbsp; REM call :SetToInteger PiTerm 1<br />&nbsp; &nbsp; copy /Y OneR.txt PiTerm.txt &gt; NUL<br /><br />&nbsp; &nbsp; REM call :DivideByInteger PiTerm %2<br />&nbsp; &nbsp; set /A &quot;#=%2,'=0&quot;<br />&nbsp; &nbsp; (for /F &quot;tokens=1-26&quot; %%A in (PiTerm.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_DivideRbyInteger#%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; )) &gt; AR_Recip.txt<br /><br />&nbsp; &nbsp; REM call :CopyValue AR_Recip PiTerm<br />&nbsp; &nbsp; &quot;%sort%&quot; AR_Recip.txt /O PiTerm.txt<br /><br />&nbsp; &nbsp; set /A V_AR_Toggle = -1,&nbsp; V_AR_K = 3<br /><br /><br />&nbsp; &nbsp; REM Re-execute the code starting at ArctanLoop label in a new cmd.exe context<br />&nbsp; &nbsp; for %%a in (&quot;%sort%&quot;) do &quot;%%~DPacmd.exe&quot; /D /C &quot;%~F0&quot; ArctanLoop %2<br />&nbsp; &nbsp; exit /B<br /><br />&nbsp; &nbsp; :ArctanLoop<br /><br />&nbsp; &nbsp; (<br />&nbsp; &nbsp; REM Remove the macros from the environment after they have been expanded<br />&nbsp; &nbsp; for /F &quot;delims==&quot; %%v in ('set M_') do set &quot;%%v=&quot;<br /><br />&nbsp; &nbsp; for /L %%? in ( ) do (<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; REM call :DivideByInteger AR_Recip %2<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;#=%2,'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; (for /F &quot;tokens=1-26&quot; %%A in (AR_Recip.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_DivideRbyInteger#%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; REM call :DivideByInteger AR_Recip %2<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; (for /F &quot;tokens=1-26&quot; %%A in (Result.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_DivideRbyInteger#%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; )) &gt; AR_Recip.txt<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; REM call :CopyValue AR_Term AR_Recip<br />&nbsp; &nbsp; &nbsp; &nbsp; copy /Y AR_Recip.txt AR_Term.txt &gt; NUL<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; REM call :DivideByInteger AR_Term !AR_K!<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;#=V_AR_K,'=0, AR_Term=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; (for /F &quot;tokens=1-26&quot; %%A in (AR_Term.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_DivideRbyInteger#%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;AR_Term+=%M_Sum%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; REM Exit from the infinite FOR /L loop (while loop)<br />&nbsp; &nbsp; &nbsp; &nbsp; if !AR_Term! equ 0 exit<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;%sort%&quot; Result.txt /O AR_Term.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; if !V_AR_Toggle! lss 0 (<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REM call :Subtract PiTerm AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt; AR_Term.txt (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%A in (PiTerm.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;oper2=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%a in (&quot;!oper2!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_Subtract%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; del PiTerm.txt &amp; ren Result.txt PiTerm.txt<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REM call :Add PiTerm AR_Term<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;'=0&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt; AR_Term.txt (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%A in (PiTerm.txt) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;oper2=&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%a in (&quot;!oper2!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;%M_Add%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; echo %%A%M_Result%<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; )) &gt; Result.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; del PiTerm.txt &amp; ren Result.txt PiTerm.txt<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a V_AR_K += 2, V_AR_Toggle *= -1<br /><br />&nbsp; &nbsp; ))<br /><br />exit /B<br /><br /><br />:Print<br />&nbsp; &nbsp; echo/<br />&nbsp; &nbsp; &lt; NUL (<br />&nbsp; &nbsp; set /P &quot;=%1 = &quot;<br />&nbsp; &nbsp; set &quot;line=0&quot;<br />&nbsp; &nbsp; for /F &quot;tokens=1-26&quot; %%A in ('&quot;%sort%&quot; /R %1.txt') do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A &quot;line+=1,%M_PrintAdjust%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; if !line! equ 1 (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;=%M_PrintFormat:!Z:~1!=!Z:~-1!.%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else if !line! lss %A_NumGroups% (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;=%M_PrintFormat%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /P &quot;=%M_PrintFormat:!C:~1!!B:~1!=%&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; ))<br />&nbsp; &nbsp; echo/<br />&nbsp; &nbsp; echo/<br />exit /B<br /><br /><br />REM&nbsp; &nbsp; $Log: pi.bat,v $<br />REM&nbsp; &nbsp; Revision 1.2&nbsp; 2007/09/06 21:49:15&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Added time stamps and display of formula.<br />REM<br />REM&nbsp; &nbsp; Revision 1.1&nbsp; 2007/09/06 21:12:36&nbsp; Don.Cross<br />REM&nbsp; &nbsp; Batch file for calculating pi<br />REM<br /><br /><br />:CreateMacros<br /><br />&nbsp; &nbsp; set &quot;n=&quot;<br />&nbsp; &nbsp; for /L %%i in (2,1,25) do set &quot;n=!n!0 &quot;<br />&nbsp; &nbsp; set /A &quot;i=100+A_NumGroups&quot;<br />&nbsp; &nbsp; (<br />&nbsp; &nbsp; echo !i:~1! %n%1<br />&nbsp; &nbsp; for /L %%i in (2,1,%A_NumGroups%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A i-=1<br />&nbsp; &nbsp; &nbsp; &nbsp; echo !i:~1! %n%0<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; ) &gt; OneR.txt<br />&nbsp; &nbsp; set /A &quot;i=101&quot;<br />&nbsp; &nbsp; (for /L %%i in (1,1,%A_NumGroups%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; echo !i:~1! %n%0<br />&nbsp; &nbsp; &nbsp; &nbsp; set /A i+=1<br />&nbsp; &nbsp; )) &gt; Zero.txt<br /><br />&nbsp; &nbsp; set&nbsp; &quot;upCase=A B C D E F G H I J K L M N O P Q R S T U V W X Y Z&quot;<br />&nbsp; &nbsp; set &quot;lowCase=a b c d e f g h i j k l m n o p q r s t u v w x y z&quot;<br /><br />&nbsp; &nbsp; REM One-char variables: $=Digit, '=Carry, @=10000, #=int number for multiply/divide<br /><br />&nbsp; &nbsp; set &quot;M_MultiplyByInteger#=&quot;<br />&nbsp; &nbsp; for %%i in (%upCase:~2%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_MultiplyByInteger#=!M_MultiplyByInteger#!,$='+%%%%i*#,%%i=$%%@,'=$/@&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;M_MultiplyByInteger#=!M_MultiplyByInteger#:~1!&quot;<br /><br />&nbsp; &nbsp; set &quot;M_DivideRbyInteger#=&quot;<br />&nbsp; &nbsp; for %%i in (%upCase:~2%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_DivideRbyInteger#=$='*@+%%%%i,%%i=$/#,'=$%%#,!M_DivideRbyInteger#!&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;M_DivideRbyInteger#=!M_DivideRbyInteger#:~0,-1!&quot;<br /><br />&nbsp; &nbsp; set &quot;M_Add=&quot;<br />&nbsp; &nbsp; set &quot;M_Sum=&quot;<br />&nbsp; &nbsp; set &quot;lowCase2=%lowCase:~2%&quot;<br />&nbsp; &nbsp; for %%i in (%upCase:~2%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1*&quot; %%j in (&quot;!lowCase2!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_Add=!M_Add!,$='+%%%%i+%%%%j,%%i=$%%@,'=$/@&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;lowCase2=%%k&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_Sum=!M_Sum!+%%%%i&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;M_Add=%M_Add:~1%&quot;<br />&nbsp; &nbsp; set &quot;M_Sum=%M_Sum:~1%&quot;<br /><br />&nbsp; &nbsp; set &quot;M_Subtract=&quot;<br />&nbsp; &nbsp; set &quot;lowCase2=%lowCase:~2%&quot;<br />&nbsp; &nbsp; for %%i in (%upCase:~2%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; for /F &quot;tokens=1*&quot; %%j in (&quot;!lowCase2!&quot;) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_Subtract=!M_Subtract!,$=%%%%i-%%%%j+','=$&gt;&gt;31,%%i=$-'*@&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set &quot;lowCase2=%%k&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;M_Subtract=%M_Subtract:~1%&quot;<br /><br />&nbsp; &nbsp; set &quot;M_Result=&quot;<br />&nbsp; &nbsp; for %%i in (%upCase:~2%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_Result=!M_Result! ^!%%i^!&quot;<br />&nbsp; &nbsp; )<br /><br />&nbsp; &nbsp; set &quot;M_PrintAdjust=&quot;<br />&nbsp; &nbsp; set &quot;M_PrintFormat=&quot;<br />&nbsp; &nbsp; for %%i in (%upCase:~2%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_PrintAdjust=!M_PrintAdjust!,%%i=@+%%%%i&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; set &quot;M_PrintFormat=^!%%i:~1^!!M_PrintFormat!&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set &quot;M_PrintAdjust=%M_PrintAdjust:~1%&quot;<br /><br />&nbsp; &nbsp; set &quot;upCase=&quot;<br />&nbsp; &nbsp; set &quot;lowCase=&quot;<br /><br />exit /B<br /></code></pre></div><br />This is the final table that include the results from Version 4:  <img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" />  <img class="smilies" src="images/smilies/icon_cool.gif" alt="8)" title="Cool" /> <br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Quads&nbsp; &nbsp;Original&nbsp; &nbsp; V1:Efficient&nbsp; &nbsp;V2:V1+Environ&nbsp; &nbsp;V3:File&nbsp; &nbsp;V4:V3+Efficient<br /><br />&nbsp; 25&nbsp; &nbsp; &nbsp; &nbsp;27.93&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10.81&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8.01&nbsp; &nbsp; &nbsp; &nbsp; 27.15&nbsp; &nbsp; &nbsp; &nbsp; 7.24<br />&nbsp; 50&nbsp; &nbsp; &nbsp; 103.00&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;69.97&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 48.18&nbsp; &nbsp; &nbsp; &nbsp; 62.31&nbsp; &nbsp; &nbsp; &nbsp;18.52<br />&nbsp; 75&nbsp; &nbsp; &nbsp; 259.24&nbsp; &nbsp; &nbsp; &nbsp; 224.30&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;151.84&nbsp; &nbsp; &nbsp; &nbsp;104.94&nbsp; &nbsp; &nbsp; &nbsp;34.28<br />&nbsp;100&nbsp; &nbsp; &nbsp; 511.39&nbsp; &nbsp; &nbsp; &nbsp; 515.69&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;345.57&nbsp; &nbsp; &nbsp; &nbsp;150.95&nbsp; &nbsp; &nbsp; &nbsp;51.58<br />&nbsp;150&nbsp; &nbsp; &nbsp;1458.53&nbsp; &nbsp; &nbsp; &nbsp;1759.33&nbsp; &nbsp; &nbsp; &nbsp; 1158.11&nbsp; &nbsp; &nbsp; &nbsp;266.01&nbsp; &nbsp; &nbsp; 100.17<br />&nbsp;200&nbsp; &nbsp; &nbsp;3157.66&nbsp; &nbsp; &nbsp; &nbsp;-------&nbsp; &nbsp; &nbsp; &nbsp; 2737.64&nbsp; &nbsp; &nbsp; &nbsp;400.80&nbsp; &nbsp; &nbsp; 163.49<br />&nbsp;250&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 570.67&nbsp; &nbsp; &nbsp; 228.17<br />&nbsp;300&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-------&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 740.29&nbsp; &nbsp; &nbsp; 316.05<br /></code></pre></div><br /><br />Antonio</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54438" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile54438">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searche2bd.html?author_id=3864&amp;sr=posts">762</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 15 Jun 2012 13:16</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Italy, Rome</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54438">

						<h3 ><a href="#p54438">Re: Batch macro vs function call test</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting07a6.html?mode=quote&amp;f=3&amp;p=54438" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopiccee2.html?p=54438#p54438" onclick="prompt('Message #14',this.href); return false;">#14</a></span> 
									<a class="unread" href="viewtopiccee2.html?p=54438#p54438" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a></strong> &raquo; </span>18 Oct 2017 09:44
			</p>
			
			
			
			<div class="content"><img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" />  <img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" />  <img class="smilies" src="images/smilies/icon_cool.gif" alt="8)" title="Cool" /> <br /><br />Hi Antonio, <br /><br />this version is very efficiency.<br /><br />There is a problem when I press CONTROL-C, the batch don't stop. It's possible break ?<br /><br />Francesco<br /><br />EDIT<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set /A A_NumGroups = 3<br />set /A A_NumQuads = NumGroups*25, A_MaxQuadIndex = A_NumQuads-1, @ = 10000<br /></code></pre></div><br />There is an error on A_NumQuads. It uses NumGroup instead of A_NumGroups. But the batch work fine  <img class="smilies" src="images/smilies/icon_confused.gif" alt=":?" title="Confused" /></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p54440" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile54440">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searche2bd.html?author_id=3864&amp;sr=posts">762</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 15 Jun 2012 13:16</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Italy, Rome</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content54440">

						<h3 ><a href="#p54440">Re: Batch macro vs function call test</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postinge9fd.html?mode=quote&amp;f=3&amp;p=54440" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicf1b6-2.html?p=54440#p54440" onclick="prompt('Message #15',this.href); return false;">#15</a></span> 
									<a class="unread" href="viewtopicf1b6-2.html?p=54440#p54440" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlista071.html?mode=viewprofile&amp;u=3864" class="username">einstein1969</a></strong> &raquo; </span>18 Oct 2017 11:57
			</p>
			
			
			
			<div class="content">I have compared the last version of mine and your and the original  <img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" />  <img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" />  <img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" />  <img class="smilies" src="images/smilies/icon_lol.gif" alt=":lol:" title="Laughing" /> <br /><br />time in seconds.<br /><img src="../../i65.tinypic.com/1zppcnr.png" class="postimage" alt="Image" /><br /><br />Francesco</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
	

	<div class="action-bar bar-bottom">
	
			<a href="posting32eb.html?mode=reply&amp;f=3&amp;t=4790" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
		
		<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopicc808.html?f=3&amp;t=4790&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>

			<form method="post" action="https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=4790">
		<div class="dropdown-container dropdown-container-left dropdown-button-control sort-tools">
	<span title="Display and sorting options" class="button button-secondary dropdown-trigger dropdown-select">
		<i class="icon fa-sort-amount-asc fa-fw" aria-hidden="true"></i>
		<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
	</span>
	<div class="dropdown hidden">
		<div class="pointer"><div class="pointer-inner"></div></div>
		<div class="dropdown-contents">
			<fieldset class="display-options">
							<label>Display: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
								<label>Sort by: <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label>
				<label>Direction: <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select></label>
								<hr class="dashed" />
				<input type="submit" class="button2" name="sort" value="Go" />
						</fieldset>
		</div>
	</div>
</div>
		</form>
	
	
	
			<div class="pagination">
			19 posts
							<ul>
		<li class="active"><span>1</span></li>
				<li><a class="button" href="viewtopicf4db-2.html?f=3&amp;t=4790&amp;start=15" role="button">2</a></li>
				<li class="arrow next"><a class="button button-icon-only" href="viewtopicf4db-2.html?f=3&amp;t=4790&amp;start=15" rel="next" role="button"><i class="icon fa-chevron-right fa-fw" aria-hidden="true"></i><span class="sr-only">Next</span></a></li>
	</ul>
					</div>
	</div>


<div class="action-bar actions-jump">
		<p class="jumpbox-return">
		<a href="viewforum4d6b.html?f=3" class="left-box arrow-left" accesskey="r">
			<i class="icon fa-angle-left fa-fw icon-black" aria-hidden="true"></i><span>Return to “DOS Batch Forum”</span>
		</a>
	</p>
	
		<div class="jumpbox dropdown-container dropdown-container-right dropdown-up dropdown-left dropdown-button-control" id="jumpbox">
			<span title="Jump to" class="button button-secondary dropdown-trigger dropdown-select">
				<span>Jump to</span>
				<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
			</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																				<li><a href="viewforum31e6.html?f=4" class="jumpbox-cat-link"> <span> DosTips - Dos Batch</span></a></li>
																<li><a href="viewforum4d6b.html?f=3" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; DOS Batch Forum</span></a></li>
											</ul>
		</div>
	</div>

	</div>


			</div>


<div id="page-footer" class="page-footer" role="contentinfo">
	<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-footer" class="nav-footer linklist" role="menubar">
		<li class="breadcrumbs">
							<span class="crumb"><a href="../index.html" data-navbar-reference="home"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span>DosTips.com</span></a></span>									<span class="crumb"><a href="index.html" data-navbar-reference="index"><span>Board index</span></a></span>					</li>
		
				<li class="rightside">All times are <span title="UTC-6">UTC-06:00</span></li>
							<li class="rightside">
				<a href="ucp033a.html?mode=delete_cookies" data-ajax="true" data-refresh="true" role="menuitem">
					<i class="icon fa-trash fa-fw" aria-hidden="true"></i><span>Delete all board cookies</span>
				</a>
			</li>
												<li class="rightside" data-last-responsive="true">
				<a href="memberlist4bfd.html?mode=team" role="menuitem">
					<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
				</a>
			</li>
									<li class="rightside" data-last-responsive="true">
				<a href="memberlist8733.html?mode=contactadmin" role="menuitem">
					<i class="icon fa-envelope fa-fw" aria-hidden="true"></i><span>Contact us</span>
				</a>
			</li>
			</ul>

	</div>
</div>

	<div class="copyright">
				<!-- WARNING NO DELETE -->Style developer by <a href="http://tricolor.x-tk.ru/">support forum tricolor</a>, <!-- END WARNING NO DELETE -->Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
									</div>

	<div id="darkenwrapper" class="darkenwrapper" data-ajax-error-title="AJAX error" data-ajax-error-text="Something went wrong when processing your request." data-ajax-error-text-abort="User aborted request." data-ajax-error-text-timeout="Your request timed out; please try again." data-ajax-error-text-parsererror="Something went wrong with the request and the server returned an invalid reply.">
		<div id="darken" class="darken">&nbsp;</div>
	</div>

	<div id="phpbb_alert" class="phpbb_alert" data-l-err="Error" data-l-timeout-processing-req="Request timed out.">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<h3 class="alert_title">&nbsp;</h3><p class="alert_text"></p>
	</div>
	<div id="phpbb_confirm" class="phpbb_alert">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<div class="alert_text"></div>
	</div>
</div>

</div>

<div>
	<a id="bottom" class="anchor" accesskey="z"></a>
	<img src="cron5897.gif?cron_type=cron.task.text_reparser.poll_option" width="1" height="1" alt="cron" /></div>

<script type="text/javascript" src="assets/javascript/jquery.mind772.js?assets_version=34"></script>
<script type="text/javascript" src="assets/javascript/cored772.js?assets_version=34"></script>



<script type="text/javascript" src="styles/prosilver/template/forum_fnd772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/prosilver/template/ajaxd772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/AllanStyle-SUBSILVER/template/jquery-uid772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/AllanStyle-SUBSILVER/template/collapsed772.js?assets_version=34"></script>



</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=4790&p=54440 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 08:40:30 GMT -->
</html>
