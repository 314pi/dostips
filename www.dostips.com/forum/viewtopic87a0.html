<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=6044&start=300&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 08:05:18 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>DosTips.com &bull; JREPL.BAT v7.14 - regex text processor now with Unicode and XRegExp support - Page 21</title>

<link href="styles/AllanStyle-SUBSILVER/theme/print.css" rel="stylesheet">
</head>
<body id="phpbb">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>DosTips.com</h1>
		<p>A Forum all about DOS Batch<br /><a href="index-2.html">https://www.dostips.com/forum/</a></p>

		<h2>JREPL.BAT v7.14 - regex text processor now with Unicode and XRegExp support</h2>
		<p><a href="viewtopicb16d.html?f=3&amp;t=6044">https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=6044</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>21</strong> of <strong>27</strong></div>
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>09 May 2017 03:18</strong></div>
				<div class="author">by <strong>nibel</strong></div>
				<div class="content">Hi, could you help me do a search replace for a string with the &quot; character?<br />I'm trying to replace the string &quot;MODE&quot; &quot;TEST&quot; with the string &quot;MODE&quot; &quot;CALC&quot;<br /><br />I attempted this but it doesn't work<br />jrepl &quot;\b&quot;MODE&quot; &quot;TEST&quot;\b&quot; &quot;&quot;MODE&quot; &quot;CALC&quot;&quot; /f filename /o -<br /><br /><br />thank you!</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>09 May 2017 10:00</strong></div>
				<div class="author">by <strong>Squashman</strong></div>
				<div class="content"><blockquote><div><cite>nibel wrote:</cite>Hi, could you help me do a search replace for a string with the &quot; character?<br />I'm trying to replace the string &quot;MODE&quot; &quot;TEST&quot; with the string &quot;MODE&quot; &quot;CALC&quot;<br /><br />I attempted this but it doesn't work<br />jrepl &quot;\b&quot;MODE&quot; &quot;TEST&quot;\b&quot; &quot;&quot;MODE&quot; &quot;CALC&quot;&quot; /f filename /o -<br /><br /><br />thank you!</div></blockquote><br />Use the hex code for the double quote \x22</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>19 May 2017 03:20</strong></div>
				<div class="author">by <strong>zimxavier</strong></div>
				<div class="content">Hi!<br /><br />1)<br />I want to extract <span style="color: #0040FF">^([ ]{4}|\t)([A-Za-z0-9_-]+)</span> from files. I use this code:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>for /f &quot;delims=&quot; %%a in ('dir /b /a-d &quot;decisions\*.txt&quot; ') do (<br />call BATCH_JREPL &quot;^(&#91; &#93;{4}|\t)(&#91;A-Za-z0-9_-&#93;+)&quot; &quot;$txt=$2&quot; /jmatchq /f &quot;decisions\%%~a&quot; /o &quot;TEMP\%%~a&quot;<br />)</code></pre></div><br />It works fine but all files are in TEMP. There is a way to do it in one file ?<br />It tried this code:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>for /f &quot;delims=&quot; %%a in ('dir /b /a-d &quot;decisions\*.txt&quot; ') do (<br />call BATCH_JREPL &quot;^(&#91; &#93;{4}|\t)(&#91;A-Za-z0-9_-&#93;+)&quot; &quot;$txt=$2&quot; /jmatchq /f &quot;decisions\%%~a&quot; /o &quot;TEMP\file.txt&quot;<br />)</code></pre></div><br />It doesn't work. Only occurrences from the last file in the directory appear. It makes sense, but is there a way to do it directly in one file ?<br /><br />2) I use this code for deleting duplicates (it's from you in a forum  ). I tried to update it with jmatchq but to no avail. Could you help me ?<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>call BATCH_JREPL &quot;&quot; &quot;&quot; /N 10 /f &quot;TEMP\ztemp0_all_decisions.txt&quot; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| sort /REC 30000 /+11 ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| BATCH_JREPL &quot;.*?:(.*)$&quot;&nbsp; &quot;x=p;p=$1;($1==x?false:$src);&quot; /jmatch /jbeg &quot;var p='',x&quot; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| sort /REC 30000 ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| BATCH_JREPL &quot;^.*?:&quot; &quot;&quot; &gt; &quot;TEMP\ztemp1_all_decisions.txt&quot;</code></pre></div><br /><br />Thank you.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>30 May 2017 02:27</strong></div>
				<div class="author">by <strong>zimxavier</strong></div>
				<div class="content">I answer to myself. It might help other persons.<br /><br />1) I didn't realise that <span style="color: #40BF40"><strong class="text-strong">&gt;&gt;</strong></span> works here  <img class="smilies" src="images/smilies/icon_rolleyes.gif" alt=":roll:" title="Rolling Eyes" /> <br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>for %%F in (&quot;decisions\*.txt&quot;) do (<br />call BATCH_JREPL &quot;(advisor_id\s*=\s*)(&#91;A-Za-z0-9_-&#93;+)&quot; &quot;$txt=$2&quot; /jmatchq /f &quot;%%F&quot; &gt;&gt; &quot;TEMP\file.txt&quot;<br />)</code></pre></div><br /><br />2) $txt= need to be in the right place:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>call BATCH_JREPL &quot;&quot; &quot;&quot; /N 10 /f &quot;TEMP\ztemp0_all_decisions.txt&quot; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| sort /REC 30000 /+11 ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| BATCH_JREPL &quot;.*?:(.*)$&quot;&nbsp; &quot;x=p;p=$1;$txt=($1==x?false:$src);&quot; /jmatchq /jbeg &quot;var p='',x&quot; ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| sort /REC 30000 ^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;| BATCH_JREPL &quot;^.*?:&quot; &quot;&quot; &gt; &quot;TEMP\ztemp1_all_decisions.txt&quot;</code></pre></div></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>31 May 2017 07:30</strong></div>
				<div class="author">by <strong>Dilborg</strong></div>
				<div class="content">I'd just like to share some modifications I made the batch file:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>============= :Batch portion ===========<br />@echo off<br />setlocal disableDelayedExpansion<br /><br />REM Debug - `0 for debug<br />SET debug=1<br /><br />REM TESTING parameter output<br />IF %debug%==1&nbsp; GOTO DB1<br />&nbsp; &nbsp; ECHO Parameter1: %1<br />&nbsp; &nbsp; ECHO Parameter2: %2<br />&nbsp; &nbsp; ECHO Parameter3: %3<br />&nbsp; &nbsp; ECHO Parameter4: %4<br />&nbsp; &nbsp; ECHO Parameter5: %5<br />&nbsp; &nbsp; ECHO Parameter6: %6<br />&nbsp; &nbsp; ECHO Parameter7: %7<br />&nbsp; &nbsp; ECHO Parameter8: %8<br />&nbsp; &nbsp;ECHO Parameter9: %9<br />PAUSE<br />:DB1<br />...<br />IF %debug%==0 ECHO:db&nbsp; &nbsp; &nbsp;FIND = %1<br />IF %debug%==0 ECHO:db&nbsp; &nbsp; &nbsp;REPL = %2<br /><br />:: Process Help</code></pre></div><br /><br />I added a debug option and included some verbose echo's of variables throughout the code.  <br /><br />Then I added a switch /DEBUG<br /><br />So when the process I'm attempting to complete fails, I run it with the debug option and this provides an insight into what is going on.<br /><br />Cheers!</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>02 Jun 2017 08:00</strong></div>
				<div class="author">by <strong>zimxavier</strong></div>
				<div class="content"><blockquote><div><cite>dbenham wrote:</cite>Normally (without /M) JREPL reads and processes one line at a time, and the terminating \r\n is not included in the string. So of course searching for \n is pointless. But \r\n automatically gets restored when the resultant line is written.<br /><br />As stated in the documentation, the only way to productively search for \n is to use the /M option, which puts the entire binary image of the file into memory. But, as you say, the /M option is incompatible with /INC.<br /><br />So you need a different approach.<br /><br />I'm not 100% sure of your end goal.<br /><br />Given the following input<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Preserve 1<br />Preserve 2<br />BEGIN<br />A<br />B<br />C<br />END<br />Preserve 3<br />Preserve 4<br /></code></pre></div><br />Then I interpret your desired output to be<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Preserve 1<br />Preserve 2<br />BEGIN<br />A|B|C<br />END<br />Preserve 3<br />Preserve 4<br /></code></pre></div><br />The following should give a result like above. I use the /M option to capture everything between the BEGIN (inclusive) and END (exclusive). I use the /JMATCHQ option to apply a second find/replace on the lines after BEGIN, substituting | for each \r\n.<br /><br />The code is simpler with a simple FOR instead of FOR /F<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />for %%F in (&quot;GAME\*.txt&quot;') do (<br />&nbsp; call jrepl &quot;(^BEGIN\r?\n)(&#91;\s\S&#93;*?)(?=\nEND$)&quot; &quot;$txt=$1+$2.replace(/\r?\n/gm,'|')&quot; /jq /m /f &quot;%%F&quot; /o -<br />)<br /></code></pre></div><br /><br />Dave Benham</div></blockquote><br /><br />This code works fine only if you remove an extra character:<br /><br />for %%F in (&quot;GAME\*.txt&quot;<strong class="text-strong"><span style="color: #FF0000">'</span></strong>) do (<br />  call jrepl &quot;(^BEGIN\r?\n)([\s\S]*?)(?=\nEND$)&quot; &quot;$txt=$1+$2.replace(/\r?\n/gm,'|')&quot; /jq /m /f &quot;%%F&quot; /o -<br />)<br /><br />for %%F in (&quot;GAME\*.txt&quot;) do (<br />  call jrepl &quot;(^BEGIN\r?\n)([\s\S]*?)(?=\nEND$)&quot; &quot;$txt=$1+$2.replace(/\r?\n/gm,'|')&quot; /jq /m /f &quot;%%F&quot; /o -<br />)<br /><br />Thank you for it <img class="smilies" src="images/smilies/icon_smile.gif" alt=":)" title="Smile" /></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>18 Jun 2017 09:11</strong></div>
				<div class="author">by <strong>marotta</strong></div>
				<div class="content">Quick and probably stupid question about JREPL.<br /><br />I am trying to put a carat at the beginning of each line, so that a file of:<br />first<br />second<br />third<br />becomes a file of:<br />^first<br />^second<br />^third<br /><br />The command I am using is:<br />call jrepl &quot;^&quot; &quot;^&quot; /f input.txt /o output.txt<br /><br />But the output file ends up with two carats at the beginning of the line:<br />^^first<br />^^second<br />^^third<br /><br />Can anyone tell me what I am doing wrong?</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>18 Jun 2017 21:41</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">Nothing stupid at all - you are doing the logical thing.<br /><br />Your problem is the result of an unfortunate behavior of batch - CALL doubles quoted carets (&quot;^&quot; becomes &quot;^^&quot;), and there is absolutely nothing you can do to prevent it.<br /><br />So the JREPL program actually sees<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>jrepl &quot;^^&quot; &quot;^^&quot; /f input.txt /o output.txt<br /></code></pre></div><br />It is interesting that the regex engine treats ^^ the same as ^ in the search string. But it obviously causes problems in the replacement string.<br /><br />The best solution is to add the /X option and use the \x5E hex escape sequence for the caret.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>jrepl &quot;^&quot; &quot;\x5E&quot; /x /f input.txt /o output.txt<br /></code></pre></div><br />Another option is to put the find and replace arguments in variables and use the /V option<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set &quot;find=^&quot;<br />set &quot;repl=^&quot;<br />call jrepl find repl /v /f input.txt /o output.txt<br /></code></pre></div>If you use the /V option with extended ascii in either variable, then you should also add the /X option.<br /><br />Another awkward option is to drop the quotes and escape the caret. But it can be difficult to figure out how many rounds of escape are needed, so I don't recommend this option. In your case, you need<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>call jrepl &quot;^&quot; ^^^^^^^^ /f input.txt /o output.txt<br /></code></pre></div><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>06 Jul 2017 03:11</strong></div>
				<div class="author">by <strong>mogodan2008</strong></div>
				<div class="content">Hi,<br /><br />I have a text file like:<br /><br />&lt;eye&gt;<br />&lt;eye-bounds&gt;<br />&lt;attribute name=&quot;3d-position-z&quot;&gt;852.11&lt;/attribute&gt;<br />&lt;attribute name=&quot;3d-position-y&quot;&gt;-92.95&lt;/attribute&gt;<br />&lt;attribute name=&quot;3d-position-x&quot;&gt;-162.88&lt;/attribute&gt;<br />&lt;attribute name=&quot;occlusion&quot;&gt;none&lt;/attribute&gt;<br />&lt;attribute name=&quot;open-closed-state&quot;&gt;closed&lt;/attribute&gt;<br />&lt;geometry&gt;<br />&lt;Rectangle x=&quot;419&quot; y=&quot;288&quot; width=&quot;15&quot; height=&quot;12&quot;/&gt;<br />&lt;/geometry&gt;<br />&lt;/eye-bounds&gt;<br />&lt;/eye&gt;<br />&lt;eye&gt;<br />&lt;eye-bounds&gt;<br />&lt;attribute name=&quot;3d-position-z&quot;&gt;808.20&lt;/attribute&gt;<br />&lt;attribute name=&quot;3d-position-y&quot;&gt;-62.91&lt;/attribute&gt;<br />&lt;attribute name=&quot;3d-position-x&quot;&gt;-123.82&lt;/attribute&gt;<br />&lt;attribute name=&quot;occlusion&quot;&gt;none&lt;/attribute&gt;<br />&lt;attribute name=&quot;open-closed-state&quot;&gt;closed&lt;/attribute&gt;<br />&lt;geometry&gt;<br />&lt;Rectangle x=&quot;446&quot; y=&quot;310&quot; width=&quot;14&quot; height=&quot;11&quot;/&gt;<br />&lt;/geometry&gt;<br />&lt;/eye-bounds&gt;<br />&lt;/eye&gt; <br /><br />How can I use Jrepl in a batch.bat file to read the x value of first eye-bounds and store in a variable var1, <br />and then read the x value of second eye-bounds and store in a variable var2?<br /><br />Thank you!<br /><br />Dan</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>24 Jul 2017 01:48</strong></div>
				<div class="author">by <strong>rebornassassin</strong></div>
				<div class="content">Hi, I'm trying to replace<br />[assembly: AssemblyFileVersion(&quot;<span style="text-decoration: underline"><strong class="text-strong">4.0.0.0</strong></span>&quot;)]<br />with<br />[assembly: AssemblyFileVersion(&quot;<span style="text-decoration: underline"><strong class="text-strong">3.0.0.123</strong></span>&quot;)]<br />where the 4.0.0.0 could be any version number.<br />I'm using the command <div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>jrepl &quot;\&#91;assembly\: AssemblyFileVersion\(&#91;0-9\.\&quot;&#93;*\)\&#93;&quot; &quot;&#91;assembly: AssemblyFileVersion(&quot;3.0.0.532&quot;)&#93;&quot; /f C:\src\App\Properties\AssemblyInfo.cs /o -</code></pre></div><br />Which gives an error, <blockquote class="uncited"><div>AssemblyFileVersion\([0-9\.\&quot;]*\)\]&quot; was unexpected at this time.</div></blockquote><br />I have tested the regular expression \[assembly\: AssemblyFileVersion\([0-9\.\&quot;]*\)\] on <!-- m --><a class="postlink" href="https://regex101.com/">https://regex101.com/</a><!-- m --> which appears to be correct.<br />What am I doing wrong spent a few hours trying this, any help would be much appreciated. <br /><br />I have attached the actual file that I want to run it on.</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>24 Jul 2017 07:19</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">The CSCRIPT engine does not allow passing of a double quote literal within an argument. You must use an escape sequence to represent the quote.<br /><br />You can use the standard regex \x22 hex escape sequence, or you can add the /X option and use the non-standard \q escape sequence.<br /><br />Here is how I would do it:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>jrepl &quot;(\&#91;assembly: AssemblyFileVersion\(\q)&#91;^\q&#93;*(\q\)\&#93;)&quot; $13.0.0.123$2 /x /f C:\src\App\Properties\AssemblyInfo.cs /o -<br /></code></pre></div><br /><br />Dave Benham</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>09 Aug 2017 01:15</strong></div>
				<div class="author">by <strong>zimxavier</strong></div>
				<div class="content">Hi,<br /><br />I have a case a bit complicated. I would like to replace a list of strings in some files with another list from a file. It is like an update. In fact, strings are syntax variables for Sublime Text.<br /><br />TEMP\all_quests.txt (containing strings only, one per line)<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>new_quest1<br />new_quest2<br />new_quest3<br />new_quest4</code></pre></div><br /><br />Part of Game_Syntaxes\syntax_file_1.sublime-syntax<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>...<br />&nbsp; VARIABLE_ALL_QUESTS: |-<br />&nbsp; &nbsp; (?x:<br />&nbsp; &nbsp; &nbsp; &nbsp; old_quest1<br />&nbsp; &nbsp; &nbsp; | old_quest2<br />&nbsp; &nbsp; &nbsp; | old_quest3<br />&nbsp; &nbsp; &nbsp; | old_quest4<br />&nbsp; &nbsp; &nbsp; | old_quest5<br />&nbsp; &nbsp; &nbsp; | old_quest6<br />&nbsp; &nbsp; )<br />...</code></pre></div><br /><br />What I want:<br />Same part of Game_Syntaxes\syntax_file_1.sublime-syntax<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>...<br />&nbsp; VARIABLE_ALL_QUESTS: |-<br />&nbsp; &nbsp; (?x:<br />&nbsp; &nbsp; &nbsp; &nbsp; new_quest1<br />&nbsp; &nbsp; &nbsp; | new_quest2<br />&nbsp; &nbsp; &nbsp; | new_quest3<br />&nbsp; &nbsp; &nbsp; | new_quest4<br />&nbsp; &nbsp; )<br />...</code></pre></div><br /><br />As you can see, the syntax is not the same in TEMP and in Game_Syntaxes (in Game_Syntaxes there is an indentation, the first string has no pipe and the number of strings is not always the same). The first line (<strong class="text-strong">  VARIABLE_ALL_QUESTS: |-</strong>) can exist zero or one time per file. If it exists, the list must be updated. The syntax in Game_Syntaxes is always the same (only strings and VARIABLE_ALL_QUESTS change).<br />All strings match the regex [A-Za-z0-9_-]+ (no spaces, no accents, etc.) and are not very long (&lt;50 characters), but can be thousands.<br />There are<br />- 52 lists (one list per file in TEMP)<br />- 64 syntax files in Game_Syntaxes (some of them have 30 000 lines, but &lt; 800kb).<br /><br />Currently I use a script working fine, but it is very slow. I'm pretty sure it can be a lot faster. Furthermore, I use a workaround (put the list in one line) because I have no ideas how replacing several lines by several lines from a file. Avoiding it should speed things up.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:::: This first part exists 52 times... Not fast either<br />:: remove duplicated strings<br />call BATCH_JREPL &quot;&quot; &quot;&quot; /N 10 /f &quot;TEMP\ztemp0_all_quests.txt&quot; ^<br />&nbsp; &nbsp;| sort /REC 30000 /+11 ^<br />&nbsp; &nbsp;| BATCH_JREPL &quot;.*?:(.*)$&quot;&nbsp; &quot;x=p;p=$1;$txt=($1==x?false:$src);&quot; /jmatchq /jbeg &quot;var p='',x&quot; ^<br />&nbsp; &nbsp;| sort /REC 30000 ^<br />&nbsp; &nbsp;| BATCH_JREPL &quot;^.*?:&quot; &quot;&quot; &gt; &quot;TEMP\ztemp1_all_quests.txt&quot;<br />:: sort the lines<br />sort /REC 30000 /c TEMP\ztemp1_all_quests.txt /o TEMP\all_quests.txt<br />:: change the syntax<br />call BATCH_JREPL &quot;(\r\n)&quot; &quot;|&quot; /i /m /x /f TEMP\all_quests.txt /o -<br />call BATCH_JREPL &quot;\|$&quot; &quot;&quot; /i /m /x /f TEMP\all_quests.txt /o -<br />call BATCH_JREPL &quot;^&quot; &quot;VARIABLE_ALL_QUESTS: '(&quot; /i /m /x /f TEMP\all_quests.txt /o -<br />call BATCH_JREPL &quot;$&quot; &quot;)'&quot; /i /m /x /f TEMP\all_quests.txt /o -<br /><br />:::: Workaround 1 - 30 seconds<br />:: In one line<br />for %%F in (&quot;Game_Syntaxes\*.sublime-syntax&quot;) do (<br />call BATCH_JREPL &quot;(^&nbsp; # MODDABLE\r?\n)(&#91;\s\S&#93;*?)(?=\n&nbsp; # NON MODDABLE$)&quot; &quot;$txt=$1+$2.replace(/\r\n&nbsp; &nbsp; &nbsp; \| /gm,'|')&quot; /jq /m /f &quot;%%F&quot; /o -<br />call BATCH_JREPL &quot;(^&nbsp; # MODDABLE\r?\n)(&#91;\s\S&#93;*?)(?=\n&nbsp; # NON MODDABLE$)&quot; &quot;$txt=$1+$2.replace(/\r\n&nbsp; &nbsp; \)/gm,')\'')&quot; /jq /m /f &quot;%%F&quot; /o -<br />call BATCH_JREPL &quot;(^&nbsp; # MODDABLE\r?\n)(&#91;\s\S&#93;*?)(?=\n&nbsp; # NON MODDABLE$)&quot; &quot;$txt=$1+$2.replace(/\|-\r\n&nbsp; &nbsp; \(\?x:\r\n\s*/gm,'\'(')&quot; /jq /m /f &quot;%%F&quot; /o -<br />)<br /><br />:::: In fact, there are 52 lines like this one. &gt;6 minutes (Just for information, I tried with for %%F and it is even longer)<br />for /f &quot;delims=&quot; %%a in ('dir /b /a-d &quot;Game_Syntaxes\*.sublime-syntax&quot; ') do (<br />call BATCH_JREPL &quot;VARIABLE_ALL_QUESTS: .*$&quot; &quot;$txt=stdin.AtEndOfStream?$0:stdin.ReadLine()&quot; /jq /f &quot;Game_Syntaxes\%%~a&quot; &lt;&quot;TEMP\all_quests.txt&quot; /o -<br />)<br /><br />:::: Workaround 2 - 50 seconds<br />:: In several lines<br />for /f &quot;delims=&quot; %%a in ('dir /b /a-d &quot;Game_Syntaxes\*.sublime-syntax&quot; ') do (<br />call BATCH_JREPL &quot;'\(&quot; &quot;(?x:\r\n&nbsp; &nbsp; &nbsp; &nbsp; &quot; /inc &quot;/^&nbsp; # MODDABLE$/+1:/^&nbsp; # NON MODDABLE$/-1&quot; /x /f &quot;Game_Syntaxes\%%~a&quot; /o -<br />call BATCH_JREPL &quot;\|&quot; &quot;\r\n&nbsp; &nbsp; &nbsp; | &quot; /inc &quot;/^&nbsp; # MODDABLE$/+1:/^&nbsp; # NON MODDABLE$/-1&quot; /x /f &quot;Game_Syntaxes\%%~a&quot; /o -<br />call BATCH_JREPL &quot;\)'&quot; &quot;\r\n&nbsp; &nbsp; )&quot; /inc &quot;/^&nbsp; # MODDABLE$/+1:/^&nbsp; # NON MODDABLE$/-1&quot; /x /f &quot;Game_Syntaxes\%%~a&quot; /o -<br />call BATCH_JREPL &quot;\: &quot; &quot;: |-\r\n&nbsp; &nbsp; &quot; /inc &quot;/^&nbsp; # MODDABLE$/+1:/^&nbsp; # NON MODDABLE$/-1&quot; /x /f &quot;Game_Syntaxes\%%~a&quot; /o -<br />)</code></pre></div><br /><br />I tried to be clear. If you accept to help me on this case and needs to have all real files, I can send them to you by pm.<br />Thank you</div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>24 Aug 2017 02:47</strong></div>
				<div class="author">by <strong>eugenemon</strong></div>
				<div class="content">Hi dbenham,<br /><br />Thank you for JREPL, I'm still learn how this magic works.<br /><br />So to start, I have thousands of these text files that I extracted using ffmpeg's ffprobe:<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>ffprobe : ffprobe version N-82966-g6993bb4 Copyright (c) 2007-2016 the FFmpeg developers<br />At line:26 char:5<br />+&nbsp; &nbsp; &nbsp;ffprobe $oldVideo 2&gt;&amp;1 | Out-File $errorLog<br />+&nbsp; &nbsp; &nbsp;~~~~~~~~~~~~~~~~~~~~~~<br />&nbsp; &nbsp; + CategoryInfo&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : NotSpecified: (ffprobe version...mpeg developers:String) &#91;&#93;, RemoteException<br />&nbsp; &nbsp; + FullyQualifiedErrorId : NativeCommandError<br />&nbsp;<br />&nbsp; built with gcc 5.4.0 (GCC)<br />&nbsp; configuration: --enable-gpl --enable-version3 --enable-dxva2 --enable-libmfx --enable-nvenc --enable-avisynth --enable-bzlib --enable-fontconfig --enable-frei0r --enable-gnutls <br />--enable-iconv --enable-libass --enable-libbluray --enable-libbs2b --enable-libcaca --enable-libfreetype --enable-libgme --enable-libgsm --enable-libilbc --enable-libmodplug <br />--enable-libmp3lame --enable-libopencore-amrnb --enable-libopencore-amrwb --enable-libopenh264 --enable-libopenjpeg --enable-libopus --enable-librtmp --enable-libsnappy <br />--enable-libsoxr --enable-libspeex --enable-libtheora --enable-libtwolame --enable-libvidstab --enable-libvo-amrwbenc --enable-libvorbis --enable-libvpx --enable-libwavpack <br />--enable-libwebp --enable-libx264 --enable-libx265 --enable-libxavs --enable-libxvid --enable-libzimg --enable-lzma --enable-decklink --enable-zlib<br />&nbsp; libavutil&nbsp; &nbsp; &nbsp; 55. 43.100 / 55. 43.100<br />&nbsp; libavcodec&nbsp; &nbsp; &nbsp;57. 70.100 / 57. 70.100<br />&nbsp; libavformat&nbsp; &nbsp; 57. 61.100 / 57. 61.100<br />&nbsp; libavdevice&nbsp; &nbsp; 57.&nbsp; 2.100 / 57.&nbsp; 2.100<br />&nbsp; libavfilter&nbsp; &nbsp; &nbsp;6. 68.100 /&nbsp; 6. 68.100<br />&nbsp; libswscale&nbsp; &nbsp; &nbsp; 4.&nbsp; 3.101 /&nbsp; 4.&nbsp; 3.101<br />&nbsp; libswresample&nbsp; &nbsp;2.&nbsp; 4.100 /&nbsp; 2.&nbsp; 4.100<br />&nbsp; libpostproc&nbsp; &nbsp; 54.&nbsp; 2.100 / 54.&nbsp; 2.100<br />&#91;mpeg @ 0000000002323720&#93; start time for stream 3 is not set in estimate_timings_from_pts<br />&#91;mpeg @ 0000000002323720&#93; Could not find codec parameters for stream 3 (Audio: mlp, 0 channels): unspecified sample format<br />Consider increasing the value for the 'analyzeduration' and 'probesize' options<br />Input #0, mpeg, from 'E:\970912.mpg':<br />&nbsp; Duration: 00:04:28.25, start: 7031.450000, bitrate: 4335 kb/s<br />&nbsp; &nbsp; Stream #0:0&#91;0x1bf&#93;: Data: dvd_nav_packet<br />&nbsp; &nbsp; Stream #0:1&#91;0x1e0&#93;: Video: mpeg1video, yuv420p(tv), 352x288 &#91;SAR 178:163 DAR 1958:1467&#93;, 1150 kb/s, 25 fps, 25 tbr, 90k tbn, 25 tbc<br />&nbsp; &nbsp; Stream #0:2&#91;0xa0&#93;: Audio: pcm_dvd, 48000 Hz, 2 channels, s16, 1536 kb/s<br />&nbsp; &nbsp; Stream #0:3&#91;0xa1&#93;: Audio: mlp, 0 channels<br />Unsupported codec with id 100357 for input stream 0<br /><br /></code></pre></div><br /><br />I only need the following information: <div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>Input #0, mpeg, from 'E:\970912.mpg':<br />&nbsp; Duration: 00:04:28.25, start: 7031.450000, bitrate: 4335 kb/s<br />&nbsp; &nbsp; Stream #0:0&#91;0x1bf&#93;: Data: dvd_nav_packet<br />&nbsp; &nbsp; Stream #0:1&#91;0x1e0&#93;: Video: mpeg1video, yuv420p(tv), 352x288 &#91;SAR 178:163 DAR 1958:1467&#93;, 1150 kb/s, 25 fps, 25 tbr, 90k tbn, 25 tbc<br />&nbsp; &nbsp; Stream #0:2&#91;0xa0&#93;: Audio: pcm_dvd, 48000 Hz, 2 channels, s16, 1536 kb/s<br />&nbsp; &nbsp; Stream #0:3&#91;0xa1&#93;: Audio: mlp, 0 channels</code></pre></div><br /><br />And place them in an excel file table as follows:<br /><a href="https://ibb.co/bBDMp5" class="postlink"><img src="../../preview.ibb.co/mqvZ95/File_Data_Excel_Example1.jpg" class="postimage" alt="Image" /></a><br /><br />I understand that I need to get the information into csv form in order for that to happen. I tried the following code to output the file name as a start but it outputs nothing. I have also checked the regex using regex101.com and it matches the value I am looking for. Please help. <img class="smilies" src="images/smilies/icon_cry.gif" alt=":cry:" title="Crying or Very sad" /> <br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />for %%i in (*.txt) do (<br />call jrepl &quot;^Input #0, mpeg, from '(.*)':$&quot;^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;$txt=$2&quot;^<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/t &quot;/&quot; /jmatchq /i /jbeg &quot;var f&quot; /f &quot;%%i&quot; /o out.txt<br />)</code></pre></div></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>24 Aug 2017 13:47</strong></div>
				<div class="author">by <strong>dbenham</strong></div>
				<div class="content">You have only one captured group, so you want $1 instead of $2 in your code.<br /><br /><br />Below is a complete solution that writes a .csv file for each *.txt, preserving the base name.<br /><br />I don't have access to the image at my current location, so the output is based on my memory from this morning. I may have gotten a detail wrong, but it should be easy to fix.<br /><br />Because I use the /T option, the numbering of captured groups is a bit more complicated. I put in comments above each search expression to show how the groups get numbered.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal<br /><br />:: Build the find and replace arguments, one pair at a time<br />::<br />::&nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2<br />set &quot;find=^Input #0,.*?'(.*)'&quot;<br />set &quot;repl=head='File';data='\x22'+$2+'\x22';$txt=false&quot;<br />::<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; 4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;5<br />set &quot;find=%find%/^\s*(Duration):\s*(.*?),&quot;<br />set &quot;repl=%repl%/head+=','+$4;data+=',\x22'+$5+'\x22';$txt=false&quot;<br />::<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;6&nbsp; &nbsp; 7&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8<br />set &quot;find=%find%/^\s*(Stream #0:\d+).*?:\s*(.*)&quot;<br />set &quot;repl=%repl%/head+=','+$7;data+=',\x22'+$8+'\x22';$txt=false&quot;<br /><br />set &quot;beg=var head='', data=''&quot;<br />set &quot;end=output.WriteLine(head+'\r\n'+data)&quot;<br /><br />for %%F in (*.txt) do (<br />&nbsp; call jrepl find repl /v /jbeg beg /jend end /t &quot;/&quot; /jmatchq /f &quot;%%F&quot; /o &quot;%%~nF.csv&quot;<br />)<br /></code></pre></div><br /><br />Here is the exact same solution, but without the use of environment variables.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />for %%F in (*.txt) do call jrepl ^<br />&nbsp; &quot;^Input #0,.*?'(.*)'/\s*(Duration):\s*(.*?),/^\s*(Stream #0:\d+).*?:\s*(.*)&quot;^<br />&nbsp; &quot;head='File';data='\x22'+$2+'\x22';$txt=false/head+=','+$4;data+=',\x22'+$5+'\x22';$txt=false/head+=','+$7;data+=',\x22'+$8+'\x22';$txt=false&quot;^<br />&nbsp; /jbeg &quot;var head='', data=''&quot;^<br />&nbsp; /jend &quot;output.WriteLine(head+'\r\n'+data)&quot;^<br />&nbsp; /t &quot;/&quot; /jmatchq /f &quot;%%F&quot; /o &quot;%%~nF.csv&quot;<br /></code></pre></div></div>
			</div>
			<hr />
					<div class="post">
				<h3>Re: JREPL.BAT - regex text processor - successor to REPL.BAT</h3>
				<div class="date">Posted: <strong>24 Aug 2017 23:28</strong></div>
				<div class="author">by <strong>eugenemon</strong></div>
				<div class="content">Thank you for your prompt reply.<br /><br />I have tried both codes and now I understand the structure for the capture groups. However, the output file I received shows 3 blank lines when I opened it with notepad++. The file size is now 4 bytes compared to previously (when I did it wrongly) 0kb. I guess that's an improvement.   <img class="smilies" src="images/smilies/icon_confused.gif" alt=":?" title="Confused" /> <br /><br />I tried to do the file portion only as below but it still outputs to nothing:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />setlocal<br /><br />:: Build the find and replace arguments, one pair at a time<br />::<br />::&nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2<br />set &quot;find=^Input #0,.*?'(.*)'&quot;<br />set &quot;repl=head='File';data='\x22'+$2+'\x22';$txt=false&quot;<br /><br />set &quot;beg=var head='', data=''&quot;<br />set &quot;end=output.WriteLine(head+'\r\n'+data)&quot;<br /><br />for %%F in (*.txt) do (<br />&nbsp; call jrepl find repl /v /jbeg beg /jend end /t &quot;/&quot; /jmatchq /f &quot;%%F&quot; /o &quot;%%~nF.csv&quot;<br />)</code></pre></div><br />I tested the regex on regex101 and it proved to matched, so I'm still at a loss.<br /><br />Also, I would like to consolidate all output to one file. I read from a previous post that I can use the following to append the result to the same file. <blockquote class="uncited"><div>&gt;&gt; output.csv</div></blockquote> <br /><br />Anyways, I'm still stuck.</div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="UTC-6">UTC-06:00</span><br />Page <strong>21</strong> of <strong>27</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Limited<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=6044&start=300&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 08:05:18 GMT -->
</html>
