<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=8629&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:14:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="robots" content="noindex" />

<title>DosTips.com &bull; include command inside repl.bat</title>

<link href="styles/AllanStyle-SUBSILVER/theme/print.css" rel="stylesheet">
</head>
<body id="phpbb">
<div id="wrap" class="wrap">
	<a id="top" class="top-anchor" accesskey="t"></a>

	<div id="page-header">
		<h1>DosTips.com</h1>
		<p>A Forum all about DOS Batch<br /><a href="index-2.html">https://www.dostips.com/forum/</a></p>

		<h2>include command inside repl.bat</h2>
		<p><a href="viewtopicb57a.html?f=3&amp;t=8629">https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=8629</a></p>
	</div>

	<div id="page-body" class="page-body">
		<div class="page-number">Page <strong>1</strong> of <strong>1</strong></div>
					<div class="post">
				<h3>include command inside repl.bat</h3>
				<div class="date">Posted: <strong>17 Jun 2018 07:32</strong></div>
				<div class="author">by <strong>BoQsc</strong></div>
				<div class="content">The output I get instead of modified source data:<br>
<br>
<strong class="text-strong">output.txt</strong> (Strangely, it redirects the command I want to execute instead of output of that command)
<blockquote class="uncited"><div>
C:\Users\user\Desktop&gt;IF ""red\s*\+\s*blue"" == "" (type test.txt   | repl "red\s*\+\s*blue" "purple" m  ) 1&gt;output.txt 
</div></blockquote>

The code I added at the top of <strong class="text-strong"> repl.bat</strong>:
<blockquote class="uncited"><div>
IF "%1"=="" (<br>
 type test.txt | <strong class="text-strong">repl </strong>"red\s*\+\s*blue" "purple" m <br>
 ) &gt; <strong class="text-strong">output.txt</strong>
</div></blockquote>

I want that after launching <strong class="text-strong">repl.bat</strong>, it would execute: <strong class="text-strong">type test.txt | repl "red\s*\+\s*blue" "purple" m</strong><br>
and use the same executed repl.bat to search and replace some text. But I seem to have some syntax error. <br>
Maybe someone can point that out?<br>
<br>
<strong class="text-strong">test.txt</strong>
<blockquote class="uncited"><div>
red<br>
+<br>
blue</div></blockquote>

<br>
<strong class="text-strong">REPL.BAT</strong>
<blockquote class="uncited"><div>
IF "%1"=="" (<br>
 type test.txt | repl "red\s*\+\s*blue" "purple" m <br>
 ) &gt; output.txt<br>
<br>
<br>
@if (@X)==(@Y) @end /* Harmless hybrid line that begins a JScript comment<br>
<br>
::************ Documentation ***********<br>
::REPL.BAT version 5.0<br>
:::<br>
:::REPL  Search  Replace  [Options  [SourceVar]]<br>
:::REPL  /?[REGEX|REPLACE]<br>
:::REPL  /V<br>
:::<br>
:::  Performs a global regular expression search and replace operation on<br>
:::  each line of input from stdin and prints the result to stdout.<br>
:::<br>
:::  Each parameter may be optionally enclosed by double quotes. The double<br>
:::  quotes are not considered part of the argument. The quotes are required<br>
:::  if the parameter contains a batch token delimiter like space, tab, comma,<br>
:::  semicolon. The quotes should also be used if the argument contains a<br>
:::  batch special character like &amp;, |, etc. so that the special character<br>
:::  does not need to be escaped with ^.<br>
:::<br>
:::  If called with a single argument of /?, then prints help documentation<br>
:::  to stdout. If a single argument of /?REGEX, then opens up Microsoft's<br>
:::  JScript regular expression documentation within your browser. If a single<br>
:::  argument of /?REPLACE, then opens up Microsoft's JScript REPLACE<br>
:::  documentation within your browser.<br>
:::<br>
:::  If called with a single argument of /V, case insensitive, then prints<br>
:::  the version of REPL.BAT.<br>
:::<br>
:::  Search  - By default, this is a case sensitive JScript (ECMA) regular<br>
:::            expression expressed as a string.<br>
:::<br>
:::            JScript regex syntax documentation is available at<br>
:::            <a href="http://msdn.microsoft.com/en-us/library/ae5bf541(v=vs.80).aspx" class="postlink">http://msdn.microsoft.com/en-us/library ... s.80).aspx</a><br>
:::<br>
:::  Replace - By default, this is the string to be used as a replacement for<br>
:::            each found search expression. Full support is provided for<br>
:::            substituion patterns available to the JScript replace method.<br>
:::<br>
:::            For example, $&amp; represents the portion of the source that matched<br>
:::            the entire search pattern, $1 represents the first captured<br>
:::            submatch, $2 the second captured submatch, etc. A $ literal<br>
:::            can be escaped as $$.<br>
:::<br>
:::            An empty replacement string must be represented as "".<br>
:::<br>
:::            Replace substitution pattern syntax is fully documented at<br>
:::            <a href="http://msdn.microsoft.com/en-US/library/efy6s3e6(v=vs.80).aspx" class="postlink">http://msdn.microsoft.com/en-US/library ... s.80).aspx</a><br>
:::<br>
:::  Options - An optional string of characters used to alter the behavior<br>
:::            of REPL. The option characters are case insensitive, and may<br>
:::            appear in any order.<br>
:::<br>
:::            I - Makes the search case-insensitive.<br>
:::<br>
:::            L - The Search is treated as a string literal instead of a<br>
:::                regular expression. Also, all $ found in Replace are<br>
:::                treated as $ literals.<br>
:::<br>
:::            B - The Search must match the beginning of a line.<br>
:::                Mostly used with literal searches.<br>
:::<br>
:::            E - The Search must match the end of a line.<br>
:::                Mostly used with literal searches.<br>
:::<br>
:::            V - Search and Replace represent the name of environment<br>
:::                variables that contain the respective values. An undefined<br>
:::                variable is treated as an empty string.<br>
:::<br>
:::            A - Only print altered lines. Unaltered lines are discarded.<br>
:::                If both the M and V options are present, then prints the<br>
:::                entire result if there was a change anywhere in the string.<br>
:::                The A option is incompatible with the M option unless the S<br>
:::                option is also present.<br>
:::<br>
:::            M - Multi-line mode. The entire contents of stdin is read and<br>
:::                processed in one pass instead of line by line, thus enabling<br>
:::                search for \n. This also enables preservation of the original<br>
:::                line terminators. If the M option is not present, then every<br>
:::                printed line is termiated with carriage return and line feed.<br>
:::                The M option is incompatible with the A option unless the S<br>
:::                option is also present.<br>
:::<br>
:::                Note: If working with binary data containing NULL bytes,<br>
:::                      then the M option must be used.<br>
:::<br>
:::            X - Enables extended substitution pattern syntax with support<br>
:::                for the following escape sequences within the Replace string:<br>
:::<br>
:::                \\     -  Backslash<br>
:::                \b     -  Backspace<br>
:::                \f     -  Formfeed<br>
:::                \n     -  Newline<br>
:::                \q     -  Quote<br>
:::                \r     -  Carriage Return<br>
:::                \t     -  Horizontal Tab<br>
:::                \v     -  Vertical Tab<br>
:::                \xnn   -  Extended ASCII byte code expressed as 2 hex digits<br>
:::                \unnnn -  Unicode character expressed as 4 hex digits<br>
:::<br>
:::                Also enables the \q escape sequence for the Search string.<br>
:::                The other escape sequences are already standard for a regular<br>
:::                expression Search string.<br>
:::<br>
:::                Also modifies the behavior of \xnn in the Search string to work<br>
:::                properly with extended ASCII byte codes.<br>
:::<br>
:::                Extended escape sequences are supported even when the L option<br>
:::                is used. Both Search and Replace support all of the extended<br>
:::                escape sequences if both the X and L opions are combined.<br>
:::<br>
:::            S - The source is read from an environment variable instead of<br>
:::                from stdin. The name of the source environment variable is<br>
:::                specified in the next argument after the option string. Without<br>
:::                the M option, ^ anchors the beginning of the string, and $ the<br>
:::                end of the string. With the M option, ^ anchors the beginning<br>
:::                of a line, and $ the end of a line.<br>
:::<br>
:::  Return Codes:  0 = At least one change was made<br>
:::                     or the /? or /V option was used<br>
:::<br>
:::                 1 = No change was made<br>
:::<br>
:::                 2 = Invalid call syntax or incompatible options<br>
:::<br>
:::                 3 = JScript runtime error, typically due to invalid regex<br>
:::<br>
::: REPL.BAT was written by Dave Benham, with assistance from DosTips user Aacini<br>
::: to get \xnn to work properly with extended ASCII byte codes. Also assistance<br>
::: from DosTips user penpen diagnosing issues reading NULL bytes, along with a<br>
::: workaround. REPL.BAT was originally posted at:<br>
::: <a href="viewtopicebb5.html?f=3&amp;t=3855" class="postlink">http://www.dostips.com/forum/viewtopic.php?f=3&amp;t=3855</a><br>
:::<br>
<br>
::************ Batch portion ***********<br>
@echo off<br>
if .%2 equ . (<br>
  if "%~1" equ "/?" (<br>
    &lt;"%~f0" cscript //E:JScript //nologo "%~f0" "^:::" "" a<br>
    exit /b 0<br>
  ) else if /i "%~1" equ "/?regex" (<br>
    explorer "<a href="http://msdn.microsoft.com/en-us/library/ae5bf541(v=vs.80).aspx" class="postlink">http://msdn.microsoft.com/en-us/library ... s.80).aspx</a>"<br>
    exit /b 0<br>
  ) else if /i "%~1" equ "/?replace" (<br>
    explorer "<a href="http://msdn.microsoft.com/en-US/library/efy6s3e6(v=vs.80).aspx" class="postlink">http://msdn.microsoft.com/en-US/library ... s.80).aspx</a>"<br>
    exit /b 0<br>
  ) else if /i "%~1" equ "/V" (<br>
    &lt;"%~f0" cscript //E:JScript //nologo "%~f0" "^::(REPL\.BAT version)" "$1" a<br>
    exit /b 0<br>
  ) else (<br>
    call :err "Insufficient arguments"<br>
    exit /b 2<br>
  )<br>
)<br>
echo(%~3|findstr /i "[^SMILEBVXA]" &gt;nul &amp;&amp; (<br>
  call :err "Invalid option(s)"<br>
  exit /b 2<br>
)<br>
echo(%~3|findstr /i "M"|findstr /i "A"|findstr /vi "S" &gt;nul &amp;&amp; (<br>
  call :err "Incompatible options"<br>
  exit /b 2<br>
)<br>
cscript //E:JScript //nologo "%~f0" %*<br>
exit /b %errorlevel%<br>
<br>
:err<br>
&gt;&amp;2 echo ERROR: %~1. Use REPL /? to get help.<br>
exit /b<br>
<br>
************* JScript portion **********/<br>
var rtn=1;<br>
try {<br>
  var env=WScript.CreateObject("WScript.Shell").Environment("Process");<br>
  var args=WScript.Arguments;<br>
  var search=args.Item(0);<br>
  var replace=args.Item(1);<br>
  var options="g";<br>
  if (args.length&gt;2) options+=args.Item(2).toLowerCase();<br>
  var multi=(options.indexOf("m")&gt;=0);<br>
  var alterations=(options.indexOf("a")&gt;=0);<br>
  if (alterations) options=options.replace(/a/g,"");<br>
  var srcVar=(options.indexOf("s")&gt;=0);<br>
  if (srcVar) options=options.replace(/s/g,"");<br>
  if (options.indexOf("v")&gt;=0) {<br>
    options=options.replace(/v/g,"");<br>
    search=env(search);<br>
    replace=env(replace);<br>
  }<br>
  if (options.indexOf("x")&gt;=0) {<br>
    options=options.replace(/x/g,"");<br>
    replace=replace.replace(/\\\\/g,"\\B");<br>
    replace=replace.replace(/\\q/g,"\"");<br>
    replace=replace.replace(/\\x80/g,"\\u20AC");<br>
    replace=replace.replace(/\\x82/g,"\\u201A");<br>
    replace=replace.replace(/\\x83/g,"\\u0192");<br>
    replace=replace.replace(/\\x84/g,"\\u201E");<br>
    replace=replace.replace(/\\x85/g,"\\u2026");<br>
    replace=replace.replace(/\\x86/g,"\\u2020");<br>
    replace=replace.replace(/\\x87/g,"\\u2021");<br>
    replace=replace.replace(/\\x88/g,"\\u02C6");<br>
    replace=replace.replace(/\\x89/g,"\\u2030");<br>
    replace=replace.replace(/\\x8[aA]/g,"\\u0160");<br>
    replace=replace.replace(/\\x8[bB]/g,"\\u2039");<br>
    replace=replace.replace(/\\x8[cC]/g,"\\u0152");<br>
    replace=replace.replace(/\\x8[eE]/g,"\\u017D");<br>
    replace=replace.replace(/\\x91/g,"\\u2018");<br>
    replace=replace.replace(/\\x92/g,"\\u2019");<br>
    replace=replace.replace(/\\x93/g,"\\u201C");<br>
    replace=replace.replace(/\\x94/g,"\\u201D");<br>
    replace=replace.replace(/\\x95/g,"\\u2022");<br>
    replace=replace.replace(/\\x96/g,"\\u2013");<br>
    replace=replace.replace(/\\x97/g,"\\u2014");<br>
    replace=replace.replace(/\\x98/g,"\\u02DC");<br>
    replace=replace.replace(/\\x99/g,"\\u2122");<br>
    replace=replace.replace(/\\x9[aA]/g,"\\u0161");<br>
    replace=replace.replace(/\\x9[bB]/g,"\\u203A");<br>
    replace=replace.replace(/\\x9[cC]/g,"\\u0153");<br>
    replace=replace.replace(/\\x9[dD]/g,"\\u009D");<br>
    replace=replace.replace(/\\x9[eE]/g,"\\u017E");<br>
    replace=replace.replace(/\\x9[fF]/g,"\\u0178");<br>
    replace=replace.replace(/\\b/g,"\b");<br>
    replace=replace.replace(/\\f/g,"\f");<br>
    replace=replace.replace(/\\n/g,"\n");<br>
    replace=replace.replace(/\\r/g,"\r");<br>
    replace=replace.replace(/\\t/g,"\t");<br>
    replace=replace.replace(/\\v/g,"\v");<br>
    replace=replace.replace(/\\x[0-9a-fA-F]{2}|\\u[0-9a-fA-F]{4}/g,<br>
      function($0,$1,$2){<br>
        return String.fromCharCode(parseInt("0x"+$0.substring(2)));<br>
      }<br>
    );<br>
    replace=replace.replace(/\\B/g,"\\");<br>
    search=search.replace(/\\\\/g,"\\B");<br>
    search=search.replace(/\\q/g,"\"");<br>
    search=search.replace(/\\x80/g,"\\u20AC");<br>
    search=search.replace(/\\x82/g,"\\u201A");<br>
    search=search.replace(/\\x83/g,"\\u0192");<br>
    search=search.replace(/\\x84/g,"\\u201E");<br>
    search=search.replace(/\\x85/g,"\\u2026");<br>
    search=search.replace(/\\x86/g,"\\u2020");<br>
    search=search.replace(/\\x87/g,"\\u2021");<br>
    search=search.replace(/\\x88/g,"\\u02C6");<br>
    search=search.replace(/\\x89/g,"\\u2030");<br>
    search=search.replace(/\\x8[aA]/g,"\\u0160");<br>
    search=search.replace(/\\x8[bB]/g,"\\u2039");<br>
    search=search.replace(/\\x8[cC]/g,"\\u0152");<br>
    search=search.replace(/\\x8[eE]/g,"\\u017D");<br>
    search=search.replace(/\\x91/g,"\\u2018");<br>
    search=search.replace(/\\x92/g,"\\u2019");<br>
    search=search.replace(/\\x93/g,"\\u201C");<br>
    search=search.replace(/\\x94/g,"\\u201D");<br>
    search=search.replace(/\\x95/g,"\\u2022");<br>
    search=search.replace(/\\x96/g,"\\u2013");<br>
    search=search.replace(/\\x97/g,"\\u2014");<br>
    search=search.replace(/\\x98/g,"\\u02DC");<br>
    search=search.replace(/\\x99/g,"\\u2122");<br>
    search=search.replace(/\\x9[aA]/g,"\\u0161");<br>
    search=search.replace(/\\x9[bB]/g,"\\u203A");<br>
    search=search.replace(/\\x9[cC]/g,"\\u0153");<br>
    search=search.replace(/\\x9[dD]/g,"\\u009D");<br>
    search=search.replace(/\\x9[eE]/g,"\\u017E");<br>
    search=search.replace(/\\x9[fF]/g,"\\u0178");<br>
    if (options.indexOf("l")&gt;=0) {<br>
      search=search.replace(/\\b/g,"\b");<br>
      search=search.replace(/\\f/g,"\f");<br>
      search=search.replace(/\\n/g,"\n");<br>
      search=search.replace(/\\r/g,"\r");<br>
      search=search.replace(/\\t/g,"\t");<br>
      search=search.replace(/\\v/g,"\v");<br>
      search=search.replace(/\\x[0-9a-fA-F]{2}|\\u[0-9a-fA-F]{4}/g,<br>
        function($0,$1,$2){<br>
          return String.fromCharCode(parseInt("0x"+$0.substring(2)));<br>
        }<br>
      );<br>
      search=search.replace(/\\B/g,"\\");<br>
    } else search=search.replace(/\\B/g,"\\\\");<br>
  }<br>
  if (options.indexOf("l")&gt;=0) {<br>
    options=options.replace(/l/g,"");<br>
    search=search.replace(/([.^$*+?()[{\\|])/g,"\\$1");<br>
    replace=replace.replace(/\$/g,"$$$$");<br>
  }<br>
  if (options.indexOf("b")&gt;=0) {<br>
    options=options.replace(/b/g,"");<br>
    search="^"+search<br>
  }<br>
  if (options.indexOf("e")&gt;=0) {<br>
    options=options.replace(/e/g,"");<br>
    search=search+"$"<br>
  }<br>
  var search=new RegExp(search,options);<br>
  var str1, str2;<br>
<br>
  if (srcVar) {<br>
    str1=env(args.Item(3));<br>
    str2=str1.replace(search,replace);<br>
    if (!alterations || str1!=str2) if (multi) {<br>
      WScript.Stdout.Write(str2);<br>
    } else {<br>
      WScript.Stdout.WriteLine(str2);<br>
    }<br>
    if (str1!=str2) rtn=0;<br>
  } else if (multi){<br>
    var buf=1024;<br>
    str1="";<br>
    while (!WScript.StdIn.AtEndOfStream) {<br>
      str1+=WScript.StdIn.Read(buf);<br>
      buf*=2<br>
    }<br>
    str2=str1.replace(search,replace);<br>
    WScript.Stdout.Write(str2);<br>
    if (str1!=str2) rtn=0;<br>
  } else {<br>
    while (!WScript.StdIn.AtEndOfStream) {<br>
      str1=WScript.StdIn.ReadLine();<br>
      str2=str1.replace(search,replace);<br>
      if (!alterations || str1!=str2) WScript.Stdout.WriteLine(str2);<br>
      if (str1!=str2) rtn=0;<br>
    }<br>
  }<br>
} catch(e) {<br>
  WScript.Stderr.WriteLine("JScript runtime error: "+e.message);<br>
  rtn=3;<br>
}<br>
WScript.Quit(rtn);<br>
<br>

</div></blockquote></div>
			</div>
			<hr />
			</div>

	<div id="page-footer" class="page-footer">
		<div class="page-number">All times are <span title="UTC-6">UTC-06:00</span><br />Page <strong>1</strong> of <strong>1</strong></div>
		<div class="copyright">Powered by phpBB&reg; Forum Software &copy; phpBB Limited<br />https://www.phpbb.com/</div>
	</div>
</div>

</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?f=3&t=8629&view=print by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 06:14:40 GMT -->
</html>
