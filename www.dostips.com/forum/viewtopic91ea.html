<!DOCTYPE html>
<html dir="ltr" lang="en-gb">

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?p=5385 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 08:01:02 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1" />

<title>strLen boosted - DosTips.com</title>


	<link rel="canonical" href="viewtopic0e76-2.html?t=1429">

<!--
	phpBB style name: Allan Style - SUBSILVER
	Based on style:   prosilver (this is the default phpBB3 style)
	Based on style:   subsilver2 (this is the default phpBB3 style)
	Original author:  Tom Beddard ( http://www.subBlue.com/ )
	Modified by:  Allan ( http://x-tk.ru/ )
-->

<link href="assets/css/font-awesome.mind772.css?assets_version=34" rel="stylesheet">
<link href="styles/AllanStyle-SUBSILVER/theme/stylesheetd772.css?assets_version=34" rel="stylesheet">
<link href="styles/AllanStyle-SUBSILVER/theme/en/stylesheetd772.css?assets_version=34" rel="stylesheet">




<!--[if lte IE 9]>
	<link href="./styles/AllanStyle-SUBSILVER/theme/tweaks.css?assets_version=34" rel="stylesheet">
<![endif]-->




<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','../../www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-280191-1', 'auto');
	ga('send', 'pageview');
</script>

</head>
<body id="phpbb" class="nojs notouch section-viewtopic ltr ">

<div id="header-subsilver">
	<a id="top" class="top-anchor" accesskey="t"></a>
		<div class="headerbar" role="banner">
					<div class="inner">

			<div id="site-description" class="site-description">
				<a id="logo" class="logo" href="../index.html" title="DosTips.com"><span class="site_logo"></span></a>
				<h1>DosTips.com</h1>
				<p>A Forum all about DOS Batch</p>
				<p class="skiplink"><a href="#start_here">Skip to content</a></p>
			</div>

									<div id="search-box" class="search-box search-header" role="search">
				<form action="https://www.dostips.com/forum/search.php" method="get" id="search">
				<fieldset>
					<input name="keywords" id="keywords" type="search" maxlength="128" title="Search for keywords" class="inputbox search tiny" size="20" value="" placeholder="Search…" />
					<button class="button button-search" type="submit" title="Search">
						<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
					</button>
					<a href="search.html" class="button button-search-end" title="Advanced search">
						<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
					</a>
					
				</fieldset>
				</form>
			</div>
						
			</div>
					</div>
</div>


<div id="wrap" class="wrap">
	<div id="page-header">
				<div class="navbar-top" role="navigation">
	<div class="inner">

	<ul id="nav-main" class="nav-main linklist" role="menubar">

		<li id="quick-links" class="quick-links dropdown-container responsive-menu" data-skip-responsive="true">
			<a href="#" class="dropdown-trigger">
				<i class="icon fa-bars fa-fw" aria-hidden="true"></i><span>Quick links</span>
			</a>
			<div class="dropdown">
				<div class="pointer"><div class="pointer-inner"></div></div>
				<ul class="dropdown-contents" role="menu">
					
											<li class="separator"></li>
																									<li>
								<a href="search33a7.html?search_id=unanswered" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-gray" aria-hidden="true"></i><span>Unanswered topics</span>
								</a>
							</li>
							<li>
								<a href="search526f.html?search_id=active_topics" role="menuitem">
									<i class="icon fa-file-o fa-fw icon-blue" aria-hidden="true"></i><span>Active topics</span>
								</a>
							</li>
							<li class="separator"></li>
							<li>
								<a href="search.html" role="menuitem">
									<i class="icon fa-search fa-fw" aria-hidden="true"></i><span>Search</span>
								</a>
							</li>
					
											<li class="separator"></li>
																			<li>
								<a href="memberlist4bfd.html?mode=team" role="menuitem">
									<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
								</a>
							</li>
																<li class="separator"></li>

									</ul>
			</div>
		</li>

				<li data-skip-responsive="true">
			<a href="app.php/help/faq.html" rel="help" title="Frequently Asked Questions" role="menuitem">
				<i class="icon fa-question-circle fa-fw" aria-hidden="true"></i><span>FAQ</span>
			</a>
		</li>
						
			<li class="rightside"  data-skip-responsive="true">
			<a href="ucp26c3.html?mode=login" title="Login" accesskey="x" role="menuitem">
				<i class="icon fa-power-off fa-fw" aria-hidden="true"></i><span>Login</span>
			</a>
		</li>
					<li class="rightside" data-skip-responsive="true">
				<a href="ucp8319.html?mode=register" role="menuitem">
					<i class="icon fa-pencil-square-o  fa-fw" aria-hidden="true"></i><span>Register</span>
				</a>
			</li>
						</ul>

	</div>
</div>

<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-breadcrumbs" class="nav-breadcrumbs linklist navlinks" role="menubar">
						<li class="breadcrumbs">
							<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope=""><a href="../index.html" itemprop="url" data-navbar-reference="home"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span itemprop="title">DosTips.com</span></a></span>
										<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope=""><a href="index.html" itemprop="url" accesskey="h" data-navbar-reference="index"><span itemprop="title">Board index</span></a></span>

											<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="4"><a href="viewforum31e6.html?f=4" itemprop="url"><span itemprop="title">DosTips - Dos Batch</span></a></span>
															<span class="crumb"  itemtype="http://data-vocabulary.org/Breadcrumb" itemscope="" data-forum-id="3"><a href="viewforum4d6b.html?f=3" itemprop="url"><span itemprop="title">DOS Batch Forum</span></a></span>
												</li>
		
					<li class="rightside responsive-search">
				<a href="search.html" title="View the advanced search options" role="menuitem">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</a>
			</li>
			</ul>

	</div>
</div>

<div class="navbar-top-link">
	<div class="inner">
		<ul>
			<li class="navbar-top-link-left"><a href="search33a7.html?search_id=unanswered">Unanswered topics</a></li>
			<li class="navbar-top-link-left"><a href="search526f.html?search_id=active_topics">Active topics</a></li>

											</ul>
	</div>
</div>
	</div>

	
	<a id="start_here" class="anchor"></a>
	<div id="page-body" class="page-body" role="main">
		
		
<h2 class="topic-title"><a href="viewtopic9a6d.html?f=3&amp;t=1429">strLen boosted</a></h2>
<!-- NOTE: remove the style="display: none" when you want to have the forum description on the topic body -->
<div style="display: none !important;">Discussion forum for all Windows batch related topics.<br /></div>
<p>
	<strong>Moderator:</strong> <a href="memberlista6a8.html?mode=viewprofile&amp;u=5" class="username">DosItHelp</a>
</p>


<div class="action-bar bar-top">
	
			<a href="postingd154.html?mode=reply&amp;f=3&amp;t=1429" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
	
			<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopicab81.html?f=3&amp;t=1429&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>
	
			<div class="search-box" role="search">
			<form method="get" id="topic-search" action="https://www.dostips.com/forum/search.php">
			<fieldset>
				<input class="inputbox search tiny"  type="search" name="keywords" id="search_keywords" size="20" placeholder="Search this topic…" />
				<button class="button button-search" type="submit" title="Search">
					<i class="icon fa-search fa-fw" aria-hidden="true"></i><span class="sr-only">Search</span>
				</button>
				<a href="search.html" class="button button-search-end" title="Advanced search">
					<i class="icon fa-cog fa-fw" aria-hidden="true"></i><span class="sr-only">Advanced search</span>
				</a>
				<input type="hidden" name="t" value="1429" />
<input type="hidden" name="sf" value="msgonly" />

			</fieldset>
			</form>
		</div>
	
			<div class="pagination">
			25 posts
							<ul>
		<li class="active"><span>1</span></li>
				<li><a class="button" href="viewtopice19a.html?f=3&amp;t=1429&amp;start=15" role="button">2</a></li>
				<li class="arrow next"><a class="button button-icon-only" href="viewtopice19a.html?f=3&amp;t=1429&amp;start=15" rel="next" role="button"><i class="icon fa-chevron-right fa-fw" aria-hidden="true"></i><span class="sr-only">Next</span></a></li>
	</ul>
					</div>
		</div>




<div id="subsilver-nav-topic">
	<div class="inner"><div class="post has-profile">
		<div class="leftsided postbody subsilver-topic-title">Message</div>
		<div class="leftsided postprofile subsilver-topic-author">Author</div>
	</div></div>
</div>

			<div id="p5385" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile5385">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist512a.html?mode=viewprofile&amp;u=1758" class="username">sowgtsoi</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search4992.html?author_id=1758&amp;sr=posts">8</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 23 Oct 2010 10:14</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content5385">

						<h3 class="first"><a href="#p5385">strLen boosted</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting70bb.html?mode=quote&amp;f=3&amp;p=5385" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic91ea.html?p=5385#p5385" onclick="prompt('Message #1',this.href); return false;">#1</a></span> 
									<a class="unread" href="viewtopic91ea.html?p=5385#p5385" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist512a.html?mode=viewprofile&amp;u=1758" class="username">sowgtsoi</a></strong> &raquo; </span>24 Oct 2010 16:46
			</p>
			
			
			
			<div class="content">Hi !<br /><br />I was wondering how to retrieve the length of a string ; I've seen «:strLen» (http://www.dostips.com/DtCodeCmdLib.php#Function.strLen) ; yay !<br /><br /><br />I've also managed to improve it, at least on this configuration : Intel Core Duo T2300 1.66GHz / Windows XPSP3 {5.1.2600}.<br />The code is towards the end of this post.<br /><br /><br /><br />Short version :<br /><br />Perfectly knowing what I was doing from the get-go <img class="smilies" src="images/smilies/icon_cool.gif" alt="8)" title="Cool" /> {...}, I decided to speed up «:strLen» twofold and to remove its 1023 chars limit at that.<br /><br /><br /><br />Long version :<br /><br />Reading the code of «:strLen», the redundancy was bugging me, and, cocksure like an idiot, I was thinking :<br />~ &quot;Why ? Why ? Why not *sim-ply* put a loop here ?!&quot;.<br /><br />Crafting a «for» loop, I was soon st(h)umbling on the «&quot;!str:~%len%!&quot;» thingy with this nasty problem of delayed expansion that can not be nested.<br />~ &quot;... tee hee ...&quot;, I *ne-ver* thought it was possible, promise ! <img class="smilies" src="images/smilies/icon_mrgreen.gif" alt=":mrgreen:" title="Mr. Green" /><br /><br />Now seeing why a «for» was not used, I was still perplexed by the absence of any loop here, be it of the «goto:loop» kind.<br />~ &quot;Is it a case of «goto» allergy ? Is it due to the risk of conflict when putting a label in a function ?&quot;.<br /><br />Anyway, I was devising a manual «goto:loop», renaming «:loop» in a manner unlikely to be encountered outside of «:strLen».<br />This was working correctly .. except for the fact that it was completing in 220% of the time sufficient for the loop-free version.<br />~ Zing ! &quot;This redundancy : it's .. it's a case of loop-unrolling ! Hats off !&quot;.<br /><br />Abandoning the idea to tweak «:strLen», I was lurking around, improving my DOS-fu, when I saw at line 7 of «:getFunctions» (http://www.dostips.com/DtCodeCmdLib.php#Function.getFunctions) that this «call set» nesting expansion trick could also be used in a way remarkably similar to «!»-style delayed expansion.<br />~ &quot;Let's see if a «for» is possible after all ...&quot;.<br /><br />Well, I did not manage to use this trick to good effect ; that said, while trying, I found a way to nest delayed expansions of the «!» variety, which permitted to write the sought-after «for», as slow as it was expected to be.<br />Knowing what to search, I found that I was not the first to have thought about it (http://judago.webs.com/variablecatches.htm#fw-footer) and replaced my clunky «(set tmp=^^!str:~!len!^^!) &amp; for %%t in (&quot;!tmp!&quot;) do if &quot;%%~t&quot;==&quot;&quot; ...» with a leaner «for %%l in (&quot;!len!&quot;) do if &quot;!str:~%%~l!&quot;==&quot;&quot; ...».<br /><br />Now, this «for» is anything but slow : it happens to complete in a good 50% of the time taken by the loop-unrolled implementation of «:strLen».<br />Maybe that internal jumps are way cheaper than manual ones ; this cannot account for the improvement compared to the loop-unrolling though.<br />Maybe that some step of the interpreting needs to occur once only for the body of a «for» kind of loop.<br /><br />With this fancy «for» came an index that was usable to directly compute the notional value of the binary search guess, thus allowing to eliminate the variable «n» and the need to access it ; things then completed in 90% of the previous time.<br /><br />Positing that strings in the wild tend to be short rather than long, I skewed the search in guessing by quarters rather than halves but this was producing disappointing results speed wise.<br /><br />All these percents, compounded, made «:strLen» complete in a small 50% of the time taken the loop-unrolled way.<br /><br /><br />While I was at it, I also focused on the maximum length limit of 1023 characters.<br />It was tempting to simply increase the number of iterations, and cursory tests were successful, but the limit was still a property of the function, not the language.<br />Instead, I chose to push the maximum close to whatever limit is inherent to the underlying machinery at hand by counting the number of full chunks of 1024 characters and letting the binary search occur on the rest.<br />This way, the new version should work wherever the loop-unrolled version works, the search domain being kept untouched.<br /><br />Attempt 1/4)<br />I knew that a usual «for» loop can be exited through a «goto» and now being aware that such loops are faster than those of the «goto:loop» kind, I first tried to combine an infinite «for /l %%i in (0,0,1) do ...» with a «goto:break» ... the script stalled. In fact, if a «goto:break» does redirect the flow outside, some echoing shows that this occurs only after the loop has iterated as many times as instructed to, no matter what. The post-«goto:break» iterations do not seem to have any other effects than to take time and to suggest the avoidance of «goto»s in «for»s.<br /><br />Attempt 2/4)<br />Falling back to a manual «goto:loop», I obtained something that was working well. Despite the overhead of counting the chunks, the new «:strLen» was completing in 60% of the time taken by the loop-unrolled version.<br /><br />Attempt 3/4)<br />Due to the «goto:loop», a label was now embedded in «:strLen». Not really a practical problem, but still ; I entertained the idea of trying a recursive approach, sort of. In fact, I zeroed in on looping directly on the function's label. This required to protect the instructions standing between the label «:strLen» and the body of the loop : they had to be run once only per call from outside «:strLen». Things got a bit dirty. Just before looping, I was appending the string &quot;local_to_strLen&quot; to the semantically numeric chunks' counter : no such thing ought to happen outside of «:strLen», which provides a way to discriminate outside calls and inside jumps. The instructions to protect were placed in a block «(...)» guarded by an «if» : they were to be run only on the condition that &quot;local_to_strLen&quot; was not a suffix of the chunks' counter. When jumped to from inside, the chunks' counter is properly conditioned and the instructions protected / when called from outside, either a homonym of the chunks' counter exists or this variable name is unassigned, anyway neither case exhibits such a suffix.<br />Again, it worked well .. and somehow quicker than with {Attempt 2} for strings of the first chunk where it was hovering under 90% of the previous time.<br />But why ? After all, it had more housekeeping to do.<br />Apparently, the mere fact of enclosing some instructions in a block «(...)» makes them faster <img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" />, even when delayed expansion is not involved, which nonetheless sees its general importance accrued. The speed tests consisting of executing «:strLen» repeatedly, it seems that some cacheability is improved. This puts the «for»-related gain in speed under a new light too.<br />Whatever.<br /><br />Attempt 4/4)<br />I put this fresh awareness to good use on {Attempt 2} ...<br />Enclosing as much as possible of «:strLen»'s body between parentheses worked OK and fast. I was not comfortable with letting a label in a block though, so split it in two, just to see ; it worked even faster.<br />This enclosing led to a decrease of the time taken by {Attempt 2} to a small 85% !. give or take 5 points depending on the lengths of the tested strings. Which, compared to {Attempt 3}, made it complete as fast for short strings and in 70% of the time for long strings.<br /><br />Ultimately, this version was/is completing in a good 50%, overhead included, of the time of its loop-unrolled counterpart. <br /><br /><br /><br />Having read these rules (http://www.dostips.com/DtGeneTermsOfUse.php), I submit this code to your attention :<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:strLen string len -- returns the length of a string via binary search<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- string &#91;in&#93;&nbsp; - variable name containing the string being measured for length<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- len&nbsp; &nbsp; &#91;out&#93; - variable to be used to return the string length<br />:$created 20081122 :$changed 20101020 :$categories StringOperation<br />:$source http://www.dostips.com<br />:: the binary search occurs after all full chunks of 1024 characters (1 KiC) have been counted<br />:: this enables the measurement of lengths nearly as great as the command line limit<br />:: the shortness of the names s for &quot;string&quot; and r for &quot;remainder&quot; helps in this matter<br />:: some blocks seem superfluous, they improve speed<br />:: when initializing s, keep the A up front to ensure we get the length and not the upper bound<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; it also avoids trouble in case of empty string<br />( SETLOCAL ENABLEDELAYEDEXPANSION<br />&nbsp; &nbsp; set s=A!%~1!<br />&nbsp; &nbsp; set nbKiC=0<br />)<br />:strLen#repeat_until_less_than_1_KiC_remains_to_search_through<br />(&nbsp; &nbsp; &nbsp; &nbsp;set r=!s:~1024!<br />&nbsp; &nbsp; &nbsp; &nbsp; if not &quot;!r!&quot;==&quot;&quot; (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a nbKiC+=1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set s=!r!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto:strLen#repeat_until_less_than_1_KiC_remains_to_search_through<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; set len=0<br />&nbsp; &nbsp; for /l %%e in (9,-1,0) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;len|=1&lt;&lt;%%e&quot; &amp; for %%l in (&quot;!len!&quot;) do if &quot;!s:~%%~l!&quot;==&quot;&quot; set /a &quot;len&amp;=~(1&lt;&lt;%%e)&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a &quot;len+=nbKiC&lt;&lt;10&quot;<br />)<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~2&quot; NEQ &quot;&quot; SET &quot;%~2=%len%&quot;<br />)<br />EXIT /b</code></pre></div><br /><br /><br /><em class="text-italics">Side notes :<br /><ul><li>While lurking here, I've seen a previous version (http://www.dostips.com/DtCodeFunctions.php#_Toc128586394) of «:strLen» (http://www.dostips.com/DtCodeCmdLib.php#Function.strLen).<br /></li><li>Tests of correctness and speed are provided in the next post.<br /></li><li>Testing required a less locale dependent version of «:getTod» (http://www.dostips.com/DtCodeFunctions.php#_Toc128586395), here is it :<div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:getTod -- get a Time of Day value in 1/100th seconds<br />::&nbsp; &nbsp;-- %~1: out - time of day<br />SETLOCAL<br />set t=%time: =0%<br />set /a t=((1%t:~0,2%*60+1%t:~3,2%)*60+1%t:~6,2%)*100+1%t:~9,2%-36610100<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~1&quot; NEQ &quot;&quot; SET %~1=%t%<br />)<br />GOTO:EOF</code></pre></div></li></ul></em><br /><br /><br />Thanks for your time !</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p5386" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile5386">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist512a.html?mode=viewprofile&amp;u=1758" class="username">sowgtsoi</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search4992.html?author_id=1758&amp;sr=posts">8</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 23 Oct 2010 10:14</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content5386">

						<h3 ><a href="#p5386">strLen tests</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting7a9c.html?mode=quote&amp;f=3&amp;p=5386" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopiccfb1.html?p=5386#p5386" onclick="prompt('Message #2',this.href); return false;">#2</a></span> 
									<a class="unread" href="viewtopiccfb1.html?p=5386#p5386" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist512a.html?mode=viewprofile&amp;u=1758" class="username">sowgtsoi</a></strong> &raquo; </span>24 Oct 2010 16:50
			</p>
			
			
			
			<div class="content">To test on a system of the NT line, copy the following files in a dedicated folder.<br /><br />The first file is intended to be modified at will depending on what is tested.<br />The others will/should require no tweaking.<br /><br />The tests of correctness produce results in {OK,FAIL}.<br />After a comprehensive test of correctness, searching 'FAIL'-without-quotes in an editor is a quick way to spot problems or limitations.<br /><br /><br /><br />strLen_tests.cmd<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />:: 2010-10-22<br />SETLOCAL ENABLEDELAYEDEXPANSION<br /><br />:: always working in the directory of this script :<br />%~d0 &amp; cd &quot;%~dp0&quot;<br /><br />:: setup :<br />if not exist logs\ mkdir logs<br />if exist tmp\ rmdir /S /Q tmp<br />mkdir tmp<br />for %%v in (<br />&nbsp; &nbsp; A_loopUnrolled<br />&nbsp; &nbsp; B_loopGoto<br />&nbsp; &nbsp; C_loopFor<br />&nbsp; &nbsp; D_loopForJudago<br />&nbsp; &nbsp; E_loopForOptim<br />&nbsp; &nbsp; F_searchSkewed<br />&nbsp; &nbsp; G_chunksAttempt2<br />&nbsp; &nbsp; H_chunksAttempt3<br />&nbsp; &nbsp; I_chunks<br />&nbsp; &nbsp; ) do (<br />&nbsp; &nbsp; type &quot;strLen_tests_stub.txt&quot; &quot;strLen%%v.txt&quot; &gt; &quot;tmp\test_strLen%%v.cmd&quot;<br />) 1&gt;nul 2&gt;nul<br /><br />:: syntactic sugar :<br />set&nbsp; &nbsp; &nbsp; &quot;test= call ^&quot;tmp\test_strLen^^!version^^!.cmd^&quot; &quot;<br />set&nbsp; &nbsp;&quot;do_test= &quot;<br />set &quot;skip_test= if 0==1 &quot;<br /><br /><br />%do_test% (echo:&amp;echo:&amp;ver&amp;echo:Unit test :<br />&nbsp; &nbsp; set &quot;version=A_loopUnrolled&quot;&nbsp; &amp;%test% unittest<br />&nbsp; &nbsp; set &quot;version=B_loopGoto&quot;&nbsp; &nbsp; &nbsp; &amp;%test% unittest<br />&nbsp; &nbsp; set &quot;version=C_loopFor&quot;&nbsp; &nbsp; &nbsp; &nbsp;&amp;%test% unittest<br />&nbsp; &nbsp; set &quot;version=D_loopForJudago&quot; &amp;%test% unittest<br />&nbsp; &nbsp; set &quot;version=E_loopForOptim&quot;&nbsp; &amp;%test% unittest<br />&nbsp; &nbsp; set &quot;version=F_searchSkewed&quot;&nbsp; &amp;%test% unittest<br />&nbsp; &nbsp; set &quot;version=G_chunksAttempt2&quot;&amp;%test% unittest<br />&nbsp; &nbsp; set &quot;version=H_chunksAttempt3&quot;&amp;%test% unittest<br />&nbsp; &nbsp; set &quot;version=I_chunks&quot;&nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% unittest<br />) &gt;con<br />::&gt;&quot;logs\strLen_unittest.log&quot;<br />::&gt;con<br /><br /><br />%skip_test% (echo:&amp;echo:&amp;ver&amp;echo:Points of interest :<br />&nbsp; &nbsp; set &quot;version=A_loopUnrolled&quot;&nbsp; &amp;%test% correctness&nbsp; &nbsp; 0_start 8_span<br />&nbsp; &nbsp; set &quot;version=B_loopGoto&quot;&nbsp; &nbsp; &nbsp; &amp;%test% correctness&nbsp; &nbsp; 0_start 8_span<br />&nbsp; &nbsp; set &quot;version=C_loopFor&quot;&nbsp; &nbsp; &nbsp; &nbsp;&amp;%test% correctness&nbsp; &nbsp; 0_start 8_span<br />&nbsp; &nbsp; set &quot;version=D_loopForJudago&quot; &amp;%test% correctness&nbsp; &nbsp; 0_start 8_span<br />&nbsp; &nbsp; set &quot;version=E_loopForOptim&quot;&nbsp; &amp;%test% correctness&nbsp; &nbsp; 0_start 8_span<br />&nbsp; &nbsp; set &quot;version=F_searchSkewed&quot;&nbsp; &amp;%test% correctness&nbsp; 508_start 8_span<br />&nbsp; &nbsp; set &quot;version=G_chunksAttempt2&quot;&amp;%test% correctness 1020_start 8_span<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% correctness 2044_start 8_span<br />&nbsp; &nbsp; set &quot;version=H_chunksAttempt3&quot;&amp;%test% correctness 1020_start 8_span<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% correctness 2044_start 8_span<br />&nbsp; &nbsp; set &quot;version=I_chunks&quot;&nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% correctness&nbsp; &nbsp; 0_start 8_span<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% correctness 1020_start 8_span<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% correctness 7164_start 8_span<br />) &gt;con<br />::&gt;&quot;logs\strLen_correctness_partial.log&quot;<br />::&gt;con<br /><br /><br />%do_test% (echo:&amp;echo:&amp;ver&amp;echo:Limits :<br />&nbsp; &nbsp; rem function dependent :<br />&nbsp; &nbsp; set &quot;version=A_loopUnrolled&quot;&nbsp; &amp;%test% correctness 1020_start 8_span<br />&nbsp; &nbsp; set &quot;version=B_loopGoto&quot;&nbsp; &nbsp; &nbsp; &amp;%test% correctness 1020_start 8_span<br />&nbsp; &nbsp; set &quot;version=C_loopFor&quot;&nbsp; &nbsp; &nbsp; &nbsp;&amp;%test% correctness 1020_start 8_span<br />&nbsp; &nbsp; set &quot;version=D_loopForJudago&quot; &amp;%test% correctness 1020_start 8_span<br />&nbsp; &nbsp; set &quot;version=E_loopForOptim&quot;&nbsp; &amp;%test% correctness 1020_start 8_span<br />&nbsp; &nbsp; set &quot;version=F_searchSkewed&quot;&nbsp; &amp;%test% correctness 1020_start 8_span<br />&nbsp; &nbsp; <br />&nbsp; &nbsp; rem system dependent (command line limit minus some length for the used command) :<br />&nbsp; &nbsp; set &quot;version=G_chunksAttempt2&quot;&amp;%test% correctness 8183_start 8_span<br />&nbsp; &nbsp; set &quot;version=H_chunksAttempt3&quot;&amp;%test% correctness 8183_start 8_span<br />&nbsp; &nbsp; set &quot;version=I_chunks&quot;&nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% correctness 8183_start 8_span<br />) &gt;con<br />::&gt;&quot;logs\strLen_correctness_limits.log&quot;<br />::&gt;con<br /><br /><br />:: with all versions, takes 5 good minutes at 1.7 GHz :<br />%skip_test% (echo:&amp;echo:&amp;ver&amp;echo:Comprehensive testing :<br />&nbsp; &nbsp; set &quot;version=A_loopUnrolled&quot;&nbsp; &amp;%test% correctness 0_start 1030_span<br />&nbsp; &nbsp; set &quot;version=B_loopGoto&quot;&nbsp; &nbsp; &nbsp; &amp;%test% correctness 0_start 1030_span<br />&nbsp; &nbsp; set &quot;version=C_loopFor&quot;&nbsp; &nbsp; &nbsp; &nbsp;&amp;%test% correctness 0_start 1030_span<br />&nbsp; &nbsp; set &quot;version=D_loopForJudago&quot; &amp;%test% correctness 0_start 1030_span<br />&nbsp; &nbsp; set &quot;version=E_loopForOptim&quot;&nbsp; &amp;%test% correctness 0_start 1030_span<br />&nbsp; &nbsp; set &quot;version=F_searchSkewed&quot;&nbsp; &amp;%test% correctness 0_start 1030_span<br />&nbsp; &nbsp; set &quot;version=G_chunksAttempt2&quot;&amp;%test% correctness 0_start 8200_span<br />&nbsp; &nbsp; set &quot;version=H_chunksAttempt3&quot;&amp;%test% correctness 0_start 8200_span<br />&nbsp; &nbsp; set &quot;version=I_chunks&quot;&nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% correctness 0_start 8200_span<br />) &gt;&quot;logs\strLen_correctness_full_test.log&quot;<br />::&gt;&quot;logs\strLen_correctness_full_test.log&quot;<br />::&gt;con<br /><br /><br />:: with all versions, takes 10 good minutes at 1.7 GHz :<br />%skip_test% (echo:&amp;echo:&amp;echo:&amp;ver&amp;echo:Speed comparisons :&gt;con<br />&nbsp; &nbsp; echo:&amp;set &quot;version=A_loopUnrolled&quot;&nbsp; &amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; rem &quot;warm up&quot; done.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 250_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 500_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 750_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; echo:&amp;set &quot;version=B_loopGoto&quot;&nbsp; &nbsp; &nbsp; &amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 250_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 500_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 750_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; echo:&amp;set &quot;version=C_loopFor&quot;&nbsp; &nbsp; &nbsp; &nbsp;&amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; echo:&amp;set &quot;version=D_loopForJudago&quot; &amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; echo:&amp;set &quot;version=E_loopForOptim&quot;&nbsp; &amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 250_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 500_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 750_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; echo:&amp;set &quot;version=F_searchSkewed&quot;&nbsp; &amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 250_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 500_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 750_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; echo:&amp;set &quot;version=G_chunksAttempt2&quot;&amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 250_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 500_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 750_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 1000_start 1000_span 2_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 2000_start 1000_span 2_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 7000_start 1000_span 2_times<br />&nbsp; &nbsp; echo:&amp;set &quot;version=H_chunksAttempt3&quot;&amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 250_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 500_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 750_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 1000_start 1000_span 2_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 2000_start 1000_span 2_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 7000_start 1000_span 2_times<br />&nbsp; &nbsp; echo:&amp;set &quot;version=I_chunks&quot;&nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 250_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 500_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 750_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 1000_start 1000_span 2_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 2000_start 1000_span 2_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 7000_start 1000_span 2_times<br />&nbsp; &nbsp; rem to check consistency, the first test is repeated :<br />&nbsp; &nbsp; echo:&amp;set &quot;version=A_loopUnrolled&quot;&nbsp; &amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />) &gt;&gt;&quot;logs\strLen_speed_comparisons.log&quot;<br />::&gt;&gt;&quot;logs\strLen_speed_comparisons.log&quot;<br />::&gt;con<br /><br /><br />:: cleaning :<br />if exist tmp\ rmdir /S /Q tmp<br />echo:<br />echo:<br />echo:strLen tests : completed.<br />pause<br />ENDLOCAL<br />@echo on<br />@EXIT /b</code></pre></div><br /><br /><br />strLen_tests_stub.txt<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:: echo stays as defined by the calling script<br />:: 2010-10-21<br />SETLOCAL ENABLEDELAYEDEXPANSION<br /><br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; tmp\&lt;this script&gt;.cmd<br />:: always working in the parent directory of this script :<br />%~d0 &amp; cd &quot;%~dp0&quot; &amp; cd ..<br /><br />echo:<br />:: &quot;nul set p&quot; see http://groups.google.com/group/microsoft.public.win2000.cmdprompt.admin/browse_frm/thread/0874b48308d94030<br />&lt;nul set /p &quot;?=*&quot; &gt;con<br />&lt;nul set /p &quot;?=%~n0 %* :&quot;<br />call :%*<br /><br />ENDLOCAL<br />:: echo stays as defined by the calling script<br />@EXIT /b<br />:: Functions :<br /><br /><br />:correctness begin span<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;int&nbsp; &nbsp;int<br />echo:<br />SETLOCAL ENABLEDELAYEDEXPANSION<br />set &quot;begin=%~1&quot; &amp; set /a &quot;begin+=0&quot; &amp;rem sanitization used to allow number labelling<br />set &quot;end=%~2&quot;&nbsp; &nbsp;&amp; set /a &quot;end+=0, end+=begin, end-=1&quot;<br />set &quot;s=&quot;<br />for /l %%l in (0,1,%begin%) do set s=x!s!<br />set s=%s:~1%<br />::<br />for /l %%l in (%begin%,1,%end%) do (<br />&nbsp; &nbsp; call :strLen s len<br />&nbsp; &nbsp; if &quot;!len!&quot;==&quot;%%l&quot; ( set &quot;res= OK &quot; &amp; set &quot;msg=&quot; ) else ( set &quot;res=FAIL&quot; &amp; set &quot;msg=&nbsp; should be '%%l'&quot; )<br />&nbsp; &nbsp; echo:&#91;!res!&#93;&nbsp; '!len!'!msg!<br />&nbsp; &nbsp; set s=x!s!<br />)<br />ENDLOCAL<br />EXIT /b<br /><br /><br />:speed begin span repeat<br />::&nbsp; &nbsp; &nbsp;int&nbsp; &nbsp;int&nbsp; int<br />SETLOCAL ENABLEDELAYEDEXPANSION<br />set &quot;begin=%~1&quot;&nbsp; &amp; set /a &quot;begin+=0&quot; &amp;rem sanitization used to allow number labelling<br />set &quot;end=%~2&quot;&nbsp; &nbsp; &amp; set /a &quot;end+=0, end+=begin, end-=1&quot;<br />set &quot;repeat=%~3&quot; &amp; set /a &quot;repeat+=0&quot;<br />set &quot;s_init=&quot;<br />for /l %%i in (0,1,%begin%) do set s_init=x!s_init!<br />set s_init=%s_init:~1%<br />::<br />call :getTod tcs_start<br />for /l %%j in (1,1,%repeat%) do (<br />&nbsp; &nbsp; set s=%s_init%<br />&nbsp; &nbsp; for /l %%i in (%begin%,1,%end%) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; call :strLen s len<br />&nbsp; &nbsp; &nbsp; &nbsp; set s=x!s!<br />&nbsp; &nbsp; )<br />)<br />call :getTod tcs_finish<br />set /a &quot;tcs=tcs_finish-tcs_start&quot; &amp; if !tcs! LSS 0 set /a tcs+=8640000<br />&lt;nul set /p &quot;?= %tcs% cs.&quot;<br />ENDLOCAL<br />EXIT /b<br /><br /><br />:: less locale dependent version of getTod<br />:: adapted from http://www.dostips.com/DtCodeFunctions.php#_Toc128586395<br />::<br />:getTod -- get a Time of Day value in 1/100th seconds<br />::&nbsp; &nbsp;-- %~1: out - time of day<br />SETLOCAL<br />set t=%time: =0%<br />set /a t=((1%t:~0,2%*60+1%t:~3,2%)*60+1%t:~6,2%)*100+1%t:~9,2%-36610100<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~1&quot; NEQ &quot;&quot; SET %~1=%t%<br />)<br />GOTO:EOF<br /><br /><br />:unittest<br />echo:<br />:: some &quot;!&quot; here requires to disable delayed expansion<br />SETLOCAL DISABLEDELAYEDEXPANSION<br />echo:---- :unittest.strLen - output<br />call :unittest.strLen<br />echo:----<br />ENDLOCAL<br />EXIT /b<br /><br /><br />:unittest.strLen<br />:$created 20081124 :$changed 20081124<br />:$source http://www.dostips.com<br />for %%C in (<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;H&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;Hi&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;Hi_&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;Hi T&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; &quot;Hi There, what's up!&quot;<br />&nbsp; &nbsp; ) do (<br />&nbsp; &nbsp; set &quot;str=%%~C&quot;<br />&nbsp; &nbsp; call:strLen str len &amp;&amp; (<br />&nbsp; &nbsp; &nbsp; &nbsp; call:Format &quot;&#91;5&#93; characters for &#91;20&#93;.&quot; &quot;'%%len%%'&quot; &quot;'%%str%%'&quot;<br />&nbsp; &nbsp; )<br />)<br />EXIT /b<br /><br /><br />:Format fmt str1 str2 ... -- outputs columns of strings right or left aligned<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -- fmt &#91;in&#93; - format string specifying column width and alignment, i.e. &quot;&#91;-10&#93;&#91;10&#93;&#91;10&#93;&quot;<br />:$created 20060101 :$changed 20091130 :$categories Echo<br />:$source http://www.dostips.com<br />SETLOCAL<br />set &quot;fmt=%~1&quot;<br />set &quot;line=&quot;<br />set &quot;spac=&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;<br />set &quot;i=1&quot;<br />for /f &quot;tokens=1,2 delims=&#91;&quot; %%a in ('&quot;echo..%fmt:&#93;=&amp;echo..%&quot;') do (<br />&nbsp; &nbsp; set /a i+=1<br />&nbsp; &nbsp; call call set &quot;subst=%%%%~%%i%%%spac%%%%%~%%i%%&quot;<br />&nbsp; &nbsp; if %%b0 GEQ 0 (call set &quot;subst=%%subst:~0,%%b%%&quot;<br />&nbsp; &nbsp; ) ELSE&nbsp; &nbsp; &nbsp; &nbsp; (call set &quot;subst=%%subst:~%%b%%&quot;)<br />&nbsp; &nbsp; call set &quot;const=%%a&quot;<br />&nbsp; &nbsp; call set &quot;line=%%line%%%%const:~1%%%%subst%%&quot;<br />)<br />echo.%line%<br />EXIT /b<br /><br /><br />:: the tested version of strLen will be automatically appended here :<br /></code></pre></div><br /><br /><br />strLenA_loopUnrolled.txt<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:strLen string len -- returns the length of a string via binary search, maximum length 1023<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- string &#91;in&#93;&nbsp; - variable name containing the string being measured for length<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- len&nbsp; &nbsp; &#91;out&#93; - variable to be used to return the string length<br />:$created 20081122 :$changed 20081122 :$categories StringOperation<br />:$source http://www.dostips.com<br />SETLOCAL ENABLEDELAYEDEXPANSION<br />set &quot;str=A!%~1!&quot;&amp;rem keep the A up front to ensures we get the length and not the upper bound<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem it also avoids trouble in case of empty string<br />set len=0<br />set /a &quot;n=1&lt;&lt;10&quot;&amp;rem 2^10=1024<br />set /a &quot;n&gt;&gt;=1, len|=n&quot;<br />&nbsp;if &quot;!str:~%len%!&quot;==&quot;&quot; set /a &quot;len&amp;=~n&quot;<br />set /a &quot;n&gt;&gt;=1, len|=n&quot;<br />&nbsp;if &quot;!str:~%len%!&quot;==&quot;&quot; set /a &quot;len&amp;=~n&quot;<br />set /a &quot;n&gt;&gt;=1, len|=n&quot;<br />&nbsp;if &quot;!str:~%len%!&quot;==&quot;&quot; set /a &quot;len&amp;=~n&quot;<br />set /a &quot;n&gt;&gt;=1, len|=n&quot;<br />&nbsp;if &quot;!str:~%len%!&quot;==&quot;&quot; set /a &quot;len&amp;=~n&quot;<br />set /a &quot;n&gt;&gt;=1, len|=n&quot;<br />&nbsp;if &quot;!str:~%len%!&quot;==&quot;&quot; set /a &quot;len&amp;=~n&quot;<br />set /a &quot;n&gt;&gt;=1, len|=n&quot;<br />&nbsp;if &quot;!str:~%len%!&quot;==&quot;&quot; set /a &quot;len&amp;=~n&quot;<br />set /a &quot;n&gt;&gt;=1, len|=n&quot;<br />&nbsp;if &quot;!str:~%len%!&quot;==&quot;&quot; set /a &quot;len&amp;=~n&quot;<br />set /a &quot;n&gt;&gt;=1, len|=n&quot;<br />&nbsp;if &quot;!str:~%len%!&quot;==&quot;&quot; set /a &quot;len&amp;=~n&quot;<br />set /a &quot;n&gt;&gt;=1, len|=n&quot;<br />&nbsp;if &quot;!str:~%len%!&quot;==&quot;&quot; set /a &quot;len&amp;=~n&quot;<br />set /a &quot;n&gt;&gt;=1, len|=n&quot;<br />&nbsp;if &quot;!str:~%len%!&quot;==&quot;&quot; set /a &quot;len&amp;=~n&quot;<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~2&quot; NEQ &quot;&quot; SET &quot;%~2=%len%&quot;<br />)<br />EXIT /b</code></pre></div><br /><br /><br />strLenB_loopGoto.txt<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:strLen string len<br />SETLOCAL ENABLEDELAYEDEXPANSION<br />set &quot;str=A!%~1!&quot;&amp;rem keep the A up front to ensure we get the length and not the upper bound<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem it also avoids trouble in case of empty string<br />rem&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1024 == 2^10<br />set /a &quot;len=0, iterations=10&quot;<br />set /a &quot;n=1&lt;&lt;%iterations%&quot;<br />:strLen#binary_search<br />set /a &quot;n&gt;&gt;=1, len|=n&quot;<br />&nbsp;if &quot;!str:~%len%!&quot;==&quot;&quot; set /a &quot;len&amp;=~n&quot;<br />set /a &quot;iterations-=1&quot; &amp; if 0 LSS !iterations! goto:strLen#binary_search<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~2&quot; NEQ &quot;&quot; SET &quot;%~2=%len%&quot;<br />)<br />EXIT /b</code></pre></div><br /><br /><br />strLenC_loopFor.txt<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:strLen string len<br />SETLOCAL ENABLEDELAYEDEXPANSION<br />set &quot;str=A!%~1!&quot;&amp;rem keep the A up front to ensure we get the length and not the upper bound<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem it also avoids trouble in case of empty string<br />rem&nbsp; &nbsp; &nbsp; &nbsp;1024 == 2^10<br />set /a &quot;len=0, n=1&lt;&lt;10&quot;<br />for /l %%i in (10,-1,1) do (<br />&nbsp; &nbsp; set /a &quot;n&gt;&gt;=1, len|=n&quot; &amp; set tmp=^^!str:~!len!^^!<br />&nbsp; &nbsp; for %%t in (&quot;!tmp!&quot;) do if &quot;%%~t&quot;==&quot;&quot; set /a &quot;len&amp;=~n&quot;<br />)<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~2&quot; NEQ &quot;&quot; SET &quot;%~2=%len%&quot;<br />)<br />EXIT /b</code></pre></div><br /><br /><br />strLenD_loopForJudago.txt<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:strLen string len<br />SETLOCAL ENABLEDELAYEDEXPANSION<br />set &quot;str=A!%~1!&quot;&amp;rem keep the A up front to ensure we get the length and not the upper bound<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem it also avoids trouble in case of empty string<br />rem&nbsp; &nbsp; &nbsp; &nbsp;1024 == 2^10<br />set /a &quot;len=0, n=1&lt;&lt;10&quot;<br />for /l %%i in (10,-1,1) do (<br />&nbsp; &nbsp; set /a &quot;n&gt;&gt;=1, len|=n&quot; &amp; for %%l in (&quot;!len!&quot;) do if &quot;!str:~%%~l!&quot;==&quot;&quot; set /a &quot;len&amp;=~n&quot;<br />)<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~2&quot; NEQ &quot;&quot; SET &quot;%~2=%len%&quot;<br />)<br />EXIT /b</code></pre></div><br /><br /><br />strLenE_loopForOptim.txt<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:strLen string len<br />SETLOCAL ENABLEDELAYEDEXPANSION<br />set &quot;str=A!%~1!&quot;&amp;rem keep the A up front to ensure we get the length and not the upper bound<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem it also avoids trouble in case of empty string<br />set len=0<br />for /l %%e in (9,-1,0) do (<br />&nbsp; &nbsp; set /a &quot;len|=1&lt;&lt;%%e&quot; &amp; for %%l in (&quot;!len!&quot;) do if &quot;!str:~%%~l!&quot;==&quot;&quot; set /a &quot;len&amp;=~(1&lt;&lt;%%e)&quot;<br />)<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~2&quot; NEQ &quot;&quot; SET &quot;%~2=%len%&quot;<br />)<br />EXIT /b</code></pre></div><br /><br /><br />strLenF_searchSkewed.txt<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:strLen<br />SETLOCAL ENABLEDELAYEDEXPANSION<br />set &quot;str=A!%~1!&quot;&amp;rem keep the A up front to ensure we get the length and not the upper bound<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem it also avoids trouble in case of empty string<br />set len=0<br />for /l %%e in (8,-2,0) do (<br />&nbsp; &nbsp; set /a &quot;len+=1&lt;&lt;%%e&quot;<br />&nbsp; &nbsp; for %%l in (&quot;!len!&quot;) do ( if &quot;!str:~%%~l!&quot;==&quot;&quot; ( set /a &quot;len-=1&lt;&lt;%%e&quot; ) else (<br />&nbsp; &nbsp; set /a &quot;len+=1&lt;&lt;%%e&quot;<br />&nbsp; &nbsp; for %%m in (&quot;!len!&quot;) do ( if &quot;!str:~%%~m!&quot;==&quot;&quot; ( set /a &quot;len-=1&lt;&lt;%%e&quot; ) else (<br />&nbsp; &nbsp; set /a &quot;len+=1&lt;&lt;%%e&quot;<br />&nbsp; &nbsp; for %%n in (&quot;!len!&quot;) do&nbsp; &nbsp;if &quot;!str:~%%~n!&quot;==&quot;&quot;&nbsp; &nbsp;set /a &quot;len-=1&lt;&lt;%%e&quot;<br />)))))<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~2&quot; NEQ &quot;&quot; SET &quot;%~2=%len%&quot;<br />)<br />EXIT /b</code></pre></div><br /><br /><br />strLenG_chunksAttempt2.txt<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:strLen string len<br />SETLOCAL ENABLEDELAYEDEXPANSION<br />set str=A!%~1!&amp;rem keep the A up front to ensure we get the length and not the upper bound<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem it also avoids trouble in case of empty string<br />set nbKiC=0&amp;rem 1024 characters == 1 KiC<br />:strLen#repeat_until_less_than_1_KiC_remains_to_search_through<br />&nbsp; &nbsp; set rmd=%str:~1024%<br />&nbsp; &nbsp; if not &quot;%rmd%&quot;==&quot;&quot; (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a nbKiC+=1<br />&nbsp; &nbsp; &nbsp; &nbsp; set str=%rmd%<br />&nbsp; &nbsp; &nbsp; &nbsp; goto:strLen#repeat_until_less_than_1_KiC_remains_to_search_through<br />&nbsp; &nbsp; )<br />set len=0<br />for /l %%e in (9,-1,0) do (<br />&nbsp; &nbsp; set /a &quot;len|=1&lt;&lt;%%e&quot; &amp; for %%l in (&quot;!len!&quot;) do if &quot;!str:~%%~l!&quot;==&quot;&quot; set /a &quot;len&amp;=~(1&lt;&lt;%%e)&quot;<br />)<br />set /a &quot;len+=nbKiC&lt;&lt;10&quot;<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~2&quot; NEQ &quot;&quot; SET &quot;%~2=%len%&quot;<br />)<br />EXIT /b</code></pre></div><br /><br /><br />strLenH_chunksAttempt3.txt<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:strLen string len<br />::&nbsp; &nbsp; &nbsp; &nbsp;1024 characters == 1 KiC<br />if not &quot;local_to_strLen&quot;==&quot;%nbKiC:~-15%&quot; (<br />&nbsp; &nbsp; SETLOCAL ENABLEDELAYEDEXPANSION<br />&nbsp; &nbsp; set str=A!%~1!&amp;rem keep the A up front to ensure we get the length and not the upper bound<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem it also avoids trouble in case of empty string<br />&nbsp; &nbsp; set nbKiC=0<br />) <br />set rmd=%str:~1024%<br />if not &quot;%rmd%&quot;==&quot;&quot; (<br />&nbsp; &nbsp; set /a nbKiC+=1<br />&nbsp; &nbsp; set str=%rmd%<br />&nbsp; &nbsp; set nbKiC=!nbKiC!local_to_strLen&amp; goto:strLen<br />)<br />set len=0<br />for /l %%e in (9,-1,0) do (<br />&nbsp; &nbsp; set /a &quot;len|=1&lt;&lt;%%e&quot; &amp; for %%l in (&quot;!len!&quot;) do if &quot;!str:~%%~l!&quot;==&quot;&quot; set /a &quot;len&amp;=~(1&lt;&lt;%%e)&quot;<br />)<br />set /a &quot;len+=nbKiC&lt;&lt;10&quot;<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~2&quot; NEQ &quot;&quot; SET &quot;%~2=%len%&quot;<br />)<br />EXIT /b</code></pre></div><br /><br /><br />strLenI_chunks.txt<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:strLen string len -- returns the length of a string via binary search<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- string &#91;in&#93;&nbsp; - variable name containing the string being measured for length<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- len&nbsp; &nbsp; &#91;out&#93; - variable to be used to return the string length<br />:$created 20081122 :$changed 20101021 :$categories StringOperation<br />:$source http://www.dostips.com<br />:: the binary search occurs after all full chunks of 1024 characters (1 KiC) have been counted<br />:: this enables the measurement of lengths nearly as great as the command line limit<br />:: the shortness of the names s for &quot;string&quot; and r for &quot;remainder&quot; helps in this matter<br />:: some blocks seem superfluous, they improve speed<br />:: when initializing s, keep the A up front to ensure we get the length and not the upper bound<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; it also avoids trouble in case of empty string<br />( SETLOCAL ENABLEDELAYEDEXPANSION<br />&nbsp; &nbsp; set s=A!%~1!<br />&nbsp; &nbsp; set nbKiC=0<br />)<br />:strLen#repeat_until_less_than_1_KiC_remains_to_search_through<br />(&nbsp; &nbsp; &nbsp; &nbsp;set r=!s:~1024!<br />&nbsp; &nbsp; &nbsp; &nbsp; if not &quot;!r!&quot;==&quot;&quot; (<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set /a nbKiC+=1<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; set s=!r!<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; goto:strLen#repeat_until_less_than_1_KiC_remains_to_search_through<br />&nbsp; &nbsp; &nbsp; &nbsp; )<br />&nbsp; &nbsp; set len=0<br />&nbsp; &nbsp; for /l %%e in (9,-1,0) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;len|=1&lt;&lt;%%e&quot; &amp; for %%l in (&quot;!len!&quot;) do if &quot;!s:~%%~l!&quot;==&quot;&quot; set /a &quot;len&amp;=~(1&lt;&lt;%%e)&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; set /a &quot;len+=nbKiC&lt;&lt;10&quot;<br />)<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~2&quot; NEQ &quot;&quot; SET &quot;%~2=%len%&quot;<br />)<br />EXIT /b</code></pre></div><br /><br /><br />Aaaand that's all !</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p5387" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile5387">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistde6b.html?mode=viewprofile&amp;u=8" class="username">ghostmachine4</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="searchfe6a.html?author_id=8&amp;sr=posts">319</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 12 May 2006 01:13</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content5387">

						<h3 ><a href="#p5387">Re: strLen boosted</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting4ced.html?mode=quote&amp;f=3&amp;p=5387" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicd7dd.html?p=5387#p5387" onclick="prompt('Message #3',this.href); return false;">#3</a></span> 
									<a class="unread" href="viewtopicd7dd.html?p=5387#p5387" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistde6b.html?mode=viewprofile&amp;u=8" class="username">ghostmachine4</a></strong> &raquo; </span>24 Oct 2010 20:34
			</p>
			
			
			
			<div class="content">why use batch in the first place?? <br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>wscript.Echo Len(Wscript.Arguments(0))<br /></code></pre></div></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p5400" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile5400">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist512a.html?mode=viewprofile&amp;u=1758" class="username">sowgtsoi</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search4992.html?author_id=1758&amp;sr=posts">8</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 23 Oct 2010 10:14</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content5400">

						<h3 ><a href="#p5400">Re: strLen boosted</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postinge2d9.html?mode=quote&amp;f=3&amp;p=5400" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic683f.html?p=5400#p5400" onclick="prompt('Message #4',this.href); return false;">#4</a></span> 
									<a class="unread" href="viewtopic683f.html?p=5400#p5400" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist512a.html?mode=viewprofile&amp;u=1758" class="username">sowgtsoi</a></strong> &raquo; </span>27 Oct 2010 15:35
			</p>
			
			
			
			<div class="content">WSH is cool too  <img class="smilies" src="images/smilies/icon_biggrin.gif" alt=":D" title="Very Happy" />.<br /><br />That said, there is some hefty overlap between what batch and WSH scripting are fit for.<br /><br />Obviously, when comes the time to measure the length of a string, WSH has the upper hand.<br /><br />There are many reasons - objective/subjective/good/bad - though, to use batch rather than WSH (even in this case) :<br /><ul><li>immediacy : the transition from the command line to a batch script is frictionless.</li><li>organic growth : the little command/script that becomes beefier and beefier ; it can or can not become wise (need/cost/self-improvement/etc.) one day to port it to WSH/PowerShell/etc.</li><li>network effect, somehow : everybody and his dog has it, so there are plenty of ready-made solutions to problems of all kinds.</li><li>investment : the cost of switching is not worth it for a small script.</li><li>involvement : the cost of switching is not worth it for a big script when the limitation to overcome is, err, limited/tiny/not-a-definitive-showstopper.</li><li>fun : to see what a tool can do.</li><li>possibly other reasons that elude me now.</li></ul><br /><br /><em class="text-italics">Edit : I meant PowerShell, wrote Powerbatch, which is a different beast.</em></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p5488" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile5488">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist7125.html?mode=viewprofile&amp;u=417" class="username">jeb</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search73f1.html?author_id=417&amp;sr=posts">880</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 30 Aug 2007 08:05</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Germany, Bochum</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content5488">

						<h3 ><a href="#p5488">Re: strLen boosted</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingc3bd.html?mode=quote&amp;f=3&amp;p=5488" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic3c5d.html?p=5488#p5488" onclick="prompt('Message #5',this.href); return false;">#5</a></span> 
									<a class="unread" href="viewtopic3c5d.html?p=5488#p5488" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist7125.html?mode=viewprofile&amp;u=417" class="username">jeb</a></strong> &raquo; </span>15 Nov 2010 09:06
			</p>
			
			
			
			<div class="content">Hi sowgtsoi,<br /><br />I'm always interested in solutions with pure batch, so your post is very interesting.<br /><br />I have one idea to improve your solution.<br /><br />With short strings (&lt;=15 chars) you can use a lookup trick.<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set &quot;str=%1&quot;<br />call :strLength result str<br />echo %str% length is %result%<br />goto :eof<br /><br />:strLength<br />setlocal EnableDelayedExpansion<br />set &quot;temp=!str!FEDCBA9876543210&quot;<br />set /a len=0x!temp:~15,1!<br />(<br />endlocal<br />set %1=%len%<br />goto :eof<br />)</code></pre></div><br />jeb</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p5501" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile5501">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlistf906.html?mode=viewprofile&amp;u=1470" class="username">amel27</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search45e1.html?author_id=1470&amp;sr=posts">177</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 04 Jun 2010 20:05</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Russia</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content5501">

						<h3 ><a href="#p5501">Re: strLen boosted</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting7a6d.html?mode=quote&amp;f=3&amp;p=5501" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic4519.html?p=5501#p5501" onclick="prompt('Message #6',this.href); return false;">#6</a></span> 
									<a class="unread" href="viewtopic4519.html?p=5501#p5501" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlistf906.html?mode=viewprofile&amp;u=1470" class="username">amel27</a></strong> &raquo; </span>16 Nov 2010 03:21
			</p>
			
			
			
			<div class="content">Excellent!.. From this follows quick code for string up to 255 chars:<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set &quot;str=%1&quot;<br />call :strLength result str<br />echo %str% length is %result%<br />goto :eof<br /><br />:strLength<br />setlocal EnableDelayedExpansion<br />REM broken into multiple lines by forum moderator to address forum readability issue.&nbsp; FOR BETTER PERFORMANCE SET TEMP IN SINGLE LINE<br />set &quot;temp=!str!!str!&quot;<br />set &quot;temp=!temp!FFFEFDFCFBFAF9F8F7F6F5F4F3F2F1F0EFEEEDECEBEAE9E8E7E6E5E4E3E2E1E0DFDEDDDCDBDAD9D8D7D6D5D4D3D2D1D0CFCECDCCCBCAC9C8C7C6C5C4C3C2C1C0&quot;<br />set &quot;temp=!temp!BFBEBDBCBBBAB9B8B7B6B5B4B3B2B1B0AFAEADACABAAA9A8A7A6A5A4A3A2A1A09F9E9D9C9B9A999897969594939291908F8E8D8C8B8A89888786858483828180&quot;<br />set &quot;temp=!temp!7F7E7D7C7B7A797877767574737271706F6E6D6C6B6A696867666564636261605F5E5D5C5B5A595857565554535251504F4E4D4C4B4A49484746454443424140&quot;<br />set &quot;temp=!temp!3F3E3D3C3B3A393837363534333231302F2E2D2C2B2A292827262524232221201F1E1D1C1B1A191817161514131211100F0E0D0C0B0A09080706050403020100&quot;<br />set/a len=0x!temp:~510,2!<br />(<br />endlocal<br />set %1=%len%<br />goto :eof<br />)<br /></code></pre></div></div>

			
													<div class="notice">
					Last edited by <a href="memberlistf906.html?mode=viewprofile&amp;u=1470" class="username">amel27</a> on 16 Nov 2010 22:34, edited 1 time in total.
									</div>
			
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p5504" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile5504">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist7125.html?mode=viewprofile&amp;u=417" class="username">jeb</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search73f1.html?author_id=417&amp;sr=posts">880</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 30 Aug 2007 08:05</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Germany, Bochum</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content5504">

						<h3 ><a href="#p5504">Re: strLen boosted</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingea62.html?mode=quote&amp;f=3&amp;p=5504" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic9d23.html?p=5504#p5504" onclick="prompt('Message #7',this.href); return false;">#7</a></span> 
									<a class="unread" href="viewtopic9d23.html?p=5504#p5504" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist7125.html?mode=viewprofile&amp;u=417" class="username">jeb</a></strong> &raquo; </span>16 Nov 2010 17:32
			</p>
			
			
			
			<div class="content">@Amel27: Nice extension, simple but good.<br /><br />I think only about to sync the read values, but your solution is much better.<br /><br />jeb</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p5508" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile5508">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlista6a8.html?mode=viewprofile&amp;u=5" class="username">DosItHelp</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search5648.html?author_id=5&amp;sr=posts">239</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 18 Feb 2006 19:54</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content5508">

						<h3 ><a href="#p5508">Re: strLen boosted</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting7083.html?mode=quote&amp;f=3&amp;p=5508" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic4de4.html?p=5508#p5508" onclick="prompt('Message #8',this.href); return false;">#8</a></span> 
									<a class="unread" href="viewtopic4de4.html?p=5508#p5508" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlista6a8.html?mode=viewprofile&amp;u=5" class="username">DosItHelp</a></strong> &raquo; </span>16 Nov 2010 22:07
			</p>
			
			
			
			<div class="content">Jeb, Amel, very very nice!<br /><br /><br />sowgtsoi,<br /><br />Yes the :strlen function at <!-- m --><a class="postlink" href="../DtCodeCmdLib.html#Function.strLen">http://www.dostips.com/DtCodeCmdLib.php#Function.strLen</a><!-- m --> turned out the way it is because:<br /><br />goto:label - is darn slow<br />&quot;goto&quot; appears to search for &quot;label&quot; by looking downwards in the batch starting from the current command until it hits the end of the batch, and then it wraps around to continue searching from the beginning.  So goto performance is bad when jumping backwards and dependents on the size of the batch file.<br />Also if someone uses by accident the same label elsewhere in the script then it would find this other label first and the :strlen function would break.<br /><br />bit shifting in loop - double expansion problem<br />Yes a script block within a loop is fast, because the whole script block is read from file only once, whereas script outside a block is read line by line from file right before processing.  In fact a script can throw script code in front of its own feed while executing - very fun for writing script that modifies itself.<br />However changing the &quot;len&quot; variable used to determine sub-string of &quot;str&quot; requires double variable expansion, delayed-expansion and &quot;!var!&quot; syntax alone doesn't help here and using &quot;call set ...&quot; type expansion is slow because &quot;call&quot; creates a new command context each time.<br /><br />So an unrolled loop was not to bad of a choice because:<br />It was performing good and you can easily scale the function up or down to adapt to different string length, i.e. doubling the supported string size requires only to change the initializer from &quot;n=1&lt;&lt;10&quot; to &quot;n=1&lt;&lt;11&quot; and duplicate another &quot;set and if&quot; line pair in the function body.<br /><br />Well I admit I was never really proud of this function.  Thanks a lot for helping speeding this up and making it much shorter.<br />The :strlen function has been updated in the library.</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p5509" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile5509">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist7125.html?mode=viewprofile&amp;u=417" class="username">jeb</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search73f1.html?author_id=417&amp;sr=posts">880</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 30 Aug 2007 08:05</dd>		
		
											<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Germany, Bochum</dd>
							
						
		</dl>

		<div class="postbody">
						<div id="post_content5509">

						<h3 ><a href="#p5509">Re: strLen boosted</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting905e.html?mode=quote&amp;f=3&amp;p=5509" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic8fcc.html?p=5509#p5509" onclick="prompt('Message #9',this.href); return false;">#9</a></span> 
									<a class="unread" href="viewtopic8fcc.html?p=5509#p5509" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist7125.html?mode=viewprofile&amp;u=417" class="username">jeb</a></strong> &raquo; </span>17 Nov 2010 01:27
			</p>
			
			
			
			<div class="content">Hi DosItHelp,<br /><br />your solutions looks like the one of sowgtsoi, without the part of splitting down to 1024 chars.<br />It's more clear, but you can optimize the for-loop.<br /><br />Because the maximum allowed string length is less than 8192 characters, this should always be enough<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>for /L %%A in (12,-1,0) do</code></pre></div><br /><br />jeb</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p5510" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile5510">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlista6a8.html?mode=viewprofile&amp;u=5" class="username">DosItHelp</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search5648.html?author_id=5&amp;sr=posts">239</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 18 Feb 2006 19:54</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content5510">

						<h3 ><a href="#p5510">Re: strLen boosted</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting7c21.html?mode=quote&amp;f=3&amp;p=5510" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicc9e3.html?p=5510#p5510" onclick="prompt('Message #10',this.href); return false;">#10</a></span> 
									<a class="unread" href="viewtopicc9e3.html?p=5510#p5510" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlista6a8.html?mode=viewprofile&amp;u=5" class="username">DosItHelp</a></strong> &raquo; </span>17 Nov 2010 17:37
			</p>
			
			
			
			<div class="content">oh - I should have looked a bit closer, no real need for my post this again (removed).</div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p5536" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile5536">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist941f.html?mode=viewprofile&amp;u=1572" class="username">orange_batch</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search325b.html?author_id=1572&amp;sr=posts">442</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 01 Aug 2010 17:13</dd>		
		
																<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Canadian Pacific</dd>
							
							<dd class="profile-contact">
				<strong>Contact:</strong>
				<div class="dropdown-container dropdown-left">
					<a href="#" class="dropdown-trigger" title="Contact orange_batch">
						<i class="icon fa-commenting-o fa-fw icon-lg" aria-hidden="true"></i><span class="sr-only">Contact orange_batch</span>
					</a>
					<div class="dropdown">
						<div class="pointer"><div class="pointer-inner"></div></div>
						<div class="dropdown-contents contact-icons">
																																								<div>
																	<a href="http://ss64.com/nt/" title="Website" class="last-cell">
										<span class="contact-icon phpbb_website-icon">Website</span>
									</a>
																	</div>
																					</div>
					</div>
				</div>
			</dd>
				
		</dl>

		<div class="postbody">
						<div id="post_content5536">

						<h3 ><a href="#p5536">Re: strLen boosted</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting4d11.html?mode=quote&amp;f=3&amp;p=5536" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicfe5d.html?p=5536#p5536" onclick="prompt('Message #11',this.href); return false;">#11</a></span> 
									<a class="unread" href="viewtopicfe5d.html?p=5536#p5536" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist941f.html?mode=viewprofile&amp;u=1572" class="username">orange_batch</a></strong> &raquo; </span>21 Nov 2010 15:50
			</p>
			
			
			
			<div class="content">Nice work guys. I'll be the first to admit I suck with any functional relationship involving logical shifts and bitwise operations. <img class="smilies" src="images/smilies/icon_sad.gif" alt=":(" title="Sad" /><br />I know what they do, I just don't know how to apply them...<br /><br />This is DosItHelp's script cut down. Could somebody teach me the thought process behind this?<br /><br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>set &quot;str=A!any_variable!&quot;<br />set &quot;len=0&quot;<br /><br />for /L %%A in (12,-1,0) do (<br />&nbsp; &nbsp; set /a &quot;len|=1&lt;&lt;%%A&quot;<br />&nbsp; &nbsp; for %%B in (!len!) do if &quot;!str:~%%B,1!&quot;==&quot;&quot; set /a &quot;len&amp;=~1&lt;&lt;%%A&quot;<br />)</code></pre></div></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p5537" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile5537">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlista6a8.html?mode=viewprofile&amp;u=5" class="username">DosItHelp</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search5648.html?author_id=5&amp;sr=posts">239</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 18 Feb 2006 19:54</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content5537">

						<h3 ><a href="#p5537">Re: strLen boosted</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postinga5e0.html?mode=quote&amp;f=3&amp;p=5537" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopicf118.html?p=5537#p5537" onclick="prompt('Message #12',this.href); return false;">#12</a></span> 
									<a class="unread" href="viewtopicf118.html?p=5537#p5537" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlista6a8.html?mode=viewprofile&amp;u=5" class="username">DosItHelp</a></strong> &raquo; </span>22 Nov 2010 00:32
			</p>
			
			
			
			<div class="content">Sure...<br /><br /><strong class="text-strong">In short:</strong><br />The value for the len variable is build successively by setting its binary bits using a loop and trial-and-error.<br />The loop loops 13 times.  Each time looping a different bit is being decided on.  The first loop decides about bit 12 (4096) of the len value the next about bit 11 (2048) working all the way down until the final loop decides about bit 0 (1).<br />During each loop the bit to be decided on is blindly being set (trial) causing the len variable to increase according to this bit position.  A subsequent check tests if this bit caused the len variable now to become too large, in which case (error) the bit will be cleared again, otherwise it will stay.  Then we move on to the next smaller bit position.<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>decimal binary<br />------------------------<br />&nbsp; &nbsp; &nbsp; &nbsp; 5432109876543210 <br />4096 =&nbsp; 0001000000000000<br />2048 =&nbsp; 0000100000000000<br />1024 =&nbsp; 0000010000000000<br />.512 =&nbsp; 0000001000000000<br />.256 =&nbsp; 0000000100000000<br />.128 =&nbsp; 0000000010000000<br />..64 =&nbsp; 0000000001000000<br />..32 =&nbsp; 0000000000100000<br />..16 =&nbsp; 0000000000010000<br />...8 =&nbsp; 0000000000001000<br />...4 =&nbsp; 0000000000000100<br />...2 =&nbsp; 0000000000000010<br />...1 =&nbsp; 0000000000000001</code></pre></div><br />The bit position is easily determined using a loop looping from 12 down to 0:<br />for /L %%A in (12,-1,0) do (<br /><br />The bit position in the len variable is set by left-shifting the number '1' according to the loop variable and applying a binary &quot;OR&quot; operator.  This effectively results in a increase of the len value according to the bit position:<br />    set /a &quot;len|=1&lt;&lt;%%A&quot;<br /><br />To overcome the limitation of double variable expansion the new len variable is then temporary being storred in another loop varaible %%B.<br />    for %%B in (!len!) do<br /><br />A subsequent check tests if a character exists at the position given by the newly calculated len variable.  If not then the string must be shorter and the bit must be cleared again.<br />    if &quot;!str:~%%B,1!&quot;==&quot;&quot; ...<br /><br />The bit is cleared (if needed) by applying a binary &quot;AND&quot; operation using a bit mask that allows all bits in len to stay execept the one that is to be cleared. <br />    set /a &quot;len&amp;=~1&lt;&lt;%%A&quot;<br /><br /><br /><strong class="text-strong">Some more background:</strong><br />The problem at hand is that the command interpreter has no native support to determine the length of a string.  However using variable-substitution it is possible to check if the string is shorter than a given length.  For example you can say: give me the 16th character in a string and if the result is 'empty' then the string must be shorter then 16 characters.<br />Great so now we can determine the string length using trial-and-error starting with 1, if 1st character returns 'empty' then string length is 0, otherwise try 2nd character, then 3rd,... all the way to the max string size of 8191.  That of course would work well (fast) for short strings but gets slower and slower the longer the string.  Its like trying to find a word in a dictionary by reading the dictionary starting from the beginning page by page, until the word is found.<br />To speed this up we take a binary search approach.<br /><br />The command interpreter supports strings that are less than 8192 characters long.  So by checking the position at half that size (8192/2=4096) we eliminate half of the possible string length.  For example if position 4096 returns 'empty' then we know the string length is less than 4096 and we don't have to check for length 4096..8191 any more.  Then we take this renaining half (0..4095) and check it right at its half at position 2048 to eliminate the next smaller half of posible string lengths.  For example if position 2084 returns not 'empty' then the string must be between 2048..4095.<br />Each loop will divide the remaining possibilities for the string length by 2, that's why its valid to say we use a binary 'search' (or 'trial-and-error') to determine the string length, and binary in this case also means efficient.<br /><br />Hope this helps <img class="smilies" src="images/smilies/icon_wink.gif" alt=";)" title="Wink" /></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p5540" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile5540">
			<dt class="has-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist941f.html?mode=viewprofile&amp;u=1572" class="username">orange_batch</a>							</dt>

						<dd class="profile-rank">Expert</dd>			
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search325b.html?author_id=1572&amp;sr=posts">442</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 01 Aug 2010 17:13</dd>		
		
																<dd class="profile-custom-field profile-phpbb_location"><strong>Location:</strong> Canadian Pacific</dd>
							
							<dd class="profile-contact">
				<strong>Contact:</strong>
				<div class="dropdown-container dropdown-left">
					<a href="#" class="dropdown-trigger" title="Contact orange_batch">
						<i class="icon fa-commenting-o fa-fw icon-lg" aria-hidden="true"></i><span class="sr-only">Contact orange_batch</span>
					</a>
					<div class="dropdown">
						<div class="pointer"><div class="pointer-inner"></div></div>
						<div class="dropdown-contents contact-icons">
																																								<div>
																	<a href="http://ss64.com/nt/" title="Website" class="last-cell">
										<span class="contact-icon phpbb_website-icon">Website</span>
									</a>
																	</div>
																					</div>
					</div>
				</div>
			</dd>
				
		</dl>

		<div class="postbody">
						<div id="post_content5540">

						<h3 ><a href="#p5540">Re: strLen boosted</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingdf05-2.html?mode=quote&amp;f=3&amp;p=5540" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic43bc.html?p=5540#p5540" onclick="prompt('Message #13',this.href); return false;">#13</a></span> 
									<a class="unread" href="viewtopic43bc.html?p=5540#p5540" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist941f.html?mode=viewprofile&amp;u=1572" class="username">orange_batch</a></strong> &raquo; </span>22 Nov 2010 03:05
			</p>
			
			
			
			<div class="content">Thanks a lot. I'll study this.<br /><br />Edit: Oh, I get it! That binary list helped a lot. Yay, now I'm not in the out-crowd. <img class="smilies" src="images/smilies/icon_cool.gif" alt="8)" title="Cool" /></div>

			
									
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p6094" class="post has-profile bg1">
		<div class="inner">

		<dl class="postprofile" id="profile6094">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist512a.html?mode=viewprofile&amp;u=1758" class="username">sowgtsoi</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search4992.html?author_id=1758&amp;sr=posts">8</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 23 Oct 2010 10:14</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content6094">

						<h3 ><a href="#p6094">Re: strLen boosted</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="posting391d.html?mode=quote&amp;f=3&amp;p=6094" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic68cd-2.html?p=6094#p6094" onclick="prompt('Message #14',this.href); return false;">#14</a></span> 
									<a class="unread" href="viewtopic68cd-2.html?p=6094#p6094" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist512a.html?mode=viewprofile&amp;u=1758" class="username">sowgtsoi</a></strong> &raquo; </span>12 Jan 2011 18:20
			</p>
			
			
			
			<div class="content">bump<br /><br />(tests' sources in the next post)<br /><br /><br />@jeb and @amel27 :<br />Fast ! As in : your use of a 'dipstick' completes in less than 66% of the time taken by a binary search <img class="smilies" src="images/smilies/icon_eek.gif" alt=":shock:" title="Shocked" />.<br /><br /><br />@DosItHelp :<br />Compared to the version with some splitting, the 20101116 version of «:strLen» completes in less than 90% of the time for short strings and less than 35% of the time for long strings !<br />Substituting «!str:~%%B!» by «!str:~%%B,1!» in the comparison is something I wish I had thought to do <img class="smilies" src="images/smilies/icon_redface.gif" alt=":oops:" title="Embarassed" />.<br /><br /><br />@all :<br />About the 8 KiB limit : there are indeed good reasons to think that it won't change anytime soon.<br /><br />Regarding the transition away from the potentially confusing «%%l» to the more legible «%%A» or «%%B», I think that <a href="http://www.codeproject.com/KB/work/FontSurvey.aspx" class="postlink">this resource</a> can be of interest.<br /><br />So .. I've tried different hybrids &quot;partial-binary-search-followed-by-a-gauging&quot; by using a handfull of dipsticks containing 16 to 1024 graduations (in the which case this baroque horror of a dipstick fills a page in its entirety).<br />Fortunately, it appears that using a 256 graduations dipstick is the sweet spot that provides the fastest results.<br />For smaller dipsticks : the binary search takes too much time / for bigger dipsticks : appending, lookup, either or both is too costly.<br />In the process, I've also found that by reordering the digits of the dipstick it was possible to avoid the duplication of the measured string.<br />I've then tried to further reduce the footprint of the dipstick by eliminating some redundancy, but to no good effect.<br /><br />All this leads to the fastest known version of «:strLen» to date :<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:: A binary search is complemented by the use of a dipstick to leverage the brutal efficiency of random access :<br />:strLen string len -- returns the length of a string<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- string &#91;in&#93;&nbsp; - variable name containing the string being measured for length<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- len&nbsp; &nbsp; &#91;out&#93; - variable to be used to return the string length<br />:: Many thanks to 'sowgtsoi', but also 'jeb' and 'amel27' dostips forum users helped making this short and efficient<br />:$created 20081122 :$changed 20101227 :$categories StringOperation<br />:$source http://www.dostips.com<br />(&nbsp; &nbsp;SETLOCAL ENABLEDELAYEDEXPANSION<br />&nbsp; &nbsp; set &quot;str=A!%~1!&quot;&amp;rem keep the A up front to ensure we get the length and not the upper bound<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem it also avoids trouble in case of empty string<br />&nbsp; &nbsp; set &quot;len=0&quot;<br />&nbsp; &nbsp; for /L %%A in (12,-1,8) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;len|=1&lt;&lt;%%A&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; for %%B in (!len!) do if &quot;!str:~%%B,1!&quot;==&quot;&quot; set /a &quot;len&amp;=~1&lt;&lt;%%A&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; for %%B in (!len!) do set str=!str:~%%B,-1!^<br />FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210^<br />FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210^<br />FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210^<br />FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210^<br />FFFFFFFFFFFFFFFFEEEEEEEEEEEEEEEEDDDDDDDDDDDDDDDDCCCCCCCCCCCCCCCC^<br />BBBBBBBBBBBBBBBBAAAAAAAAAAAAAAAA99999999999999998888888888888888^<br />7777777777777777666666666666666655555555555555554444444444444444^<br />3333333333333333222222222222222211111111111111110000000000000000<br />&nbsp; &nbsp; set /a len+=0x!str:~0x1FF,1!!str:~0xFF,1!<br />)<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~2&quot; NEQ &quot;&quot; SET /a %~2=%len%<br />)<br />EXIT /b</code></pre></div><br />Minuses :<br />The code is not as lean as the 20101116 version of «:strLen».<br /><br />Plusses :<br />Compared to the already refined 20101116 version, this end result still manages to complete for short strings in a good 90% of the previous time, and for long strings in a small 80%.<br />Custom tailoring derived versions to specific cases is for the most unchanged *and* the code already hints toward what to do for very short strings.<br /><br /><br />Thanks for your time !<br /><br /><em class="text-italics">Edit 20110116 : replaced the word 'gauge' by the fitter : 'dipstick'.</em></div>

			
													<div class="notice">
					Last edited by <a href="memberlist512a.html?mode=viewprofile&amp;u=1758" class="username">sowgtsoi</a> on 16 Jan 2011 16:50, edited 2 times in total.
									</div>
			
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
				<div id="p6095" class="post has-profile bg2">
		<div class="inner">

		<dl class="postprofile" id="profile6095">
			<dt class="no-profile-rank no-avatar">
				<div class="avatar-container">
																			</div>
								<a href="memberlist512a.html?mode=viewprofile&amp;u=1758" class="username">sowgtsoi</a>							</dt>

									
		<dd class="profile-posts"><strong>Posts:</strong> <a href="search4992.html?author_id=1758&amp;sr=posts">8</a></dd>		<dd class="profile-joined"><strong>Joined:</strong> 23 Oct 2010 10:14</dd>		
		
						
						
		</dl>

		<div class="postbody">
						<div id="post_content6095">

						<h3 ><a href="#p6095">Re: strLen boosted</a></h3>

													<ul class="post-buttons">
																																									<li>
							<a href="postingc0ac.html?mode=quote&amp;f=3&amp;p=6095" title="Reply with quote" class="button button-icon-only">
								<i class="icon fa-quote-left fa-fw" aria-hidden="true"></i><span class="sr-only">Quote</span>
							</a>
						</li>
														</ul>
							
						<p class="author"><span class="posti"><a href="viewtopic8fe7.html?p=6095#p6095" onclick="prompt('Message #15',this.href); return false;">#15</a></span> 
									<a class="unread" href="viewtopic8fe7.html?p=6095#p6095" title="Post">
						<i class="icon fa-file fa-fw icon-lightgray icon-md" aria-hidden="true"></i><span class="sr-only">Post</span>
					</a>
								<span class="responsive-hide">by <strong><a href="memberlist512a.html?mode=viewprofile&amp;u=1758" class="username">sowgtsoi</a></strong> &raquo; </span>12 Jan 2011 18:25
			</p>
			
			
			
			<div class="content">To test on an XP system or higher, copy the following files in the dedicated folder described in the second post of this thread (&quot;strLen_tests_stub.txt&quot; and &quot;strLenI_chunks.txt&quot; should be present too).<br /><br />Note : the differences in the amounts of comments of each function do have a notable impact on the accuracy of speed comparisons ; this impact is not significant though.<br /><br /><br /><br />strLen_more_tests.cmd<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>@echo off<br />:: 2011-01-08<br />SETLOCAL ENABLEDELAYEDEXPANSION<br /><br />:: always working in the directory of this script :<br />%~d0 &amp; cd &quot;%~dp0&quot;<br /><br />:: setup :<br />if not exist logs\ mkdir logs<br />if exist tmp\ rmdir /S /Q tmp<br />mkdir tmp<br />for %%v in (<br />&nbsp; &nbsp; I_chunks<br />&nbsp; &nbsp; J_20101116<br />&nbsp; &nbsp; K_dipstickAlone<br />&nbsp; &nbsp; L_dipstick<br />&nbsp; &nbsp; M_dipstickDeBruijn<br />&nbsp; &nbsp; ) do (<br />&nbsp; &nbsp; type &quot;strLen_tests_stub.txt&quot; &quot;strLen%%v.txt&quot; &gt; &quot;tmp\test_strLen%%v.cmd&quot;<br />) 1&gt;nul 2&gt;nul<br /><br />:: syntactic sugar :<br />set&nbsp; &nbsp; &nbsp; &quot;test= call ^&quot;tmp\test_strLen^^!version^^!.cmd^&quot; &quot;<br />set&nbsp; &nbsp;&quot;do_test= &quot;<br />set &quot;skip_test= if 0==1 &quot;<br /><br /><br />%do_test% (echo:&amp;echo:&amp;ver&amp;echo:Unit test :<br />&nbsp; &nbsp; set &quot;version=I_chunks&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% unittest<br />&nbsp; &nbsp; set &quot;version=J_20101116&quot;&nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% unittest<br />&nbsp; &nbsp; set &quot;version=K_dipstickAlone&quot;&nbsp; &nbsp;&amp;%test% unittest<br />&nbsp; &nbsp; set &quot;version=L_dipstick&quot;&nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% unittest<br />&nbsp; &nbsp; set &quot;version=M_dipstickDeBruijn&quot;&amp;%test% unittest<br />) &gt;con<br />::&gt;&quot;logs\strLen_unittest.log&quot;<br />::&gt;con<br /><br /><br />%skip_test% (echo:&amp;echo:&amp;ver&amp;echo:Points of interest :<br />&nbsp; &nbsp; set &quot;version=I_chunks&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% correctness&nbsp; &nbsp; 0_start 8_span<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% correctness 1020_start 8_span<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% correctness 7164_start 8_span<br />&nbsp; &nbsp; set &quot;version=J_20101116&quot;&nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% correctness&nbsp; &nbsp; 0_start 8_span<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% correctness 1020_start 8_span<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% correctness 7164_start 8_span<br />&nbsp; &nbsp; set &quot;version=K_dipstickAlone&quot;&nbsp; &nbsp;&amp;%test% correctness&nbsp; &nbsp; 0_start 8_span<br />&nbsp; &nbsp; set &quot;version=L_dipstick&quot;&nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% correctness&nbsp; &nbsp; 0_start 8_span<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% correctness 1020_start 8_span<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% correctness 7164_start 8_span<br />&nbsp; &nbsp; set &quot;version=M_dipstickDeBruijn&quot;&amp;%test% correctness&nbsp; &nbsp; 0_start 8_span<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% correctness 1020_start 8_span<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% correctness 7164_start 8_span<br />) &gt;con<br />::&gt;&quot;logs\strLen_correctness_partial.log&quot;<br />::&gt;con<br /><br /><br />%do_test% (echo:&amp;echo:&amp;ver&amp;echo:Limits :<br />&nbsp; &nbsp; set &quot;version=I_chunks&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% correctness 8183_start 8_span<br />&nbsp; &nbsp; set &quot;version=J_20101116&quot;&nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% correctness 8183_start 8_span<br />&nbsp; &nbsp; set &quot;version=K_dipstickAlone&quot;&nbsp; &nbsp;&amp;%test% correctness&nbsp; 250_start 8_span<br />&nbsp; &nbsp; set &quot;version=L_dipstick&quot;&nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% correctness 8183_start 8_span<br />&nbsp; &nbsp; set &quot;version=M_dipstickDeBruijn&quot;&amp;%test% correctness 8183_start 8_span<br />) &gt;con<br />::&gt;&quot;logs\strLen_correctness_limits.log&quot;<br />::&gt;con<br /><br /><br />:: with all versions, takes 5 good minutes at 1.7 GHz :<br />%skip_test% (echo:&amp;echo:&amp;ver&amp;echo:Comprehensive testing :<br />&nbsp; &nbsp; set &quot;version=I_chunks&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% correctness 0_start 8200_span<br />&nbsp; &nbsp; set &quot;version=J_20101116&quot;&nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% correctness 0_start 8200_span<br />&nbsp; &nbsp; set &quot;version=K_dipstickAlone&quot;&nbsp; &nbsp;&amp;%test% correctness 0_start&nbsp; 260_span<br />&nbsp; &nbsp; set &quot;version=L_dipstick&quot;&nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% correctness 0_start 8200_span<br />&nbsp; &nbsp; set &quot;version=M_dipstickDeBruijn&quot;&amp;%test% correctness 0_start 8200_span<br />) &gt;&quot;logs\strLen_correctness_full_test.log&quot;<br />::&gt;&quot;logs\strLen_correctness_full_test.log&quot;<br />::&gt;con<br /><br /><br />:: with all versions, takes 5 good minutes at 1.7 GHz :<br />%skip_test% (echo:&amp;echo:&amp;echo:&amp;ver&amp;echo:Speed comparisons :&gt;con<br />&nbsp; &nbsp; echo:&amp;set &quot;version=I_chunks&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; rem &quot;warm up&quot; done.<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 250_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 500_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 750_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 1000_start 1000_span 2_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 2000_start 1000_span 2_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 7000_start 1000_span 2_times<br />&nbsp; &nbsp; echo:&amp;set &quot;version=J_20101116&quot;&nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 250_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 500_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 750_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 1000_start 1000_span 2_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 2000_start 1000_span 2_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 7000_start 1000_span 2_times<br />&nbsp; &nbsp; echo:&amp;set &quot;version=K_dipstickAlone&quot;&nbsp; &nbsp;&amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; echo:&amp;set &quot;version=L_dipstick&quot;&nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 250_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 500_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 750_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 1000_start 1000_span 2_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 2000_start 1000_span 2_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 7000_start 1000_span 2_times<br />&nbsp; &nbsp; echo:&amp;set &quot;version=M_dipstickDeBruijn&quot;&amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 250_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 500_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed&nbsp; 750_start&nbsp; 250_span 8_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 1000_start 1000_span 2_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 2000_start 1000_span 2_times<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;%test% speed 7000_start 1000_span 2_times<br />&nbsp; &nbsp; rem to check consistency, the first test is repeated :<br />&nbsp; &nbsp; echo:&amp;set &quot;version=I_chunks&quot;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;%test% speed&nbsp; &nbsp; 0_start&nbsp; 250_span 8_times<br />) &gt;&gt;&quot;logs\strLen_speed_comparisons.log&quot;<br />::&gt;&gt;&quot;logs\strLen_speed_comparisons.log&quot;<br />::&gt;con<br /><br /><br />:: cleaning :<br />if exist tmp\ rmdir /S /Q tmp<br />echo:<br />echo:<br />echo:strLen tests : completed.<br />pause<br />ENDLOCAL<br />@echo on<br />@EXIT /b</code></pre></div><br /><br /><br />strLenJ_20101116.txt<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:strLen string len -- returns the length of a string<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- string &#91;in&#93;&nbsp; - variable name containing the string being measured for length<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- len&nbsp; &nbsp; &#91;out&#93; - variable to be used to return the string length<br />:: Many thanks to 'sowgtsoi', but also 'jeb' and 'amel27' dostips forum users helped making this short and efficient<br />:$created 20081122 :$changed 20101116 :$categories StringOperation<br />:$source http://www.dostips.com<br />(&nbsp; &nbsp;SETLOCAL ENABLEDELAYEDEXPANSION<br />&nbsp; &nbsp; set &quot;str=A!%~1!&quot;&amp;rem keep the A up front to ensure we get the length and not the upper bound<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem it also avoids trouble in case of empty string<br />&nbsp; &nbsp; set &quot;len=0&quot;<br />&nbsp; &nbsp; for /L %%A in (12,-1,0) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;len|=1&lt;&lt;%%A&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; for %%B in (!len!) do if &quot;!str:~%%B,1!&quot;==&quot;&quot; set /a &quot;len&amp;=~1&lt;&lt;%%A&quot;<br />&nbsp; &nbsp; )<br />)<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~2&quot; NEQ &quot;&quot; SET /a %~2=%len%<br />)<br />EXIT /b</code></pre></div><br /><br /><br />strLenK_dipstickAlone.txt<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:strLen<br />( SETLOCAL ENABLEDELAYEDEXPANSION<br />&nbsp; &nbsp; set tmp=!%~1!^<br />FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210^<br />FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210^<br />FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210^<br />FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210^<br />FFFFFFFFFFFFFFFFEEEEEEEEEEEEEEEEDDDDDDDDDDDDDDDDCCCCCCCCCCCCCCCC^<br />BBBBBBBBBBBBBBBBAAAAAAAAAAAAAAAA99999999999999998888888888888888^<br />7777777777777777666666666666666655555555555555554444444444444444^<br />3333333333333333222222222222222211111111111111110000000000000000<br />&nbsp; &nbsp; set /a len=0x!tmp:~0x1FF,1!!tmp:~0xFF,1!<br />)<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~2&quot; NEQ &quot;&quot; SET &quot;%~2=%len%&quot;<br />)<br />EXIT /b</code></pre></div><br /><br /><br />strLenL_dipstick.txt<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:: A binary search is complemented by the use of a dipstick to leverage the brutal efficiency of random access :<br />:strLen string len -- returns the length of a string<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- string &#91;in&#93;&nbsp; - variable name containing the string being measured for length<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- len&nbsp; &nbsp; &#91;out&#93; - variable to be used to return the string length<br />:: Many thanks to 'sowgtsoi', but also 'jeb' and 'amel27' dostips forum users helped making this short and efficient<br />:$created 20081122 :$changed 20101227 :$categories StringOperation<br />:$source http://www.dostips.com<br />(&nbsp; &nbsp;SETLOCAL ENABLEDELAYEDEXPANSION<br />&nbsp; &nbsp; set &quot;str=A!%~1!&quot;&amp;rem keep the A up front to ensure we get the length and not the upper bound<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem it also avoids trouble in case of empty string<br />&nbsp; &nbsp; set &quot;len=0&quot;<br />&nbsp; &nbsp; for /L %%A in (12,-1,8) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;len|=1&lt;&lt;%%A&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; for %%B in (!len!) do if &quot;!str:~%%B,1!&quot;==&quot;&quot; set /a &quot;len&amp;=~1&lt;&lt;%%A&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; for %%B in (!len!) do set str=!str:~%%B,-1!^<br />FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210^<br />FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210^<br />FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210^<br />FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210FEDCBA9876543210^<br />FFFFFFFFFFFFFFFFEEEEEEEEEEEEEEEEDDDDDDDDDDDDDDDDCCCCCCCCCCCCCCCC^<br />BBBBBBBBBBBBBBBBAAAAAAAAAAAAAAAA99999999999999998888888888888888^<br />7777777777777777666666666666666655555555555555554444444444444444^<br />3333333333333333222222222222222211111111111111110000000000000000<br />&nbsp; &nbsp; set /a len+=0x!str:~0x1FF,1!!str:~0xFF,1!<br />)<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~2&quot; NEQ &quot;&quot; SET /a %~2=%len%<br />)<br />EXIT /b</code></pre></div><br /><br /><br />strLenM_dipstickDeBruijn.txt<br /><div class="codebox"><p>Code: <a href="#" onclick="selectCode(this); return false;">Select all</a></p><pre><code>:: Unfruitful attempt at using a smaller dipstick, a &quot;B(16,2) De Bruijn sequence&quot;, crafted by<br />::&nbsp; &nbsp;listing the 256 hexadecimal pairs in decreasing order, and by removing the redundancies.<br />:: Each sliding pair in the dipstick now appears once only and there remains 256 of them :<br />::&nbsp; &nbsp;each can be seen as a unique encoding of its index.<br />:: To simplify the decoding, the used dipstick is rotated rightward once.<br />:: Here, the decoding computations do not manage to clearly beat random access, speedwise.<br />:strLen string len -- returns the length of a string<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- string &#91;in&#93;&nbsp; - variable name containing the string being measured for length<br />::&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;-- len&nbsp; &nbsp; &#91;out&#93; - variable to be used to return the string length<br />(&nbsp; &nbsp;SETLOCAL ENABLEDELAYEDEXPANSION<br />&nbsp; &nbsp; set &quot;str=A!%~1!&quot;&amp;rem keep the A up front to ensure we get the length and not the upper bound<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;rem it also avoids trouble in case of empty string<br />&nbsp; &nbsp; set &quot;len=0&quot;<br />&nbsp; &nbsp; for /L %%A in (12,-1,8) do (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;len|=1&lt;&lt;%%A&quot;<br />&nbsp; &nbsp; &nbsp; &nbsp; for %%B in (!len!) do if &quot;!str:~%%B,1!&quot;==&quot;&quot; set /a &quot;len&amp;=~1&lt;&lt;%%A&quot;<br />&nbsp; &nbsp; )<br />&nbsp; &nbsp; for %%B in (!len!) do set str=!str:~%%B,-1!^<br />0FFEFDFCFBFAF9F8F7F6F5F4F3F2F1F^<br />0EEDECEBEAE9E8E7E6E5E4E3E2E1E^<br />0DDCDBDAD9D8D7D6D5D4D3D2D1D^<br />0CCBCAC9C8C7C6C5C4C3C2C1C^<br />0BBAB9B8B7B6B5B4B3B2B1B^<br />0AA9A8A7A6A5A4A3A2A1A^<br />0998979695949392919^<br />08878685848382818^<br />077675747372717^<br />0665646362616^<br />05545352515^<br />044342414^<br />0332313^<br />02212^<br />011^<br />00<br />&nbsp; &nbsp; set /a &quot;bruijn=0x!str:~0xFF,2!, sixteenth=bruijn&gt;&gt;4, domain=bruijn-(sixteenth&lt;&lt;4|sixteenth)&quot;<br />&nbsp; &nbsp; if !domain! LSS 0 (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;len+=sixteenth*sixteenth+((0xF&amp;bruijn)&lt;&lt;1)&quot;<br />&nbsp; &nbsp; ) else (<br />&nbsp; &nbsp; &nbsp; &nbsp; set /a &quot;abscissa=(0xF&amp;bruijn)-1+^!sixteenth, len+=(sixteenth&lt;&lt;1)+abscissa*(abscissa+2)&quot;<br />&nbsp; &nbsp; )<br />)<br />( ENDLOCAL &amp; REM RETURN VALUES<br />&nbsp; &nbsp; IF &quot;%~2&quot; NEQ &quot;&quot; SET /a %~2=%len%<br />)<br />EXIT /b</code></pre></div><br /><br /><br />Aaaand that should be all !<br /><br /><em class="text-italics">Edit 20110116 : replaced the word 'gauge' by the fitter : 'dipstick'.</em></div>

			
													<div class="notice">
					Last edited by <a href="memberlist512a.html?mode=viewprofile&amp;u=1758" class="username">sowgtsoi</a> on 16 Jan 2011 16:55, edited 1 time in total.
									</div>
			
									
						</div>

		</div>

				<div class="back2top">
						<a href="#top" class="top" title="Top">
				<i class="icon fa-chevron-circle-up fa-fw icon-gray" aria-hidden="true"></i>
				<span class="sr-only">Top</span>
			</a>
					</div>
		
		</div>
	</div>

	<hr class="divider" />
	

	<div class="action-bar bar-bottom">
	
			<a href="postingd154.html?mode=reply&amp;f=3&amp;t=1429" class="button" title="Post a reply">
							<span>Post Reply</span> <i class="icon fa-reply fa-fw" aria-hidden="true"></i>
					</a>
		
		<div class="dropdown-container dropdown-button-control topic-tools">
		<span title="Topic tools" class="button button-secondary dropdown-trigger dropdown-select">
			<i class="icon fa-wrench fa-fw" aria-hidden="true"></i>
			<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
		</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																												<li>
					<a href="viewtopicab81.html?f=3&amp;t=1429&amp;view=print" title="Print view" accesskey="p">
						<i class="icon fa-print fa-fw" aria-hidden="true"></i><span>Print view</span>
					</a>
				</li>
											</ul>
		</div>
	</div>

			<form method="post" action="https://www.dostips.com/forum/viewtopic.php?f=3&amp;t=1429">
		<div class="dropdown-container dropdown-container-left dropdown-button-control sort-tools">
	<span title="Display and sorting options" class="button button-secondary dropdown-trigger dropdown-select">
		<i class="icon fa-sort-amount-asc fa-fw" aria-hidden="true"></i>
		<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
	</span>
	<div class="dropdown hidden">
		<div class="pointer"><div class="pointer-inner"></div></div>
		<div class="dropdown-contents">
			<fieldset class="display-options">
							<label>Display: <select name="st" id="st"><option value="0" selected="selected">All posts</option><option value="1">1 day</option><option value="7">7 days</option><option value="14">2 weeks</option><option value="30">1 month</option><option value="90">3 months</option><option value="180">6 months</option><option value="365">1 year</option></select></label>
								<label>Sort by: <select name="sk" id="sk"><option value="a">Author</option><option value="t" selected="selected">Post time</option><option value="s">Subject</option></select></label>
				<label>Direction: <select name="sd" id="sd"><option value="a" selected="selected">Ascending</option><option value="d">Descending</option></select></label>
								<hr class="dashed" />
				<input type="submit" class="button2" name="sort" value="Go" />
						</fieldset>
		</div>
	</div>
</div>
		</form>
	
	
	
			<div class="pagination">
			25 posts
							<ul>
		<li class="active"><span>1</span></li>
				<li><a class="button" href="viewtopice19a.html?f=3&amp;t=1429&amp;start=15" role="button">2</a></li>
				<li class="arrow next"><a class="button button-icon-only" href="viewtopice19a.html?f=3&amp;t=1429&amp;start=15" rel="next" role="button"><i class="icon fa-chevron-right fa-fw" aria-hidden="true"></i><span class="sr-only">Next</span></a></li>
	</ul>
					</div>
	</div>


<div class="action-bar actions-jump">
		<p class="jumpbox-return">
		<a href="viewforum4d6b.html?f=3" class="left-box arrow-left" accesskey="r">
			<i class="icon fa-angle-left fa-fw icon-black" aria-hidden="true"></i><span>Return to “DOS Batch Forum”</span>
		</a>
	</p>
	
		<div class="jumpbox dropdown-container dropdown-container-right dropdown-up dropdown-left dropdown-button-control" id="jumpbox">
			<span title="Jump to" class="button button-secondary dropdown-trigger dropdown-select">
				<span>Jump to</span>
				<span class="caret"><i class="icon fa-sort-down fa-fw" aria-hidden="true"></i></span>
			</span>
		<div class="dropdown">
			<div class="pointer"><div class="pointer-inner"></div></div>
			<ul class="dropdown-contents">
																				<li><a href="viewforum31e6.html?f=4" class="jumpbox-cat-link"> <span> DosTips - Dos Batch</span></a></li>
																<li><a href="viewforum4d6b.html?f=3" class="jumpbox-sub-link"><span class="spacer"></span> <span>&#8627; &nbsp; DOS Batch Forum</span></a></li>
											</ul>
		</div>
	</div>

	</div>


			</div>


<div id="page-footer" class="page-footer" role="contentinfo">
	<div class="navbar" role="navigation">
	<div class="inner">

	<ul id="nav-footer" class="nav-footer linklist" role="menubar">
		<li class="breadcrumbs">
							<span class="crumb"><a href="../index.html" data-navbar-reference="home"><i class="icon fa-home fa-fw" aria-hidden="true"></i><span>DosTips.com</span></a></span>									<span class="crumb"><a href="index.html" data-navbar-reference="index"><span>Board index</span></a></span>					</li>
		
				<li class="rightside">All times are <span title="UTC-6">UTC-06:00</span></li>
							<li class="rightside">
				<a href="ucp033a.html?mode=delete_cookies" data-ajax="true" data-refresh="true" role="menuitem">
					<i class="icon fa-trash fa-fw" aria-hidden="true"></i><span>Delete all board cookies</span>
				</a>
			</li>
												<li class="rightside" data-last-responsive="true">
				<a href="memberlist4bfd.html?mode=team" role="menuitem">
					<i class="icon fa-shield fa-fw" aria-hidden="true"></i><span>The team</span>
				</a>
			</li>
									<li class="rightside" data-last-responsive="true">
				<a href="memberlist8733.html?mode=contactadmin" role="menuitem">
					<i class="icon fa-envelope fa-fw" aria-hidden="true"></i><span>Contact us</span>
				</a>
			</li>
			</ul>

	</div>
</div>

	<div class="copyright">
				<!-- WARNING NO DELETE -->Style developer by <a href="http://tricolor.x-tk.ru/">support forum tricolor</a>, <!-- END WARNING NO DELETE -->Powered by <a href="https://www.phpbb.com/">phpBB</a>&reg; Forum Software &copy; phpBB Limited
									</div>

	<div id="darkenwrapper" class="darkenwrapper" data-ajax-error-title="AJAX error" data-ajax-error-text="Something went wrong when processing your request." data-ajax-error-text-abort="User aborted request." data-ajax-error-text-timeout="Your request timed out; please try again." data-ajax-error-text-parsererror="Something went wrong with the request and the server returned an invalid reply.">
		<div id="darken" class="darken">&nbsp;</div>
	</div>

	<div id="phpbb_alert" class="phpbb_alert" data-l-err="Error" data-l-timeout-processing-req="Request timed out.">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<h3 class="alert_title">&nbsp;</h3><p class="alert_text"></p>
	</div>
	<div id="phpbb_confirm" class="phpbb_alert">
		<a href="#" class="alert_close">
			<i class="icon fa-times-circle fa-fw" aria-hidden="true"></i>
		</a>
		<div class="alert_text"></div>
	</div>
</div>

</div>

<div>
	<a id="bottom" class="anchor" accesskey="z"></a>
	<img src="cronc6bf.gif?cron_type=cron.task.text_reparser.user_signature" width="1" height="1" alt="cron" /></div>

<script type="text/javascript" src="assets/javascript/jquery.mind772.js?assets_version=34"></script>
<script type="text/javascript" src="assets/javascript/cored772.js?assets_version=34"></script>



<script type="text/javascript" src="styles/prosilver/template/forum_fnd772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/prosilver/template/ajaxd772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/AllanStyle-SUBSILVER/template/jquery-uid772.js?assets_version=34"></script>
<script type="text/javascript" src="styles/AllanStyle-SUBSILVER/template/collapsed772.js?assets_version=34"></script>



</body>

<!-- Mirrored from www.dostips.com/forum/viewtopic.php?p=5385 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 19 Oct 2018 08:01:22 GMT -->
</html>
